(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();var kd={exports:{}},Ro={};var O0;function Uw(){if(O0)return Ro;O0=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(i,s,r){var l=null;if(r!==void 0&&(l=""+r),s.key!==void 0&&(l=""+s.key),"key"in s){r={};for(var c in s)c!=="key"&&(r[c]=s[c])}else r=s;return s=r.ref,{$$typeof:n,type:i,key:l,ref:s!==void 0?s:null,props:r}}return Ro.Fragment=t,Ro.jsx=e,Ro.jsxs=e,Ro}var I0;function Fw(){return I0||(I0=1,kd.exports=Uw()),kd.exports}var qt=Fw(),Nd={exports:{}},Co={},Bd={exports:{}},Ud={};var P0;function Lw(){return P0||(P0=1,(function(n){function t($,it){var ht=$.length;$.push(it);t:for(;0<ht;){var Pt=ht-1>>>1,Ot=$[Pt];if(0<s(Ot,it))$[Pt]=it,$[ht]=Ot,ht=Pt;else break t}}function e($){return $.length===0?null:$[0]}function i($){if($.length===0)return null;var it=$[0],ht=$.pop();if(ht!==it){$[0]=ht;t:for(var Pt=0,Ot=$.length,P=Ot>>>1;Pt<P;){var Q=2*(Pt+1)-1,st=$[Q],lt=Q+1,_t=$[lt];if(0>s(st,ht))lt<Ot&&0>s(_t,st)?($[Pt]=_t,$[lt]=ht,Pt=lt):($[Pt]=st,$[Q]=ht,Pt=Q);else if(lt<Ot&&0>s(_t,ht))$[Pt]=_t,$[lt]=ht,Pt=lt;else break t}}return it}function s($,it){var ht=$.sortIndex-it.sortIndex;return ht!==0?ht:$.id-it.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;n.unstable_now=function(){return r.now()}}else{var l=Date,c=l.now();n.unstable_now=function(){return l.now()-c}}var f=[],d=[],p=1,_=null,y=3,b=!1,x=!1,T=!1,A=!1,E=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;function O($){for(var it=e(d);it!==null;){if(it.callback===null)i(d);else if(it.startTime<=$)i(d),it.sortIndex=it.expirationTime,t(f,it);else break;it=e(d)}}function k($){if(T=!1,O($),!x)if(e(f)!==null)x=!0,z||(z=!0,ot());else{var it=e(d);it!==null&&mt(k,it.startTime-$)}}var z=!1,Y=-1,q=5,G=-1;function at(){return A?!0:!(n.unstable_now()-G<q)}function nt(){if(A=!1,z){var $=n.unstable_now();G=$;var it=!0;try{t:{x=!1,T&&(T=!1,D(Y),Y=-1),b=!0;var ht=y;try{e:{for(O($),_=e(f);_!==null&&!(_.expirationTime>$&&at());){var Pt=_.callback;if(typeof Pt=="function"){_.callback=null,y=_.priorityLevel;var Ot=Pt(_.expirationTime<=$);if($=n.unstable_now(),typeof Ot=="function"){_.callback=Ot,O($),it=!0;break e}_===e(f)&&i(f),O($)}else i(f);_=e(f)}if(_!==null)it=!0;else{var P=e(d);P!==null&&mt(k,P.startTime-$),it=!1}}break t}finally{_=null,y=ht,b=!1}it=void 0}}finally{it?ot():z=!1}}}var ot;if(typeof C=="function")ot=function(){C(nt)};else if(typeof MessageChannel<"u"){var xt=new MessageChannel,dt=xt.port2;xt.port1.onmessage=nt,ot=function(){dt.postMessage(null)}}else ot=function(){E(nt,0)};function mt($,it){Y=E(function(){$(n.unstable_now())},it)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function($){$.callback=null},n.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<$?Math.floor(1e3/$):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_next=function($){switch(y){case 1:case 2:case 3:var it=3;break;default:it=y}var ht=y;y=it;try{return $()}finally{y=ht}},n.unstable_requestPaint=function(){A=!0},n.unstable_runWithPriority=function($,it){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var ht=y;y=$;try{return it()}finally{y=ht}},n.unstable_scheduleCallback=function($,it,ht){var Pt=n.unstable_now();switch(typeof ht=="object"&&ht!==null?(ht=ht.delay,ht=typeof ht=="number"&&0<ht?Pt+ht:Pt):ht=Pt,$){case 1:var Ot=-1;break;case 2:Ot=250;break;case 5:Ot=1073741823;break;case 4:Ot=1e4;break;default:Ot=5e3}return Ot=ht+Ot,$={id:p++,callback:it,priorityLevel:$,startTime:ht,expirationTime:Ot,sortIndex:-1},ht>Pt?($.sortIndex=ht,t(d,$),e(f)===null&&$===e(d)&&(T?(D(Y),Y=-1):T=!0,mt(k,ht-Pt))):($.sortIndex=Ot,t(f,$),x||b||(x=!0,z||(z=!0,ot()))),$},n.unstable_shouldYield=at,n.unstable_wrapCallback=function($){var it=y;return function(){var ht=y;y=it;try{return $.apply(this,arguments)}finally{y=ht}}}})(Ud)),Ud}var D0;function zw(){return D0||(D0=1,Bd.exports=Lw()),Bd.exports}var Fd={exports:{}},bt={};var k0;function Vw(){if(k0)return bt;k0=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),y=Symbol.iterator;function b(P){return P===null||typeof P!="object"?null:(P=y&&P[y]||P["@@iterator"],typeof P=="function"?P:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,A={};function E(P,Q,st){this.props=P,this.context=Q,this.refs=A,this.updater=st||x}E.prototype.isReactComponent={},E.prototype.setState=function(P,Q){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,Q,"setState")},E.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function D(){}D.prototype=E.prototype;function C(P,Q,st){this.props=P,this.context=Q,this.refs=A,this.updater=st||x}var O=C.prototype=new D;O.constructor=C,T(O,E.prototype),O.isPureReactComponent=!0;var k=Array.isArray;function z(){}var Y={H:null,A:null,T:null,S:null},q=Object.prototype.hasOwnProperty;function G(P,Q,st){var lt=st.ref;return{$$typeof:n,type:P,key:Q,ref:lt!==void 0?lt:null,props:st}}function at(P,Q){return G(P.type,Q,P.props)}function nt(P){return typeof P=="object"&&P!==null&&P.$$typeof===n}function ot(P){var Q={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(st){return Q[st]})}var xt=/\/+/g;function dt(P,Q){return typeof P=="object"&&P!==null&&P.key!=null?ot(""+P.key):Q.toString(36)}function mt(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(z,z):(P.status="pending",P.then(function(Q){P.status==="pending"&&(P.status="fulfilled",P.value=Q)},function(Q){P.status==="pending"&&(P.status="rejected",P.reason=Q)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function $(P,Q,st,lt,_t){var yt=typeof P;(yt==="undefined"||yt==="boolean")&&(P=null);var Lt=!1;if(P===null)Lt=!0;else switch(yt){case"bigint":case"string":case"number":Lt=!0;break;case"object":switch(P.$$typeof){case n:case t:Lt=!0;break;case p:return Lt=P._init,$(Lt(P._payload),Q,st,lt,_t)}}if(Lt)return _t=_t(P),Lt=lt===""?"."+dt(P,0):lt,k(_t)?(st="",Lt!=null&&(st=Lt.replace(xt,"$&/")+"/"),$(_t,Q,st,"",function(Da){return Da})):_t!=null&&(nt(_t)&&(_t=at(_t,st+(_t.key==null||P&&P.key===_t.key?"":(""+_t.key).replace(xt,"$&/")+"/")+Lt)),Q.push(_t)),1;Lt=0;var Ve=lt===""?".":lt+":";if(k(P))for(var ce=0;ce<P.length;ce++)lt=P[ce],yt=Ve+dt(lt,ce),Lt+=$(lt,Q,st,yt,_t);else if(ce=b(P),typeof ce=="function")for(P=ce.call(P),ce=0;!(lt=P.next()).done;)lt=lt.value,yt=Ve+dt(lt,ce++),Lt+=$(lt,Q,st,yt,_t);else if(yt==="object"){if(typeof P.then=="function")return $(mt(P),Q,st,lt,_t);throw Q=String(P),Error("Objects are not valid as a React child (found: "+(Q==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":Q)+"). If you meant to render a collection of children, use an array instead.")}return Lt}function it(P,Q,st){if(P==null)return P;var lt=[],_t=0;return $(P,lt,"","",function(yt){return Q.call(st,yt,_t++)}),lt}function ht(P){if(P._status===-1){var Q=P._result;Q=Q(),Q.then(function(st){(P._status===0||P._status===-1)&&(P._status=1,P._result=st)},function(st){(P._status===0||P._status===-1)&&(P._status=2,P._result=st)}),P._status===-1&&(P._status=0,P._result=Q)}if(P._status===1)return P._result.default;throw P._result}var Pt=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(Q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)},Ot={map:it,forEach:function(P,Q,st){it(P,function(){Q.apply(this,arguments)},st)},count:function(P){var Q=0;return it(P,function(){Q++}),Q},toArray:function(P){return it(P,function(Q){return Q})||[]},only:function(P){if(!nt(P))throw Error("React.Children.only expected to receive a single React element child.");return P}};return bt.Activity=_,bt.Children=Ot,bt.Component=E,bt.Fragment=e,bt.Profiler=s,bt.PureComponent=C,bt.StrictMode=i,bt.Suspense=f,bt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Y,bt.__COMPILER_RUNTIME={__proto__:null,c:function(P){return Y.H.useMemoCache(P)}},bt.cache=function(P){return function(){return P.apply(null,arguments)}},bt.cacheSignal=function(){return null},bt.cloneElement=function(P,Q,st){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var lt=T({},P.props),_t=P.key;if(Q!=null)for(yt in Q.key!==void 0&&(_t=""+Q.key),Q)!q.call(Q,yt)||yt==="key"||yt==="__self"||yt==="__source"||yt==="ref"&&Q.ref===void 0||(lt[yt]=Q[yt]);var yt=arguments.length-2;if(yt===1)lt.children=st;else if(1<yt){for(var Lt=Array(yt),Ve=0;Ve<yt;Ve++)Lt[Ve]=arguments[Ve+2];lt.children=Lt}return G(P.type,_t,lt)},bt.createContext=function(P){return P={$$typeof:l,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:r,_context:P},P},bt.createElement=function(P,Q,st){var lt,_t={},yt=null;if(Q!=null)for(lt in Q.key!==void 0&&(yt=""+Q.key),Q)q.call(Q,lt)&&lt!=="key"&&lt!=="__self"&&lt!=="__source"&&(_t[lt]=Q[lt]);var Lt=arguments.length-2;if(Lt===1)_t.children=st;else if(1<Lt){for(var Ve=Array(Lt),ce=0;ce<Lt;ce++)Ve[ce]=arguments[ce+2];_t.children=Ve}if(P&&P.defaultProps)for(lt in Lt=P.defaultProps,Lt)_t[lt]===void 0&&(_t[lt]=Lt[lt]);return G(P,yt,_t)},bt.createRef=function(){return{current:null}},bt.forwardRef=function(P){return{$$typeof:c,render:P}},bt.isValidElement=nt,bt.lazy=function(P){return{$$typeof:p,_payload:{_status:-1,_result:P},_init:ht}},bt.memo=function(P,Q){return{$$typeof:d,type:P,compare:Q===void 0?null:Q}},bt.startTransition=function(P){var Q=Y.T,st={};Y.T=st;try{var lt=P(),_t=Y.S;_t!==null&&_t(st,lt),typeof lt=="object"&&lt!==null&&typeof lt.then=="function"&&lt.then(z,Pt)}catch(yt){Pt(yt)}finally{Q!==null&&st.types!==null&&(Q.types=st.types),Y.T=Q}},bt.unstable_useCacheRefresh=function(){return Y.H.useCacheRefresh()},bt.use=function(P){return Y.H.use(P)},bt.useActionState=function(P,Q,st){return Y.H.useActionState(P,Q,st)},bt.useCallback=function(P,Q){return Y.H.useCallback(P,Q)},bt.useContext=function(P){return Y.H.useContext(P)},bt.useDebugValue=function(){},bt.useDeferredValue=function(P,Q){return Y.H.useDeferredValue(P,Q)},bt.useEffect=function(P,Q){return Y.H.useEffect(P,Q)},bt.useEffectEvent=function(P){return Y.H.useEffectEvent(P)},bt.useId=function(){return Y.H.useId()},bt.useImperativeHandle=function(P,Q,st){return Y.H.useImperativeHandle(P,Q,st)},bt.useInsertionEffect=function(P,Q){return Y.H.useInsertionEffect(P,Q)},bt.useLayoutEffect=function(P,Q){return Y.H.useLayoutEffect(P,Q)},bt.useMemo=function(P,Q){return Y.H.useMemo(P,Q)},bt.useOptimistic=function(P,Q){return Y.H.useOptimistic(P,Q)},bt.useReducer=function(P,Q,st){return Y.H.useReducer(P,Q,st)},bt.useRef=function(P){return Y.H.useRef(P)},bt.useState=function(P){return Y.H.useState(P)},bt.useSyncExternalStore=function(P,Q,st){return Y.H.useSyncExternalStore(P,Q,st)},bt.useTransition=function(){return Y.H.useTransition()},bt.version="19.2.0",bt}var N0;function xg(){return N0||(N0=1,Fd.exports=Vw()),Fd.exports}var Ld={exports:{}},Ne={};var B0;function Hw(){if(B0)return Ne;B0=1;var n=xg();function t(f){var d="https://react.dev/errors/"+f;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)d+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+f+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var i={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},s=Symbol.for("react.portal");function r(f,d,p){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:_==null?null:""+_,children:f,containerInfo:d,implementation:p}}var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(f,d){if(f==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Ne.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Ne.createPortal=function(f,d){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(t(299));return r(f,d,null,p)},Ne.flushSync=function(f){var d=l.T,p=i.p;try{if(l.T=null,i.p=2,f)return f()}finally{l.T=d,i.p=p,i.d.f()}},Ne.preconnect=function(f,d){typeof f=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,i.d.C(f,d))},Ne.prefetchDNS=function(f){typeof f=="string"&&i.d.D(f)},Ne.preinit=function(f,d){if(typeof f=="string"&&d&&typeof d.as=="string"){var p=d.as,_=c(p,d.crossOrigin),y=typeof d.integrity=="string"?d.integrity:void 0,b=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;p==="style"?i.d.S(f,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:_,integrity:y,fetchPriority:b}):p==="script"&&i.d.X(f,{crossOrigin:_,integrity:y,fetchPriority:b,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Ne.preinitModule=function(f,d){if(typeof f=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var p=c(d.as,d.crossOrigin);i.d.M(f,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&i.d.M(f)},Ne.preload=function(f,d){if(typeof f=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var p=d.as,_=c(p,d.crossOrigin);i.d.L(f,p,{crossOrigin:_,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Ne.preloadModule=function(f,d){if(typeof f=="string")if(d){var p=c(d.as,d.crossOrigin);i.d.m(f,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else i.d.m(f)},Ne.requestFormReset=function(f){i.d.r(f)},Ne.unstable_batchedUpdates=function(f,d){return f(d)},Ne.useFormState=function(f,d,p){return l.H.useFormState(f,d,p)},Ne.useFormStatus=function(){return l.H.useHostTransitionStatus()},Ne.version="19.2.0",Ne}var U0;function jw(){if(U0)return Ld.exports;U0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Ld.exports=Hw(),Ld.exports}var F0;function Ww(){if(F0)return Co;F0=1;var n=zw(),t=xg(),e=jw();function i(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function r(a){var o=a,u=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(u=o.return),a=o.return;while(a)}return o.tag===3?u:null}function l(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function c(a){if(a.tag===31){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function f(a){if(r(a)!==a)throw Error(i(188))}function d(a){var o=a.alternate;if(!o){if(o=r(a),o===null)throw Error(i(188));return o!==a?null:a}for(var u=a,h=o;;){var g=u.return;if(g===null)break;var m=g.alternate;if(m===null){if(h=g.return,h!==null){u=h;continue}break}if(g.child===m.child){for(m=g.child;m;){if(m===u)return f(g),a;if(m===h)return f(g),o;m=m.sibling}throw Error(i(188))}if(u.return!==h.return)u=g,h=m;else{for(var v=!1,S=g.child;S;){if(S===u){v=!0,u=g,h=m;break}if(S===h){v=!0,h=g,u=m;break}S=S.sibling}if(!v){for(S=m.child;S;){if(S===u){v=!0,u=m,h=g;break}if(S===h){v=!0,h=m,u=g;break}S=S.sibling}if(!v)throw Error(i(189))}}if(u.alternate!==h)throw Error(i(190))}if(u.tag!==3)throw Error(i(188));return u.stateNode.current===u?a:o}function p(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=p(a),o!==null)return o;a=a.sibling}return null}var _=Object.assign,y=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),D=Symbol.for("react.consumer"),C=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),z=Symbol.for("react.suspense_list"),Y=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),G=Symbol.for("react.activity"),at=Symbol.for("react.memo_cache_sentinel"),nt=Symbol.iterator;function ot(a){return a===null||typeof a!="object"?null:(a=nt&&a[nt]||a["@@iterator"],typeof a=="function"?a:null)}var xt=Symbol.for("react.client.reference");function dt(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===xt?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case T:return"Fragment";case E:return"Profiler";case A:return"StrictMode";case k:return"Suspense";case z:return"SuspenseList";case G:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case x:return"Portal";case C:return a.displayName||"Context";case D:return(a._context.displayName||"Context")+".Consumer";case O:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case Y:return o=a.displayName||null,o!==null?o:dt(a.type)||"Memo";case q:o=a._payload,a=a._init;try{return dt(a(o))}catch{}}return null}var mt=Array.isArray,$=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,it=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ht={pending:!1,data:null,method:null,action:null},Pt=[],Ot=-1;function P(a){return{current:a}}function Q(a){0>Ot||(a.current=Pt[Ot],Pt[Ot]=null,Ot--)}function st(a,o){Ot++,Pt[Ot]=a.current,a.current=o}var lt=P(null),_t=P(null),yt=P(null),Lt=P(null);function Ve(a,o){switch(st(yt,o),st(_t,a),st(lt,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?Jb(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=Jb(o),a=t0(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Q(lt),st(lt,a)}function ce(){Q(lt),Q(_t),Q(yt)}function Da(a){a.memoizedState!==null&&st(Lt,a);var o=lt.current,u=t0(o,a.type);o!==u&&(st(_t,a),st(lt,u))}function Al(a){_t.current===a&&(Q(lt),Q(_t)),Lt.current===a&&(Q(Lt),So._currentValue=ht)}var _f,M_;function bs(a){if(_f===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);_f=o&&o[1]||"",M_=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+_f+a+M_}var mf=!1;function yf(a,o){if(!a||mf)return"";mf=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(o){var tt=function(){throw Error()};if(Object.defineProperty(tt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(tt,[])}catch(X){var W=X}Reflect.construct(a,[],tt)}else{try{tt.call()}catch(X){W=X}a.call(tt.prototype)}}else{try{throw Error()}catch(X){W=X}(tt=a())&&typeof tt.catch=="function"&&tt.catch(function(){})}}catch(X){if(X&&W&&typeof X.stack=="string")return[X.stack,W.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=h.DetermineComponentFrameRoot(),v=m[0],S=m[1];if(v&&S){var M=v.split(`
`),j=S.split(`
`);for(g=h=0;h<M.length&&!M[h].includes("DetermineComponentFrameRoot");)h++;for(;g<j.length&&!j[g].includes("DetermineComponentFrameRoot");)g++;if(h===M.length||g===j.length)for(h=M.length-1,g=j.length-1;1<=h&&0<=g&&M[h]!==j[g];)g--;for(;1<=h&&0<=g;h--,g--)if(M[h]!==j[g]){if(h!==1||g!==1)do if(h--,g--,0>g||M[h]!==j[g]){var K=`
`+M[h].replace(" at new "," at ");return a.displayName&&K.includes("<anonymous>")&&(K=K.replace("<anonymous>",a.displayName)),K}while(1<=h&&0<=g);break}}}finally{mf=!1,Error.prepareStackTrace=u}return(u=a?a.displayName||a.name:"")?bs(u):""}function pS(a,o){switch(a.tag){case 26:case 27:case 5:return bs(a.type);case 16:return bs("Lazy");case 13:return a.child!==o&&o!==null?bs("Suspense Fallback"):bs("Suspense");case 19:return bs("SuspenseList");case 0:case 15:return yf(a.type,!1);case 11:return yf(a.type.render,!1);case 1:return yf(a.type,!0);case 31:return bs("Activity");default:return""}}function O_(a){try{var o="",u=null;do o+=pS(a,u),u=a,a=a.return;while(a);return o}catch(h){return`
Error generating stack: `+h.message+`
`+h.stack}}var bf=Object.prototype.hasOwnProperty,vf=n.unstable_scheduleCallback,xf=n.unstable_cancelCallback,gS=n.unstable_shouldYield,_S=n.unstable_requestPaint,tn=n.unstable_now,mS=n.unstable_getCurrentPriorityLevel,I_=n.unstable_ImmediatePriority,P_=n.unstable_UserBlockingPriority,wl=n.unstable_NormalPriority,yS=n.unstable_LowPriority,D_=n.unstable_IdlePriority,bS=n.log,vS=n.unstable_setDisableYieldValue,ka=null,en=null;function Di(a){if(typeof bS=="function"&&vS(a),en&&typeof en.setStrictMode=="function")try{en.setStrictMode(ka,a)}catch{}}var nn=Math.clz32?Math.clz32:SS,xS=Math.log,TS=Math.LN2;function SS(a){return a>>>=0,a===0?32:31-(xS(a)/TS|0)|0}var El=256,Rl=262144,Cl=4194304;function vs(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Ml(a,o,u){var h=a.pendingLanes;if(h===0)return 0;var g=0,m=a.suspendedLanes,v=a.pingedLanes;a=a.warmLanes;var S=h&134217727;return S!==0?(h=S&~m,h!==0?g=vs(h):(v&=S,v!==0?g=vs(v):u||(u=S&~a,u!==0&&(g=vs(u))))):(S=h&~m,S!==0?g=vs(S):v!==0?g=vs(v):u||(u=h&~a,u!==0&&(g=vs(u)))),g===0?0:o!==0&&o!==g&&(o&m)===0&&(m=g&-g,u=o&-o,m>=u||m===32&&(u&4194048)!==0)?o:g}function Na(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function AS(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function k_(){var a=Cl;return Cl<<=1,(Cl&62914560)===0&&(Cl=4194304),a}function Tf(a){for(var o=[],u=0;31>u;u++)o.push(a);return o}function Ba(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function wS(a,o,u,h,g,m){var v=a.pendingLanes;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=u,a.entangledLanes&=u,a.errorRecoveryDisabledLanes&=u,a.shellSuspendCounter=0;var S=a.entanglements,M=a.expirationTimes,j=a.hiddenUpdates;for(u=v&~u;0<u;){var K=31-nn(u),tt=1<<K;S[K]=0,M[K]=-1;var W=j[K];if(W!==null)for(j[K]=null,K=0;K<W.length;K++){var X=W[K];X!==null&&(X.lane&=-536870913)}u&=~tt}h!==0&&N_(a,h,0),m!==0&&g===0&&a.tag!==0&&(a.suspendedLanes|=m&~(v&~o))}function N_(a,o,u){a.pendingLanes|=o,a.suspendedLanes&=~o;var h=31-nn(o);a.entangledLanes|=o,a.entanglements[h]=a.entanglements[h]|1073741824|u&261930}function B_(a,o){var u=a.entangledLanes|=o;for(a=a.entanglements;u;){var h=31-nn(u),g=1<<h;g&o|a[h]&o&&(a[h]|=o),u&=~g}}function U_(a,o){var u=o&-o;return u=(u&42)!==0?1:Sf(u),(u&(a.suspendedLanes|o))!==0?0:u}function Sf(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Af(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function F_(){var a=it.p;return a!==0?a:(a=window.event,a===void 0?32:S0(a.type))}function L_(a,o){var u=it.p;try{return it.p=a,o()}finally{it.p=u}}var ki=Math.random().toString(36).slice(2),Me="__reactFiber$"+ki,$e="__reactProps$"+ki,_r="__reactContainer$"+ki,wf="__reactEvents$"+ki,ES="__reactListeners$"+ki,RS="__reactHandles$"+ki,z_="__reactResources$"+ki,Ua="__reactMarker$"+ki;function Ef(a){delete a[Me],delete a[$e],delete a[wf],delete a[ES],delete a[RS]}function mr(a){var o=a[Me];if(o)return o;for(var u=a.parentNode;u;){if(o=u[_r]||u[Me]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(a=o0(a);a!==null;){if(u=a[Me])return u;a=o0(a)}return o}a=u,u=a.parentNode}return null}function yr(a){if(a=a[Me]||a[_r]){var o=a.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return a}return null}function Fa(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(i(33))}function br(a){var o=a[z_];return o||(o=a[z_]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Ae(a){a[Ua]=!0}var V_=new Set,H_={};function xs(a,o){vr(a,o),vr(a+"Capture",o)}function vr(a,o){for(H_[a]=o,a=0;a<o.length;a++)V_.add(o[a])}var CS=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),j_={},W_={};function MS(a){return bf.call(W_,a)?!0:bf.call(j_,a)?!1:CS.test(a)?W_[a]=!0:(j_[a]=!0,!1)}function Ol(a,o,u){if(MS(o))if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var h=o.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+u)}}function Il(a,o,u){if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+u)}}function ai(a,o,u,h){if(h===null)a.removeAttribute(u);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttributeNS(o,u,""+h)}}function gn(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function $_(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function OS(a,o,u){var h=Object.getOwnPropertyDescriptor(a.constructor.prototype,o);if(!a.hasOwnProperty(o)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var g=h.get,m=h.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return g.call(this)},set:function(v){u=""+v,m.call(this,v)}}),Object.defineProperty(a,o,{enumerable:h.enumerable}),{getValue:function(){return u},setValue:function(v){u=""+v},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function Rf(a){if(!a._valueTracker){var o=$_(a)?"checked":"value";a._valueTracker=OS(a,o,""+a[o])}}function X_(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var u=o.getValue(),h="";return a&&(h=$_(a)?a.checked?"true":"false":a.value),a=h,a!==u?(o.setValue(a),!0):!1}function Pl(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var IS=/[\n"\\]/g;function _n(a){return a.replace(IS,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Cf(a,o,u,h,g,m,v,S){a.name="",v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?a.type=v:a.removeAttribute("type"),o!=null?v==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+gn(o)):a.value!==""+gn(o)&&(a.value=""+gn(o)):v!=="submit"&&v!=="reset"||a.removeAttribute("value"),o!=null?Mf(a,v,gn(o)):u!=null?Mf(a,v,gn(u)):h!=null&&a.removeAttribute("value"),g==null&&m!=null&&(a.defaultChecked=!!m),g!=null&&(a.checked=g&&typeof g!="function"&&typeof g!="symbol"),S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?a.name=""+gn(S):a.removeAttribute("name")}function Y_(a,o,u,h,g,m,v,S){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(a.type=m),o!=null||u!=null){if(!(m!=="submit"&&m!=="reset"||o!=null)){Rf(a);return}u=u!=null?""+gn(u):"",o=o!=null?""+gn(o):u,S||o===a.value||(a.value=o),a.defaultValue=o}h=h??g,h=typeof h!="function"&&typeof h!="symbol"&&!!h,a.checked=S?a.checked:!!h,a.defaultChecked=!!h,v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(a.name=v),Rf(a)}function Mf(a,o,u){o==="number"&&Pl(a.ownerDocument)===a||a.defaultValue===""+u||(a.defaultValue=""+u)}function xr(a,o,u,h){if(a=a.options,o){o={};for(var g=0;g<u.length;g++)o["$"+u[g]]=!0;for(u=0;u<a.length;u++)g=o.hasOwnProperty("$"+a[u].value),a[u].selected!==g&&(a[u].selected=g),g&&h&&(a[u].defaultSelected=!0)}else{for(u=""+gn(u),o=null,g=0;g<a.length;g++){if(a[g].value===u){a[g].selected=!0,h&&(a[g].defaultSelected=!0);return}o!==null||a[g].disabled||(o=a[g])}o!==null&&(o.selected=!0)}}function q_(a,o,u){if(o!=null&&(o=""+gn(o),o!==a.value&&(a.value=o),u==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=u!=null?""+gn(u):""}function K_(a,o,u,h){if(o==null){if(h!=null){if(u!=null)throw Error(i(92));if(mt(h)){if(1<h.length)throw Error(i(93));h=h[0]}u=h}u==null&&(u=""),o=u}u=gn(o),a.defaultValue=u,h=a.textContent,h===u&&h!==""&&h!==null&&(a.value=h),Rf(a)}function Tr(a,o){if(o){var u=a.firstChild;if(u&&u===a.lastChild&&u.nodeType===3){u.nodeValue=o;return}}a.textContent=o}var PS=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Z_(a,o,u){var h=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?h?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":h?a.setProperty(o,u):typeof u!="number"||u===0||PS.has(o)?o==="float"?a.cssFloat=u:a[o]=(""+u).trim():a[o]=u+"px"}function Q_(a,o,u){if(o!=null&&typeof o!="object")throw Error(i(62));if(a=a.style,u!=null){for(var h in u)!u.hasOwnProperty(h)||o!=null&&o.hasOwnProperty(h)||(h.indexOf("--")===0?a.setProperty(h,""):h==="float"?a.cssFloat="":a[h]="");for(var g in o)h=o[g],o.hasOwnProperty(g)&&u[g]!==h&&Z_(a,g,h)}else for(var m in o)o.hasOwnProperty(m)&&Z_(a,m,o[m])}function Of(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var DS=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),kS=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Dl(a){return kS.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function oi(){}var If=null;function Pf(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Sr=null,Ar=null;function G_(a){var o=yr(a);if(o&&(a=o.stateNode)){var u=a[$e]||null;t:switch(a=o.stateNode,o.type){case"input":if(Cf(a,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=a;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+_n(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var h=u[o];if(h!==a&&h.form===a.form){var g=h[$e]||null;if(!g)throw Error(i(90));Cf(h,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(o=0;o<u.length;o++)h=u[o],h.form===a.form&&X_(h)}break t;case"textarea":q_(a,u.value,u.defaultValue);break t;case"select":o=u.value,o!=null&&xr(a,!!u.multiple,o,!1)}}}var Df=!1;function J_(a,o,u){if(Df)return a(o,u);Df=!0;try{var h=a(o);return h}finally{if(Df=!1,(Sr!==null||Ar!==null)&&(vc(),Sr&&(o=Sr,a=Ar,Ar=Sr=null,G_(o),a)))for(o=0;o<a.length;o++)G_(a[o])}}function La(a,o){var u=a.stateNode;if(u===null)return null;var h=u[$e]||null;if(h===null)return null;u=h[o];t:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(a=a.type,h=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!h;break t;default:a=!1}if(a)return null;if(u&&typeof u!="function")throw Error(i(231,o,typeof u));return u}var li=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),kf=!1;if(li)try{var za={};Object.defineProperty(za,"passive",{get:function(){kf=!0}}),window.addEventListener("test",za,za),window.removeEventListener("test",za,za)}catch{kf=!1}var Ni=null,Nf=null,kl=null;function tm(){if(kl)return kl;var a,o=Nf,u=o.length,h,g="value"in Ni?Ni.value:Ni.textContent,m=g.length;for(a=0;a<u&&o[a]===g[a];a++);var v=u-a;for(h=1;h<=v&&o[u-h]===g[m-h];h++);return kl=g.slice(a,1<h?1-h:void 0)}function Nl(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function Bl(){return!0}function em(){return!1}function Xe(a){function o(u,h,g,m,v){this._reactName=u,this._targetInst=g,this.type=h,this.nativeEvent=m,this.target=v,this.currentTarget=null;for(var S in a)a.hasOwnProperty(S)&&(u=a[S],this[S]=u?u(m):m[S]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?Bl:em,this.isPropagationStopped=em,this}return _(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Bl)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Bl)},persist:function(){},isPersistent:Bl}),o}var Ts={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ul=Xe(Ts),Va=_({},Ts,{view:0,detail:0}),NS=Xe(Va),Bf,Uf,Ha,Fl=_({},Va,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Lf,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ha&&(Ha&&a.type==="mousemove"?(Bf=a.screenX-Ha.screenX,Uf=a.screenY-Ha.screenY):Uf=Bf=0,Ha=a),Bf)},movementY:function(a){return"movementY"in a?a.movementY:Uf}}),nm=Xe(Fl),BS=_({},Fl,{dataTransfer:0}),US=Xe(BS),FS=_({},Va,{relatedTarget:0}),Ff=Xe(FS),LS=_({},Ts,{animationName:0,elapsedTime:0,pseudoElement:0}),zS=Xe(LS),VS=_({},Ts,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),HS=Xe(VS),jS=_({},Ts,{data:0}),im=Xe(jS),WS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$S={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},XS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function YS(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=XS[a])?!!o[a]:!1}function Lf(){return YS}var qS=_({},Va,{key:function(a){if(a.key){var o=WS[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=Nl(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?$S[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Lf,charCode:function(a){return a.type==="keypress"?Nl(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Nl(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),KS=Xe(qS),ZS=_({},Fl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sm=Xe(ZS),QS=_({},Va,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Lf}),GS=Xe(QS),JS=_({},Ts,{propertyName:0,elapsedTime:0,pseudoElement:0}),tA=Xe(JS),eA=_({},Fl,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),nA=Xe(eA),iA=_({},Ts,{newState:0,oldState:0}),sA=Xe(iA),rA=[9,13,27,32],zf=li&&"CompositionEvent"in window,ja=null;li&&"documentMode"in document&&(ja=document.documentMode);var aA=li&&"TextEvent"in window&&!ja,rm=li&&(!zf||ja&&8<ja&&11>=ja),am=" ",om=!1;function lm(a,o){switch(a){case"keyup":return rA.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cm(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var wr=!1;function oA(a,o){switch(a){case"compositionend":return cm(o);case"keypress":return o.which!==32?null:(om=!0,am);case"textInput":return a=o.data,a===am&&om?null:a;default:return null}}function lA(a,o){if(wr)return a==="compositionend"||!zf&&lm(a,o)?(a=tm(),kl=Nf=Ni=null,wr=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return rm&&o.locale!=="ko"?null:o.data;default:return null}}var cA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function um(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!cA[a.type]:o==="textarea"}function fm(a,o,u,h){Sr?Ar?Ar.push(h):Ar=[h]:Sr=h,o=Rc(o,"onChange"),0<o.length&&(u=new Ul("onChange","change",null,u,h),a.push({event:u,listeners:o}))}var Wa=null,$a=null;function uA(a){Yb(a,0)}function Ll(a){var o=Fa(a);if(X_(o))return a}function hm(a,o){if(a==="change")return o}var dm=!1;if(li){var Vf;if(li){var Hf="oninput"in document;if(!Hf){var pm=document.createElement("div");pm.setAttribute("oninput","return;"),Hf=typeof pm.oninput=="function"}Vf=Hf}else Vf=!1;dm=Vf&&(!document.documentMode||9<document.documentMode)}function gm(){Wa&&(Wa.detachEvent("onpropertychange",_m),$a=Wa=null)}function _m(a){if(a.propertyName==="value"&&Ll($a)){var o=[];fm(o,$a,a,Pf(a)),J_(uA,o)}}function fA(a,o,u){a==="focusin"?(gm(),Wa=o,$a=u,Wa.attachEvent("onpropertychange",_m)):a==="focusout"&&gm()}function hA(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Ll($a)}function dA(a,o){if(a==="click")return Ll(o)}function pA(a,o){if(a==="input"||a==="change")return Ll(o)}function gA(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var sn=typeof Object.is=="function"?Object.is:gA;function Xa(a,o){if(sn(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var u=Object.keys(a),h=Object.keys(o);if(u.length!==h.length)return!1;for(h=0;h<u.length;h++){var g=u[h];if(!bf.call(o,g)||!sn(a[g],o[g]))return!1}return!0}function mm(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ym(a,o){var u=mm(a);a=0;for(var h;u;){if(u.nodeType===3){if(h=a+u.textContent.length,a<=o&&h>=o)return{node:u,offset:o-a};a=h}t:{for(;u;){if(u.nextSibling){u=u.nextSibling;break t}u=u.parentNode}u=void 0}u=mm(u)}}function bm(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?bm(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function vm(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=Pl(a.document);o instanceof a.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)a=o.contentWindow;else break;o=Pl(a.document)}return o}function jf(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var _A=li&&"documentMode"in document&&11>=document.documentMode,Er=null,Wf=null,Ya=null,$f=!1;function xm(a,o,u){var h=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;$f||Er==null||Er!==Pl(h)||(h=Er,"selectionStart"in h&&jf(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Ya&&Xa(Ya,h)||(Ya=h,h=Rc(Wf,"onSelect"),0<h.length&&(o=new Ul("onSelect","select",null,o,u),a.push({event:o,listeners:h}),o.target=Er)))}function Ss(a,o){var u={};return u[a.toLowerCase()]=o.toLowerCase(),u["Webkit"+a]="webkit"+o,u["Moz"+a]="moz"+o,u}var Rr={animationend:Ss("Animation","AnimationEnd"),animationiteration:Ss("Animation","AnimationIteration"),animationstart:Ss("Animation","AnimationStart"),transitionrun:Ss("Transition","TransitionRun"),transitionstart:Ss("Transition","TransitionStart"),transitioncancel:Ss("Transition","TransitionCancel"),transitionend:Ss("Transition","TransitionEnd")},Xf={},Tm={};li&&(Tm=document.createElement("div").style,"AnimationEvent"in window||(delete Rr.animationend.animation,delete Rr.animationiteration.animation,delete Rr.animationstart.animation),"TransitionEvent"in window||delete Rr.transitionend.transition);function As(a){if(Xf[a])return Xf[a];if(!Rr[a])return a;var o=Rr[a],u;for(u in o)if(o.hasOwnProperty(u)&&u in Tm)return Xf[a]=o[u];return a}var Sm=As("animationend"),Am=As("animationiteration"),wm=As("animationstart"),mA=As("transitionrun"),yA=As("transitionstart"),bA=As("transitioncancel"),Em=As("transitionend"),Rm=new Map,Yf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Yf.push("scrollEnd");function Un(a,o){Rm.set(a,o),xs(o,[a])}var zl=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},mn=[],Cr=0,qf=0;function Vl(){for(var a=Cr,o=qf=Cr=0;o<a;){var u=mn[o];mn[o++]=null;var h=mn[o];mn[o++]=null;var g=mn[o];mn[o++]=null;var m=mn[o];if(mn[o++]=null,h!==null&&g!==null){var v=h.pending;v===null?g.next=g:(g.next=v.next,v.next=g),h.pending=g}m!==0&&Cm(u,g,m)}}function Hl(a,o,u,h){mn[Cr++]=a,mn[Cr++]=o,mn[Cr++]=u,mn[Cr++]=h,qf|=h,a.lanes|=h,a=a.alternate,a!==null&&(a.lanes|=h)}function Kf(a,o,u,h){return Hl(a,o,u,h),jl(a)}function ws(a,o){return Hl(a,null,null,o),jl(a)}function Cm(a,o,u){a.lanes|=u;var h=a.alternate;h!==null&&(h.lanes|=u);for(var g=!1,m=a.return;m!==null;)m.childLanes|=u,h=m.alternate,h!==null&&(h.childLanes|=u),m.tag===22&&(a=m.stateNode,a===null||a._visibility&1||(g=!0)),a=m,m=m.return;return a.tag===3?(m=a.stateNode,g&&o!==null&&(g=31-nn(u),a=m.hiddenUpdates,h=a[g],h===null?a[g]=[o]:h.push(o),o.lane=u|536870912),m):null}function jl(a){if(50<_o)throw _o=0,sd=null,Error(i(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var Mr={};function vA(a,o,u,h){this.tag=a,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function rn(a,o,u,h){return new vA(a,o,u,h)}function Zf(a){return a=a.prototype,!(!a||!a.isReactComponent)}function ci(a,o){var u=a.alternate;return u===null?(u=rn(a.tag,o,a.key,a.mode),u.elementType=a.elementType,u.type=a.type,u.stateNode=a.stateNode,u.alternate=a,a.alternate=u):(u.pendingProps=o,u.type=a.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=a.flags&65011712,u.childLanes=a.childLanes,u.lanes=a.lanes,u.child=a.child,u.memoizedProps=a.memoizedProps,u.memoizedState=a.memoizedState,u.updateQueue=a.updateQueue,o=a.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=a.sibling,u.index=a.index,u.ref=a.ref,u.refCleanup=a.refCleanup,u}function Mm(a,o){a.flags&=65011714;var u=a.alternate;return u===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,o=u.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function Wl(a,o,u,h,g,m){var v=0;if(h=a,typeof a=="function")Zf(a)&&(v=1);else if(typeof a=="string")v=ww(a,u,lt.current)?26:a==="html"||a==="head"||a==="body"?27:5;else t:switch(a){case G:return a=rn(31,u,o,g),a.elementType=G,a.lanes=m,a;case T:return Es(u.children,g,m,o);case A:v=8,g|=24;break;case E:return a=rn(12,u,o,g|2),a.elementType=E,a.lanes=m,a;case k:return a=rn(13,u,o,g),a.elementType=k,a.lanes=m,a;case z:return a=rn(19,u,o,g),a.elementType=z,a.lanes=m,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case C:v=10;break t;case D:v=9;break t;case O:v=11;break t;case Y:v=14;break t;case q:v=16,h=null;break t}v=29,u=Error(i(130,a===null?"null":typeof a,"")),h=null}return o=rn(v,u,o,g),o.elementType=a,o.type=h,o.lanes=m,o}function Es(a,o,u,h){return a=rn(7,a,h,o),a.lanes=u,a}function Qf(a,o,u){return a=rn(6,a,null,o),a.lanes=u,a}function Om(a){var o=rn(18,null,null,0);return o.stateNode=a,o}function Gf(a,o,u){return o=rn(4,a.children!==null?a.children:[],a.key,o),o.lanes=u,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var Im=new WeakMap;function yn(a,o){if(typeof a=="object"&&a!==null){var u=Im.get(a);return u!==void 0?u:(o={value:a,source:o,stack:O_(o)},Im.set(a,o),o)}return{value:a,source:o,stack:O_(o)}}var Or=[],Ir=0,$l=null,qa=0,bn=[],vn=0,Bi=null,$n=1,Xn="";function ui(a,o){Or[Ir++]=qa,Or[Ir++]=$l,$l=a,qa=o}function Pm(a,o,u){bn[vn++]=$n,bn[vn++]=Xn,bn[vn++]=Bi,Bi=a;var h=$n;a=Xn;var g=32-nn(h)-1;h&=~(1<<g),u+=1;var m=32-nn(o)+g;if(30<m){var v=g-g%5;m=(h&(1<<v)-1).toString(32),h>>=v,g-=v,$n=1<<32-nn(o)+g|u<<g|h,Xn=m+a}else $n=1<<m|u<<g|h,Xn=a}function Jf(a){a.return!==null&&(ui(a,1),Pm(a,1,0))}function th(a){for(;a===$l;)$l=Or[--Ir],Or[Ir]=null,qa=Or[--Ir],Or[Ir]=null;for(;a===Bi;)Bi=bn[--vn],bn[vn]=null,Xn=bn[--vn],bn[vn]=null,$n=bn[--vn],bn[vn]=null}function Dm(a,o){bn[vn++]=$n,bn[vn++]=Xn,bn[vn++]=Bi,$n=o.id,Xn=o.overflow,Bi=a}var Oe=null,te=null,Mt=!1,Ui=null,xn=!1,eh=Error(i(519));function Fi(a){var o=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ka(yn(o,a)),eh}function km(a){var o=a.stateNode,u=a.type,h=a.memoizedProps;switch(o[Me]=a,o[$e]=h,u){case"dialog":Et("cancel",o),Et("close",o);break;case"iframe":case"object":case"embed":Et("load",o);break;case"video":case"audio":for(u=0;u<yo.length;u++)Et(yo[u],o);break;case"source":Et("error",o);break;case"img":case"image":case"link":Et("error",o),Et("load",o);break;case"details":Et("toggle",o);break;case"input":Et("invalid",o),Y_(o,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0);break;case"select":Et("invalid",o);break;case"textarea":Et("invalid",o),K_(o,h.value,h.defaultValue,h.children)}u=h.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||h.suppressHydrationWarning===!0||Qb(o.textContent,u)?(h.popover!=null&&(Et("beforetoggle",o),Et("toggle",o)),h.onScroll!=null&&Et("scroll",o),h.onScrollEnd!=null&&Et("scrollend",o),h.onClick!=null&&(o.onclick=oi),o=!0):o=!1,o||Fi(a,!0)}function Nm(a){for(Oe=a.return;Oe;)switch(Oe.tag){case 5:case 31:case 13:xn=!1;return;case 27:case 3:xn=!0;return;default:Oe=Oe.return}}function Pr(a){if(a!==Oe)return!1;if(!Mt)return Nm(a),Mt=!0,!1;var o=a.tag,u;if((u=o!==3&&o!==27)&&((u=o===5)&&(u=a.type,u=!(u!=="form"&&u!=="button")||bd(a.type,a.memoizedProps)),u=!u),u&&te&&Fi(a),Nm(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(i(317));te=a0(a)}else if(o===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(i(317));te=a0(a)}else o===27?(o=te,Gi(a.type)?(a=Ad,Ad=null,te=a):te=o):te=Oe?Sn(a.stateNode.nextSibling):null;return!0}function Rs(){te=Oe=null,Mt=!1}function nh(){var a=Ui;return a!==null&&(Ze===null?Ze=a:Ze.push.apply(Ze,a),Ui=null),a}function Ka(a){Ui===null?Ui=[a]:Ui.push(a)}var ih=P(null),Cs=null,fi=null;function Li(a,o,u){st(ih,o._currentValue),o._currentValue=u}function hi(a){a._currentValue=ih.current,Q(ih)}function sh(a,o,u){for(;a!==null;){var h=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,h!==null&&(h.childLanes|=o)):h!==null&&(h.childLanes&o)!==o&&(h.childLanes|=o),a===u)break;a=a.return}}function rh(a,o,u,h){var g=a.child;for(g!==null&&(g.return=a);g!==null;){var m=g.dependencies;if(m!==null){var v=g.child;m=m.firstContext;t:for(;m!==null;){var S=m;m=g;for(var M=0;M<o.length;M++)if(S.context===o[M]){m.lanes|=u,S=m.alternate,S!==null&&(S.lanes|=u),sh(m.return,u,a),h||(v=null);break t}m=S.next}}else if(g.tag===18){if(v=g.return,v===null)throw Error(i(341));v.lanes|=u,m=v.alternate,m!==null&&(m.lanes|=u),sh(v,u,a),v=null}else v=g.child;if(v!==null)v.return=g;else for(v=g;v!==null;){if(v===a){v=null;break}if(g=v.sibling,g!==null){g.return=v.return,v=g;break}v=v.return}g=v}}function Dr(a,o,u,h){a=null;for(var g=o,m=!1;g!==null;){if(!m){if((g.flags&524288)!==0)m=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var v=g.alternate;if(v===null)throw Error(i(387));if(v=v.memoizedProps,v!==null){var S=g.type;sn(g.pendingProps.value,v.value)||(a!==null?a.push(S):a=[S])}}else if(g===Lt.current){if(v=g.alternate,v===null)throw Error(i(387));v.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(a!==null?a.push(So):a=[So])}g=g.return}a!==null&&rh(o,a,u,h),o.flags|=262144}function Xl(a){for(a=a.firstContext;a!==null;){if(!sn(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Ms(a){Cs=a,fi=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Ie(a){return Bm(Cs,a)}function Yl(a,o){return Cs===null&&Ms(a),Bm(a,o)}function Bm(a,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},fi===null){if(a===null)throw Error(i(308));fi=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else fi=fi.next=o;return u}var xA=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(u,h){a.push(h)}};this.abort=function(){o.aborted=!0,a.forEach(function(u){return u()})}},TA=n.unstable_scheduleCallback,SA=n.unstable_NormalPriority,de={$$typeof:C,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ah(){return{controller:new xA,data:new Map,refCount:0}}function Za(a){a.refCount--,a.refCount===0&&TA(SA,function(){a.controller.abort()})}var Qa=null,oh=0,kr=0,Nr=null;function AA(a,o){if(Qa===null){var u=Qa=[];oh=0,kr=ud(),Nr={status:"pending",value:void 0,then:function(h){u.push(h)}}}return oh++,o.then(Um,Um),o}function Um(){if(--oh===0&&Qa!==null){Nr!==null&&(Nr.status="fulfilled");var a=Qa;Qa=null,kr=0,Nr=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function wA(a,o){var u=[],h={status:"pending",value:null,reason:null,then:function(g){u.push(g)}};return a.then(function(){h.status="fulfilled",h.value=o;for(var g=0;g<u.length;g++)(0,u[g])(o)},function(g){for(h.status="rejected",h.reason=g,g=0;g<u.length;g++)(0,u[g])(void 0)}),h}var Fm=$.S;$.S=function(a,o){xb=tn(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&AA(a,o),Fm!==null&&Fm(a,o)};var Os=P(null);function lh(){var a=Os.current;return a!==null?a:Zt.pooledCache}function ql(a,o){o===null?st(Os,Os.current):st(Os,o.pool)}function Lm(){var a=lh();return a===null?null:{parent:de._currentValue,pool:a}}var Br=Error(i(460)),ch=Error(i(474)),Kl=Error(i(542)),Zl={then:function(){}};function zm(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Vm(a,o,u){switch(u=a[u],u===void 0?a.push(o):u!==o&&(o.then(oi,oi),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,jm(a),a;default:if(typeof o.status=="string")o.then(oi,oi);else{if(a=Zt,a!==null&&100<a.shellSuspendCounter)throw Error(i(482));a=o,a.status="pending",a.then(function(h){if(o.status==="pending"){var g=o;g.status="fulfilled",g.value=h}},function(h){if(o.status==="pending"){var g=o;g.status="rejected",g.reason=h}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,jm(a),a}throw Ps=o,Br}}function Is(a){try{var o=a._init;return o(a._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(Ps=u,Br):u}}var Ps=null;function Hm(){if(Ps===null)throw Error(i(459));var a=Ps;return Ps=null,a}function jm(a){if(a===Br||a===Kl)throw Error(i(483))}var Ur=null,Ga=0;function Ql(a){var o=Ga;return Ga+=1,Ur===null&&(Ur=[]),Vm(Ur,a,o)}function Ja(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function Gl(a,o){throw o.$$typeof===y?Error(i(525)):(a=Object.prototype.toString.call(o),Error(i(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function Wm(a){function o(F,I){if(a){var H=F.deletions;H===null?(F.deletions=[I],F.flags|=16):H.push(I)}}function u(F,I){if(!a)return null;for(;I!==null;)o(F,I),I=I.sibling;return null}function h(F){for(var I=new Map;F!==null;)F.key!==null?I.set(F.key,F):I.set(F.index,F),F=F.sibling;return I}function g(F,I){return F=ci(F,I),F.index=0,F.sibling=null,F}function m(F,I,H){return F.index=H,a?(H=F.alternate,H!==null?(H=H.index,H<I?(F.flags|=67108866,I):H):(F.flags|=67108866,I)):(F.flags|=1048576,I)}function v(F){return a&&F.alternate===null&&(F.flags|=67108866),F}function S(F,I,H,Z){return I===null||I.tag!==6?(I=Qf(H,F.mode,Z),I.return=F,I):(I=g(I,H),I.return=F,I)}function M(F,I,H,Z){var ft=H.type;return ft===T?K(F,I,H.props.children,Z,H.key):I!==null&&(I.elementType===ft||typeof ft=="object"&&ft!==null&&ft.$$typeof===q&&Is(ft)===I.type)?(I=g(I,H.props),Ja(I,H),I.return=F,I):(I=Wl(H.type,H.key,H.props,null,F.mode,Z),Ja(I,H),I.return=F,I)}function j(F,I,H,Z){return I===null||I.tag!==4||I.stateNode.containerInfo!==H.containerInfo||I.stateNode.implementation!==H.implementation?(I=Gf(H,F.mode,Z),I.return=F,I):(I=g(I,H.children||[]),I.return=F,I)}function K(F,I,H,Z,ft){return I===null||I.tag!==7?(I=Es(H,F.mode,Z,ft),I.return=F,I):(I=g(I,H),I.return=F,I)}function tt(F,I,H){if(typeof I=="string"&&I!==""||typeof I=="number"||typeof I=="bigint")return I=Qf(""+I,F.mode,H),I.return=F,I;if(typeof I=="object"&&I!==null){switch(I.$$typeof){case b:return H=Wl(I.type,I.key,I.props,null,F.mode,H),Ja(H,I),H.return=F,H;case x:return I=Gf(I,F.mode,H),I.return=F,I;case q:return I=Is(I),tt(F,I,H)}if(mt(I)||ot(I))return I=Es(I,F.mode,H,null),I.return=F,I;if(typeof I.then=="function")return tt(F,Ql(I),H);if(I.$$typeof===C)return tt(F,Yl(F,I),H);Gl(F,I)}return null}function W(F,I,H,Z){var ft=I!==null?I.key:null;if(typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint")return ft!==null?null:S(F,I,""+H,Z);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case b:return H.key===ft?M(F,I,H,Z):null;case x:return H.key===ft?j(F,I,H,Z):null;case q:return H=Is(H),W(F,I,H,Z)}if(mt(H)||ot(H))return ft!==null?null:K(F,I,H,Z,null);if(typeof H.then=="function")return W(F,I,Ql(H),Z);if(H.$$typeof===C)return W(F,I,Yl(F,H),Z);Gl(F,H)}return null}function X(F,I,H,Z,ft){if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return F=F.get(H)||null,S(I,F,""+Z,ft);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case b:return F=F.get(Z.key===null?H:Z.key)||null,M(I,F,Z,ft);case x:return F=F.get(Z.key===null?H:Z.key)||null,j(I,F,Z,ft);case q:return Z=Is(Z),X(F,I,H,Z,ft)}if(mt(Z)||ot(Z))return F=F.get(H)||null,K(I,F,Z,ft,null);if(typeof Z.then=="function")return X(F,I,H,Ql(Z),ft);if(Z.$$typeof===C)return X(F,I,H,Yl(I,Z),ft);Gl(I,Z)}return null}function ct(F,I,H,Z){for(var ft=null,Dt=null,ut=I,St=I=0,Ct=null;ut!==null&&St<H.length;St++){ut.index>St?(Ct=ut,ut=null):Ct=ut.sibling;var kt=W(F,ut,H[St],Z);if(kt===null){ut===null&&(ut=Ct);break}a&&ut&&kt.alternate===null&&o(F,ut),I=m(kt,I,St),Dt===null?ft=kt:Dt.sibling=kt,Dt=kt,ut=Ct}if(St===H.length)return u(F,ut),Mt&&ui(F,St),ft;if(ut===null){for(;St<H.length;St++)ut=tt(F,H[St],Z),ut!==null&&(I=m(ut,I,St),Dt===null?ft=ut:Dt.sibling=ut,Dt=ut);return Mt&&ui(F,St),ft}for(ut=h(ut);St<H.length;St++)Ct=X(ut,F,St,H[St],Z),Ct!==null&&(a&&Ct.alternate!==null&&ut.delete(Ct.key===null?St:Ct.key),I=m(Ct,I,St),Dt===null?ft=Ct:Dt.sibling=Ct,Dt=Ct);return a&&ut.forEach(function(is){return o(F,is)}),Mt&&ui(F,St),ft}function pt(F,I,H,Z){if(H==null)throw Error(i(151));for(var ft=null,Dt=null,ut=I,St=I=0,Ct=null,kt=H.next();ut!==null&&!kt.done;St++,kt=H.next()){ut.index>St?(Ct=ut,ut=null):Ct=ut.sibling;var is=W(F,ut,kt.value,Z);if(is===null){ut===null&&(ut=Ct);break}a&&ut&&is.alternate===null&&o(F,ut),I=m(is,I,St),Dt===null?ft=is:Dt.sibling=is,Dt=is,ut=Ct}if(kt.done)return u(F,ut),Mt&&ui(F,St),ft;if(ut===null){for(;!kt.done;St++,kt=H.next())kt=tt(F,kt.value,Z),kt!==null&&(I=m(kt,I,St),Dt===null?ft=kt:Dt.sibling=kt,Dt=kt);return Mt&&ui(F,St),ft}for(ut=h(ut);!kt.done;St++,kt=H.next())kt=X(ut,F,St,kt.value,Z),kt!==null&&(a&&kt.alternate!==null&&ut.delete(kt.key===null?St:kt.key),I=m(kt,I,St),Dt===null?ft=kt:Dt.sibling=kt,Dt=kt);return a&&ut.forEach(function(Bw){return o(F,Bw)}),Mt&&ui(F,St),ft}function Xt(F,I,H,Z){if(typeof H=="object"&&H!==null&&H.type===T&&H.key===null&&(H=H.props.children),typeof H=="object"&&H!==null){switch(H.$$typeof){case b:t:{for(var ft=H.key;I!==null;){if(I.key===ft){if(ft=H.type,ft===T){if(I.tag===7){u(F,I.sibling),Z=g(I,H.props.children),Z.return=F,F=Z;break t}}else if(I.elementType===ft||typeof ft=="object"&&ft!==null&&ft.$$typeof===q&&Is(ft)===I.type){u(F,I.sibling),Z=g(I,H.props),Ja(Z,H),Z.return=F,F=Z;break t}u(F,I);break}else o(F,I);I=I.sibling}H.type===T?(Z=Es(H.props.children,F.mode,Z,H.key),Z.return=F,F=Z):(Z=Wl(H.type,H.key,H.props,null,F.mode,Z),Ja(Z,H),Z.return=F,F=Z)}return v(F);case x:t:{for(ft=H.key;I!==null;){if(I.key===ft)if(I.tag===4&&I.stateNode.containerInfo===H.containerInfo&&I.stateNode.implementation===H.implementation){u(F,I.sibling),Z=g(I,H.children||[]),Z.return=F,F=Z;break t}else{u(F,I);break}else o(F,I);I=I.sibling}Z=Gf(H,F.mode,Z),Z.return=F,F=Z}return v(F);case q:return H=Is(H),Xt(F,I,H,Z)}if(mt(H))return ct(F,I,H,Z);if(ot(H)){if(ft=ot(H),typeof ft!="function")throw Error(i(150));return H=ft.call(H),pt(F,I,H,Z)}if(typeof H.then=="function")return Xt(F,I,Ql(H),Z);if(H.$$typeof===C)return Xt(F,I,Yl(F,H),Z);Gl(F,H)}return typeof H=="string"&&H!==""||typeof H=="number"||typeof H=="bigint"?(H=""+H,I!==null&&I.tag===6?(u(F,I.sibling),Z=g(I,H),Z.return=F,F=Z):(u(F,I),Z=Qf(H,F.mode,Z),Z.return=F,F=Z),v(F)):u(F,I)}return function(F,I,H,Z){try{Ga=0;var ft=Xt(F,I,H,Z);return Ur=null,ft}catch(ut){if(ut===Br||ut===Kl)throw ut;var Dt=rn(29,ut,null,F.mode);return Dt.lanes=Z,Dt.return=F,Dt}finally{}}}var Ds=Wm(!0),$m=Wm(!1),zi=!1;function uh(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function fh(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Vi(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Hi(a,o,u){var h=a.updateQueue;if(h===null)return null;if(h=h.shared,(Nt&2)!==0){var g=h.pending;return g===null?o.next=o:(o.next=g.next,g.next=o),h.pending=o,o=jl(a),Cm(a,null,u),o}return Hl(a,h,o,u),jl(a)}function to(a,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194048)!==0)){var h=o.lanes;h&=a.pendingLanes,u|=h,o.lanes=u,B_(a,u)}}function hh(a,o){var u=a.updateQueue,h=a.alternate;if(h!==null&&(h=h.updateQueue,u===h)){var g=null,m=null;if(u=u.firstBaseUpdate,u!==null){do{var v={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};m===null?g=m=v:m=m.next=v,u=u.next}while(u!==null);m===null?g=m=o:m=m.next=o}else g=m=o;u={baseState:h.baseState,firstBaseUpdate:g,lastBaseUpdate:m,shared:h.shared,callbacks:h.callbacks},a.updateQueue=u;return}a=u.lastBaseUpdate,a===null?u.firstBaseUpdate=o:a.next=o,u.lastBaseUpdate=o}var dh=!1;function eo(){if(dh){var a=Nr;if(a!==null)throw a}}function no(a,o,u,h){dh=!1;var g=a.updateQueue;zi=!1;var m=g.firstBaseUpdate,v=g.lastBaseUpdate,S=g.shared.pending;if(S!==null){g.shared.pending=null;var M=S,j=M.next;M.next=null,v===null?m=j:v.next=j,v=M;var K=a.alternate;K!==null&&(K=K.updateQueue,S=K.lastBaseUpdate,S!==v&&(S===null?K.firstBaseUpdate=j:S.next=j,K.lastBaseUpdate=M))}if(m!==null){var tt=g.baseState;v=0,K=j=M=null,S=m;do{var W=S.lane&-536870913,X=W!==S.lane;if(X?(Rt&W)===W:(h&W)===W){W!==0&&W===kr&&(dh=!0),K!==null&&(K=K.next={lane:0,tag:S.tag,payload:S.payload,callback:null,next:null});t:{var ct=a,pt=S;W=o;var Xt=u;switch(pt.tag){case 1:if(ct=pt.payload,typeof ct=="function"){tt=ct.call(Xt,tt,W);break t}tt=ct;break t;case 3:ct.flags=ct.flags&-65537|128;case 0:if(ct=pt.payload,W=typeof ct=="function"?ct.call(Xt,tt,W):ct,W==null)break t;tt=_({},tt,W);break t;case 2:zi=!0}}W=S.callback,W!==null&&(a.flags|=64,X&&(a.flags|=8192),X=g.callbacks,X===null?g.callbacks=[W]:X.push(W))}else X={lane:W,tag:S.tag,payload:S.payload,callback:S.callback,next:null},K===null?(j=K=X,M=tt):K=K.next=X,v|=W;if(S=S.next,S===null){if(S=g.shared.pending,S===null)break;X=S,S=X.next,X.next=null,g.lastBaseUpdate=X,g.shared.pending=null}}while(!0);K===null&&(M=tt),g.baseState=M,g.firstBaseUpdate=j,g.lastBaseUpdate=K,m===null&&(g.shared.lanes=0),Yi|=v,a.lanes=v,a.memoizedState=tt}}function Xm(a,o){if(typeof a!="function")throw Error(i(191,a));a.call(o)}function Ym(a,o){var u=a.callbacks;if(u!==null)for(a.callbacks=null,a=0;a<u.length;a++)Xm(u[a],o)}var Fr=P(null),Jl=P(0);function qm(a,o){a=xi,st(Jl,a),st(Fr,o),xi=a|o.baseLanes}function ph(){st(Jl,xi),st(Fr,Fr.current)}function gh(){xi=Jl.current,Q(Fr),Q(Jl)}var an=P(null),Tn=null;function ji(a){var o=a.alternate;st(ue,ue.current&1),st(an,a),Tn===null&&(o===null||Fr.current!==null||o.memoizedState!==null)&&(Tn=a)}function _h(a){st(ue,ue.current),st(an,a),Tn===null&&(Tn=a)}function Km(a){a.tag===22?(st(ue,ue.current),st(an,a),Tn===null&&(Tn=a)):Wi()}function Wi(){st(ue,ue.current),st(an,an.current)}function on(a){Q(an),Tn===a&&(Tn=null),Q(ue)}var ue=P(0);function tc(a){for(var o=a;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||Td(u)||Sd(u)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var di=0,Tt=null,Wt=null,pe=null,ec=!1,Lr=!1,ks=!1,nc=0,io=0,zr=null,EA=0;function re(){throw Error(i(321))}function mh(a,o){if(o===null)return!1;for(var u=0;u<o.length&&u<a.length;u++)if(!sn(a[u],o[u]))return!1;return!0}function yh(a,o,u,h,g,m){return di=m,Tt=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,$.H=a===null||a.memoizedState===null?Py:Dh,ks=!1,m=u(h,g),ks=!1,Lr&&(m=Qm(o,u,h,g)),Zm(a),m}function Zm(a){$.H=ao;var o=Wt!==null&&Wt.next!==null;if(di=0,pe=Wt=Tt=null,ec=!1,io=0,zr=null,o)throw Error(i(300));a===null||ge||(a=a.dependencies,a!==null&&Xl(a)&&(ge=!0))}function Qm(a,o,u,h){Tt=a;var g=0;do{if(Lr&&(zr=null),io=0,Lr=!1,25<=g)throw Error(i(301));if(g+=1,pe=Wt=null,a.updateQueue!=null){var m=a.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}$.H=Dy,m=o(u,h)}while(Lr);return m}function RA(){var a=$.H,o=a.useState()[0];return o=typeof o.then=="function"?so(o):o,a=a.useState()[0],(Wt!==null?Wt.memoizedState:null)!==a&&(Tt.flags|=1024),o}function bh(){var a=nc!==0;return nc=0,a}function vh(a,o,u){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~u}function xh(a){if(ec){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}ec=!1}di=0,pe=Wt=Tt=null,Lr=!1,io=nc=0,zr=null}function He(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pe===null?Tt.memoizedState=pe=a:pe=pe.next=a,pe}function fe(){if(Wt===null){var a=Tt.alternate;a=a!==null?a.memoizedState:null}else a=Wt.next;var o=pe===null?Tt.memoizedState:pe.next;if(o!==null)pe=o,Wt=a;else{if(a===null)throw Tt.alternate===null?Error(i(467)):Error(i(310));Wt=a,a={memoizedState:Wt.memoizedState,baseState:Wt.baseState,baseQueue:Wt.baseQueue,queue:Wt.queue,next:null},pe===null?Tt.memoizedState=pe=a:pe=pe.next=a}return pe}function ic(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function so(a){var o=io;return io+=1,zr===null&&(zr=[]),a=Vm(zr,a,o),o=Tt,(pe===null?o.memoizedState:pe.next)===null&&(o=o.alternate,$.H=o===null||o.memoizedState===null?Py:Dh),a}function sc(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return so(a);if(a.$$typeof===C)return Ie(a)}throw Error(i(438,String(a)))}function Th(a){var o=null,u=Tt.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var h=Tt.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(o={data:h.data.map(function(g){return g.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=ic(),Tt.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(a),h=0;h<a;h++)u[h]=at;return o.index++,u}function pi(a,o){return typeof o=="function"?o(a):o}function rc(a){var o=fe();return Sh(o,Wt,a)}function Sh(a,o,u){var h=a.queue;if(h===null)throw Error(i(311));h.lastRenderedReducer=u;var g=a.baseQueue,m=h.pending;if(m!==null){if(g!==null){var v=g.next;g.next=m.next,m.next=v}o.baseQueue=g=m,h.pending=null}if(m=a.baseState,g===null)a.memoizedState=m;else{o=g.next;var S=v=null,M=null,j=o,K=!1;do{var tt=j.lane&-536870913;if(tt!==j.lane?(Rt&tt)===tt:(di&tt)===tt){var W=j.revertLane;if(W===0)M!==null&&(M=M.next={lane:0,revertLane:0,gesture:null,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null}),tt===kr&&(K=!0);else if((di&W)===W){j=j.next,W===kr&&(K=!0);continue}else tt={lane:0,revertLane:j.revertLane,gesture:null,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null},M===null?(S=M=tt,v=m):M=M.next=tt,Tt.lanes|=W,Yi|=W;tt=j.action,ks&&u(m,tt),m=j.hasEagerState?j.eagerState:u(m,tt)}else W={lane:tt,revertLane:j.revertLane,gesture:j.gesture,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null},M===null?(S=M=W,v=m):M=M.next=W,Tt.lanes|=tt,Yi|=tt;j=j.next}while(j!==null&&j!==o);if(M===null?v=m:M.next=S,!sn(m,a.memoizedState)&&(ge=!0,K&&(u=Nr,u!==null)))throw u;a.memoizedState=m,a.baseState=v,a.baseQueue=M,h.lastRenderedState=m}return g===null&&(h.lanes=0),[a.memoizedState,h.dispatch]}function Ah(a){var o=fe(),u=o.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=a;var h=u.dispatch,g=u.pending,m=o.memoizedState;if(g!==null){u.pending=null;var v=g=g.next;do m=a(m,v.action),v=v.next;while(v!==g);sn(m,o.memoizedState)||(ge=!0),o.memoizedState=m,o.baseQueue===null&&(o.baseState=m),u.lastRenderedState=m}return[m,h]}function Gm(a,o,u){var h=Tt,g=fe(),m=Mt;if(m){if(u===void 0)throw Error(i(407));u=u()}else u=o();var v=!sn((Wt||g).memoizedState,u);if(v&&(g.memoizedState=u,ge=!0),g=g.queue,Rh(ey.bind(null,h,g,a),[a]),g.getSnapshot!==o||v||pe!==null&&pe.memoizedState.tag&1){if(h.flags|=2048,Vr(9,{destroy:void 0},ty.bind(null,h,g,u,o),null),Zt===null)throw Error(i(349));m||(di&127)!==0||Jm(h,o,u)}return u}function Jm(a,o,u){a.flags|=16384,a={getSnapshot:o,value:u},o=Tt.updateQueue,o===null?(o=ic(),Tt.updateQueue=o,o.stores=[a]):(u=o.stores,u===null?o.stores=[a]:u.push(a))}function ty(a,o,u,h){o.value=u,o.getSnapshot=h,ny(o)&&iy(a)}function ey(a,o,u){return u(function(){ny(o)&&iy(a)})}function ny(a){var o=a.getSnapshot;a=a.value;try{var u=o();return!sn(a,u)}catch{return!0}}function iy(a){var o=ws(a,2);o!==null&&Qe(o,a,2)}function wh(a){var o=He();if(typeof a=="function"){var u=a;if(a=u(),ks){Di(!0);try{u()}finally{Di(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pi,lastRenderedState:a},o}function sy(a,o,u,h){return a.baseState=u,Sh(a,Wt,typeof h=="function"?h:pi)}function CA(a,o,u,h,g){if(lc(a))throw Error(i(485));if(a=o.action,a!==null){var m={payload:g,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(v){m.listeners.push(v)}};$.T!==null?u(!0):m.isTransition=!1,h(m),u=o.pending,u===null?(m.next=o.pending=m,ry(o,m)):(m.next=u.next,o.pending=u.next=m)}}function ry(a,o){var u=o.action,h=o.payload,g=a.state;if(o.isTransition){var m=$.T,v={};$.T=v;try{var S=u(g,h),M=$.S;M!==null&&M(v,S),ay(a,o,S)}catch(j){Eh(a,o,j)}finally{m!==null&&v.types!==null&&(m.types=v.types),$.T=m}}else try{m=u(g,h),ay(a,o,m)}catch(j){Eh(a,o,j)}}function ay(a,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(h){oy(a,o,h)},function(h){return Eh(a,o,h)}):oy(a,o,u)}function oy(a,o,u){o.status="fulfilled",o.value=u,ly(o),a.state=u,o=a.pending,o!==null&&(u=o.next,u===o?a.pending=null:(u=u.next,o.next=u,ry(a,u)))}function Eh(a,o,u){var h=a.pending;if(a.pending=null,h!==null){h=h.next;do o.status="rejected",o.reason=u,ly(o),o=o.next;while(o!==h)}a.action=null}function ly(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function cy(a,o){return o}function uy(a,o){if(Mt){var u=Zt.formState;if(u!==null){t:{var h=Tt;if(Mt){if(te){e:{for(var g=te,m=xn;g.nodeType!==8;){if(!m){g=null;break e}if(g=Sn(g.nextSibling),g===null){g=null;break e}}m=g.data,g=m==="F!"||m==="F"?g:null}if(g){te=Sn(g.nextSibling),h=g.data==="F!";break t}}Fi(h)}h=!1}h&&(o=u[0])}}return u=He(),u.memoizedState=u.baseState=o,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cy,lastRenderedState:o},u.queue=h,u=My.bind(null,Tt,h),h.dispatch=u,h=wh(!1),m=Ph.bind(null,Tt,!1,h.queue),h=He(),g={state:o,dispatch:null,action:a,pending:null},h.queue=g,u=CA.bind(null,Tt,g,m,u),g.dispatch=u,h.memoizedState=a,[o,u,!1]}function fy(a){var o=fe();return hy(o,Wt,a)}function hy(a,o,u){if(o=Sh(a,o,cy)[0],a=rc(pi)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var h=so(o)}catch(v){throw v===Br?Kl:v}else h=o;o=fe();var g=o.queue,m=g.dispatch;return u!==o.memoizedState&&(Tt.flags|=2048,Vr(9,{destroy:void 0},MA.bind(null,g,u),null)),[h,m,a]}function MA(a,o){a.action=o}function dy(a){var o=fe(),u=Wt;if(u!==null)return hy(o,u,a);fe(),o=o.memoizedState,u=fe();var h=u.queue.dispatch;return u.memoizedState=a,[o,h,!1]}function Vr(a,o,u,h){return a={tag:a,create:u,deps:h,inst:o,next:null},o=Tt.updateQueue,o===null&&(o=ic(),Tt.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=a.next=a:(h=u.next,u.next=a,a.next=h,o.lastEffect=a),a}function py(){return fe().memoizedState}function ac(a,o,u,h){var g=He();Tt.flags|=a,g.memoizedState=Vr(1|o,{destroy:void 0},u,h===void 0?null:h)}function oc(a,o,u,h){var g=fe();h=h===void 0?null:h;var m=g.memoizedState.inst;Wt!==null&&h!==null&&mh(h,Wt.memoizedState.deps)?g.memoizedState=Vr(o,m,u,h):(Tt.flags|=a,g.memoizedState=Vr(1|o,m,u,h))}function gy(a,o){ac(8390656,8,a,o)}function Rh(a,o){oc(2048,8,a,o)}function OA(a){Tt.flags|=4;var o=Tt.updateQueue;if(o===null)o=ic(),Tt.updateQueue=o,o.events=[a];else{var u=o.events;u===null?o.events=[a]:u.push(a)}}function _y(a){var o=fe().memoizedState;return OA({ref:o,nextImpl:a}),function(){if((Nt&2)!==0)throw Error(i(440));return o.impl.apply(void 0,arguments)}}function my(a,o){return oc(4,2,a,o)}function yy(a,o){return oc(4,4,a,o)}function by(a,o){if(typeof o=="function"){a=a();var u=o(a);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function vy(a,o,u){u=u!=null?u.concat([a]):null,oc(4,4,by.bind(null,o,a),u)}function Ch(){}function xy(a,o){var u=fe();o=o===void 0?null:o;var h=u.memoizedState;return o!==null&&mh(o,h[1])?h[0]:(u.memoizedState=[a,o],a)}function Ty(a,o){var u=fe();o=o===void 0?null:o;var h=u.memoizedState;if(o!==null&&mh(o,h[1]))return h[0];if(h=a(),ks){Di(!0);try{a()}finally{Di(!1)}}return u.memoizedState=[h,o],h}function Mh(a,o,u){return u===void 0||(di&1073741824)!==0&&(Rt&261930)===0?a.memoizedState=o:(a.memoizedState=u,a=Sb(),Tt.lanes|=a,Yi|=a,u)}function Sy(a,o,u,h){return sn(u,o)?u:Fr.current!==null?(a=Mh(a,u,h),sn(a,o)||(ge=!0),a):(di&42)===0||(di&1073741824)!==0&&(Rt&261930)===0?(ge=!0,a.memoizedState=u):(a=Sb(),Tt.lanes|=a,Yi|=a,o)}function Ay(a,o,u,h,g){var m=it.p;it.p=m!==0&&8>m?m:8;var v=$.T,S={};$.T=S,Ph(a,!1,o,u);try{var M=g(),j=$.S;if(j!==null&&j(S,M),M!==null&&typeof M=="object"&&typeof M.then=="function"){var K=wA(M,h);ro(a,o,K,un(a))}else ro(a,o,h,un(a))}catch(tt){ro(a,o,{then:function(){},status:"rejected",reason:tt},un())}finally{it.p=m,v!==null&&S.types!==null&&(v.types=S.types),$.T=v}}function IA(){}function Oh(a,o,u,h){if(a.tag!==5)throw Error(i(476));var g=wy(a).queue;Ay(a,g,o,ht,u===null?IA:function(){return Ey(a),u(h)})}function wy(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:ht,baseState:ht,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pi,lastRenderedState:ht},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pi,lastRenderedState:u},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function Ey(a){var o=wy(a);o.next===null&&(o=a.alternate.memoizedState),ro(a,o.next.queue,{},un())}function Ih(){return Ie(So)}function Ry(){return fe().memoizedState}function Cy(){return fe().memoizedState}function PA(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var u=un();a=Vi(u);var h=Hi(o,a,u);h!==null&&(Qe(h,o,u),to(h,o,u)),o={cache:ah()},a.payload=o;return}o=o.return}}function DA(a,o,u){var h=un();u={lane:h,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},lc(a)?Oy(o,u):(u=Kf(a,o,u,h),u!==null&&(Qe(u,a,h),Iy(u,o,h)))}function My(a,o,u){var h=un();ro(a,o,u,h)}function ro(a,o,u,h){var g={lane:h,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(lc(a))Oy(o,g);else{var m=a.alternate;if(a.lanes===0&&(m===null||m.lanes===0)&&(m=o.lastRenderedReducer,m!==null))try{var v=o.lastRenderedState,S=m(v,u);if(g.hasEagerState=!0,g.eagerState=S,sn(S,v))return Hl(a,o,g,0),Zt===null&&Vl(),!1}catch{}finally{}if(u=Kf(a,o,g,h),u!==null)return Qe(u,a,h),Iy(u,o,h),!0}return!1}function Ph(a,o,u,h){if(h={lane:2,revertLane:ud(),gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},lc(a)){if(o)throw Error(i(479))}else o=Kf(a,u,h,2),o!==null&&Qe(o,a,2)}function lc(a){var o=a.alternate;return a===Tt||o!==null&&o===Tt}function Oy(a,o){Lr=ec=!0;var u=a.pending;u===null?o.next=o:(o.next=u.next,u.next=o),a.pending=o}function Iy(a,o,u){if((u&4194048)!==0){var h=o.lanes;h&=a.pendingLanes,u|=h,o.lanes=u,B_(a,u)}}var ao={readContext:Ie,use:sc,useCallback:re,useContext:re,useEffect:re,useImperativeHandle:re,useLayoutEffect:re,useInsertionEffect:re,useMemo:re,useReducer:re,useRef:re,useState:re,useDebugValue:re,useDeferredValue:re,useTransition:re,useSyncExternalStore:re,useId:re,useHostTransitionStatus:re,useFormState:re,useActionState:re,useOptimistic:re,useMemoCache:re,useCacheRefresh:re};ao.useEffectEvent=re;var Py={readContext:Ie,use:sc,useCallback:function(a,o){return He().memoizedState=[a,o===void 0?null:o],a},useContext:Ie,useEffect:gy,useImperativeHandle:function(a,o,u){u=u!=null?u.concat([a]):null,ac(4194308,4,by.bind(null,o,a),u)},useLayoutEffect:function(a,o){return ac(4194308,4,a,o)},useInsertionEffect:function(a,o){ac(4,2,a,o)},useMemo:function(a,o){var u=He();o=o===void 0?null:o;var h=a();if(ks){Di(!0);try{a()}finally{Di(!1)}}return u.memoizedState=[h,o],h},useReducer:function(a,o,u){var h=He();if(u!==void 0){var g=u(o);if(ks){Di(!0);try{u(o)}finally{Di(!1)}}}else g=o;return h.memoizedState=h.baseState=g,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:g},h.queue=a,a=a.dispatch=DA.bind(null,Tt,a),[h.memoizedState,a]},useRef:function(a){var o=He();return a={current:a},o.memoizedState=a},useState:function(a){a=wh(a);var o=a.queue,u=My.bind(null,Tt,o);return o.dispatch=u,[a.memoizedState,u]},useDebugValue:Ch,useDeferredValue:function(a,o){var u=He();return Mh(u,a,o)},useTransition:function(){var a=wh(!1);return a=Ay.bind(null,Tt,a.queue,!0,!1),He().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,u){var h=Tt,g=He();if(Mt){if(u===void 0)throw Error(i(407));u=u()}else{if(u=o(),Zt===null)throw Error(i(349));(Rt&127)!==0||Jm(h,o,u)}g.memoizedState=u;var m={value:u,getSnapshot:o};return g.queue=m,gy(ey.bind(null,h,m,a),[a]),h.flags|=2048,Vr(9,{destroy:void 0},ty.bind(null,h,m,u,o),null),u},useId:function(){var a=He(),o=Zt.identifierPrefix;if(Mt){var u=Xn,h=$n;u=(h&~(1<<32-nn(h)-1)).toString(32)+u,o="_"+o+"R_"+u,u=nc++,0<u&&(o+="H"+u.toString(32)),o+="_"}else u=EA++,o="_"+o+"r_"+u.toString(32)+"_";return a.memoizedState=o},useHostTransitionStatus:Ih,useFormState:uy,useActionState:uy,useOptimistic:function(a){var o=He();o.memoizedState=o.baseState=a;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=Ph.bind(null,Tt,!0,u),u.dispatch=o,[a,o]},useMemoCache:Th,useCacheRefresh:function(){return He().memoizedState=PA.bind(null,Tt)},useEffectEvent:function(a){var o=He(),u={impl:a};return o.memoizedState=u,function(){if((Nt&2)!==0)throw Error(i(440));return u.impl.apply(void 0,arguments)}}},Dh={readContext:Ie,use:sc,useCallback:xy,useContext:Ie,useEffect:Rh,useImperativeHandle:vy,useInsertionEffect:my,useLayoutEffect:yy,useMemo:Ty,useReducer:rc,useRef:py,useState:function(){return rc(pi)},useDebugValue:Ch,useDeferredValue:function(a,o){var u=fe();return Sy(u,Wt.memoizedState,a,o)},useTransition:function(){var a=rc(pi)[0],o=fe().memoizedState;return[typeof a=="boolean"?a:so(a),o]},useSyncExternalStore:Gm,useId:Ry,useHostTransitionStatus:Ih,useFormState:fy,useActionState:fy,useOptimistic:function(a,o){var u=fe();return sy(u,Wt,a,o)},useMemoCache:Th,useCacheRefresh:Cy};Dh.useEffectEvent=_y;var Dy={readContext:Ie,use:sc,useCallback:xy,useContext:Ie,useEffect:Rh,useImperativeHandle:vy,useInsertionEffect:my,useLayoutEffect:yy,useMemo:Ty,useReducer:Ah,useRef:py,useState:function(){return Ah(pi)},useDebugValue:Ch,useDeferredValue:function(a,o){var u=fe();return Wt===null?Mh(u,a,o):Sy(u,Wt.memoizedState,a,o)},useTransition:function(){var a=Ah(pi)[0],o=fe().memoizedState;return[typeof a=="boolean"?a:so(a),o]},useSyncExternalStore:Gm,useId:Ry,useHostTransitionStatus:Ih,useFormState:dy,useActionState:dy,useOptimistic:function(a,o){var u=fe();return Wt!==null?sy(u,Wt,a,o):(u.baseState=a,[a,u.queue.dispatch])},useMemoCache:Th,useCacheRefresh:Cy};Dy.useEffectEvent=_y;function kh(a,o,u,h){o=a.memoizedState,u=u(h,o),u=u==null?o:_({},o,u),a.memoizedState=u,a.lanes===0&&(a.updateQueue.baseState=u)}var Nh={enqueueSetState:function(a,o,u){a=a._reactInternals;var h=un(),g=Vi(h);g.payload=o,u!=null&&(g.callback=u),o=Hi(a,g,h),o!==null&&(Qe(o,a,h),to(o,a,h))},enqueueReplaceState:function(a,o,u){a=a._reactInternals;var h=un(),g=Vi(h);g.tag=1,g.payload=o,u!=null&&(g.callback=u),o=Hi(a,g,h),o!==null&&(Qe(o,a,h),to(o,a,h))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var u=un(),h=Vi(u);h.tag=2,o!=null&&(h.callback=o),o=Hi(a,h,u),o!==null&&(Qe(o,a,u),to(o,a,u))}};function ky(a,o,u,h,g,m,v){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(h,m,v):o.prototype&&o.prototype.isPureReactComponent?!Xa(u,h)||!Xa(g,m):!0}function Ny(a,o,u,h){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,h),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,h),o.state!==a&&Nh.enqueueReplaceState(o,o.state,null)}function Ns(a,o){var u=o;if("ref"in o){u={};for(var h in o)h!=="ref"&&(u[h]=o[h])}if(a=a.defaultProps){u===o&&(u=_({},u));for(var g in a)u[g]===void 0&&(u[g]=a[g])}return u}function By(a){zl(a)}function Uy(a){console.error(a)}function Fy(a){zl(a)}function cc(a,o){try{var u=a.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(h){setTimeout(function(){throw h})}}function Ly(a,o,u){try{var h=a.onCaughtError;h(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function Bh(a,o,u){return u=Vi(u),u.tag=3,u.payload={element:null},u.callback=function(){cc(a,o)},u}function zy(a){return a=Vi(a),a.tag=3,a}function Vy(a,o,u,h){var g=u.type.getDerivedStateFromError;if(typeof g=="function"){var m=h.value;a.payload=function(){return g(m)},a.callback=function(){Ly(o,u,h)}}var v=u.stateNode;v!==null&&typeof v.componentDidCatch=="function"&&(a.callback=function(){Ly(o,u,h),typeof g!="function"&&(qi===null?qi=new Set([this]):qi.add(this));var S=h.stack;this.componentDidCatch(h.value,{componentStack:S!==null?S:""})})}function kA(a,o,u,h,g){if(u.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(o=u.alternate,o!==null&&Dr(o,u,g,!0),u=an.current,u!==null){switch(u.tag){case 31:case 13:return Tn===null?xc():u.alternate===null&&ae===0&&(ae=3),u.flags&=-257,u.flags|=65536,u.lanes=g,h===Zl?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([h]):o.add(h),od(a,h,g)),!1;case 22:return u.flags|=65536,h===Zl?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([h])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([h]):u.add(h)),od(a,h,g)),!1}throw Error(i(435,u.tag))}return od(a,h,g),xc(),!1}if(Mt)return o=an.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=g,h!==eh&&(a=Error(i(422),{cause:h}),Ka(yn(a,u)))):(h!==eh&&(o=Error(i(423),{cause:h}),Ka(yn(o,u))),a=a.current.alternate,a.flags|=65536,g&=-g,a.lanes|=g,h=yn(h,u),g=Bh(a.stateNode,h,g),hh(a,g),ae!==4&&(ae=2)),!1;var m=Error(i(520),{cause:h});if(m=yn(m,u),go===null?go=[m]:go.push(m),ae!==4&&(ae=2),o===null)return!0;h=yn(h,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,a=g&-g,u.lanes|=a,a=Bh(u.stateNode,h,a),hh(u,a),!1;case 1:if(o=u.type,m=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(qi===null||!qi.has(m))))return u.flags|=65536,g&=-g,u.lanes|=g,g=zy(g),Vy(g,a,u,h),hh(u,g),!1}u=u.return}while(u!==null);return!1}var Uh=Error(i(461)),ge=!1;function Pe(a,o,u,h){o.child=a===null?$m(o,null,u,h):Ds(o,a.child,u,h)}function Hy(a,o,u,h,g){u=u.render;var m=o.ref;if("ref"in h){var v={};for(var S in h)S!=="ref"&&(v[S]=h[S])}else v=h;return Ms(o),h=yh(a,o,u,v,m,g),S=bh(),a!==null&&!ge?(vh(a,o,g),gi(a,o,g)):(Mt&&S&&Jf(o),o.flags|=1,Pe(a,o,h,g),o.child)}function jy(a,o,u,h,g){if(a===null){var m=u.type;return typeof m=="function"&&!Zf(m)&&m.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=m,Wy(a,o,m,h,g)):(a=Wl(u.type,null,h,o,o.mode,g),a.ref=o.ref,a.return=o,o.child=a)}if(m=a.child,!$h(a,g)){var v=m.memoizedProps;if(u=u.compare,u=u!==null?u:Xa,u(v,h)&&a.ref===o.ref)return gi(a,o,g)}return o.flags|=1,a=ci(m,h),a.ref=o.ref,a.return=o,o.child=a}function Wy(a,o,u,h,g){if(a!==null){var m=a.memoizedProps;if(Xa(m,h)&&a.ref===o.ref)if(ge=!1,o.pendingProps=h=m,$h(a,g))(a.flags&131072)!==0&&(ge=!0);else return o.lanes=a.lanes,gi(a,o,g)}return Fh(a,o,u,h,g)}function $y(a,o,u,h){var g=h.children,m=a!==null?a.memoizedState:null;if(a===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),h.mode==="hidden"){if((o.flags&128)!==0){if(m=m!==null?m.baseLanes|u:u,a!==null){for(h=o.child=a.child,g=0;h!==null;)g=g|h.lanes|h.childLanes,h=h.sibling;h=g&~m}else h=0,o.child=null;return Xy(a,o,m,u,h)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&ql(o,m!==null?m.cachePool:null),m!==null?qm(o,m):ph(),Km(o);else return h=o.lanes=536870912,Xy(a,o,m!==null?m.baseLanes|u:u,u,h)}else m!==null?(ql(o,m.cachePool),qm(o,m),Wi(),o.memoizedState=null):(a!==null&&ql(o,null),ph(),Wi());return Pe(a,o,g,u),o.child}function oo(a,o){return a!==null&&a.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function Xy(a,o,u,h,g){var m=lh();return m=m===null?null:{parent:de._currentValue,pool:m},o.memoizedState={baseLanes:u,cachePool:m},a!==null&&ql(o,null),ph(),Km(o),a!==null&&Dr(a,o,h,!0),o.childLanes=g,null}function uc(a,o){return o=hc({mode:o.mode,children:o.children},a.mode),o.ref=a.ref,a.child=o,o.return=a,o}function Yy(a,o,u){return Ds(o,a.child,null,u),a=uc(o,o.pendingProps),a.flags|=2,on(o),o.memoizedState=null,a}function NA(a,o,u){var h=o.pendingProps,g=(o.flags&128)!==0;if(o.flags&=-129,a===null){if(Mt){if(h.mode==="hidden")return a=uc(o,h),o.lanes=536870912,oo(null,a);if(_h(o),(a=te)?(a=r0(a,xn),a=a!==null&&a.data==="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:Bi!==null?{id:$n,overflow:Xn}:null,retryLane:536870912,hydrationErrors:null},u=Om(a),u.return=o,o.child=u,Oe=o,te=null)):a=null,a===null)throw Fi(o);return o.lanes=536870912,null}return uc(o,h)}var m=a.memoizedState;if(m!==null){var v=m.dehydrated;if(_h(o),g)if(o.flags&256)o.flags&=-257,o=Yy(a,o,u);else if(o.memoizedState!==null)o.child=a.child,o.flags|=128,o=null;else throw Error(i(558));else if(ge||Dr(a,o,u,!1),g=(u&a.childLanes)!==0,ge||g){if(h=Zt,h!==null&&(v=U_(h,u),v!==0&&v!==m.retryLane))throw m.retryLane=v,ws(a,v),Qe(h,a,v),Uh;xc(),o=Yy(a,o,u)}else a=m.treeContext,te=Sn(v.nextSibling),Oe=o,Mt=!0,Ui=null,xn=!1,a!==null&&Dm(o,a),o=uc(o,h),o.flags|=4096;return o}return a=ci(a.child,{mode:h.mode,children:h.children}),a.ref=o.ref,o.child=a,a.return=o,a}function fc(a,o){var u=o.ref;if(u===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(i(284));(a===null||a.ref!==u)&&(o.flags|=4194816)}}function Fh(a,o,u,h,g){return Ms(o),u=yh(a,o,u,h,void 0,g),h=bh(),a!==null&&!ge?(vh(a,o,g),gi(a,o,g)):(Mt&&h&&Jf(o),o.flags|=1,Pe(a,o,u,g),o.child)}function qy(a,o,u,h,g,m){return Ms(o),o.updateQueue=null,u=Qm(o,h,u,g),Zm(a),h=bh(),a!==null&&!ge?(vh(a,o,m),gi(a,o,m)):(Mt&&h&&Jf(o),o.flags|=1,Pe(a,o,u,m),o.child)}function Ky(a,o,u,h,g){if(Ms(o),o.stateNode===null){var m=Mr,v=u.contextType;typeof v=="object"&&v!==null&&(m=Ie(v)),m=new u(h,m),o.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Nh,o.stateNode=m,m._reactInternals=o,m=o.stateNode,m.props=h,m.state=o.memoizedState,m.refs={},uh(o),v=u.contextType,m.context=typeof v=="object"&&v!==null?Ie(v):Mr,m.state=o.memoizedState,v=u.getDerivedStateFromProps,typeof v=="function"&&(kh(o,u,v,h),m.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(v=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),v!==m.state&&Nh.enqueueReplaceState(m,m.state,null),no(o,h,m,g),eo(),m.state=o.memoizedState),typeof m.componentDidMount=="function"&&(o.flags|=4194308),h=!0}else if(a===null){m=o.stateNode;var S=o.memoizedProps,M=Ns(u,S);m.props=M;var j=m.context,K=u.contextType;v=Mr,typeof K=="object"&&K!==null&&(v=Ie(K));var tt=u.getDerivedStateFromProps;K=typeof tt=="function"||typeof m.getSnapshotBeforeUpdate=="function",S=o.pendingProps!==S,K||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(S||j!==v)&&Ny(o,m,h,v),zi=!1;var W=o.memoizedState;m.state=W,no(o,h,m,g),eo(),j=o.memoizedState,S||W!==j||zi?(typeof tt=="function"&&(kh(o,u,tt,h),j=o.memoizedState),(M=zi||ky(o,u,M,h,W,j,v))?(K||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(o.flags|=4194308)):(typeof m.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=h,o.memoizedState=j),m.props=h,m.state=j,m.context=v,h=M):(typeof m.componentDidMount=="function"&&(o.flags|=4194308),h=!1)}else{m=o.stateNode,fh(a,o),v=o.memoizedProps,K=Ns(u,v),m.props=K,tt=o.pendingProps,W=m.context,j=u.contextType,M=Mr,typeof j=="object"&&j!==null&&(M=Ie(j)),S=u.getDerivedStateFromProps,(j=typeof S=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(v!==tt||W!==M)&&Ny(o,m,h,M),zi=!1,W=o.memoizedState,m.state=W,no(o,h,m,g),eo();var X=o.memoizedState;v!==tt||W!==X||zi||a!==null&&a.dependencies!==null&&Xl(a.dependencies)?(typeof S=="function"&&(kh(o,u,S,h),X=o.memoizedState),(K=zi||ky(o,u,K,h,W,X,M)||a!==null&&a.dependencies!==null&&Xl(a.dependencies))?(j||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(h,X,M),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(h,X,M)),typeof m.componentDidUpdate=="function"&&(o.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof m.componentDidUpdate!="function"||v===a.memoizedProps&&W===a.memoizedState||(o.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||v===a.memoizedProps&&W===a.memoizedState||(o.flags|=1024),o.memoizedProps=h,o.memoizedState=X),m.props=h,m.state=X,m.context=M,h=K):(typeof m.componentDidUpdate!="function"||v===a.memoizedProps&&W===a.memoizedState||(o.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||v===a.memoizedProps&&W===a.memoizedState||(o.flags|=1024),h=!1)}return m=h,fc(a,o),h=(o.flags&128)!==0,m||h?(m=o.stateNode,u=h&&typeof u.getDerivedStateFromError!="function"?null:m.render(),o.flags|=1,a!==null&&h?(o.child=Ds(o,a.child,null,g),o.child=Ds(o,null,u,g)):Pe(a,o,u,g),o.memoizedState=m.state,a=o.child):a=gi(a,o,g),a}function Zy(a,o,u,h){return Rs(),o.flags|=256,Pe(a,o,u,h),o.child}var Lh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function zh(a){return{baseLanes:a,cachePool:Lm()}}function Vh(a,o,u){return a=a!==null?a.childLanes&~u:0,o&&(a|=cn),a}function Qy(a,o,u){var h=o.pendingProps,g=!1,m=(o.flags&128)!==0,v;if((v=m)||(v=a!==null&&a.memoizedState===null?!1:(ue.current&2)!==0),v&&(g=!0,o.flags&=-129),v=(o.flags&32)!==0,o.flags&=-33,a===null){if(Mt){if(g?ji(o):Wi(),(a=te)?(a=r0(a,xn),a=a!==null&&a.data!=="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:Bi!==null?{id:$n,overflow:Xn}:null,retryLane:536870912,hydrationErrors:null},u=Om(a),u.return=o,o.child=u,Oe=o,te=null)):a=null,a===null)throw Fi(o);return Sd(a)?o.lanes=32:o.lanes=536870912,null}var S=h.children;return h=h.fallback,g?(Wi(),g=o.mode,S=hc({mode:"hidden",children:S},g),h=Es(h,g,u,null),S.return=o,h.return=o,S.sibling=h,o.child=S,h=o.child,h.memoizedState=zh(u),h.childLanes=Vh(a,v,u),o.memoizedState=Lh,oo(null,h)):(ji(o),Hh(o,S))}var M=a.memoizedState;if(M!==null&&(S=M.dehydrated,S!==null)){if(m)o.flags&256?(ji(o),o.flags&=-257,o=jh(a,o,u)):o.memoizedState!==null?(Wi(),o.child=a.child,o.flags|=128,o=null):(Wi(),S=h.fallback,g=o.mode,h=hc({mode:"visible",children:h.children},g),S=Es(S,g,u,null),S.flags|=2,h.return=o,S.return=o,h.sibling=S,o.child=h,Ds(o,a.child,null,u),h=o.child,h.memoizedState=zh(u),h.childLanes=Vh(a,v,u),o.memoizedState=Lh,o=oo(null,h));else if(ji(o),Sd(S)){if(v=S.nextSibling&&S.nextSibling.dataset,v)var j=v.dgst;v=j,h=Error(i(419)),h.stack="",h.digest=v,Ka({value:h,source:null,stack:null}),o=jh(a,o,u)}else if(ge||Dr(a,o,u,!1),v=(u&a.childLanes)!==0,ge||v){if(v=Zt,v!==null&&(h=U_(v,u),h!==0&&h!==M.retryLane))throw M.retryLane=h,ws(a,h),Qe(v,a,h),Uh;Td(S)||xc(),o=jh(a,o,u)}else Td(S)?(o.flags|=192,o.child=a.child,o=null):(a=M.treeContext,te=Sn(S.nextSibling),Oe=o,Mt=!0,Ui=null,xn=!1,a!==null&&Dm(o,a),o=Hh(o,h.children),o.flags|=4096);return o}return g?(Wi(),S=h.fallback,g=o.mode,M=a.child,j=M.sibling,h=ci(M,{mode:"hidden",children:h.children}),h.subtreeFlags=M.subtreeFlags&65011712,j!==null?S=ci(j,S):(S=Es(S,g,u,null),S.flags|=2),S.return=o,h.return=o,h.sibling=S,o.child=h,oo(null,h),h=o.child,S=a.child.memoizedState,S===null?S=zh(u):(g=S.cachePool,g!==null?(M=de._currentValue,g=g.parent!==M?{parent:M,pool:M}:g):g=Lm(),S={baseLanes:S.baseLanes|u,cachePool:g}),h.memoizedState=S,h.childLanes=Vh(a,v,u),o.memoizedState=Lh,oo(a.child,h)):(ji(o),u=a.child,a=u.sibling,u=ci(u,{mode:"visible",children:h.children}),u.return=o,u.sibling=null,a!==null&&(v=o.deletions,v===null?(o.deletions=[a],o.flags|=16):v.push(a)),o.child=u,o.memoizedState=null,u)}function Hh(a,o){return o=hc({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function hc(a,o){return a=rn(22,a,null,o),a.lanes=0,a}function jh(a,o,u){return Ds(o,a.child,null,u),a=Hh(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function Gy(a,o,u){a.lanes|=o;var h=a.alternate;h!==null&&(h.lanes|=o),sh(a.return,o,u)}function Wh(a,o,u,h,g,m){var v=a.memoizedState;v===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:h,tail:u,tailMode:g,treeForkCount:m}:(v.isBackwards=o,v.rendering=null,v.renderingStartTime=0,v.last=h,v.tail=u,v.tailMode=g,v.treeForkCount=m)}function Jy(a,o,u){var h=o.pendingProps,g=h.revealOrder,m=h.tail;h=h.children;var v=ue.current,S=(v&2)!==0;if(S?(v=v&1|2,o.flags|=128):v&=1,st(ue,v),Pe(a,o,h,u),h=Mt?qa:0,!S&&a!==null&&(a.flags&128)!==0)t:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Gy(a,u,o);else if(a.tag===19)Gy(a,u,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break t;for(;a.sibling===null;){if(a.return===null||a.return===o)break t;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(g){case"forwards":for(u=o.child,g=null;u!==null;)a=u.alternate,a!==null&&tc(a)===null&&(g=u),u=u.sibling;u=g,u===null?(g=o.child,o.child=null):(g=u.sibling,u.sibling=null),Wh(o,!1,g,u,m,h);break;case"backwards":case"unstable_legacy-backwards":for(u=null,g=o.child,o.child=null;g!==null;){if(a=g.alternate,a!==null&&tc(a)===null){o.child=g;break}a=g.sibling,g.sibling=u,u=g,g=a}Wh(o,!0,u,null,m,h);break;case"together":Wh(o,!1,null,null,void 0,h);break;default:o.memoizedState=null}return o.child}function gi(a,o,u){if(a!==null&&(o.dependencies=a.dependencies),Yi|=o.lanes,(u&o.childLanes)===0)if(a!==null){if(Dr(a,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(i(153));if(o.child!==null){for(a=o.child,u=ci(a,a.pendingProps),o.child=u,u.return=o;a.sibling!==null;)a=a.sibling,u=u.sibling=ci(a,a.pendingProps),u.return=o;u.sibling=null}return o.child}function $h(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&Xl(a)))}function BA(a,o,u){switch(o.tag){case 3:Ve(o,o.stateNode.containerInfo),Li(o,de,a.memoizedState.cache),Rs();break;case 27:case 5:Da(o);break;case 4:Ve(o,o.stateNode.containerInfo);break;case 10:Li(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,_h(o),null;break;case 13:var h=o.memoizedState;if(h!==null)return h.dehydrated!==null?(ji(o),o.flags|=128,null):(u&o.child.childLanes)!==0?Qy(a,o,u):(ji(o),a=gi(a,o,u),a!==null?a.sibling:null);ji(o);break;case 19:var g=(a.flags&128)!==0;if(h=(u&o.childLanes)!==0,h||(Dr(a,o,u,!1),h=(u&o.childLanes)!==0),g){if(h)return Jy(a,o,u);o.flags|=128}if(g=o.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),st(ue,ue.current),h)break;return null;case 22:return o.lanes=0,$y(a,o,u,o.pendingProps);case 24:Li(o,de,a.memoizedState.cache)}return gi(a,o,u)}function tb(a,o,u){if(a!==null)if(a.memoizedProps!==o.pendingProps)ge=!0;else{if(!$h(a,u)&&(o.flags&128)===0)return ge=!1,BA(a,o,u);ge=(a.flags&131072)!==0}else ge=!1,Mt&&(o.flags&1048576)!==0&&Pm(o,qa,o.index);switch(o.lanes=0,o.tag){case 16:t:{var h=o.pendingProps;if(a=Is(o.elementType),o.type=a,typeof a=="function")Zf(a)?(h=Ns(a,h),o.tag=1,o=Ky(null,o,a,h,u)):(o.tag=0,o=Fh(null,o,a,h,u));else{if(a!=null){var g=a.$$typeof;if(g===O){o.tag=11,o=Hy(null,o,a,h,u);break t}else if(g===Y){o.tag=14,o=jy(null,o,a,h,u);break t}}throw o=dt(a)||a,Error(i(306,o,""))}}return o;case 0:return Fh(a,o,o.type,o.pendingProps,u);case 1:return h=o.type,g=Ns(h,o.pendingProps),Ky(a,o,h,g,u);case 3:t:{if(Ve(o,o.stateNode.containerInfo),a===null)throw Error(i(387));h=o.pendingProps;var m=o.memoizedState;g=m.element,fh(a,o),no(o,h,null,u);var v=o.memoizedState;if(h=v.cache,Li(o,de,h),h!==m.cache&&rh(o,[de],u,!0),eo(),h=v.element,m.isDehydrated)if(m={element:h,isDehydrated:!1,cache:v.cache},o.updateQueue.baseState=m,o.memoizedState=m,o.flags&256){o=Zy(a,o,h,u);break t}else if(h!==g){g=yn(Error(i(424)),o),Ka(g),o=Zy(a,o,h,u);break t}else{switch(a=o.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(te=Sn(a.firstChild),Oe=o,Mt=!0,Ui=null,xn=!0,u=$m(o,null,h,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(Rs(),h===g){o=gi(a,o,u);break t}Pe(a,o,h,u)}o=o.child}return o;case 26:return fc(a,o),a===null?(u=f0(o.type,null,o.pendingProps,null))?o.memoizedState=u:Mt||(u=o.type,a=o.pendingProps,h=Cc(yt.current).createElement(u),h[Me]=o,h[$e]=a,De(h,u,a),Ae(h),o.stateNode=h):o.memoizedState=f0(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return Da(o),a===null&&Mt&&(h=o.stateNode=l0(o.type,o.pendingProps,yt.current),Oe=o,xn=!0,g=te,Gi(o.type)?(Ad=g,te=Sn(h.firstChild)):te=g),Pe(a,o,o.pendingProps.children,u),fc(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&Mt&&((g=h=te)&&(h=hw(h,o.type,o.pendingProps,xn),h!==null?(o.stateNode=h,Oe=o,te=Sn(h.firstChild),xn=!1,g=!0):g=!1),g||Fi(o)),Da(o),g=o.type,m=o.pendingProps,v=a!==null?a.memoizedProps:null,h=m.children,bd(g,m)?h=null:v!==null&&bd(g,v)&&(o.flags|=32),o.memoizedState!==null&&(g=yh(a,o,RA,null,null,u),So._currentValue=g),fc(a,o),Pe(a,o,h,u),o.child;case 6:return a===null&&Mt&&((a=u=te)&&(u=dw(u,o.pendingProps,xn),u!==null?(o.stateNode=u,Oe=o,te=null,a=!0):a=!1),a||Fi(o)),null;case 13:return Qy(a,o,u);case 4:return Ve(o,o.stateNode.containerInfo),h=o.pendingProps,a===null?o.child=Ds(o,null,h,u):Pe(a,o,h,u),o.child;case 11:return Hy(a,o,o.type,o.pendingProps,u);case 7:return Pe(a,o,o.pendingProps,u),o.child;case 8:return Pe(a,o,o.pendingProps.children,u),o.child;case 12:return Pe(a,o,o.pendingProps.children,u),o.child;case 10:return h=o.pendingProps,Li(o,o.type,h.value),Pe(a,o,h.children,u),o.child;case 9:return g=o.type._context,h=o.pendingProps.children,Ms(o),g=Ie(g),h=h(g),o.flags|=1,Pe(a,o,h,u),o.child;case 14:return jy(a,o,o.type,o.pendingProps,u);case 15:return Wy(a,o,o.type,o.pendingProps,u);case 19:return Jy(a,o,u);case 31:return NA(a,o,u);case 22:return $y(a,o,u,o.pendingProps);case 24:return Ms(o),h=Ie(de),a===null?(g=lh(),g===null&&(g=Zt,m=ah(),g.pooledCache=m,m.refCount++,m!==null&&(g.pooledCacheLanes|=u),g=m),o.memoizedState={parent:h,cache:g},uh(o),Li(o,de,g)):((a.lanes&u)!==0&&(fh(a,o),no(o,null,null,u),eo()),g=a.memoizedState,m=o.memoizedState,g.parent!==h?(g={parent:h,cache:h},o.memoizedState=g,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=g),Li(o,de,h)):(h=m.cache,Li(o,de,h),h!==g.cache&&rh(o,[de],u,!0))),Pe(a,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(i(156,o.tag))}function _i(a){a.flags|=4}function Xh(a,o,u,h,g){if((o=(a.mode&32)!==0)&&(o=!1),o){if(a.flags|=16777216,(g&335544128)===g)if(a.stateNode.complete)a.flags|=8192;else if(Rb())a.flags|=8192;else throw Ps=Zl,ch}else a.flags&=-16777217}function eb(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!_0(o))if(Rb())a.flags|=8192;else throw Ps=Zl,ch}function dc(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?k_():536870912,a.lanes|=o,$r|=o)}function lo(a,o){if(!Mt)switch(a.tailMode){case"hidden":o=a.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?a.tail=null:u.sibling=null;break;case"collapsed":u=a.tail;for(var h=null;u!==null;)u.alternate!==null&&(h=u),u=u.sibling;h===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:h.sibling=null}}function ee(a){var o=a.alternate!==null&&a.alternate.child===a.child,u=0,h=0;if(o)for(var g=a.child;g!==null;)u|=g.lanes|g.childLanes,h|=g.subtreeFlags&65011712,h|=g.flags&65011712,g.return=a,g=g.sibling;else for(g=a.child;g!==null;)u|=g.lanes|g.childLanes,h|=g.subtreeFlags,h|=g.flags,g.return=a,g=g.sibling;return a.subtreeFlags|=h,a.childLanes=u,o}function UA(a,o,u){var h=o.pendingProps;switch(th(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ee(o),null;case 1:return ee(o),null;case 3:return u=o.stateNode,h=null,a!==null&&(h=a.memoizedState.cache),o.memoizedState.cache!==h&&(o.flags|=2048),hi(de),ce(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(a===null||a.child===null)&&(Pr(o)?_i(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,nh())),ee(o),null;case 26:var g=o.type,m=o.memoizedState;return a===null?(_i(o),m!==null?(ee(o),eb(o,m)):(ee(o),Xh(o,g,null,h,u))):m?m!==a.memoizedState?(_i(o),ee(o),eb(o,m)):(ee(o),o.flags&=-16777217):(a=a.memoizedProps,a!==h&&_i(o),ee(o),Xh(o,g,a,h,u)),null;case 27:if(Al(o),u=yt.current,g=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==h&&_i(o);else{if(!h){if(o.stateNode===null)throw Error(i(166));return ee(o),null}a=lt.current,Pr(o)?km(o):(a=l0(g,h,u),o.stateNode=a,_i(o))}return ee(o),null;case 5:if(Al(o),g=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==h&&_i(o);else{if(!h){if(o.stateNode===null)throw Error(i(166));return ee(o),null}if(m=lt.current,Pr(o))km(o);else{var v=Cc(yt.current);switch(m){case 1:m=v.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:m=v.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":m=v.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":m=v.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":m=v.createElement("div"),m.innerHTML="<script><\/script>",m=m.removeChild(m.firstChild);break;case"select":m=typeof h.is=="string"?v.createElement("select",{is:h.is}):v.createElement("select"),h.multiple?m.multiple=!0:h.size&&(m.size=h.size);break;default:m=typeof h.is=="string"?v.createElement(g,{is:h.is}):v.createElement(g)}}m[Me]=o,m[$e]=h;t:for(v=o.child;v!==null;){if(v.tag===5||v.tag===6)m.appendChild(v.stateNode);else if(v.tag!==4&&v.tag!==27&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===o)break t;for(;v.sibling===null;){if(v.return===null||v.return===o)break t;v=v.return}v.sibling.return=v.return,v=v.sibling}o.stateNode=m;t:switch(De(m,g,h),g){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break t;case"img":h=!0;break t;default:h=!1}h&&_i(o)}}return ee(o),Xh(o,o.type,a===null?null:a.memoizedProps,o.pendingProps,u),null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==h&&_i(o);else{if(typeof h!="string"&&o.stateNode===null)throw Error(i(166));if(a=yt.current,Pr(o)){if(a=o.stateNode,u=o.memoizedProps,h=null,g=Oe,g!==null)switch(g.tag){case 27:case 5:h=g.memoizedProps}a[Me]=o,a=!!(a.nodeValue===u||h!==null&&h.suppressHydrationWarning===!0||Qb(a.nodeValue,u)),a||Fi(o,!0)}else a=Cc(a).createTextNode(h),a[Me]=o,o.stateNode=a}return ee(o),null;case 31:if(u=o.memoizedState,a===null||a.memoizedState!==null){if(h=Pr(o),u!==null){if(a===null){if(!h)throw Error(i(318));if(a=o.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(i(557));a[Me]=o}else Rs(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;ee(o),a=!1}else u=nh(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=u),a=!0;if(!a)return o.flags&256?(on(o),o):(on(o),null);if((o.flags&128)!==0)throw Error(i(558))}return ee(o),null;case 13:if(h=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(g=Pr(o),h!==null&&h.dehydrated!==null){if(a===null){if(!g)throw Error(i(318));if(g=o.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(i(317));g[Me]=o}else Rs(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;ee(o),g=!1}else g=nh(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=g),g=!0;if(!g)return o.flags&256?(on(o),o):(on(o),null)}return on(o),(o.flags&128)!==0?(o.lanes=u,o):(u=h!==null,a=a!==null&&a.memoizedState!==null,u&&(h=o.child,g=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(g=h.alternate.memoizedState.cachePool.pool),m=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(m=h.memoizedState.cachePool.pool),m!==g&&(h.flags|=2048)),u!==a&&u&&(o.child.flags|=8192),dc(o,o.updateQueue),ee(o),null);case 4:return ce(),a===null&&pd(o.stateNode.containerInfo),ee(o),null;case 10:return hi(o.type),ee(o),null;case 19:if(Q(ue),h=o.memoizedState,h===null)return ee(o),null;if(g=(o.flags&128)!==0,m=h.rendering,m===null)if(g)lo(h,!1);else{if(ae!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(m=tc(a),m!==null){for(o.flags|=128,lo(h,!1),a=m.updateQueue,o.updateQueue=a,dc(o,a),o.subtreeFlags=0,a=u,u=o.child;u!==null;)Mm(u,a),u=u.sibling;return st(ue,ue.current&1|2),Mt&&ui(o,h.treeForkCount),o.child}a=a.sibling}h.tail!==null&&tn()>yc&&(o.flags|=128,g=!0,lo(h,!1),o.lanes=4194304)}else{if(!g)if(a=tc(m),a!==null){if(o.flags|=128,g=!0,a=a.updateQueue,o.updateQueue=a,dc(o,a),lo(h,!0),h.tail===null&&h.tailMode==="hidden"&&!m.alternate&&!Mt)return ee(o),null}else 2*tn()-h.renderingStartTime>yc&&u!==536870912&&(o.flags|=128,g=!0,lo(h,!1),o.lanes=4194304);h.isBackwards?(m.sibling=o.child,o.child=m):(a=h.last,a!==null?a.sibling=m:o.child=m,h.last=m)}return h.tail!==null?(a=h.tail,h.rendering=a,h.tail=a.sibling,h.renderingStartTime=tn(),a.sibling=null,u=ue.current,st(ue,g?u&1|2:u&1),Mt&&ui(o,h.treeForkCount),a):(ee(o),null);case 22:case 23:return on(o),gh(),h=o.memoizedState!==null,a!==null?a.memoizedState!==null!==h&&(o.flags|=8192):h&&(o.flags|=8192),h?(u&536870912)!==0&&(o.flags&128)===0&&(ee(o),o.subtreeFlags&6&&(o.flags|=8192)):ee(o),u=o.updateQueue,u!==null&&dc(o,u.retryQueue),u=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),h=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(h=o.memoizedState.cachePool.pool),h!==u&&(o.flags|=2048),a!==null&&Q(Os),null;case 24:return u=null,a!==null&&(u=a.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),hi(de),ee(o),null;case 25:return null;case 30:return null}throw Error(i(156,o.tag))}function FA(a,o){switch(th(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return hi(de),ce(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return Al(o),null;case 31:if(o.memoizedState!==null){if(on(o),o.alternate===null)throw Error(i(340));Rs()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 13:if(on(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(i(340));Rs()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return Q(ue),null;case 4:return ce(),null;case 10:return hi(o.type),null;case 22:case 23:return on(o),gh(),a!==null&&Q(Os),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return hi(de),null;case 25:return null;default:return null}}function nb(a,o){switch(th(o),o.tag){case 3:hi(de),ce();break;case 26:case 27:case 5:Al(o);break;case 4:ce();break;case 31:o.memoizedState!==null&&on(o);break;case 13:on(o);break;case 19:Q(ue);break;case 10:hi(o.type);break;case 22:case 23:on(o),gh(),a!==null&&Q(Os);break;case 24:hi(de)}}function co(a,o){try{var u=o.updateQueue,h=u!==null?u.lastEffect:null;if(h!==null){var g=h.next;u=g;do{if((u.tag&a)===a){h=void 0;var m=u.create,v=u.inst;h=m(),v.destroy=h}u=u.next}while(u!==g)}}catch(S){Ht(o,o.return,S)}}function $i(a,o,u){try{var h=o.updateQueue,g=h!==null?h.lastEffect:null;if(g!==null){var m=g.next;h=m;do{if((h.tag&a)===a){var v=h.inst,S=v.destroy;if(S!==void 0){v.destroy=void 0,g=o;var M=u,j=S;try{j()}catch(K){Ht(g,M,K)}}}h=h.next}while(h!==m)}}catch(K){Ht(o,o.return,K)}}function ib(a){var o=a.updateQueue;if(o!==null){var u=a.stateNode;try{Ym(o,u)}catch(h){Ht(a,a.return,h)}}}function sb(a,o,u){u.props=Ns(a.type,a.memoizedProps),u.state=a.memoizedState;try{u.componentWillUnmount()}catch(h){Ht(a,o,h)}}function uo(a,o){try{var u=a.ref;if(u!==null){switch(a.tag){case 26:case 27:case 5:var h=a.stateNode;break;case 30:h=a.stateNode;break;default:h=a.stateNode}typeof u=="function"?a.refCleanup=u(h):u.current=h}}catch(g){Ht(a,o,g)}}function Yn(a,o){var u=a.ref,h=a.refCleanup;if(u!==null)if(typeof h=="function")try{h()}catch(g){Ht(a,o,g)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(g){Ht(a,o,g)}else u.current=null}function rb(a){var o=a.type,u=a.memoizedProps,h=a.stateNode;try{t:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&h.focus();break t;case"img":u.src?h.src=u.src:u.srcSet&&(h.srcset=u.srcSet)}}catch(g){Ht(a,a.return,g)}}function Yh(a,o,u){try{var h=a.stateNode;aw(h,a.type,u,o),h[$e]=o}catch(g){Ht(a,a.return,g)}}function ab(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Gi(a.type)||a.tag===4}function qh(a){t:for(;;){for(;a.sibling===null;){if(a.return===null||ab(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Gi(a.type)||a.flags&2||a.child===null||a.tag===4)continue t;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Kh(a,o,u){var h=a.tag;if(h===5||h===6)a=a.stateNode,o?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(a,o):(o=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,o.appendChild(a),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=oi));else if(h!==4&&(h===27&&Gi(a.type)&&(u=a.stateNode,o=null),a=a.child,a!==null))for(Kh(a,o,u),a=a.sibling;a!==null;)Kh(a,o,u),a=a.sibling}function pc(a,o,u){var h=a.tag;if(h===5||h===6)a=a.stateNode,o?u.insertBefore(a,o):u.appendChild(a);else if(h!==4&&(h===27&&Gi(a.type)&&(u=a.stateNode),a=a.child,a!==null))for(pc(a,o,u),a=a.sibling;a!==null;)pc(a,o,u),a=a.sibling}function ob(a){var o=a.stateNode,u=a.memoizedProps;try{for(var h=a.type,g=o.attributes;g.length;)o.removeAttributeNode(g[0]);De(o,h,u),o[Me]=a,o[$e]=u}catch(m){Ht(a,a.return,m)}}var mi=!1,_e=!1,Zh=!1,lb=typeof WeakSet=="function"?WeakSet:Set,we=null;function LA(a,o){if(a=a.containerInfo,md=Nc,a=vm(a),jf(a)){if("selectionStart"in a)var u={start:a.selectionStart,end:a.selectionEnd};else t:{u=(u=a.ownerDocument)&&u.defaultView||window;var h=u.getSelection&&u.getSelection();if(h&&h.rangeCount!==0){u=h.anchorNode;var g=h.anchorOffset,m=h.focusNode;h=h.focusOffset;try{u.nodeType,m.nodeType}catch{u=null;break t}var v=0,S=-1,M=-1,j=0,K=0,tt=a,W=null;e:for(;;){for(var X;tt!==u||g!==0&&tt.nodeType!==3||(S=v+g),tt!==m||h!==0&&tt.nodeType!==3||(M=v+h),tt.nodeType===3&&(v+=tt.nodeValue.length),(X=tt.firstChild)!==null;)W=tt,tt=X;for(;;){if(tt===a)break e;if(W===u&&++j===g&&(S=v),W===m&&++K===h&&(M=v),(X=tt.nextSibling)!==null)break;tt=W,W=tt.parentNode}tt=X}u=S===-1||M===-1?null:{start:S,end:M}}else u=null}u=u||{start:0,end:0}}else u=null;for(yd={focusedElem:a,selectionRange:u},Nc=!1,we=o;we!==null;)if(o=we,a=o.child,(o.subtreeFlags&1028)!==0&&a!==null)a.return=o,we=a;else for(;we!==null;){switch(o=we,m=o.alternate,a=o.flags,o.tag){case 0:if((a&4)!==0&&(a=o.updateQueue,a=a!==null?a.events:null,a!==null))for(u=0;u<a.length;u++)g=a[u],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&m!==null){a=void 0,u=o,g=m.memoizedProps,m=m.memoizedState,h=u.stateNode;try{var ct=Ns(u.type,g);a=h.getSnapshotBeforeUpdate(ct,m),h.__reactInternalSnapshotBeforeUpdate=a}catch(pt){Ht(u,u.return,pt)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,u=a.nodeType,u===9)xd(a);else if(u===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":xd(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(i(163))}if(a=o.sibling,a!==null){a.return=o.return,we=a;break}we=o.return}}function cb(a,o,u){var h=u.flags;switch(u.tag){case 0:case 11:case 15:bi(a,u),h&4&&co(5,u);break;case 1:if(bi(a,u),h&4)if(a=u.stateNode,o===null)try{a.componentDidMount()}catch(v){Ht(u,u.return,v)}else{var g=Ns(u.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(g,o,a.__reactInternalSnapshotBeforeUpdate)}catch(v){Ht(u,u.return,v)}}h&64&&ib(u),h&512&&uo(u,u.return);break;case 3:if(bi(a,u),h&64&&(a=u.updateQueue,a!==null)){if(o=null,u.child!==null)switch(u.child.tag){case 27:case 5:o=u.child.stateNode;break;case 1:o=u.child.stateNode}try{Ym(a,o)}catch(v){Ht(u,u.return,v)}}break;case 27:o===null&&h&4&&ob(u);case 26:case 5:bi(a,u),o===null&&h&4&&rb(u),h&512&&uo(u,u.return);break;case 12:bi(a,u);break;case 31:bi(a,u),h&4&&hb(a,u);break;case 13:bi(a,u),h&4&&db(a,u),h&64&&(a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(u=qA.bind(null,u),pw(a,u))));break;case 22:if(h=u.memoizedState!==null||mi,!h){o=o!==null&&o.memoizedState!==null||_e,g=mi;var m=_e;mi=h,(_e=o)&&!m?vi(a,u,(u.subtreeFlags&8772)!==0):bi(a,u),mi=g,_e=m}break;case 30:break;default:bi(a,u)}}function ub(a){var o=a.alternate;o!==null&&(a.alternate=null,ub(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&Ef(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var ie=null,Ye=!1;function yi(a,o,u){for(u=u.child;u!==null;)fb(a,o,u),u=u.sibling}function fb(a,o,u){if(en&&typeof en.onCommitFiberUnmount=="function")try{en.onCommitFiberUnmount(ka,u)}catch{}switch(u.tag){case 26:_e||Yn(u,o),yi(a,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:_e||Yn(u,o);var h=ie,g=Ye;Gi(u.type)&&(ie=u.stateNode,Ye=!1),yi(a,o,u),vo(u.stateNode),ie=h,Ye=g;break;case 5:_e||Yn(u,o);case 6:if(h=ie,g=Ye,ie=null,yi(a,o,u),ie=h,Ye=g,ie!==null)if(Ye)try{(ie.nodeType===9?ie.body:ie.nodeName==="HTML"?ie.ownerDocument.body:ie).removeChild(u.stateNode)}catch(m){Ht(u,o,m)}else try{ie.removeChild(u.stateNode)}catch(m){Ht(u,o,m)}break;case 18:ie!==null&&(Ye?(a=ie,i0(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,u.stateNode),Jr(a)):i0(ie,u.stateNode));break;case 4:h=ie,g=Ye,ie=u.stateNode.containerInfo,Ye=!0,yi(a,o,u),ie=h,Ye=g;break;case 0:case 11:case 14:case 15:$i(2,u,o),_e||$i(4,u,o),yi(a,o,u);break;case 1:_e||(Yn(u,o),h=u.stateNode,typeof h.componentWillUnmount=="function"&&sb(u,o,h)),yi(a,o,u);break;case 21:yi(a,o,u);break;case 22:_e=(h=_e)||u.memoizedState!==null,yi(a,o,u),_e=h;break;default:yi(a,o,u)}}function hb(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{Jr(a)}catch(u){Ht(o,o.return,u)}}}function db(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Jr(a)}catch(u){Ht(o,o.return,u)}}function zA(a){switch(a.tag){case 31:case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new lb),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new lb),o;default:throw Error(i(435,a.tag))}}function gc(a,o){var u=zA(a);o.forEach(function(h){if(!u.has(h)){u.add(h);var g=KA.bind(null,a,h);h.then(g,g)}})}function qe(a,o){var u=o.deletions;if(u!==null)for(var h=0;h<u.length;h++){var g=u[h],m=a,v=o,S=v;t:for(;S!==null;){switch(S.tag){case 27:if(Gi(S.type)){ie=S.stateNode,Ye=!1;break t}break;case 5:ie=S.stateNode,Ye=!1;break t;case 3:case 4:ie=S.stateNode.containerInfo,Ye=!0;break t}S=S.return}if(ie===null)throw Error(i(160));fb(m,v,g),ie=null,Ye=!1,m=g.alternate,m!==null&&(m.return=null),g.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)pb(o,a),o=o.sibling}var Fn=null;function pb(a,o){var u=a.alternate,h=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:qe(o,a),Ke(a),h&4&&($i(3,a,a.return),co(3,a),$i(5,a,a.return));break;case 1:qe(o,a),Ke(a),h&512&&(_e||u===null||Yn(u,u.return)),h&64&&mi&&(a=a.updateQueue,a!==null&&(h=a.callbacks,h!==null&&(u=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=u===null?h:u.concat(h))));break;case 26:var g=Fn;if(qe(o,a),Ke(a),h&512&&(_e||u===null||Yn(u,u.return)),h&4){var m=u!==null?u.memoizedState:null;if(h=a.memoizedState,u===null)if(h===null)if(a.stateNode===null){t:{h=a.type,u=a.memoizedProps,g=g.ownerDocument||g;e:switch(h){case"title":m=g.getElementsByTagName("title")[0],(!m||m[Ua]||m[Me]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=g.createElement(h),g.head.insertBefore(m,g.querySelector("head > title"))),De(m,h,u),m[Me]=a,Ae(m),h=m;break t;case"link":var v=p0("link","href",g).get(h+(u.href||""));if(v){for(var S=0;S<v.length;S++)if(m=v[S],m.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&m.getAttribute("rel")===(u.rel==null?null:u.rel)&&m.getAttribute("title")===(u.title==null?null:u.title)&&m.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){v.splice(S,1);break e}}m=g.createElement(h),De(m,h,u),g.head.appendChild(m);break;case"meta":if(v=p0("meta","content",g).get(h+(u.content||""))){for(S=0;S<v.length;S++)if(m=v[S],m.getAttribute("content")===(u.content==null?null:""+u.content)&&m.getAttribute("name")===(u.name==null?null:u.name)&&m.getAttribute("property")===(u.property==null?null:u.property)&&m.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&m.getAttribute("charset")===(u.charSet==null?null:u.charSet)){v.splice(S,1);break e}}m=g.createElement(h),De(m,h,u),g.head.appendChild(m);break;default:throw Error(i(468,h))}m[Me]=a,Ae(m),h=m}a.stateNode=h}else g0(g,a.type,a.stateNode);else a.stateNode=d0(g,h,a.memoizedProps);else m!==h?(m===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):m.count--,h===null?g0(g,a.type,a.stateNode):d0(g,h,a.memoizedProps)):h===null&&a.stateNode!==null&&Yh(a,a.memoizedProps,u.memoizedProps)}break;case 27:qe(o,a),Ke(a),h&512&&(_e||u===null||Yn(u,u.return)),u!==null&&h&4&&Yh(a,a.memoizedProps,u.memoizedProps);break;case 5:if(qe(o,a),Ke(a),h&512&&(_e||u===null||Yn(u,u.return)),a.flags&32){g=a.stateNode;try{Tr(g,"")}catch(ct){Ht(a,a.return,ct)}}h&4&&a.stateNode!=null&&(g=a.memoizedProps,Yh(a,g,u!==null?u.memoizedProps:g)),h&1024&&(Zh=!0);break;case 6:if(qe(o,a),Ke(a),h&4){if(a.stateNode===null)throw Error(i(162));h=a.memoizedProps,u=a.stateNode;try{u.nodeValue=h}catch(ct){Ht(a,a.return,ct)}}break;case 3:if(Ic=null,g=Fn,Fn=Mc(o.containerInfo),qe(o,a),Fn=g,Ke(a),h&4&&u!==null&&u.memoizedState.isDehydrated)try{Jr(o.containerInfo)}catch(ct){Ht(a,a.return,ct)}Zh&&(Zh=!1,gb(a));break;case 4:h=Fn,Fn=Mc(a.stateNode.containerInfo),qe(o,a),Ke(a),Fn=h;break;case 12:qe(o,a),Ke(a);break;case 31:qe(o,a),Ke(a),h&4&&(h=a.updateQueue,h!==null&&(a.updateQueue=null,gc(a,h)));break;case 13:qe(o,a),Ke(a),a.child.flags&8192&&a.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(mc=tn()),h&4&&(h=a.updateQueue,h!==null&&(a.updateQueue=null,gc(a,h)));break;case 22:g=a.memoizedState!==null;var M=u!==null&&u.memoizedState!==null,j=mi,K=_e;if(mi=j||g,_e=K||M,qe(o,a),_e=K,mi=j,Ke(a),h&8192)t:for(o=a.stateNode,o._visibility=g?o._visibility&-2:o._visibility|1,g&&(u===null||M||mi||_e||Bs(a)),u=null,o=a;;){if(o.tag===5||o.tag===26){if(u===null){M=u=o;try{if(m=M.stateNode,g)v=m.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none";else{S=M.stateNode;var tt=M.memoizedProps.style,W=tt!=null&&tt.hasOwnProperty("display")?tt.display:null;S.style.display=W==null||typeof W=="boolean"?"":(""+W).trim()}}catch(ct){Ht(M,M.return,ct)}}}else if(o.tag===6){if(u===null){M=o;try{M.stateNode.nodeValue=g?"":M.memoizedProps}catch(ct){Ht(M,M.return,ct)}}}else if(o.tag===18){if(u===null){M=o;try{var X=M.stateNode;g?s0(X,!0):s0(M.stateNode,!1)}catch(ct){Ht(M,M.return,ct)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break t;for(;o.sibling===null;){if(o.return===null||o.return===a)break t;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}h&4&&(h=a.updateQueue,h!==null&&(u=h.retryQueue,u!==null&&(h.retryQueue=null,gc(a,u))));break;case 19:qe(o,a),Ke(a),h&4&&(h=a.updateQueue,h!==null&&(a.updateQueue=null,gc(a,h)));break;case 30:break;case 21:break;default:qe(o,a),Ke(a)}}function Ke(a){var o=a.flags;if(o&2){try{for(var u,h=a.return;h!==null;){if(ab(h)){u=h;break}h=h.return}if(u==null)throw Error(i(160));switch(u.tag){case 27:var g=u.stateNode,m=qh(a);pc(a,m,g);break;case 5:var v=u.stateNode;u.flags&32&&(Tr(v,""),u.flags&=-33);var S=qh(a);pc(a,S,v);break;case 3:case 4:var M=u.stateNode.containerInfo,j=qh(a);Kh(a,j,M);break;default:throw Error(i(161))}}catch(K){Ht(a,a.return,K)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function gb(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;gb(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function bi(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)cb(a,o.alternate,o),o=o.sibling}function Bs(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:$i(4,o,o.return),Bs(o);break;case 1:Yn(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&sb(o,o.return,u),Bs(o);break;case 27:vo(o.stateNode);case 26:case 5:Yn(o,o.return),Bs(o);break;case 22:o.memoizedState===null&&Bs(o);break;case 30:Bs(o);break;default:Bs(o)}a=a.sibling}}function vi(a,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var h=o.alternate,g=a,m=o,v=m.flags;switch(m.tag){case 0:case 11:case 15:vi(g,m,u),co(4,m);break;case 1:if(vi(g,m,u),h=m,g=h.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(j){Ht(h,h.return,j)}if(h=m,g=h.updateQueue,g!==null){var S=h.stateNode;try{var M=g.shared.hiddenCallbacks;if(M!==null)for(g.shared.hiddenCallbacks=null,g=0;g<M.length;g++)Xm(M[g],S)}catch(j){Ht(h,h.return,j)}}u&&v&64&&ib(m),uo(m,m.return);break;case 27:ob(m);case 26:case 5:vi(g,m,u),u&&h===null&&v&4&&rb(m),uo(m,m.return);break;case 12:vi(g,m,u);break;case 31:vi(g,m,u),u&&v&4&&hb(g,m);break;case 13:vi(g,m,u),u&&v&4&&db(g,m);break;case 22:m.memoizedState===null&&vi(g,m,u),uo(m,m.return);break;case 30:break;default:vi(g,m,u)}o=o.sibling}}function Qh(a,o){var u=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==u&&(a!=null&&a.refCount++,u!=null&&Za(u))}function Gh(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Za(a))}function Ln(a,o,u,h){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)_b(a,o,u,h),o=o.sibling}function _b(a,o,u,h){var g=o.flags;switch(o.tag){case 0:case 11:case 15:Ln(a,o,u,h),g&2048&&co(9,o);break;case 1:Ln(a,o,u,h);break;case 3:Ln(a,o,u,h),g&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Za(a)));break;case 12:if(g&2048){Ln(a,o,u,h),a=o.stateNode;try{var m=o.memoizedProps,v=m.id,S=m.onPostCommit;typeof S=="function"&&S(v,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(M){Ht(o,o.return,M)}}else Ln(a,o,u,h);break;case 31:Ln(a,o,u,h);break;case 13:Ln(a,o,u,h);break;case 23:break;case 22:m=o.stateNode,v=o.alternate,o.memoizedState!==null?m._visibility&2?Ln(a,o,u,h):fo(a,o):m._visibility&2?Ln(a,o,u,h):(m._visibility|=2,Hr(a,o,u,h,(o.subtreeFlags&10256)!==0||!1)),g&2048&&Qh(v,o);break;case 24:Ln(a,o,u,h),g&2048&&Gh(o.alternate,o);break;default:Ln(a,o,u,h)}}function Hr(a,o,u,h,g){for(g=g&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var m=a,v=o,S=u,M=h,j=v.flags;switch(v.tag){case 0:case 11:case 15:Hr(m,v,S,M,g),co(8,v);break;case 23:break;case 22:var K=v.stateNode;v.memoizedState!==null?K._visibility&2?Hr(m,v,S,M,g):fo(m,v):(K._visibility|=2,Hr(m,v,S,M,g)),g&&j&2048&&Qh(v.alternate,v);break;case 24:Hr(m,v,S,M,g),g&&j&2048&&Gh(v.alternate,v);break;default:Hr(m,v,S,M,g)}o=o.sibling}}function fo(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=a,h=o,g=h.flags;switch(h.tag){case 22:fo(u,h),g&2048&&Qh(h.alternate,h);break;case 24:fo(u,h),g&2048&&Gh(h.alternate,h);break;default:fo(u,h)}o=o.sibling}}var ho=8192;function jr(a,o,u){if(a.subtreeFlags&ho)for(a=a.child;a!==null;)mb(a,o,u),a=a.sibling}function mb(a,o,u){switch(a.tag){case 26:jr(a,o,u),a.flags&ho&&a.memoizedState!==null&&Ew(u,Fn,a.memoizedState,a.memoizedProps);break;case 5:jr(a,o,u);break;case 3:case 4:var h=Fn;Fn=Mc(a.stateNode.containerInfo),jr(a,o,u),Fn=h;break;case 22:a.memoizedState===null&&(h=a.alternate,h!==null&&h.memoizedState!==null?(h=ho,ho=16777216,jr(a,o,u),ho=h):jr(a,o,u));break;default:jr(a,o,u)}}function yb(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function po(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var h=o[u];we=h,vb(h,a)}yb(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)bb(a),a=a.sibling}function bb(a){switch(a.tag){case 0:case 11:case 15:po(a),a.flags&2048&&$i(9,a,a.return);break;case 3:po(a);break;case 12:po(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,_c(a)):po(a);break;default:po(a)}}function _c(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var h=o[u];we=h,vb(h,a)}yb(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:$i(8,o,o.return),_c(o);break;case 22:u=o.stateNode,u._visibility&2&&(u._visibility&=-3,_c(o));break;default:_c(o)}a=a.sibling}}function vb(a,o){for(;we!==null;){var u=we;switch(u.tag){case 0:case 11:case 15:$i(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var h=u.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:Za(u.memoizedState.cache)}if(h=u.child,h!==null)h.return=u,we=h;else t:for(u=a;we!==null;){h=we;var g=h.sibling,m=h.return;if(ub(h),h===u){we=null;break t}if(g!==null){g.return=m,we=g;break t}we=m}}}var VA={getCacheForType:function(a){var o=Ie(de),u=o.data.get(a);return u===void 0&&(u=a(),o.data.set(a,u)),u},cacheSignal:function(){return Ie(de).controller.signal}},HA=typeof WeakMap=="function"?WeakMap:Map,Nt=0,Zt=null,wt=null,Rt=0,Vt=0,ln=null,Xi=!1,Wr=!1,Jh=!1,xi=0,ae=0,Yi=0,Us=0,td=0,cn=0,$r=0,go=null,Ze=null,ed=!1,mc=0,xb=0,yc=1/0,bc=null,qi=null,ve=0,Ki=null,Xr=null,Ti=0,nd=0,id=null,Tb=null,_o=0,sd=null;function un(){return(Nt&2)!==0&&Rt!==0?Rt&-Rt:$.T!==null?ud():F_()}function Sb(){if(cn===0)if((Rt&536870912)===0||Mt){var a=Rl;Rl<<=1,(Rl&3932160)===0&&(Rl=262144),cn=a}else cn=536870912;return a=an.current,a!==null&&(a.flags|=32),cn}function Qe(a,o,u){(a===Zt&&(Vt===2||Vt===9)||a.cancelPendingCommit!==null)&&(Yr(a,0),Zi(a,Rt,cn,!1)),Ba(a,u),((Nt&2)===0||a!==Zt)&&(a===Zt&&((Nt&2)===0&&(Us|=u),ae===4&&Zi(a,Rt,cn,!1)),qn(a))}function Ab(a,o,u){if((Nt&6)!==0)throw Error(i(327));var h=!u&&(o&127)===0&&(o&a.expiredLanes)===0||Na(a,o),g=h?$A(a,o):ad(a,o,!0),m=h;do{if(g===0){Wr&&!h&&Zi(a,o,0,!1);break}else{if(u=a.current.alternate,m&&!jA(u)){g=ad(a,o,!1),m=!1;continue}if(g===2){if(m=o,a.errorRecoveryDisabledLanes&m)var v=0;else v=a.pendingLanes&-536870913,v=v!==0?v:v&536870912?536870912:0;if(v!==0){o=v;t:{var S=a;g=go;var M=S.current.memoizedState.isDehydrated;if(M&&(Yr(S,v).flags|=256),v=ad(S,v,!1),v!==2){if(Jh&&!M){S.errorRecoveryDisabledLanes|=m,Us|=m,g=4;break t}m=Ze,Ze=g,m!==null&&(Ze===null?Ze=m:Ze.push.apply(Ze,m))}g=v}if(m=!1,g!==2)continue}}if(g===1){Yr(a,0),Zi(a,o,0,!0);break}t:{switch(h=a,m=g,m){case 0:case 1:throw Error(i(345));case 4:if((o&4194048)!==o)break;case 6:Zi(h,o,cn,!Xi);break t;case 2:Ze=null;break;case 3:case 5:break;default:throw Error(i(329))}if((o&62914560)===o&&(g=mc+300-tn(),10<g)){if(Zi(h,o,cn,!Xi),Ml(h,0,!0)!==0)break t;Ti=o,h.timeoutHandle=e0(wb.bind(null,h,u,Ze,bc,ed,o,cn,Us,$r,Xi,m,"Throttled",-0,0),g);break t}wb(h,u,Ze,bc,ed,o,cn,Us,$r,Xi,m,null,-0,0)}}break}while(!0);qn(a)}function wb(a,o,u,h,g,m,v,S,M,j,K,tt,W,X){if(a.timeoutHandle=-1,tt=o.subtreeFlags,tt&8192||(tt&16785408)===16785408){tt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:oi},mb(o,m,tt);var ct=(m&62914560)===m?mc-tn():(m&4194048)===m?xb-tn():0;if(ct=Rw(tt,ct),ct!==null){Ti=m,a.cancelPendingCommit=ct(Db.bind(null,a,o,m,u,h,g,v,S,M,K,tt,null,W,X)),Zi(a,m,v,!j);return}}Db(a,o,m,u,h,g,v,S,M)}function jA(a){for(var o=a;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var h=0;h<u.length;h++){var g=u[h],m=g.getSnapshot;g=g.value;try{if(!sn(m(),g))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Zi(a,o,u,h){o&=~td,o&=~Us,a.suspendedLanes|=o,a.pingedLanes&=~o,h&&(a.warmLanes|=o),h=a.expirationTimes;for(var g=o;0<g;){var m=31-nn(g),v=1<<m;h[m]=-1,g&=~v}u!==0&&N_(a,u,o)}function vc(){return(Nt&6)===0?(mo(0),!1):!0}function rd(){if(wt!==null){if(Vt===0)var a=wt.return;else a=wt,fi=Cs=null,xh(a),Ur=null,Ga=0,a=wt;for(;a!==null;)nb(a.alternate,a),a=a.return;wt=null}}function Yr(a,o){var u=a.timeoutHandle;u!==-1&&(a.timeoutHandle=-1,cw(u)),u=a.cancelPendingCommit,u!==null&&(a.cancelPendingCommit=null,u()),Ti=0,rd(),Zt=a,wt=u=ci(a.current,null),Rt=o,Vt=0,ln=null,Xi=!1,Wr=Na(a,o),Jh=!1,$r=cn=td=Us=Yi=ae=0,Ze=go=null,ed=!1,(o&8)!==0&&(o|=o&32);var h=a.entangledLanes;if(h!==0)for(a=a.entanglements,h&=o;0<h;){var g=31-nn(h),m=1<<g;o|=a[g],h&=~m}return xi=o,Vl(),u}function Eb(a,o){Tt=null,$.H=ao,o===Br||o===Kl?(o=Hm(),Vt=3):o===ch?(o=Hm(),Vt=4):Vt=o===Uh?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,ln=o,wt===null&&(ae=1,cc(a,yn(o,a.current)))}function Rb(){var a=an.current;return a===null?!0:(Rt&4194048)===Rt?Tn===null:(Rt&62914560)===Rt||(Rt&536870912)!==0?a===Tn:!1}function Cb(){var a=$.H;return $.H=ao,a===null?ao:a}function Mb(){var a=$.A;return $.A=VA,a}function xc(){ae=4,Xi||(Rt&4194048)!==Rt&&an.current!==null||(Wr=!0),(Yi&134217727)===0&&(Us&134217727)===0||Zt===null||Zi(Zt,Rt,cn,!1)}function ad(a,o,u){var h=Nt;Nt|=2;var g=Cb(),m=Mb();(Zt!==a||Rt!==o)&&(bc=null,Yr(a,o)),o=!1;var v=ae;t:do try{if(Vt!==0&&wt!==null){var S=wt,M=ln;switch(Vt){case 8:rd(),v=6;break t;case 3:case 2:case 9:case 6:an.current===null&&(o=!0);var j=Vt;if(Vt=0,ln=null,qr(a,S,M,j),u&&Wr){v=0;break t}break;default:j=Vt,Vt=0,ln=null,qr(a,S,M,j)}}WA(),v=ae;break}catch(K){Eb(a,K)}while(!0);return o&&a.shellSuspendCounter++,fi=Cs=null,Nt=h,$.H=g,$.A=m,wt===null&&(Zt=null,Rt=0,Vl()),v}function WA(){for(;wt!==null;)Ob(wt)}function $A(a,o){var u=Nt;Nt|=2;var h=Cb(),g=Mb();Zt!==a||Rt!==o?(bc=null,yc=tn()+500,Yr(a,o)):Wr=Na(a,o);t:do try{if(Vt!==0&&wt!==null){o=wt;var m=ln;e:switch(Vt){case 1:Vt=0,ln=null,qr(a,o,m,1);break;case 2:case 9:if(zm(m)){Vt=0,ln=null,Ib(o);break}o=function(){Vt!==2&&Vt!==9||Zt!==a||(Vt=7),qn(a)},m.then(o,o);break t;case 3:Vt=7;break t;case 4:Vt=5;break t;case 7:zm(m)?(Vt=0,ln=null,Ib(o)):(Vt=0,ln=null,qr(a,o,m,7));break;case 5:var v=null;switch(wt.tag){case 26:v=wt.memoizedState;case 5:case 27:var S=wt;if(v?_0(v):S.stateNode.complete){Vt=0,ln=null;var M=S.sibling;if(M!==null)wt=M;else{var j=S.return;j!==null?(wt=j,Tc(j)):wt=null}break e}}Vt=0,ln=null,qr(a,o,m,5);break;case 6:Vt=0,ln=null,qr(a,o,m,6);break;case 8:rd(),ae=6;break t;default:throw Error(i(462))}}XA();break}catch(K){Eb(a,K)}while(!0);return fi=Cs=null,$.H=h,$.A=g,Nt=u,wt!==null?0:(Zt=null,Rt=0,Vl(),ae)}function XA(){for(;wt!==null&&!gS();)Ob(wt)}function Ob(a){var o=tb(a.alternate,a,xi);a.memoizedProps=a.pendingProps,o===null?Tc(a):wt=o}function Ib(a){var o=a,u=o.alternate;switch(o.tag){case 15:case 0:o=qy(u,o,o.pendingProps,o.type,void 0,Rt);break;case 11:o=qy(u,o,o.pendingProps,o.type.render,o.ref,Rt);break;case 5:xh(o);default:nb(u,o),o=wt=Mm(o,xi),o=tb(u,o,xi)}a.memoizedProps=a.pendingProps,o===null?Tc(a):wt=o}function qr(a,o,u,h){fi=Cs=null,xh(o),Ur=null,Ga=0;var g=o.return;try{if(kA(a,g,o,u,Rt)){ae=1,cc(a,yn(u,a.current)),wt=null;return}}catch(m){if(g!==null)throw wt=g,m;ae=1,cc(a,yn(u,a.current)),wt=null;return}o.flags&32768?(Mt||h===1?a=!0:Wr||(Rt&536870912)!==0?a=!1:(Xi=a=!0,(h===2||h===9||h===3||h===6)&&(h=an.current,h!==null&&h.tag===13&&(h.flags|=16384))),Pb(o,a)):Tc(o)}function Tc(a){var o=a;do{if((o.flags&32768)!==0){Pb(o,Xi);return}a=o.return;var u=UA(o.alternate,o,xi);if(u!==null){wt=u;return}if(o=o.sibling,o!==null){wt=o;return}wt=o=a}while(o!==null);ae===0&&(ae=5)}function Pb(a,o){do{var u=FA(a.alternate,a);if(u!==null){u.flags&=32767,wt=u;return}if(u=a.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(a=a.sibling,a!==null)){wt=a;return}wt=a=u}while(a!==null);ae=6,wt=null}function Db(a,o,u,h,g,m,v,S,M){a.cancelPendingCommit=null;do Sc();while(ve!==0);if((Nt&6)!==0)throw Error(i(327));if(o!==null){if(o===a.current)throw Error(i(177));if(m=o.lanes|o.childLanes,m|=qf,wS(a,u,m,v,S,M),a===Zt&&(wt=Zt=null,Rt=0),Xr=o,Ki=a,Ti=u,nd=m,id=g,Tb=h,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,ZA(wl,function(){return Fb(),null})):(a.callbackNode=null,a.callbackPriority=0),h=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||h){h=$.T,$.T=null,g=it.p,it.p=2,v=Nt,Nt|=4;try{LA(a,o,u)}finally{Nt=v,it.p=g,$.T=h}}ve=1,kb(),Nb(),Bb()}}function kb(){if(ve===1){ve=0;var a=Ki,o=Xr,u=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||u){u=$.T,$.T=null;var h=it.p;it.p=2;var g=Nt;Nt|=4;try{pb(o,a);var m=yd,v=vm(a.containerInfo),S=m.focusedElem,M=m.selectionRange;if(v!==S&&S&&S.ownerDocument&&bm(S.ownerDocument.documentElement,S)){if(M!==null&&jf(S)){var j=M.start,K=M.end;if(K===void 0&&(K=j),"selectionStart"in S)S.selectionStart=j,S.selectionEnd=Math.min(K,S.value.length);else{var tt=S.ownerDocument||document,W=tt&&tt.defaultView||window;if(W.getSelection){var X=W.getSelection(),ct=S.textContent.length,pt=Math.min(M.start,ct),Xt=M.end===void 0?pt:Math.min(M.end,ct);!X.extend&&pt>Xt&&(v=Xt,Xt=pt,pt=v);var F=ym(S,pt),I=ym(S,Xt);if(F&&I&&(X.rangeCount!==1||X.anchorNode!==F.node||X.anchorOffset!==F.offset||X.focusNode!==I.node||X.focusOffset!==I.offset)){var H=tt.createRange();H.setStart(F.node,F.offset),X.removeAllRanges(),pt>Xt?(X.addRange(H),X.extend(I.node,I.offset)):(H.setEnd(I.node,I.offset),X.addRange(H))}}}}for(tt=[],X=S;X=X.parentNode;)X.nodeType===1&&tt.push({element:X,left:X.scrollLeft,top:X.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<tt.length;S++){var Z=tt[S];Z.element.scrollLeft=Z.left,Z.element.scrollTop=Z.top}}Nc=!!md,yd=md=null}finally{Nt=g,it.p=h,$.T=u}}a.current=o,ve=2}}function Nb(){if(ve===2){ve=0;var a=Ki,o=Xr,u=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||u){u=$.T,$.T=null;var h=it.p;it.p=2;var g=Nt;Nt|=4;try{cb(a,o.alternate,o)}finally{Nt=g,it.p=h,$.T=u}}ve=3}}function Bb(){if(ve===4||ve===3){ve=0,_S();var a=Ki,o=Xr,u=Ti,h=Tb;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?ve=5:(ve=0,Xr=Ki=null,Ub(a,a.pendingLanes));var g=a.pendingLanes;if(g===0&&(qi=null),Af(u),o=o.stateNode,en&&typeof en.onCommitFiberRoot=="function")try{en.onCommitFiberRoot(ka,o,void 0,(o.current.flags&128)===128)}catch{}if(h!==null){o=$.T,g=it.p,it.p=2,$.T=null;try{for(var m=a.onRecoverableError,v=0;v<h.length;v++){var S=h[v];m(S.value,{componentStack:S.stack})}}finally{$.T=o,it.p=g}}(Ti&3)!==0&&Sc(),qn(a),g=a.pendingLanes,(u&261930)!==0&&(g&42)!==0?a===sd?_o++:(_o=0,sd=a):_o=0,mo(0)}}function Ub(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,Za(o)))}function Sc(){return kb(),Nb(),Bb(),Fb()}function Fb(){if(ve!==5)return!1;var a=Ki,o=nd;nd=0;var u=Af(Ti),h=$.T,g=it.p;try{it.p=32>u?32:u,$.T=null,u=id,id=null;var m=Ki,v=Ti;if(ve=0,Xr=Ki=null,Ti=0,(Nt&6)!==0)throw Error(i(331));var S=Nt;if(Nt|=4,bb(m.current),_b(m,m.current,v,u),Nt=S,mo(0,!1),en&&typeof en.onPostCommitFiberRoot=="function")try{en.onPostCommitFiberRoot(ka,m)}catch{}return!0}finally{it.p=g,$.T=h,Ub(a,o)}}function Lb(a,o,u){o=yn(u,o),o=Bh(a.stateNode,o,2),a=Hi(a,o,2),a!==null&&(Ba(a,2),qn(a))}function Ht(a,o,u){if(a.tag===3)Lb(a,a,u);else for(;o!==null;){if(o.tag===3){Lb(o,a,u);break}else if(o.tag===1){var h=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(qi===null||!qi.has(h))){a=yn(u,a),u=zy(2),h=Hi(o,u,2),h!==null&&(Vy(u,h,o,a),Ba(h,2),qn(h));break}}o=o.return}}function od(a,o,u){var h=a.pingCache;if(h===null){h=a.pingCache=new HA;var g=new Set;h.set(o,g)}else g=h.get(o),g===void 0&&(g=new Set,h.set(o,g));g.has(u)||(Jh=!0,g.add(u),a=YA.bind(null,a,o,u),o.then(a,a))}function YA(a,o,u){var h=a.pingCache;h!==null&&h.delete(o),a.pingedLanes|=a.suspendedLanes&u,a.warmLanes&=~u,Zt===a&&(Rt&u)===u&&(ae===4||ae===3&&(Rt&62914560)===Rt&&300>tn()-mc?(Nt&2)===0&&Yr(a,0):td|=u,$r===Rt&&($r=0)),qn(a)}function zb(a,o){o===0&&(o=k_()),a=ws(a,o),a!==null&&(Ba(a,o),qn(a))}function qA(a){var o=a.memoizedState,u=0;o!==null&&(u=o.retryLane),zb(a,u)}function KA(a,o){var u=0;switch(a.tag){case 31:case 13:var h=a.stateNode,g=a.memoizedState;g!==null&&(u=g.retryLane);break;case 19:h=a.stateNode;break;case 22:h=a.stateNode._retryCache;break;default:throw Error(i(314))}h!==null&&h.delete(o),zb(a,u)}function ZA(a,o){return vf(a,o)}var Ac=null,Kr=null,ld=!1,wc=!1,cd=!1,Qi=0;function qn(a){a!==Kr&&a.next===null&&(Kr===null?Ac=Kr=a:Kr=Kr.next=a),wc=!0,ld||(ld=!0,GA())}function mo(a,o){if(!cd&&wc){cd=!0;do for(var u=!1,h=Ac;h!==null;){if(a!==0){var g=h.pendingLanes;if(g===0)var m=0;else{var v=h.suspendedLanes,S=h.pingedLanes;m=(1<<31-nn(42|a)+1)-1,m&=g&~(v&~S),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(u=!0,Wb(h,m))}else m=Rt,m=Ml(h,h===Zt?m:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),(m&3)===0||Na(h,m)||(u=!0,Wb(h,m));h=h.next}while(u);cd=!1}}function QA(){Vb()}function Vb(){wc=ld=!1;var a=0;Qi!==0&&lw()&&(a=Qi);for(var o=tn(),u=null,h=Ac;h!==null;){var g=h.next,m=Hb(h,o);m===0?(h.next=null,u===null?Ac=g:u.next=g,g===null&&(Kr=u)):(u=h,(a!==0||(m&3)!==0)&&(wc=!0)),h=g}ve!==0&&ve!==5||mo(a),Qi!==0&&(Qi=0)}function Hb(a,o){for(var u=a.suspendedLanes,h=a.pingedLanes,g=a.expirationTimes,m=a.pendingLanes&-62914561;0<m;){var v=31-nn(m),S=1<<v,M=g[v];M===-1?((S&u)===0||(S&h)!==0)&&(g[v]=AS(S,o)):M<=o&&(a.expiredLanes|=S),m&=~S}if(o=Zt,u=Rt,u=Ml(a,a===o?u:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),h=a.callbackNode,u===0||a===o&&(Vt===2||Vt===9)||a.cancelPendingCommit!==null)return h!==null&&h!==null&&xf(h),a.callbackNode=null,a.callbackPriority=0;if((u&3)===0||Na(a,u)){if(o=u&-u,o===a.callbackPriority)return o;switch(h!==null&&xf(h),Af(u)){case 2:case 8:u=P_;break;case 32:u=wl;break;case 268435456:u=D_;break;default:u=wl}return h=jb.bind(null,a),u=vf(u,h),a.callbackPriority=o,a.callbackNode=u,o}return h!==null&&h!==null&&xf(h),a.callbackPriority=2,a.callbackNode=null,2}function jb(a,o){if(ve!==0&&ve!==5)return a.callbackNode=null,a.callbackPriority=0,null;var u=a.callbackNode;if(Sc()&&a.callbackNode!==u)return null;var h=Rt;return h=Ml(a,a===Zt?h:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),h===0?null:(Ab(a,h,o),Hb(a,tn()),a.callbackNode!=null&&a.callbackNode===u?jb.bind(null,a):null)}function Wb(a,o){if(Sc())return null;Ab(a,o,!0)}function GA(){uw(function(){(Nt&6)!==0?vf(I_,QA):Vb()})}function ud(){if(Qi===0){var a=kr;a===0&&(a=El,El<<=1,(El&261888)===0&&(El=256)),Qi=a}return Qi}function $b(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Dl(""+a)}function Xb(a,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,a.id&&u.setAttribute("form",a.id),o.parentNode.insertBefore(u,o),a=new FormData(a),u.parentNode.removeChild(u),a}function JA(a,o,u,h,g){if(o==="submit"&&u&&u.stateNode===g){var m=$b((g[$e]||null).action),v=h.submitter;v&&(o=(o=v[$e]||null)?$b(o.formAction):v.getAttribute("formAction"),o!==null&&(m=o,v=null));var S=new Ul("action","action",null,h,g);a.push({event:S,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(Qi!==0){var M=v?Xb(g,v):new FormData(g);Oh(u,{pending:!0,data:M,method:g.method,action:m},null,M)}}else typeof m=="function"&&(S.preventDefault(),M=v?Xb(g,v):new FormData(g),Oh(u,{pending:!0,data:M,method:g.method,action:m},m,M))},currentTarget:g}]})}}for(var fd=0;fd<Yf.length;fd++){var hd=Yf[fd],tw=hd.toLowerCase(),ew=hd[0].toUpperCase()+hd.slice(1);Un(tw,"on"+ew)}Un(Sm,"onAnimationEnd"),Un(Am,"onAnimationIteration"),Un(wm,"onAnimationStart"),Un("dblclick","onDoubleClick"),Un("focusin","onFocus"),Un("focusout","onBlur"),Un(mA,"onTransitionRun"),Un(yA,"onTransitionStart"),Un(bA,"onTransitionCancel"),Un(Em,"onTransitionEnd"),vr("onMouseEnter",["mouseout","mouseover"]),vr("onMouseLeave",["mouseout","mouseover"]),vr("onPointerEnter",["pointerout","pointerover"]),vr("onPointerLeave",["pointerout","pointerover"]),xs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),xs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),xs("onBeforeInput",["compositionend","keypress","textInput","paste"]),xs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),xs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),xs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nw=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(yo));function Yb(a,o){o=(o&4)!==0;for(var u=0;u<a.length;u++){var h=a[u],g=h.event;h=h.listeners;t:{var m=void 0;if(o)for(var v=h.length-1;0<=v;v--){var S=h[v],M=S.instance,j=S.currentTarget;if(S=S.listener,M!==m&&g.isPropagationStopped())break t;m=S,g.currentTarget=j;try{m(g)}catch(K){zl(K)}g.currentTarget=null,m=M}else for(v=0;v<h.length;v++){if(S=h[v],M=S.instance,j=S.currentTarget,S=S.listener,M!==m&&g.isPropagationStopped())break t;m=S,g.currentTarget=j;try{m(g)}catch(K){zl(K)}g.currentTarget=null,m=M}}}}function Et(a,o){var u=o[wf];u===void 0&&(u=o[wf]=new Set);var h=a+"__bubble";u.has(h)||(qb(o,a,2,!1),u.add(h))}function dd(a,o,u){var h=0;o&&(h|=4),qb(u,a,h,o)}var Ec="_reactListening"+Math.random().toString(36).slice(2);function pd(a){if(!a[Ec]){a[Ec]=!0,V_.forEach(function(u){u!=="selectionchange"&&(nw.has(u)||dd(u,!1,a),dd(u,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[Ec]||(o[Ec]=!0,dd("selectionchange",!1,o))}}function qb(a,o,u,h){switch(S0(o)){case 2:var g=Ow;break;case 8:g=Iw;break;default:g=Md}u=g.bind(null,o,u,a),g=void 0,!kf||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(g=!0),h?g!==void 0?a.addEventListener(o,u,{capture:!0,passive:g}):a.addEventListener(o,u,!0):g!==void 0?a.addEventListener(o,u,{passive:g}):a.addEventListener(o,u,!1)}function gd(a,o,u,h,g){var m=h;if((o&1)===0&&(o&2)===0&&h!==null)t:for(;;){if(h===null)return;var v=h.tag;if(v===3||v===4){var S=h.stateNode.containerInfo;if(S===g)break;if(v===4)for(v=h.return;v!==null;){var M=v.tag;if((M===3||M===4)&&v.stateNode.containerInfo===g)return;v=v.return}for(;S!==null;){if(v=mr(S),v===null)return;if(M=v.tag,M===5||M===6||M===26||M===27){h=m=v;continue t}S=S.parentNode}}h=h.return}J_(function(){var j=m,K=Pf(u),tt=[];t:{var W=Rm.get(a);if(W!==void 0){var X=Ul,ct=a;switch(a){case"keypress":if(Nl(u)===0)break t;case"keydown":case"keyup":X=KS;break;case"focusin":ct="focus",X=Ff;break;case"focusout":ct="blur",X=Ff;break;case"beforeblur":case"afterblur":X=Ff;break;case"click":if(u.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":X=nm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":X=US;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":X=GS;break;case Sm:case Am:case wm:X=zS;break;case Em:X=tA;break;case"scroll":case"scrollend":X=NS;break;case"wheel":X=nA;break;case"copy":case"cut":case"paste":X=HS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":X=sm;break;case"toggle":case"beforetoggle":X=sA}var pt=(o&4)!==0,Xt=!pt&&(a==="scroll"||a==="scrollend"),F=pt?W!==null?W+"Capture":null:W;pt=[];for(var I=j,H;I!==null;){var Z=I;if(H=Z.stateNode,Z=Z.tag,Z!==5&&Z!==26&&Z!==27||H===null||F===null||(Z=La(I,F),Z!=null&&pt.push(bo(I,Z,H))),Xt)break;I=I.return}0<pt.length&&(W=new X(W,ct,null,u,K),tt.push({event:W,listeners:pt}))}}if((o&7)===0){t:{if(W=a==="mouseover"||a==="pointerover",X=a==="mouseout"||a==="pointerout",W&&u!==If&&(ct=u.relatedTarget||u.fromElement)&&(mr(ct)||ct[_r]))break t;if((X||W)&&(W=K.window===K?K:(W=K.ownerDocument)?W.defaultView||W.parentWindow:window,X?(ct=u.relatedTarget||u.toElement,X=j,ct=ct?mr(ct):null,ct!==null&&(Xt=r(ct),pt=ct.tag,ct!==Xt||pt!==5&&pt!==27&&pt!==6)&&(ct=null)):(X=null,ct=j),X!==ct)){if(pt=nm,Z="onMouseLeave",F="onMouseEnter",I="mouse",(a==="pointerout"||a==="pointerover")&&(pt=sm,Z="onPointerLeave",F="onPointerEnter",I="pointer"),Xt=X==null?W:Fa(X),H=ct==null?W:Fa(ct),W=new pt(Z,I+"leave",X,u,K),W.target=Xt,W.relatedTarget=H,Z=null,mr(K)===j&&(pt=new pt(F,I+"enter",ct,u,K),pt.target=H,pt.relatedTarget=Xt,Z=pt),Xt=Z,X&&ct)e:{for(pt=iw,F=X,I=ct,H=0,Z=F;Z;Z=pt(Z))H++;Z=0;for(var ft=I;ft;ft=pt(ft))Z++;for(;0<H-Z;)F=pt(F),H--;for(;0<Z-H;)I=pt(I),Z--;for(;H--;){if(F===I||I!==null&&F===I.alternate){pt=F;break e}F=pt(F),I=pt(I)}pt=null}else pt=null;X!==null&&Kb(tt,W,X,pt,!1),ct!==null&&Xt!==null&&Kb(tt,Xt,ct,pt,!0)}}t:{if(W=j?Fa(j):window,X=W.nodeName&&W.nodeName.toLowerCase(),X==="select"||X==="input"&&W.type==="file")var Dt=hm;else if(um(W))if(dm)Dt=pA;else{Dt=hA;var ut=fA}else X=W.nodeName,!X||X.toLowerCase()!=="input"||W.type!=="checkbox"&&W.type!=="radio"?j&&Of(j.elementType)&&(Dt=hm):Dt=dA;if(Dt&&(Dt=Dt(a,j))){fm(tt,Dt,u,K);break t}ut&&ut(a,W,j),a==="focusout"&&j&&W.type==="number"&&j.memoizedProps.value!=null&&Mf(W,"number",W.value)}switch(ut=j?Fa(j):window,a){case"focusin":(um(ut)||ut.contentEditable==="true")&&(Er=ut,Wf=j,Ya=null);break;case"focusout":Ya=Wf=Er=null;break;case"mousedown":$f=!0;break;case"contextmenu":case"mouseup":case"dragend":$f=!1,xm(tt,u,K);break;case"selectionchange":if(_A)break;case"keydown":case"keyup":xm(tt,u,K)}var St;if(zf)t:{switch(a){case"compositionstart":var Ct="onCompositionStart";break t;case"compositionend":Ct="onCompositionEnd";break t;case"compositionupdate":Ct="onCompositionUpdate";break t}Ct=void 0}else wr?lm(a,u)&&(Ct="onCompositionEnd"):a==="keydown"&&u.keyCode===229&&(Ct="onCompositionStart");Ct&&(rm&&u.locale!=="ko"&&(wr||Ct!=="onCompositionStart"?Ct==="onCompositionEnd"&&wr&&(St=tm()):(Ni=K,Nf="value"in Ni?Ni.value:Ni.textContent,wr=!0)),ut=Rc(j,Ct),0<ut.length&&(Ct=new im(Ct,a,null,u,K),tt.push({event:Ct,listeners:ut}),St?Ct.data=St:(St=cm(u),St!==null&&(Ct.data=St)))),(St=aA?oA(a,u):lA(a,u))&&(Ct=Rc(j,"onBeforeInput"),0<Ct.length&&(ut=new im("onBeforeInput","beforeinput",null,u,K),tt.push({event:ut,listeners:Ct}),ut.data=St)),JA(tt,a,j,u,K)}Yb(tt,o)})}function bo(a,o,u){return{instance:a,listener:o,currentTarget:u}}function Rc(a,o){for(var u=o+"Capture",h=[];a!==null;){var g=a,m=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||m===null||(g=La(a,u),g!=null&&h.unshift(bo(a,g,m)),g=La(a,o),g!=null&&h.push(bo(a,g,m))),a.tag===3)return h;a=a.return}return[]}function iw(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function Kb(a,o,u,h,g){for(var m=o._reactName,v=[];u!==null&&u!==h;){var S=u,M=S.alternate,j=S.stateNode;if(S=S.tag,M!==null&&M===h)break;S!==5&&S!==26&&S!==27||j===null||(M=j,g?(j=La(u,m),j!=null&&v.unshift(bo(u,j,M))):g||(j=La(u,m),j!=null&&v.push(bo(u,j,M)))),u=u.return}v.length!==0&&a.push({event:o,listeners:v})}var sw=/\r\n?/g,rw=/\u0000|\uFFFD/g;function Zb(a){return(typeof a=="string"?a:""+a).replace(sw,`
`).replace(rw,"")}function Qb(a,o){return o=Zb(o),Zb(a)===o}function $t(a,o,u,h,g,m){switch(u){case"children":typeof h=="string"?o==="body"||o==="textarea"&&h===""||Tr(a,h):(typeof h=="number"||typeof h=="bigint")&&o!=="body"&&Tr(a,""+h);break;case"className":Il(a,"class",h);break;case"tabIndex":Il(a,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":Il(a,u,h);break;case"style":Q_(a,h,m);break;case"data":if(o!=="object"){Il(a,"data",h);break}case"src":case"href":if(h===""&&(o!=="a"||u!=="href")){a.removeAttribute(u);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){a.removeAttribute(u);break}h=Dl(""+h),a.setAttribute(u,h);break;case"action":case"formAction":if(typeof h=="function"){a.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(u==="formAction"?(o!=="input"&&$t(a,o,"name",g.name,g,null),$t(a,o,"formEncType",g.formEncType,g,null),$t(a,o,"formMethod",g.formMethod,g,null),$t(a,o,"formTarget",g.formTarget,g,null)):($t(a,o,"encType",g.encType,g,null),$t(a,o,"method",g.method,g,null),$t(a,o,"target",g.target,g,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){a.removeAttribute(u);break}h=Dl(""+h),a.setAttribute(u,h);break;case"onClick":h!=null&&(a.onclick=oi);break;case"onScroll":h!=null&&Et("scroll",a);break;case"onScrollEnd":h!=null&&Et("scrollend",a);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(u=h.__html,u!=null){if(g.children!=null)throw Error(i(60));a.innerHTML=u}}break;case"multiple":a.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":a.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){a.removeAttribute("xlink:href");break}u=Dl(""+h),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?a.setAttribute(u,""+h):a.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?a.setAttribute(u,""):a.removeAttribute(u);break;case"capture":case"download":h===!0?a.setAttribute(u,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?a.setAttribute(u,h):a.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?a.setAttribute(u,h):a.removeAttribute(u);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?a.removeAttribute(u):a.setAttribute(u,h);break;case"popover":Et("beforetoggle",a),Et("toggle",a),Ol(a,"popover",h);break;case"xlinkActuate":ai(a,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":ai(a,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":ai(a,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":ai(a,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":ai(a,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":ai(a,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":ai(a,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":ai(a,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":ai(a,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":Ol(a,"is",h);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=DS.get(u)||u,Ol(a,u,h))}}function _d(a,o,u,h,g,m){switch(u){case"style":Q_(a,h,m);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(u=h.__html,u!=null){if(g.children!=null)throw Error(i(60));a.innerHTML=u}}break;case"children":typeof h=="string"?Tr(a,h):(typeof h=="number"||typeof h=="bigint")&&Tr(a,""+h);break;case"onScroll":h!=null&&Et("scroll",a);break;case"onScrollEnd":h!=null&&Et("scrollend",a);break;case"onClick":h!=null&&(a.onclick=oi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!H_.hasOwnProperty(u))t:{if(u[0]==="o"&&u[1]==="n"&&(g=u.endsWith("Capture"),o=u.slice(2,g?u.length-7:void 0),m=a[$e]||null,m=m!=null?m[u]:null,typeof m=="function"&&a.removeEventListener(o,m,g),typeof h=="function")){typeof m!="function"&&m!==null&&(u in a?a[u]=null:a.hasAttribute(u)&&a.removeAttribute(u)),a.addEventListener(o,h,g);break t}u in a?a[u]=h:h===!0?a.setAttribute(u,""):Ol(a,u,h)}}}function De(a,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Et("error",a),Et("load",a);var h=!1,g=!1,m;for(m in u)if(u.hasOwnProperty(m)){var v=u[m];if(v!=null)switch(m){case"src":h=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,o));default:$t(a,o,m,v,u,null)}}g&&$t(a,o,"srcSet",u.srcSet,u,null),h&&$t(a,o,"src",u.src,u,null);return;case"input":Et("invalid",a);var S=m=v=g=null,M=null,j=null;for(h in u)if(u.hasOwnProperty(h)){var K=u[h];if(K!=null)switch(h){case"name":g=K;break;case"type":v=K;break;case"checked":M=K;break;case"defaultChecked":j=K;break;case"value":m=K;break;case"defaultValue":S=K;break;case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(i(137,o));break;default:$t(a,o,h,K,u,null)}}Y_(a,m,S,M,j,v,g,!1);return;case"select":Et("invalid",a),h=v=m=null;for(g in u)if(u.hasOwnProperty(g)&&(S=u[g],S!=null))switch(g){case"value":m=S;break;case"defaultValue":v=S;break;case"multiple":h=S;default:$t(a,o,g,S,u,null)}o=m,u=v,a.multiple=!!h,o!=null?xr(a,!!h,o,!1):u!=null&&xr(a,!!h,u,!0);return;case"textarea":Et("invalid",a),m=g=h=null;for(v in u)if(u.hasOwnProperty(v)&&(S=u[v],S!=null))switch(v){case"value":h=S;break;case"defaultValue":g=S;break;case"children":m=S;break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(i(91));break;default:$t(a,o,v,S,u,null)}K_(a,h,g,m);return;case"option":for(M in u)if(u.hasOwnProperty(M)&&(h=u[M],h!=null))switch(M){case"selected":a.selected=h&&typeof h!="function"&&typeof h!="symbol";break;default:$t(a,o,M,h,u,null)}return;case"dialog":Et("beforetoggle",a),Et("toggle",a),Et("cancel",a),Et("close",a);break;case"iframe":case"object":Et("load",a);break;case"video":case"audio":for(h=0;h<yo.length;h++)Et(yo[h],a);break;case"image":Et("error",a),Et("load",a);break;case"details":Et("toggle",a);break;case"embed":case"source":case"link":Et("error",a),Et("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(j in u)if(u.hasOwnProperty(j)&&(h=u[j],h!=null))switch(j){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,o));default:$t(a,o,j,h,u,null)}return;default:if(Of(o)){for(K in u)u.hasOwnProperty(K)&&(h=u[K],h!==void 0&&_d(a,o,K,h,u,void 0));return}}for(S in u)u.hasOwnProperty(S)&&(h=u[S],h!=null&&$t(a,o,S,h,u,null))}function aw(a,o,u,h){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,m=null,v=null,S=null,M=null,j=null,K=null;for(X in u){var tt=u[X];if(u.hasOwnProperty(X)&&tt!=null)switch(X){case"checked":break;case"value":break;case"defaultValue":M=tt;default:h.hasOwnProperty(X)||$t(a,o,X,null,h,tt)}}for(var W in h){var X=h[W];if(tt=u[W],h.hasOwnProperty(W)&&(X!=null||tt!=null))switch(W){case"type":m=X;break;case"name":g=X;break;case"checked":j=X;break;case"defaultChecked":K=X;break;case"value":v=X;break;case"defaultValue":S=X;break;case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(i(137,o));break;default:X!==tt&&$t(a,o,W,X,h,tt)}}Cf(a,v,S,M,j,K,m,g);return;case"select":X=v=S=W=null;for(m in u)if(M=u[m],u.hasOwnProperty(m)&&M!=null)switch(m){case"value":break;case"multiple":X=M;default:h.hasOwnProperty(m)||$t(a,o,m,null,h,M)}for(g in h)if(m=h[g],M=u[g],h.hasOwnProperty(g)&&(m!=null||M!=null))switch(g){case"value":W=m;break;case"defaultValue":S=m;break;case"multiple":v=m;default:m!==M&&$t(a,o,g,m,h,M)}o=S,u=v,h=X,W!=null?xr(a,!!u,W,!1):!!h!=!!u&&(o!=null?xr(a,!!u,o,!0):xr(a,!!u,u?[]:"",!1));return;case"textarea":X=W=null;for(S in u)if(g=u[S],u.hasOwnProperty(S)&&g!=null&&!h.hasOwnProperty(S))switch(S){case"value":break;case"children":break;default:$t(a,o,S,null,h,g)}for(v in h)if(g=h[v],m=u[v],h.hasOwnProperty(v)&&(g!=null||m!=null))switch(v){case"value":W=g;break;case"defaultValue":X=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(i(91));break;default:g!==m&&$t(a,o,v,g,h,m)}q_(a,W,X);return;case"option":for(var ct in u)if(W=u[ct],u.hasOwnProperty(ct)&&W!=null&&!h.hasOwnProperty(ct))switch(ct){case"selected":a.selected=!1;break;default:$t(a,o,ct,null,h,W)}for(M in h)if(W=h[M],X=u[M],h.hasOwnProperty(M)&&W!==X&&(W!=null||X!=null))switch(M){case"selected":a.selected=W&&typeof W!="function"&&typeof W!="symbol";break;default:$t(a,o,M,W,h,X)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var pt in u)W=u[pt],u.hasOwnProperty(pt)&&W!=null&&!h.hasOwnProperty(pt)&&$t(a,o,pt,null,h,W);for(j in h)if(W=h[j],X=u[j],h.hasOwnProperty(j)&&W!==X&&(W!=null||X!=null))switch(j){case"children":case"dangerouslySetInnerHTML":if(W!=null)throw Error(i(137,o));break;default:$t(a,o,j,W,h,X)}return;default:if(Of(o)){for(var Xt in u)W=u[Xt],u.hasOwnProperty(Xt)&&W!==void 0&&!h.hasOwnProperty(Xt)&&_d(a,o,Xt,void 0,h,W);for(K in h)W=h[K],X=u[K],!h.hasOwnProperty(K)||W===X||W===void 0&&X===void 0||_d(a,o,K,W,h,X);return}}for(var F in u)W=u[F],u.hasOwnProperty(F)&&W!=null&&!h.hasOwnProperty(F)&&$t(a,o,F,null,h,W);for(tt in h)W=h[tt],X=u[tt],!h.hasOwnProperty(tt)||W===X||W==null&&X==null||$t(a,o,tt,W,h,X)}function Gb(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ow(){if(typeof performance.getEntriesByType=="function"){for(var a=0,o=0,u=performance.getEntriesByType("resource"),h=0;h<u.length;h++){var g=u[h],m=g.transferSize,v=g.initiatorType,S=g.duration;if(m&&S&&Gb(v)){for(v=0,S=g.responseEnd,h+=1;h<u.length;h++){var M=u[h],j=M.startTime;if(j>S)break;var K=M.transferSize,tt=M.initiatorType;K&&Gb(tt)&&(M=M.responseEnd,v+=K*(M<S?1:(S-j)/(M-j)))}if(--h,o+=8*(m+v)/(g.duration/1e3),a++,10<a)break}}if(0<a)return o/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var md=null,yd=null;function Cc(a){return a.nodeType===9?a:a.ownerDocument}function Jb(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function t0(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function bd(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var vd=null;function lw(){var a=window.event;return a&&a.type==="popstate"?a===vd?!1:(vd=a,!0):(vd=null,!1)}var e0=typeof setTimeout=="function"?setTimeout:void 0,cw=typeof clearTimeout=="function"?clearTimeout:void 0,n0=typeof Promise=="function"?Promise:void 0,uw=typeof queueMicrotask=="function"?queueMicrotask:typeof n0<"u"?function(a){return n0.resolve(null).then(a).catch(fw)}:e0;function fw(a){setTimeout(function(){throw a})}function Gi(a){return a==="head"}function i0(a,o){var u=o,h=0;do{var g=u.nextSibling;if(a.removeChild(u),g&&g.nodeType===8)if(u=g.data,u==="/$"||u==="/&"){if(h===0){a.removeChild(g),Jr(o);return}h--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")h++;else if(u==="html")vo(a.ownerDocument.documentElement);else if(u==="head"){u=a.ownerDocument.head,vo(u);for(var m=u.firstChild;m;){var v=m.nextSibling,S=m.nodeName;m[Ua]||S==="SCRIPT"||S==="STYLE"||S==="LINK"&&m.rel.toLowerCase()==="stylesheet"||u.removeChild(m),m=v}}else u==="body"&&vo(a.ownerDocument.body);u=g}while(u);Jr(o)}function s0(a,o){var u=a;a=0;do{var h=u.nextSibling;if(u.nodeType===1?o?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(o?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),h&&h.nodeType===8)if(u=h.data,u==="/$"){if(a===0)break;a--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||a++;u=h}while(u)}function xd(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":xd(u),Ef(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}a.removeChild(u)}}function hw(a,o,u,h){for(;a.nodeType===1;){var g=u;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!h&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(h){if(!a[Ua])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(m=a.getAttribute("rel"),m==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(m!==g.rel||a.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||a.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||a.getAttribute("title")!==(g.title==null?null:g.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(m=a.getAttribute("src"),(m!==(g.src==null?null:g.src)||a.getAttribute("type")!==(g.type==null?null:g.type)||a.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&m&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var m=g.name==null?null:""+g.name;if(g.type==="hidden"&&a.getAttribute("name")===m)return a}else return a;if(a=Sn(a.nextSibling),a===null)break}return null}function dw(a,o,u){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!u||(a=Sn(a.nextSibling),a===null))return null;return a}function r0(a,o){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!o||(a=Sn(a.nextSibling),a===null))return null;return a}function Td(a){return a.data==="$?"||a.data==="$~"}function Sd(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function pw(a,o){var u=a.ownerDocument;if(a.data==="$~")a._reactRetry=o;else if(a.data!=="$?"||u.readyState!=="loading")o();else{var h=function(){o(),u.removeEventListener("DOMContentLoaded",h)};u.addEventListener("DOMContentLoaded",h),a._reactRetry=h}}function Sn(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return a}var Ad=null;function a0(a){a=a.nextSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="/$"||u==="/&"){if(o===0)return Sn(a.nextSibling);o--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||o++}a=a.nextSibling}return null}function o0(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(o===0)return a;o--}else u!=="/$"&&u!=="/&"||o++}a=a.previousSibling}return null}function l0(a,o,u){switch(o=Cc(u),a){case"html":if(a=o.documentElement,!a)throw Error(i(452));return a;case"head":if(a=o.head,!a)throw Error(i(453));return a;case"body":if(a=o.body,!a)throw Error(i(454));return a;default:throw Error(i(451))}}function vo(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);Ef(a)}var An=new Map,c0=new Set;function Mc(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Si=it.d;it.d={f:gw,r:_w,D:mw,C:yw,L:bw,m:vw,X:Tw,S:xw,M:Sw};function gw(){var a=Si.f(),o=vc();return a||o}function _w(a){var o=yr(a);o!==null&&o.tag===5&&o.type==="form"?Ey(o):Si.r(a)}var Zr=typeof document>"u"?null:document;function u0(a,o,u){var h=Zr;if(h&&typeof o=="string"&&o){var g=_n(o);g='link[rel="'+a+'"][href="'+g+'"]',typeof u=="string"&&(g+='[crossorigin="'+u+'"]'),c0.has(g)||(c0.add(g),a={rel:a,crossOrigin:u,href:o},h.querySelector(g)===null&&(o=h.createElement("link"),De(o,"link",a),Ae(o),h.head.appendChild(o)))}}function mw(a){Si.D(a),u0("dns-prefetch",a,null)}function yw(a,o){Si.C(a,o),u0("preconnect",a,o)}function bw(a,o,u){Si.L(a,o,u);var h=Zr;if(h&&a&&o){var g='link[rel="preload"][as="'+_n(o)+'"]';o==="image"&&u&&u.imageSrcSet?(g+='[imagesrcset="'+_n(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(g+='[imagesizes="'+_n(u.imageSizes)+'"]')):g+='[href="'+_n(a)+'"]';var m=g;switch(o){case"style":m=Qr(a);break;case"script":m=Gr(a)}An.has(m)||(a=_({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:a,as:o},u),An.set(m,a),h.querySelector(g)!==null||o==="style"&&h.querySelector(xo(m))||o==="script"&&h.querySelector(To(m))||(o=h.createElement("link"),De(o,"link",a),Ae(o),h.head.appendChild(o)))}}function vw(a,o){Si.m(a,o);var u=Zr;if(u&&a){var h=o&&typeof o.as=="string"?o.as:"script",g='link[rel="modulepreload"][as="'+_n(h)+'"][href="'+_n(a)+'"]',m=g;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=Gr(a)}if(!An.has(m)&&(a=_({rel:"modulepreload",href:a},o),An.set(m,a),u.querySelector(g)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(To(m)))return}h=u.createElement("link"),De(h,"link",a),Ae(h),u.head.appendChild(h)}}}function xw(a,o,u){Si.S(a,o,u);var h=Zr;if(h&&a){var g=br(h).hoistableStyles,m=Qr(a);o=o||"default";var v=g.get(m);if(!v){var S={loading:0,preload:null};if(v=h.querySelector(xo(m)))S.loading=5;else{a=_({rel:"stylesheet",href:a,"data-precedence":o},u),(u=An.get(m))&&wd(a,u);var M=v=h.createElement("link");Ae(M),De(M,"link",a),M._p=new Promise(function(j,K){M.onload=j,M.onerror=K}),M.addEventListener("load",function(){S.loading|=1}),M.addEventListener("error",function(){S.loading|=2}),S.loading|=4,Oc(v,o,h)}v={type:"stylesheet",instance:v,count:1,state:S},g.set(m,v)}}}function Tw(a,o){Si.X(a,o);var u=Zr;if(u&&a){var h=br(u).hoistableScripts,g=Gr(a),m=h.get(g);m||(m=u.querySelector(To(g)),m||(a=_({src:a,async:!0},o),(o=An.get(g))&&Ed(a,o),m=u.createElement("script"),Ae(m),De(m,"link",a),u.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},h.set(g,m))}}function Sw(a,o){Si.M(a,o);var u=Zr;if(u&&a){var h=br(u).hoistableScripts,g=Gr(a),m=h.get(g);m||(m=u.querySelector(To(g)),m||(a=_({src:a,async:!0,type:"module"},o),(o=An.get(g))&&Ed(a,o),m=u.createElement("script"),Ae(m),De(m,"link",a),u.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},h.set(g,m))}}function f0(a,o,u,h){var g=(g=yt.current)?Mc(g):null;if(!g)throw Error(i(446));switch(a){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=Qr(u.href),u=br(g).hoistableStyles,h=u.get(o),h||(h={type:"style",instance:null,count:0,state:null},u.set(o,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){a=Qr(u.href);var m=br(g).hoistableStyles,v=m.get(a);if(v||(g=g.ownerDocument||g,v={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(a,v),(m=g.querySelector(xo(a)))&&!m._p&&(v.instance=m,v.state.loading=5),An.has(a)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},An.set(a,u),m||Aw(g,a,u,v.state))),o&&h===null)throw Error(i(528,""));return v}if(o&&h!==null)throw Error(i(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Gr(u),u=br(g).hoistableScripts,h=u.get(o),h||(h={type:"script",instance:null,count:0,state:null},u.set(o,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,a))}}function Qr(a){return'href="'+_n(a)+'"'}function xo(a){return'link[rel="stylesheet"]['+a+"]"}function h0(a){return _({},a,{"data-precedence":a.precedence,precedence:null})}function Aw(a,o,u,h){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?h.loading=1:(o=a.createElement("link"),h.preload=o,o.addEventListener("load",function(){return h.loading|=1}),o.addEventListener("error",function(){return h.loading|=2}),De(o,"link",u),Ae(o),a.head.appendChild(o))}function Gr(a){return'[src="'+_n(a)+'"]'}function To(a){return"script[async]"+a}function d0(a,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var h=a.querySelector('style[data-href~="'+_n(u.href)+'"]');if(h)return o.instance=h,Ae(h),h;var g=_({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return h=(a.ownerDocument||a).createElement("style"),Ae(h),De(h,"style",g),Oc(h,u.precedence,a),o.instance=h;case"stylesheet":g=Qr(u.href);var m=a.querySelector(xo(g));if(m)return o.state.loading|=4,o.instance=m,Ae(m),m;h=h0(u),(g=An.get(g))&&wd(h,g),m=(a.ownerDocument||a).createElement("link"),Ae(m);var v=m;return v._p=new Promise(function(S,M){v.onload=S,v.onerror=M}),De(m,"link",h),o.state.loading|=4,Oc(m,u.precedence,a),o.instance=m;case"script":return m=Gr(u.src),(g=a.querySelector(To(m)))?(o.instance=g,Ae(g),g):(h=u,(g=An.get(m))&&(h=_({},u),Ed(h,g)),a=a.ownerDocument||a,g=a.createElement("script"),Ae(g),De(g,"link",h),a.head.appendChild(g),o.instance=g);case"void":return null;default:throw Error(i(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(h=o.instance,o.state.loading|=4,Oc(h,u.precedence,a));return o.instance}function Oc(a,o,u){for(var h=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=h.length?h[h.length-1]:null,m=g,v=0;v<h.length;v++){var S=h[v];if(S.dataset.precedence===o)m=S;else if(m!==g)break}m?m.parentNode.insertBefore(a,m.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(a,o.firstChild))}function wd(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function Ed(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var Ic=null;function p0(a,o,u){if(Ic===null){var h=new Map,g=Ic=new Map;g.set(u,h)}else g=Ic,h=g.get(u),h||(h=new Map,g.set(u,h));if(h.has(a))return h;for(h.set(a,null),u=u.getElementsByTagName(a),g=0;g<u.length;g++){var m=u[g];if(!(m[Ua]||m[Me]||a==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var v=m.getAttribute(o)||"";v=a+v;var S=h.get(v);S?S.push(m):h.set(v,[m])}}return h}function g0(a,o,u){a=a.ownerDocument||a,a.head.insertBefore(u,o==="title"?a.querySelector("head > title"):null)}function ww(a,o,u){if(u===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return a=o.disabled,typeof o.precedence=="string"&&a==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function _0(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function Ew(a,o,u,h){if(u.type==="stylesheet"&&(typeof h.media!="string"||matchMedia(h.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var g=Qr(h.href),m=o.querySelector(xo(g));if(m){o=m._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(a.count++,a=Pc.bind(a),o.then(a,a)),u.state.loading|=4,u.instance=m,Ae(m);return}m=o.ownerDocument||o,h=h0(h),(g=An.get(g))&&wd(h,g),m=m.createElement("link"),Ae(m);var v=m;v._p=new Promise(function(S,M){v.onload=S,v.onerror=M}),De(m,"link",h),u.instance=m}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(u,o),(o=u.state.preload)&&(u.state.loading&3)===0&&(a.count++,u=Pc.bind(a),o.addEventListener("load",u),o.addEventListener("error",u))}}var Rd=0;function Rw(a,o){return a.stylesheets&&a.count===0&&kc(a,a.stylesheets),0<a.count||0<a.imgCount?function(u){var h=setTimeout(function(){if(a.stylesheets&&kc(a,a.stylesheets),a.unsuspend){var m=a.unsuspend;a.unsuspend=null,m()}},6e4+o);0<a.imgBytes&&Rd===0&&(Rd=62500*ow());var g=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&kc(a,a.stylesheets),a.unsuspend)){var m=a.unsuspend;a.unsuspend=null,m()}},(a.imgBytes>Rd?50:800)+o);return a.unsuspend=u,function(){a.unsuspend=null,clearTimeout(h),clearTimeout(g)}}:null}function Pc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)kc(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Dc=null;function kc(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Dc=new Map,o.forEach(Cw,a),Dc=null,Pc.call(a))}function Cw(a,o){if(!(o.state.loading&4)){var u=Dc.get(a);if(u)var h=u.get(null);else{u=new Map,Dc.set(a,u);for(var g=a.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<g.length;m++){var v=g[m];(v.nodeName==="LINK"||v.getAttribute("media")!=="not all")&&(u.set(v.dataset.precedence,v),h=v)}h&&u.set(null,h)}g=o.instance,v=g.getAttribute("data-precedence"),m=u.get(v)||h,m===h&&u.set(null,g),u.set(v,g),this.count++,h=Pc.bind(this),g.addEventListener("load",h),g.addEventListener("error",h),m?m.parentNode.insertBefore(g,m.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(g,a.firstChild)),o.state.loading|=4}}var So={$$typeof:C,Provider:null,Consumer:null,_currentValue:ht,_currentValue2:ht,_threadCount:0};function Mw(a,o,u,h,g,m,v,S,M){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Tf(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Tf(0),this.hiddenUpdates=Tf(null),this.identifierPrefix=h,this.onUncaughtError=g,this.onCaughtError=m,this.onRecoverableError=v,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=M,this.incompleteTransitions=new Map}function m0(a,o,u,h,g,m,v,S,M,j,K,tt){return a=new Mw(a,o,u,v,M,j,K,tt,S),o=1,m===!0&&(o|=24),m=rn(3,null,null,o),a.current=m,m.stateNode=a,o=ah(),o.refCount++,a.pooledCache=o,o.refCount++,m.memoizedState={element:h,isDehydrated:u,cache:o},uh(m),a}function y0(a){return a?(a=Mr,a):Mr}function b0(a,o,u,h,g,m){g=y0(g),h.context===null?h.context=g:h.pendingContext=g,h=Vi(o),h.payload={element:u},m=m===void 0?null:m,m!==null&&(h.callback=m),u=Hi(a,h,o),u!==null&&(Qe(u,a,o),to(u,a,o))}function v0(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var u=a.retryLane;a.retryLane=u!==0&&u<o?u:o}}function Cd(a,o){v0(a,o),(a=a.alternate)&&v0(a,o)}function x0(a){if(a.tag===13||a.tag===31){var o=ws(a,67108864);o!==null&&Qe(o,a,67108864),Cd(a,67108864)}}function T0(a){if(a.tag===13||a.tag===31){var o=un();o=Sf(o);var u=ws(a,o);u!==null&&Qe(u,a,o),Cd(a,o)}}var Nc=!0;function Ow(a,o,u,h){var g=$.T;$.T=null;var m=it.p;try{it.p=2,Md(a,o,u,h)}finally{it.p=m,$.T=g}}function Iw(a,o,u,h){var g=$.T;$.T=null;var m=it.p;try{it.p=8,Md(a,o,u,h)}finally{it.p=m,$.T=g}}function Md(a,o,u,h){if(Nc){var g=Od(h);if(g===null)gd(a,o,h,Bc,u),A0(a,h);else if(Dw(g,a,o,u,h))h.stopPropagation();else if(A0(a,h),o&4&&-1<Pw.indexOf(a)){for(;g!==null;){var m=yr(g);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var v=vs(m.pendingLanes);if(v!==0){var S=m;for(S.pendingLanes|=2,S.entangledLanes|=2;v;){var M=1<<31-nn(v);S.entanglements[1]|=M,v&=~M}qn(m),(Nt&6)===0&&(yc=tn()+500,mo(0))}}break;case 31:case 13:S=ws(m,2),S!==null&&Qe(S,m,2),vc(),Cd(m,2)}if(m=Od(h),m===null&&gd(a,o,h,Bc,u),m===g)break;g=m}g!==null&&h.stopPropagation()}else gd(a,o,h,null,u)}}function Od(a){return a=Pf(a),Id(a)}var Bc=null;function Id(a){if(Bc=null,a=mr(a),a!==null){var o=r(a);if(o===null)a=null;else{var u=o.tag;if(u===13){if(a=l(o),a!==null)return a;a=null}else if(u===31){if(a=c(o),a!==null)return a;a=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return Bc=a,null}function S0(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(mS()){case I_:return 2;case P_:return 8;case wl:case yS:return 32;case D_:return 268435456;default:return 32}default:return 32}}var Pd=!1,Ji=null,ts=null,es=null,Ao=new Map,wo=new Map,ns=[],Pw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function A0(a,o){switch(a){case"focusin":case"focusout":Ji=null;break;case"dragenter":case"dragleave":ts=null;break;case"mouseover":case"mouseout":es=null;break;case"pointerover":case"pointerout":Ao.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":wo.delete(o.pointerId)}}function Eo(a,o,u,h,g,m){return a===null||a.nativeEvent!==m?(a={blockedOn:o,domEventName:u,eventSystemFlags:h,nativeEvent:m,targetContainers:[g]},o!==null&&(o=yr(o),o!==null&&x0(o)),a):(a.eventSystemFlags|=h,o=a.targetContainers,g!==null&&o.indexOf(g)===-1&&o.push(g),a)}function Dw(a,o,u,h,g){switch(o){case"focusin":return Ji=Eo(Ji,a,o,u,h,g),!0;case"dragenter":return ts=Eo(ts,a,o,u,h,g),!0;case"mouseover":return es=Eo(es,a,o,u,h,g),!0;case"pointerover":var m=g.pointerId;return Ao.set(m,Eo(Ao.get(m)||null,a,o,u,h,g)),!0;case"gotpointercapture":return m=g.pointerId,wo.set(m,Eo(wo.get(m)||null,a,o,u,h,g)),!0}return!1}function w0(a){var o=mr(a.target);if(o!==null){var u=r(o);if(u!==null){if(o=u.tag,o===13){if(o=l(u),o!==null){a.blockedOn=o,L_(a.priority,function(){T0(u)});return}}else if(o===31){if(o=c(u),o!==null){a.blockedOn=o,L_(a.priority,function(){T0(u)});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){a.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Uc(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var u=Od(a.nativeEvent);if(u===null){u=a.nativeEvent;var h=new u.constructor(u.type,u);If=h,u.target.dispatchEvent(h),If=null}else return o=yr(u),o!==null&&x0(o),a.blockedOn=u,!1;o.shift()}return!0}function E0(a,o,u){Uc(a)&&u.delete(o)}function kw(){Pd=!1,Ji!==null&&Uc(Ji)&&(Ji=null),ts!==null&&Uc(ts)&&(ts=null),es!==null&&Uc(es)&&(es=null),Ao.forEach(E0),wo.forEach(E0)}function Fc(a,o){a.blockedOn===o&&(a.blockedOn=null,Pd||(Pd=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,kw)))}var Lc=null;function R0(a){Lc!==a&&(Lc=a,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Lc===a&&(Lc=null);for(var o=0;o<a.length;o+=3){var u=a[o],h=a[o+1],g=a[o+2];if(typeof h!="function"){if(Id(h||u)===null)continue;break}var m=yr(u);m!==null&&(a.splice(o,3),o-=3,Oh(m,{pending:!0,data:g,method:u.method,action:h},h,g))}}))}function Jr(a){function o(M){return Fc(M,a)}Ji!==null&&Fc(Ji,a),ts!==null&&Fc(ts,a),es!==null&&Fc(es,a),Ao.forEach(o),wo.forEach(o);for(var u=0;u<ns.length;u++){var h=ns[u];h.blockedOn===a&&(h.blockedOn=null)}for(;0<ns.length&&(u=ns[0],u.blockedOn===null);)w0(u),u.blockedOn===null&&ns.shift();if(u=(a.ownerDocument||a).$$reactFormReplay,u!=null)for(h=0;h<u.length;h+=3){var g=u[h],m=u[h+1],v=g[$e]||null;if(typeof m=="function")v||R0(u);else if(v){var S=null;if(m&&m.hasAttribute("formAction")){if(g=m,v=m[$e]||null)S=v.formAction;else if(Id(g)!==null)continue}else S=v.action;typeof S=="function"?u[h+1]=S:(u.splice(h,3),h-=3),R0(u)}}}function C0(){function a(m){m.canIntercept&&m.info==="react-transition"&&m.intercept({handler:function(){return new Promise(function(v){return g=v})},focusReset:"manual",scroll:"manual"})}function o(){g!==null&&(g(),g=null),h||setTimeout(u,20)}function u(){if(!h&&!navigation.transition){var m=navigation.currentEntry;m&&m.url!=null&&navigation.navigate(m.url,{state:m.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var h=!1,g=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(u,100),function(){h=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),g!==null&&(g(),g=null)}}}function Dd(a){this._internalRoot=a}zc.prototype.render=Dd.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(i(409));var u=o.current,h=un();b0(u,h,a,o,null,null)},zc.prototype.unmount=Dd.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;b0(a.current,2,null,a,null,null),vc(),o[_r]=null}};function zc(a){this._internalRoot=a}zc.prototype.unstable_scheduleHydration=function(a){if(a){var o=F_();a={blockedOn:null,target:a,priority:o};for(var u=0;u<ns.length&&o!==0&&o<ns[u].priority;u++);ns.splice(u,0,a),u===0&&w0(a)}};var M0=t.version;if(M0!=="19.2.0")throw Error(i(527,M0,"19.2.0"));it.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(i(188)):(a=Object.keys(a).join(","),Error(i(268,a)));return a=d(o),a=a!==null?p(a):null,a=a===null?null:a.stateNode,a};var Nw={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:$,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Vc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Vc.isDisabled&&Vc.supportsFiber)try{ka=Vc.inject(Nw),en=Vc}catch{}}return Co.createRoot=function(a,o){if(!s(a))throw Error(i(299));var u=!1,h="",g=By,m=Uy,v=Fy;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(h=o.identifierPrefix),o.onUncaughtError!==void 0&&(g=o.onUncaughtError),o.onCaughtError!==void 0&&(m=o.onCaughtError),o.onRecoverableError!==void 0&&(v=o.onRecoverableError)),o=m0(a,1,!1,null,null,u,h,null,g,m,v,C0),a[_r]=o.current,pd(a),new Dd(o)},Co.hydrateRoot=function(a,o,u){if(!s(a))throw Error(i(299));var h=!1,g="",m=By,v=Uy,S=Fy,M=null;return u!=null&&(u.unstable_strictMode===!0&&(h=!0),u.identifierPrefix!==void 0&&(g=u.identifierPrefix),u.onUncaughtError!==void 0&&(m=u.onUncaughtError),u.onCaughtError!==void 0&&(v=u.onCaughtError),u.onRecoverableError!==void 0&&(S=u.onRecoverableError),u.formState!==void 0&&(M=u.formState)),o=m0(a,1,!0,o,u??null,h,g,M,m,v,S,C0),o.context=y0(null),u=o.current,h=un(),h=Sf(h),g=Vi(h),g.callback=null,Hi(u,g,h),u=h,o.current.lanes=u,Ba(o,u),qn(o),a[_r]=o.current,pd(a),new zc(o)},Co.version="19.2.0",Co}var L0;function $w(){if(L0)return Nd.exports;L0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Nd.exports=Ww(),Nd.exports}var Xw=$w(),At=xg();function Eu(n,t){if(!n)throw new Error(t||"loader assertion failed.")}const Tg=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),z0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);z0&&parseFloat(z0[1]);const V0=globalThis,H0=globalThis.process||{},Yw=globalThis.navigator||{};function c1(n){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const e=typeof navigator<"u"&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}function fr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||c1()}function qw(n){return fr()?c1()?"Electron":(Yw.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const u1="4.1.0";function Kw(n){try{const t=window[n],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class Zw{constructor(t,e,i="sessionStorage"){this.storage=Kw(i),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function Qw(n){let t;return n<10?t=`${n.toFixed(2)}ms`:n<100?t=`${n.toFixed(1)}ms`:n<1e3?t=`${n.toFixed(0)}ms`:t=`${(n/1e3).toFixed(2)}s`,t}function Gw(n,t=8){const e=Math.max(t-n.length,0);return`${" ".repeat(e)}${n}`}var Ru;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Ru||(Ru={}));const Jw=10;function j0(n){return typeof n!="string"?n:(n=n.toUpperCase(),Ru[n]||Ru.WHITE)}function tE(n,t,e){return!fr&&typeof n=="string"&&(t&&(n=`\x1B[${j0(t)}m${n}\x1B[39m`),e&&(n=`\x1B[${j0(e)+Jw}m${n}\x1B[49m`)),n}function eE(n,t=["constructor"]){const e=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(e),s=n;for(const r of i){const l=s[r];typeof l=="function"&&(t.find(c=>r===c)||(s[r]=l.bind(n)))}}function Sg(n,t){if(!n)throw new Error("Assertion failed")}function ta(){let n;if(fr()&&V0.performance)n=V0?.performance?.now?.();else if("hrtime"in H0){const t=H0?.hrtime?.();n=t[0]*1e3+t[1]/1e6}else n=Date.now();return n}const ea={debug:fr()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},nE={enabled:!0,level:0};function na(){}const W0={},$0={once:!0};class gl{constructor({id:t}={id:""}){this.VERSION=u1,this._startTs=ta(),this._deltaTs=ta(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new Zw(`__probe-${this.id}__`,nE),this.timeStamp(`${this.id} started`),eE(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ta()-this._startTs).toPrecision(10))}getDelta(){return Number((ta()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){if(!t)throw new Error(e||"Assertion failed")}warn(t){return this._getLogFunction(0,t,ea.warn,arguments,$0)}error(t){return this._getLogFunction(0,t,ea.error,arguments)}deprecated(t,e){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${e}\` instead`)}removed(t,e){return this.error(`\`${t}\` has been removed. Use \`${e}\` instead`)}probe(t,e){return this._getLogFunction(t,e,ea.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,ea.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,ea.debug||ea.info,arguments,$0)}table(t,e,i){return e?this._getLogFunction(t,e,console.table||na,i&&[i],{tag:sE(e)}):na}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||na)}group(t,e,i={collapsed:!1}){const s=X0({logLevel:t,message:e,opts:i}),{collapsed:r}=i;return s.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(t,e,i={}){return this.group(t,e,Object.assign({},i,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||na)}withGroup(t,e,i){this.group(t,e)();try{i()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=f1(t)}_getLogFunction(t,e,i,s,r){if(this._shouldLog(t)){r=X0({logLevel:t,message:e,args:s,opts:r}),i=i||r.method,Sg(i),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=ta();const l=r.tag||r.message;if(r.once&&l)if(!W0[l])W0[l]=ta();else return na;return e=iE(this.id,r.message,r),i.bind(console,e,...r.args)}return na}}gl.VERSION=u1;function f1(n){if(!n)return 0;let t;switch(typeof n){case"number":t=n;break;case"object":t=n.logLevel||n.priority||0;break;default:return 0}return Sg(Number.isFinite(t)&&t>=0),t}function X0(n){const{logLevel:t,message:e}=n;n.logLevel=f1(t);const i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&i.unshift(e),n.message=t;break;case"object":Object.assign(n,t);break}typeof n.message=="function"&&(n.message=n.message());const s=typeof n.message;return Sg(s==="string"||s==="object"),Object.assign(n,{args:i},n.opts)}function iE(n,t,e){if(typeof t=="string"){const i=e.time?Gw(Qw(e.total)):"";t=e.time?`${n}: ${i}  ${t}`:`${n}: ${t}`,t=tE(t,e.color,e.background)}return t}function sE(n){for(const t in n)for(const e in n[t])return e||"untitled";return"empty"}const zd="4.3.3",rE=zd[0]>="0"&&zd[0]<="9"?`v${zd}`:"";function aE(){const n=new gl({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=rE,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const oE=aE();function lE(n,t){return h1(n||{},t)}function h1(n,t,e=0){if(e>3)return t;const i={...n};for(const[s,r]of Object.entries(t))r&&typeof r=="object"&&!Array.isArray(r)?i[s]=h1(i[s]||{},t[s],e+1):i[s]=t[s];return i}const cE="latest";function uE(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const fE=uE();function ms(n,t){if(!n)throw new Error(t||"loaders.gl assertion failed.")}const Qs=typeof process!="object"||String(process)!=="[object process]"||process.browser,hE=typeof window<"u"&&typeof window.orientation<"u",Y0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Y0&&parseFloat(Y0[1]);class dE{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(t,e){this.name=t,this.workerThread=e,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){ms(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){ms(this.isRunning),this.isRunning=!1,this._reject(t)}}class Vd{terminate(){}}const Hd=new Map;function pE(n){ms(n.source&&!n.url||!n.source&&n.url);let t=Hd.get(n.source||n.url);return t||(n.url&&(t=gE(n.url),Hd.set(n.url,t)),n.source&&(t=d1(n.source),Hd.set(n.source,t))),ms(t),t}function gE(n){if(!n.startsWith("http"))return n;const t=_E(n);return d1(t)}function d1(n){const t=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(t)}function _E(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function p1(n,t=!0,e){const i=e||new Set;if(n){if(q0(n))i.add(n);else if(q0(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(t&&typeof n=="object")for(const s in n)p1(n[s],t,i)}}return e===void 0?Array.from(i):[]}function q0(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const jd=()=>{};class Pp{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Qs||typeof Vd<"u"&&!Qs}constructor(t){const{name:e,source:i,url:s}=t;ms(i||s),this.name=e,this.source=i,this.url=s,this.onMessage=jd,this.onError=r=>console.log(r),this.worker=Qs?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=jd,this.onError=jd,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||p1(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+=`worker ${this.name} from ${this.url}. `,t.message&&(e+=`${t.message} in `),t.lineno&&(e+=`:${t.lineno}:${t.colno}`),new Error(e)}_createBrowserWorker(){this._loadableURL=pE({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new Vd(i,{eval:!1})}else if(this.source)t=new Vd(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class mE{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return Pp.isSupported()}constructor(t){this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,e=(s,r,l)=>s.done(l),i=(s,r)=>s.error(r)){const s=new Promise(r=>(this.jobQueue.push({name:t,onMessage:e,onError:i,onStart:r}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const i=new dE(e.name,t);t.onMessage=s=>e.onMessage(i,s.type,s.payload),t.onError=s=>e.onError(i,s),e.onStart(i);try{await i.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!Qs||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Pp({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return hE?this.maxMobileConcurrency:this.maxConcurrency}}const yE={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class cs{props;workerPools=new Map;static _workerFarm;static isSupported(){return Pp.isSupported()}static getWorkerFarm(t={}){return cs._workerFarm=cs._workerFarm||new cs({}),cs._workerFarm.setProps(t),cs._workerFarm}constructor(t){this.props={...yE},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:i,url:s}=t;let r=this.workerPools.get(e);return r||(r=new mE({name:e,source:i,url:s}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function bE(n,t={}){const e=t[n.id]||{},i=Qs?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let s=e.workerUrl;if(!s&&n.id==="compression"&&(s=t.workerUrl),t._workerType==="test"&&(Qs?s=`modules/${n.module}/dist/${i}`:s=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!s){let r=n.version;r==="latest"&&(r=cE);const l=r?`@${r}`:"";s=`https://unpkg.com/@loaders.gl/${n.module}${l}/dist/${i}`}return ms(s),s}function vE(n,t=fE){ms(n,"no worker provided");const e=n.version;return!(!t||!e)}function xE(n,t){return!cs.isSupported()||!Qs&&!t?._nodeWorkers?!1:n.worker&&t?.worker}async function TE(n,t,e,i,s){const r=n.id,l=bE(n,e),f=cs.getWorkerFarm(e).getWorkerPool({name:r,url:l});e=JSON.parse(JSON.stringify(e)),i=JSON.parse(JSON.stringify(i||{}));const d=await f.startJob("process-on-worker",SE.bind(null,s));return d.postMessage("process",{input:t,options:e,context:i}),await(await d.result).result}async function SE(n,t,e,i){switch(e){case"done":t.done(i);break;case"error":t.error(new Error(i.error));break;case"process":const{id:s,input:r,options:l}=i;try{const c=await n(r,l);t.postMessage("done",{id:s,result:c})}catch(c){const f=c instanceof Error?c.message:"unknown error";t.postMessage("error",{id:s,error:f})}break;default:console.warn(`parse-with-worker unknown message ${e}`)}}function AE(n,t,e){if(e=e||n.byteLength,n.byteLength<e||t.byteLength<e)return!1;const i=new Uint8Array(n),s=new Uint8Array(t);for(let r=0;r<i.length;++r)if(i[r]!==s[r])return!1;return!0}function wE(...n){return EE(n)}function EE(n){const t=n.map(r=>r instanceof ArrayBuffer?new Uint8Array(r):r),e=t.reduce((r,l)=>r+l.byteLength,0),i=new Uint8Array(e);let s=0;for(const r of t)i.set(r,s),s+=r.byteLength;return i.buffer}async function RE(n){const t=[];for await(const e of n)t.push(e);return wE(...t)}function K0(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();n=t[0]*1e3+t[1]/1e6}else n=Date.now();return n}class Z0{constructor(t,e){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=K0(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(K0()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class ef{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,e="count"){return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(e=>this._getOrCreate(e))}_getOrCreate(t){const{name:e,type:i}=t;let s=this.stats[e];return s||(t instanceof Z0?s=t:s=new Z0(e,i),this.stats[e]=s),s}}let CE="";const Q0={};function ME(n){for(const t in Q0)if(n.startsWith(t)){const e=Q0[t];n=n.replace(t,e)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${CE}${n}`),n}function OE(n){return n&&typeof n=="object"&&n.isBuffer}function g1(n){if(OE(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const t=n;return new TextEncoder().encode(t).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function _1(n){const t=n?n.lastIndexOf("/"):-1;return t>=0?n.substr(t+1):""}function IE(n){const t=n?n.lastIndexOf("/"):-1;return t>=0?n.substr(0,t):""}const PE=n=>typeof n=="boolean",Yo=n=>typeof n=="function",_l=n=>n!==null&&typeof n=="object",G0=n=>_l(n)&&n.constructor==={}.constructor,DE=n=>!!n&&typeof n[Symbol.iterator]=="function",kE=n=>n&&typeof n[Symbol.asyncIterator]=="function",hr=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,dr=n=>typeof Blob<"u"&&n instanceof Blob,NE=n=>n&&typeof n=="object"&&n.isBuffer,BE=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||_l(n)&&Yo(n.tee)&&Yo(n.cancel)&&Yo(n.getReader),UE=n=>_l(n)&&Yo(n.read)&&Yo(n.pipe)&&PE(n.readable),m1=n=>BE(n)||UE(n);class FE extends Error{constructor(t,e){super(t),this.reason=e.reason,this.url=e.url,this.response=e.response}reason;url;response}const LE=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,zE=/^([-\w.]+\/[-\w.+]+)/;function J0(n,t){return n.toLowerCase()===t.toLowerCase()}function VE(n){const t=zE.exec(n);return t?t[1]:n}function tv(n){const t=LE.exec(n);return t?t[1]:""}const y1=/\?.*/;function HE(n){const t=n.match(y1);return t&&t[0]}function Ag(n){return n.replace(y1,"")}function jE(n){if(n.length<50)return n;const t=n.slice(n.length-15);return`${n.substr(0,32)}...${t}`}function nf(n){return hr(n)?n.url:dr(n)?n.name||"":typeof n=="string"?n:""}function wg(n){if(hr(n)){const t=n,e=t.headers.get("content-type")||"",i=Ag(t.url);return VE(e)||tv(i)}return dr(n)?n.type||"":typeof n=="string"?tv(n):""}function WE(n){return hr(n)?n.headers["content-length"]||-1:dr(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function b1(n){if(hr(n))return n;const t={},e=WE(n);e>=0&&(t["content-length"]=String(e));const i=nf(n),s=wg(n);s&&(t["content-type"]=s);const r=await YE(n);r&&(t["x-first-bytes"]=r),typeof n=="string"&&(n=new TextEncoder().encode(n));const l=new Response(n,{headers:t});return Object.defineProperty(l,"url",{value:i}),l}async function $E(n){if(!n.ok)throw await XE(n)}async function XE(n){const t=jE(n.url);let e=`Failed to fetch resource (${n.status}) ${n.statusText}: ${t}`;e=e.length>100?`${e.slice(0,100)}...`:e;const i={reason:n.statusText,url:n.url,response:n};try{const s=n.headers.get("Content-Type");i.reason=!n.bodyUsed&&s?.includes("application/json")?await n.json():await n.text()}catch{}return new FE(e,i)}async function YE(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const e=n.slice(0,5);return await new Promise(i=>{const s=new FileReader;s.onload=r=>i(r?.target?.result),s.readAsDataURL(e)})}if(n instanceof ArrayBuffer){const e=n.slice(0,5);return`data:base64,${qE(e)}`}return null}function qE(n){let t="";const e=new Uint8Array(n);for(let i=0;i<e.byteLength;i++)t+=String.fromCharCode(e[i]);return btoa(t)}function KE(n){return!ZE(n)&&!QE(n)}function ZE(n){return n.startsWith("http:")||n.startsWith("https:")}function QE(n){return n.startsWith("data:")}async function ev(n,t){if(typeof n=="string"){const e=ME(n);return KE(e)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(e,t):await fetch(e,t)}return await b1(n)}const nv=new gl({id:"loaders.gl"});class GE{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class JE{console;constructor(){this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const v1={fetch:null,mimeType:void 0,nothrow:!1,log:new JE,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Tg,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},tR={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function x1(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function T1(){const n=x1();return n.globalOptions=n.globalOptions||{...v1},n.globalOptions}function eR(n,t,e,i){return e=e||[],e=Array.isArray(e)?e:[e],nR(n,e),sR(t,n,i)}function nR(n,t){iv(n,null,v1,tR,t);for(const e of t){const i=n&&n[e.id]||{},s=e.options&&e.options[e.id]||{},r=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};iv(i,e.id,s,r,t)}}function iv(n,t,e,i,s){const r=t||"Top level",l=t?`${t}.`:"";for(const c in n){const f=!t&&_l(n[c]),d=c==="baseUri"&&!t,p=c==="workerUrl"&&t;if(!(c in e)&&!d&&!p){if(c in i)nv.warn(`${r} loader option '${l}${c}' no longer supported, use '${i[c]}'`)();else if(!f){const _=iR(c,s);nv.warn(`${r} loader option '${l}${c}' not recognized. ${_}`)()}}}}function iR(n,t){const e=n.toLowerCase();let i="";for(const s of t)for(const r in s.options){if(n===r)return`Did you mean '${s.id}.${r}'?`;const l=r.toLowerCase();(e.startsWith(l)||l.startsWith(e))&&(i=i||`Did you mean '${s.id}.${r}'?`)}return i}function sR(n,t,e){const s={...n.options||{}};return rR(s,e),s.log===null&&(s.log=new GE),sv(s,T1()),sv(s,t),s}function sv(n,t){for(const e in t)if(e in t){const i=t[e];G0(i)&&G0(n[e])?n[e]={...n[e],...t[e]}:n[e]=t[e]}}function rR(n,t){t&&!("baseUri"in n)&&(n.baseUri=t)}function Eg(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n?.extensions)):!1}function Rg(n){Eu(n,"null loader"),Eu(Eg(n),"invalid loader");let t;return Array.isArray(n)&&(t=n[1],n=n[0],n={...n,options:{...n.options,...t}}),(n?.parseTextSync||n?.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const S1=()=>{const n=x1();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function aR(n){const t=S1();n=Array.isArray(n)?n:[n];for(const e of n){const i=Rg(e);t.find(s=>i===s)||t.unshift(i)}}function oR(){return S1()}const lR=/\.([^.]+)$/;async function cR(n,t=[],e,i){if(!A1(n))return null;let s=rv(n,t,{...e,nothrow:!0},i);if(s)return s;if(dr(n)&&(n=await n.slice(0,10).arrayBuffer(),s=rv(n,t,e,i)),!s&&!e?.nothrow)throw new Error(w1(n));return s}function rv(n,t=[],e,i){if(!A1(n))return null;if(t&&!Array.isArray(t))return Rg(t);let s=[];t&&(s=s.concat(t)),e?.ignoreRegisteredLoaders||s.push(...oR()),fR(s);const r=uR(n,s,e,i);if(!r&&!e?.nothrow)throw new Error(w1(n));return r}function uR(n,t,e,i){const s=nf(n),r=wg(n),l=Ag(s)||i?.url;let c=null,f="";return e?.mimeType&&(c=Wd(t,e?.mimeType),f=`match forced by supplied MIME type ${e?.mimeType}`),c=c||hR(t,l),f=f||(c?`matched url ${l}`:""),c=c||Wd(t,r),f=f||(c?`matched MIME type ${r}`:""),c=c||pR(t,n),f=f||(c?`matched initial data ${E1(n)}`:""),e?.fallbackMimeType&&(c=c||Wd(t,e?.fallbackMimeType),f=f||(c?`matched fallback MIME type ${r}`:"")),f&&oE.log(1,`selectLoader selected ${c?.name}: ${f}.`),c}function A1(n){return!(n instanceof Response&&n.status===204)}function w1(n){const t=nf(n),e=wg(n);let i="No valid loader found (";i+=t?`${_1(t)}, `:"no url provided, ",i+=`MIME type: ${e?`"${e}"`:"not provided"}, `;const s=n?E1(n):"";return i+=s?` first bytes: "${s}"`:"first bytes: not available",i+=")",i}function fR(n){for(const t of n)Rg(t)}function hR(n,t){const e=t&&lR.exec(t),i=e&&e[1];return i?dR(n,i):null}function dR(n,t){t=t.toLowerCase();for(const e of n)for(const i of e.extensions)if(i.toLowerCase()===t)return e;return null}function Wd(n,t){for(const e of n)if(e.mimeTypes?.some(i=>J0(t,i))||J0(t,`application/x.${e.id}`))return e;return null}function pR(n,t){if(!t)return null;for(const e of n)if(typeof t=="string"){if(gR(t,e))return e}else if(ArrayBuffer.isView(t)){if(av(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&av(t,0,e))return e;return null}function gR(n,t){return t.testText?t.testText(n):(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>n.startsWith(i))}function av(n,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(s=>_R(n,t,e,s))}function _R(n,t,e,i){if(i instanceof ArrayBuffer)return AE(i,n,i.byteLength);switch(typeof i){case"function":return i(n);case"string":const s=Dp(n,t,i.length);return i===s;default:return!1}}function E1(n,t=5){return typeof n=="string"?n.slice(0,t):ArrayBuffer.isView(n)?Dp(n.buffer,n.byteOffset,t):n instanceof ArrayBuffer?Dp(n,0,t):""}function Dp(n,t,e){if(n.byteLength<t+e)return"";const i=new DataView(n);let s="";for(let r=0;r<e;r++)s+=String.fromCharCode(i.getUint8(t+r));return s}const mR=256*1024;function*yR(n,t){const e=t?.chunkSize||mR;let i=0;const s=new TextEncoder;for(;i<n.length;){const r=Math.min(n.length-i,e),l=n.slice(i,i+r);i+=r,yield s.encode(l)}}const bR=256*1024;function*vR(n,t={}){const{chunkSize:e=bR}=t;let i=0;for(;i<n.byteLength;){const s=Math.min(n.byteLength-i,e),r=new ArrayBuffer(s),l=new Uint8Array(n,i,s);new Uint8Array(r).set(l),i+=s,yield r}}const xR=1024*1024;async function*TR(n,t){const e=t?.chunkSize||xR;let i=0;for(;i<n.size;){const s=i+e,r=await n.slice(i,s).arrayBuffer();i=s,yield r}}function ov(n,t){return Tg?SR(n,t):AR(n)}async function*SR(n,t){const e=n.getReader();let i;try{for(;;){const s=i||e.read();t?._streamReadAhead&&(i=e.read());const{done:r,value:l}=await s;if(r)return;yield g1(l)}}catch{e.releaseLock()}}async function*AR(n,t){for await(const e of n)yield g1(e)}function wR(n,t){if(typeof n=="string")return yR(n,t);if(n instanceof ArrayBuffer)return vR(n,t);if(dr(n))return TR(n,t);if(m1(n))return ov(n,t);if(hr(n))return ov(n.body,t);throw new Error("makeIterator")}const R1="Cannot convert supplied data type";function ER(n,t,e){if(t.text&&typeof n=="string")return n;if(NE(n)&&(n=n.buffer),n instanceof ArrayBuffer){const i=n;return t.text&&!t.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer;const s=n.byteLength||n.length;return(n.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+s)),i}throw new Error(R1)}async function RR(n,t,e){const i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||i)return ER(n,t);if(dr(n)&&(n=await b1(n)),hr(n)){const s=n;return await $E(s),t.binary?await s.arrayBuffer():await s.text()}if(m1(n)&&(n=wR(n,e)),DE(n)||kE(n))return RE(n);throw new Error(R1)}function C1(n,t){const e=T1(),i=n||e;return typeof i.fetch=="function"?i.fetch:_l(i.fetch)?s=>ev(s,i.fetch):t?.fetch?t?.fetch:ev}function CR(n,t,e){if(e)return e;const i={fetch:C1(t,n),...n};if(i.url){const s=Ag(i.url);i.baseUrl=s,i.queryString=HE(i.url),i.filename=_1(s),i.baseUrl=IE(s)}return Array.isArray(i.loaders)||(i.loaders=null),i}function MR(n,t){if(n&&!Array.isArray(n))return n;let e;if(n&&(e=Array.isArray(n)?n:[n]),t&&t.loaders){const i=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...i]:i}return e&&e.length?e:void 0}async function Cu(n,t,e,i){t&&!Array.isArray(t)&&!Eg(t)&&(i=void 0,e=t,t=void 0),n=await n,e=e||{};const s=nf(n),l=MR(t,i),c=await cR(n,l,e);return c?(e=eR(e,c,l,s),i=CR({url:s,_parse:Cu,loaders:l},e,i||null),await OR(c,n,e,i)):null}async function OR(n,t,e,i){if(vE(n),e=lE(n.options,e),hr(t)){const r=t,{ok:l,redirected:c,status:f,statusText:d,type:p,url:_}=r,y=Object.fromEntries(r.headers.entries());i.response={headers:y,ok:l,redirected:c,status:f,statusText:d,type:p,url:_}}t=await RR(t,n,e);const s=n;if(s.parseTextSync&&typeof t=="string")return s.parseTextSync(t,e,i);if(xE(n,e))return await TE(n,t,e,i,Cu);if(s.parseText&&typeof t=="string")return await s.parseText(t,e,i);if(s.parse)return await s.parse(t,e,i);throw ms(!s.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function kp(n,t,e,i){let s,r;!Array.isArray(t)&&!Eg(t)?(s=[],r=t):(s=t,r=e);const l=C1(r);let c=n;return typeof n=="string"&&(c=await l(n)),dr(n)&&(c=await l(n)),Array.isArray(s)?await Cu(c,s,r):await Cu(c,s,r)}const IR="4.3.3",PR=globalThis.loaders?.parseImageNode,Np=typeof Image<"u",Bp=typeof ImageBitmap<"u",DR=!!PR,Up=Tg?!0:DR;function kR(n){switch(n){case"auto":return Bp||Np||Up;case"imagebitmap":return Bp;case"image":return Np;case"data":return Up;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function NR(){if(Bp)return"imagebitmap";if(Np)return"image";if(Up)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function BR(n){const t=FR(n);if(!t)throw new Error("Not an image");return t}function UR(n){switch(BR(n)){case"data":return n;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=n.width,t.height=n.height,e.drawImage(n,0,0),e.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function FR(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const LR=/^data:image\/svg\+xml/,zR=/\.svg((\?|#).*)?$/;function Cg(n){return n&&(LR.test(n)||zR.test(n))}function VR(n,t){if(Cg(t)){let i=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(r){throw new Error(r.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return M1(n,t)}function M1(n,t){if(Cg(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function O1(n,t,e){const i=VR(n,e),s=self.URL||self.webkitURL,r=typeof i!="string"&&s.createObjectURL(i);try{return await HR(r||i,t)}finally{r&&s.revokeObjectURL(r)}}async function HR(n,t){const e=new Image;return e.src=n,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((i,s)=>{try{e.onload=()=>i(e),e.onerror=r=>{const l=r instanceof Error?r.message:"error";s(new Error(l))}}catch(r){s(r)}})}const jR={};let lv=!0;async function WR(n,t,e){let i;Cg(e)?i=await O1(n,t,e):i=M1(n,e);const s=t&&t.imagebitmap;return await $R(i,s)}async function $R(n,t=null){if((XR(t)||!lv)&&(t=null),t)try{return await createImageBitmap(n,t)}catch(e){console.warn(e),lv=!1}return await createImageBitmap(n)}function XR(n){for(const t in n||jR)return!1;return!0}function YR(n){return!QR(n,"ftyp",4)||(n[8]&96)===0?null:qR(n)}function qR(n){switch(KR(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function KR(n,t,e){return String.fromCharCode(...n.slice(t,e))}function ZR(n){return[...n].map(t=>t.charCodeAt(0))}function QR(n,t,e=0){const i=ZR(t);for(let s=0;s<i.length;++s)if(i[s]!==n[s+e])return!1;return!0}const ei=!1,qo=!0;function I1(n){const t=ml(n);return JR(t)||nC(t)||tC(t)||eC(t)||GR(t)}function GR(n){const t=new Uint8Array(n instanceof DataView?n.buffer:n),e=YR(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function JR(n){const t=ml(n);return t.byteLength>=24&&t.getUint32(0,ei)===2303741511?{mimeType:"image/png",width:t.getUint32(16,ei),height:t.getUint32(20,ei)}:null}function tC(n){const t=ml(n);return t.byteLength>=10&&t.getUint32(0,ei)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,qo),height:t.getUint16(8,qo)}:null}function eC(n){const t=ml(n);return t.byteLength>=14&&t.getUint16(0,ei)===16973&&t.getUint32(2,qo)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,qo),height:t.getUint32(22,qo)}:null}function nC(n){const t=ml(n);if(!(t.byteLength>=3&&t.getUint16(0,ei)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=iC();let r=2;for(;r+9<t.byteLength;){const l=t.getUint16(r,ei);if(s.has(l))return{mimeType:"image/jpeg",height:t.getUint16(r+5,ei),width:t.getUint16(r+7,ei)};if(!i.has(l))return null;r+=2,r+=t.getUint16(r,ei)}return null}function iC(){const n=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)n.add(e);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function ml(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function sC(n,t){const{mimeType:e}=I1(n)||{},i=globalThis.loaders?.parseImageNode;return Eu(i),await i(n,e)}async function rC(n,t,e){t=t||{};const s=(t.image||{}).type||"auto",{url:r}=e||{},l=aC(s);let c;switch(l){case"imagebitmap":c=await WR(n,t,r);break;case"image":c=await O1(n,t,r);break;case"data":c=await sC(n);break;default:Eu(!1)}return s==="data"&&(c=UR(c)),c}function aC(n){switch(n){case"auto":case"data":return NR();default:return kR(n),n}}const oC=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],lC=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],cC={image:{type:"auto",decode:!0}},uC={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:IR,mimeTypes:lC,extensions:oC,parse:rC,tests:[n=>!!I1(new DataView(n))],options:cC},Qt=new gl({id:"deck"});let Fp={};function fC(n){Fp=n}function We(n,t,e,i){Qt.level>0&&Fp[n]&&Fp[n].call(null,t,e,i)}function hC(n){const t=n[0],e=n[n.length-1];return t==="{"&&e==="}"||t==="["&&e==="]"}const dC={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:hC,parseTextSync:JSON.parse};function pC(){const n="9.2.2",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==n)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${n}`);return t||(Qt.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:Qt,_registerLoggers:fC},aR([dC,[uC,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const gC=pC();function Mg(n,t){if(!n)throw new Error(t||"shadertools: assertion failed.")}const $d={number:{type:"number",validate(n,t){return Number.isFinite(n)&&typeof t=="object"&&(t.max===void 0||n<=t.max)&&(t.min===void 0||n>=t.min)}},array:{type:"array",validate(n,t){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function _C(n){const t={};for(const[e,i]of Object.entries(n))t[e]=mC(i);return t}function mC(n){let t=cv(n);if(t!=="object")return{value:n,...$d[t],type:t};if(typeof n=="object")return n?n.type!==void 0?{...n,...$d[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(t=cv(n.value),{...n,...$d[t],type:t}):{type:"object",value:null};throw new Error("props")}function cv(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const yC=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,bC=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,vC={vertex:yC,fragment:bC},uv=/void\s+main\s*\([^)]*\)\s*\{\n?/,fv=/}\n?[^{}]*$/,Xd=[],mu="__LUMA_INJECT_DECLARATIONS__";function xC(n){const t={vertex:{},fragment:{}};for(const e in n){let i=n[e];const s=TC(e);typeof i=="string"&&(i={order:0,injection:i}),t[s][e]=i}return t}function TC(n){const t=n.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function Mu(n,t,e,i=!1){const s=t==="vertex";for(const r in e){const l=e[r];l.sort((f,d)=>f.order-d.order),Xd.length=l.length;for(let f=0,d=l.length;f<d;++f)Xd[f]=l[f].injection;const c=`${Xd.join(`
`)}
`;switch(r){case"vs:#decl":s&&(n=n.replace(mu,c));break;case"vs:#main-start":s&&(n=n.replace(uv,f=>f+c));break;case"vs:#main-end":s&&(n=n.replace(fv,f=>c+f));break;case"fs:#decl":s||(n=n.replace(mu,c));break;case"fs:#main-start":s||(n=n.replace(uv,f=>f+c));break;case"fs:#main-end":s||(n=n.replace(fv,f=>c+f));break;default:n=n.replace(r,f=>f+c)}}return n=n.replace(mu,""),i&&(n=n.replace(/\}\s*$/,r=>r+vC[t])),n}function Ou(n){n.map(t=>SC(t))}function SC(n){if(n.instance)return;Ou(n.dependencies||[]);const{propTypes:t={},deprecations:e=[],inject:i={}}=n,s={normalizedInjections:xC(i),parsedDeprecations:AC(e)};t&&(s.propValidators=_C(t)),n.instance=s;let r={};t&&(r=Object.entries(t).reduce((l,[c,f])=>{const d=f?.value;return d&&(l[c]=d),l},{})),n.defaultUniforms={...n.defaultUniforms,...r}}function P1(n,t,e){n.deprecations?.forEach(i=>{i.regex?.test(t)&&(i.deprecated?e.deprecated(i.old,i.new)():e.removed(i.old,i.new)())})}function AC(n){return n.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp(`\\b${t.old}\\(`);break;default:t.regex=new RegExp(`${t.type} ${t.old};`)}}),n}function Og(n){Ou(n);const t={},e={};D1({modules:n,level:0,moduleMap:t,moduleDepth:e});const i=Object.keys(e).sort((s,r)=>e[r]-e[s]).map(s=>t[s]);return Ou(i),i}function D1(n){const{modules:t,level:e,moduleMap:i,moduleDepth:s}=n;if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const r of t)i[r.name]=r,(s[r.name]===void 0||s[r.name]<e)&&(s[r.name]=e);for(const r of t)r.dependencies&&D1({modules:r.dependencies,level:e+1,moduleMap:i,moduleDepth:s})}function wC(n){switch(n?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function EC(n,t){if(Number(n.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return n=hv(n,RC),n;case"fragment":return n=hv(n,CC),n;default:throw new Error(t)}}const k1=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],RC=[...k1,[Lp("attribute"),"in $1"],[Lp("varying"),"out $1"]],CC=[...k1,[Lp("varying"),"in $1"]];function hv(n,t){for(const[e,i]of t)n=n.replace(e,i);return n}function Lp(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function N1(n,t){let e="";for(const i in n){const s=n[i];if(e+=`void ${s.signature} {
`,s.header&&(e+=`  ${s.header}`),t[i]){const r=t[i];r.sort((l,c)=>l.order-c.order);for(const l of r)e+=`  ${l.injection}
`}s.footer&&(e+=`  ${s.footer}`),e+=`}
`}return e}function B1(n){const t={vertex:{},fragment:{}};for(const e of n){let i,s;typeof e!="string"?(i=e,s=i.hook):(i={},s=e),s=s.trim();const[r,l]=s.split(":"),c=s.replace(/\(.+/,""),f=Object.assign(i,{signature:l});switch(r){case"vs":t.vertex[c]=f;break;case"fs":t.fragment[c]=f;break;default:throw new Error(r)}}return t}function MC(n,t){return{name:OC(n,t),language:"glsl",version:IC(n)}}function OC(n,t="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return i?i[1]:t}function IC(n){let t=100;const e=n.match(/[^\s]+/g);if(e&&e.length>=2&&e[0]==="#version"){const i=parseInt(e[1],10);Number.isFinite(i)&&(t=i)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}const U1=`

${mu}
`,PC=`precision highp float;
`;function DC(n){const t=Og(n.modules||[]);return{source:NC(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:t}),getUniforms:F1(t)}}function kC(n){const{vs:t,fs:e}=n,i=Og(n.modules||[]);return{vs:dv(n.platformInfo,{...n,source:t,stage:"vertex",modules:i}),fs:dv(n.platformInfo,{...n,source:e,stage:"fragment",modules:i}),getUniforms:F1(i)}}function NC(n,t){const{source:e,stage:i,modules:s,hookFunctions:r=[],inject:l={},log:c}=t;Mg(typeof e=="string","shader source must be a string");const f=e;let d="";const p=B1(r),_={},y={},b={};for(const T in l){const A=typeof l[T]=="string"?{injection:l[T],order:0}:l[T],E=/^(v|f)s:(#)?([\w-]+)$/.exec(T);if(E){const D=E[2],C=E[3];D?C==="decl"?y[T]=[A]:b[T]=[A]:_[T]=[A]}else b[T]=[A]}const x=s;for(const T of x){c&&P1(T,f,c);const A=L1(T,"wgsl");d+=A;const E=T.injections?.[i]||{};for(const D in E){const C=/^(v|f)s:#([\w-]+)$/.exec(D);if(C){const k=C[2]==="decl"?y:b;k[D]=k[D]||[],k[D].push(E[D])}else _[D]=_[D]||[],_[D].push(E[D])}}return d+=U1,d=Mu(d,i,y),d+=N1(p[i],_),d+=f,d=Mu(d,i,b),d}function dv(n,t){const{source:e,stage:i,language:s="glsl",modules:r,defines:l={},hookFunctions:c=[],inject:f={},prologue:d=!0,log:p}=t;Mg(typeof e=="string","shader source must be a string");const _=s==="glsl"?MC(e).version:-1,y=n.shaderLanguageVersion,b=_===100?"#version 100":"#version 300 es",T=e.split(`
`).slice(1).join(`
`),A={};r.forEach(z=>{Object.assign(A,z.defines)}),Object.assign(A,l);let E="";switch(s){case"wgsl":break;case"glsl":E=d?`${b}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${wC(n)}
${i==="fragment"?PC:""}

// ----- APPLICATION DEFINES -------------------------

${BC(A)}

`:`${b}
`;break}const D=B1(c),C={},O={},k={};for(const z in f){const Y=typeof f[z]=="string"?{injection:f[z],order:0}:f[z],q=/^(v|f)s:(#)?([\w-]+)$/.exec(z);if(q){const G=q[2],at=q[3];G?at==="decl"?O[z]=[Y]:k[z]=[Y]:C[z]=[Y]}else k[z]=[Y]}for(const z of r){p&&P1(z,T,p);const Y=L1(z,i);E+=Y;const q=z.instance?.normalizedInjections[i]||{};for(const G in q){const at=/^(v|f)s:#([\w-]+)$/.exec(G);if(at){const ot=at[2]==="decl"?O:k;ot[G]=ot[G]||[],ot[G].push(q[G])}else C[G]=C[G]||[],C[G].push(q[G])}}return E+="// ----- MAIN SHADER SOURCE -------------------------",E+=U1,E=Mu(E,i,O),E+=N1(D[i],C),E+=T,E=Mu(E,i,k),s==="glsl"&&_!==y&&(E=EC(E,i)),E.trim()}function F1(n){return function(e){const i={};for(const s of n){const r=s.getUniforms?.(e,i);Object.assign(i,r)}return i}}function BC(n={}){let t="";for(const e in n){const i=n[e];(i||Number.isFinite(i))&&(t+=`#define ${e.toUpperCase()} ${n[e]}
`)}return t}function L1(n,t){let e;switch(t){case"vertex":e=n.vs||"";break;case"fragment":e=n.fs||"";break;case"wgsl":e=n.source||"";break;default:Mg(!1)}if(!n.name)throw new Error("Shader module must have a name");const i=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${n.name} ---------------

`;return t!=="wgsl"&&(s+=`#define MODULE_${i}
`),s+=`${e}
`,s}const UC=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,FC=/^\s*\#\s*endif\s*$/;function LC(n,t){const e=n.split(`
`),i=[];let s=!0,r=null;for(const l of e){const c=l.match(UC),f=l.match(FC);c?(r=c[1],s=!!t?.defines?.[r]):f?s=!0:s&&i.push(l)}return i.join(`
`)}class Xs{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Xs.defaultShaderAssembler=Xs.defaultShaderAssembler||new Xs,Xs.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(e=>e.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){const e=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==e)}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t)}assembleWGSLShader(t){const e=this._getModuleList(t.modules),i=this._hookFunctions,{source:s,getUniforms:r}=DC({...t,source:t.source,modules:e,hookFunctions:i});return{source:t.platformInfo.shaderLanguage==="wgsl"?LC(s):s,getUniforms:r,modules:e}}assembleGLSLShaderPair(t){const e=this._getModuleList(t.modules),i=this._hookFunctions;return{...kC({...t,vs:t.vs,fs:t.fs,modules:e,hookFunctions:i}),modules:e}}_getModuleList(t=[]){const e=new Array(this._defaultModules.length+t.length),i={};let s=0;for(let r=0,l=this._defaultModules.length;r<l;++r){const c=this._defaultModules[r],f=c.name;e[s++]=c,i[f]=!0}for(let r=0,l=t.length;r<l;++r){const c=t[r],f=c.name;i[f]||(e[s++]=c,i[f]=!0)}return e.length=s,Ou(e),e}}const zC=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,VC=`#version 300 es
${zC}`;function HC(n){const{input:t,inputChannels:e,output:i}={};if(!t)return VC;if(!e)throw new Error("inputChannels");const s=jC(e),r=WC(t,e);return`#version 300 es
in ${s} ${t};
out vec4 ${i};
void main() {
  ${i} = ${r};
}`}function jC(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function WC(n,t){switch(t){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${t}`)}}class $C{stats=new Map;getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new ef({id:t})),this.stats.get(t)}}const z1=new $C,et=new gl({id:"luma.gl"}),Yd={};function sf(n="id"){Yd[n]=Yd[n]||1;const t=Yd[n]++;return`${n}-${t}`}let Kt=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(t,e,i){if(!t)throw new Error("no device");this._device=t,this.props=XC(e,i);const s=this.props.id!=="undefined"?this.props.id:sf(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(const t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get(`${e}s Active`).decrementCount()}trackAllocatedMemory(t,e=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(t),i.get(`${e} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){const e=this._device.statsManager.getStats("Resource Counts");e.get("GPU Memory").subtractCount(this.allocatedBytes),e.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}};function XC(n,t){const e={...t};for(const i in n)n[i]!==void 0&&(e[i]=n[i]);return e}class Gt extends Kt{static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(t,e){const i={...e};(e.usage||0)&Gt.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?i.indexType="uint32":e.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data,super(t,i,Gt.defaultProps),this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=t.incrementTimestamp()}clone(t){return this.device.createBuffer({...this.props,...t})}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(t,e,i){const s=ArrayBuffer.isView(t)?t.buffer:t,r=Math.min(t?t.byteLength:i,Gt.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(r):e===0&&i===s.byteLength?this.debugData=s.slice(0,r):this.debugData=s.slice(e,e+r)}static defaultProps={...Kt.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0}}function V1(n){const[t,e,i]=Dg[n],s=n.includes("norm"),r=!s&&!n.startsWith("float"),l=n.startsWith("s");return{signedType:t,primitiveType:e,byteLength:i,normalized:s,integer:r,signed:l}}function YC(n){const t=n;switch(t){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return t}}function qC(n,t){switch(t){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}function Ig(n){const t=ArrayBuffer.isView(n)?n.constructor:n;if(t===Uint8ClampedArray)return"uint8";const e=Object.values(Dg).find(i=>t===i[4]);if(!e)throw new Error(t.name);return e[0]}function Pg(n){const[,,,,t]=Dg[n];return t}const Dg={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function kg(n){let t;n.endsWith("-webgl")&&(n.replace("-webgl",""),t=!0);const[e,i]=n.split("x"),s=e,r=i?parseInt(i):1,l=V1(s),c={type:s,components:r,byteLength:l.byteLength*r,integer:l.integer,signed:l.signed,normalized:l.normalized};return t&&(c.webglOnly=!0),c}function KC(n,t,e){const i=e?YC(n):n;switch(i){case"unorm8":return t===1?"unorm8":t===3?"unorm8x3-webgl":`${i}x${t}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(t===1||t===3)throw new Error(`size: ${t}`);return`${i}x${t}`;default:return t===1?i:`${i}x${t}`}}function ZC(n,t,e){if(!t||t>4)throw new Error(`size ${t}`);const i=t,s=Ig(n);return KC(s,i,e)}function QC(n){let t;switch(n.primitiveType){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return n.components<=2?"float16x2":"float16x4"}return n.components===1?t:`${t}x${n.components}`}const Be="texture-compression-bc",Yt="texture-compression-astc",Kn="texture-compression-etc2",GC="texture-compression-etc1-webgl",Hc="texture-compression-pvrtc-webgl",qd="texture-compression-atc-webgl",jc="float32-renderable-webgl",Kd="float16-renderable-webgl",JC="rgb9e5ufloat-renderable-webgl",Zd="snorm8-renderable-webgl",Mo="norm16-renderable-webgl",Qd="snorm16-renderable-webgl",Wc="float32-filterable",pv="float16-filterable-webgl";function H1(n){const t=nM[n];if(!t)throw new Error(`Unsupported texture format ${n}`);return t}const tM={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:Zd},rg8snorm:{render:Zd},"rgb8snorm-webgl":{},rgba8snorm:{render:Zd},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:Mo},rg16unorm:{render:Mo},"rgb16unorm-webgl":{f:Mo},rgba16unorm:{render:Mo},r16snorm:{f:Qd},rg16snorm:{render:Qd},"rgb16snorm-webgl":{f:Mo},rgba16snorm:{render:Qd},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:Kd,filter:"float16-filterable-webgl"},rg16float:{render:Kd,filter:pv},rgba16float:{render:Kd,filter:pv},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:jc,filter:Wc},rg32float:{render:!1,filter:Wc},"rgb32float-webgl":{render:jc,filter:Wc},rgba32float:{render:jc,filter:Wc},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:JC},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:jc},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},eM={"bc1-rgb-unorm-webgl":{f:Be},"bc1-rgb-unorm-srgb-webgl":{f:Be},"bc1-rgba-unorm":{f:Be},"bc1-rgba-unorm-srgb":{f:Be},"bc2-rgba-unorm":{f:Be},"bc2-rgba-unorm-srgb":{f:Be},"bc3-rgba-unorm":{f:Be},"bc3-rgba-unorm-srgb":{f:Be},"bc4-r-unorm":{f:Be},"bc4-r-snorm":{f:Be},"bc5-rg-unorm":{f:Be},"bc5-rg-snorm":{f:Be},"bc6h-rgb-ufloat":{f:Be},"bc6h-rgb-float":{f:Be},"bc7-rgba-unorm":{f:Be},"bc7-rgba-unorm-srgb":{f:Be},"etc2-rgb8unorm":{f:Kn},"etc2-rgb8unorm-srgb":{f:Kn},"etc2-rgb8a1unorm":{f:Kn},"etc2-rgb8a1unorm-srgb":{f:Kn},"etc2-rgba8unorm":{f:Kn},"etc2-rgba8unorm-srgb":{f:Kn},"eac-r11unorm":{f:Kn},"eac-r11snorm":{f:Kn},"eac-rg11unorm":{f:Kn},"eac-rg11snorm":{f:Kn},"astc-4x4-unorm":{f:Yt},"astc-4x4-unorm-srgb":{f:Yt},"astc-5x4-unorm":{f:Yt},"astc-5x4-unorm-srgb":{f:Yt},"astc-5x5-unorm":{f:Yt},"astc-5x5-unorm-srgb":{f:Yt},"astc-6x5-unorm":{f:Yt},"astc-6x5-unorm-srgb":{f:Yt},"astc-6x6-unorm":{f:Yt},"astc-6x6-unorm-srgb":{f:Yt},"astc-8x5-unorm":{f:Yt},"astc-8x5-unorm-srgb":{f:Yt},"astc-8x6-unorm":{f:Yt},"astc-8x6-unorm-srgb":{f:Yt},"astc-8x8-unorm":{f:Yt},"astc-8x8-unorm-srgb":{f:Yt},"astc-10x5-unorm":{f:Yt},"astc-10x5-unorm-srgb":{f:Yt},"astc-10x6-unorm":{f:Yt},"astc-10x6-unorm-srgb":{f:Yt},"astc-10x8-unorm":{f:Yt},"astc-10x8-unorm-srgb":{f:Yt},"astc-10x10-unorm":{f:Yt},"astc-10x10-unorm-srgb":{f:Yt},"astc-12x10-unorm":{f:Yt},"astc-12x10-unorm-srgb":{f:Yt},"astc-12x12-unorm":{f:Yt},"astc-12x12-unorm-srgb":{f:Yt},"pvrtc-rgb4unorm-webgl":{f:Hc},"pvrtc-rgba4unorm-webgl":{f:Hc},"pvrtc-rbg2unorm-webgl":{f:Hc},"pvrtc-rgba2unorm-webgl":{f:Hc},"etc1-rbg-unorm-webgl":{f:GC},"atc-rgb-unorm-webgl":{f:qd},"atc-rgba-unorm-webgl":{f:qd},"atc-rgbai-unorm-webgl":{f:qd}},nM={...tM,...eM},iM=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],sM=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class rM{getInfo(t){return gv(t)}isColor(t){return t.startsWith("rgba")||t.startsWith("bgra")||t.startsWith("rgb")}isDepthStencil(t){return t.startsWith("depth")||t.startsWith("stencil")}isCompressed(t){return iM.some(e=>t.startsWith(e))}getCapabilities(t){const e=H1(t),i={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},s=gv(t),r=t.startsWith("depth")||t.startsWith("stencil"),l=s?.signed,c=s?.integer,f=s?.webgl;return i.render&&=!l,i.filter&&=!r&&!l&&!c&&!f,i}}const da=new rM;function gv(n){let t=aM(n);if(da.isCompressed(n)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const i=oM(n);i&&(t.blockWidth=i.blockWidth,t.blockHeight=i.blockHeight)}const e=sM.exec(n);if(e){const[,i,s,r,l,c]=e,f=`${r}${s}`,d=V1(f),p=d.byteLength*8,_=i.length,y=[p,_>=2?p:0,_>=3?p:0,_>=4?p:0];t={format:n,attachment:t.attachment,dataType:d.signedType,components:_,channels:i,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:y,bytesPerPixel:d.byteLength*i.length,packed:t.packed,srgb:t.srgb},c==="-webgl"&&(t.webgl=!0),l==="-srgb"&&(t.srgb=!0)}return n.endsWith("-webgl")&&(t.webgl=!0),n.endsWith("-srgb")&&(t.srgb=!0),t}function aM(n){const t=H1(n),e=t.bytesPerPixel||1,i=t.bitsPerChannel||[8,8,8,8];return delete t.bitsPerChannel,delete t.bytesPerPixel,delete t.f,delete t.render,delete t.filter,delete t.blend,delete t.store,{...t,format:n,attachment:t.attachment||"color",channels:t.channels||"r",components:t.components||t.channels?.length||1,bytesPerPixel:e,bitsPerChannel:i,dataType:t.dataType||"uint8",srgb:t.srgb??!1,packed:t.packed??!1,webgl:t.webgl??!1,integer:t.integer??!1,signed:t.signed??!1,normalized:t.normalized??!1,compressed:t.compressed??!1}}function oM(n){const e=/.*-(\d+)x(\d+)-.*/.exec(n);if(e){const[,i,s]=e;return{blockWidth:Number(i),blockHeight:Number(s)}}return null}function lM(n){return typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement||typeof VideoFrame<"u"&&n instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}function cM(n){if(typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height};if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)return{width:n.naturalWidth,height:n.naturalHeight};if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)return{width:n.videoWidth,height:n.videoHeight};if(typeof VideoFrame<"u"&&n instanceof VideoFrame)return{width:n.displayWidth,height:n.displayHeight};throw new Error("Unknown image type")}class uM{}class fM{features;disabledFeatures;constructor(t=[],e){this.features=new Set(t),this.disabledFeatures=e||{}}*[Symbol.iterator](){yield*this.features}has(t){return!this.disabledFeatures?.[t]&&this.features.has(t)}}class sr{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(t,e)=>{},onResize:(t,e)=>{const[i,s]=t.getDevicePixelSize();et.log(1,`${t} resized => ${i}x${s}px`)()},onPositionChange:(t,e)=>{const[i,s]=t.getPosition();et.log(1,`${t} repositioned => ${i},${s}`)()},onVisibilityChange:t=>et.log(1,`${t} Visibility changed ${t.isVisible}`)(),onDevicePixelRatioChange:(t,e)=>et.log(1,`${t} DPR changed ${e.oldRatio} => ${t.devicePixelRatio}`)(),debug:et.get("debug")||void 0,debugShaders:et.get("debug-shaders")||void 0,debugFramebuffers:!!et.get("debug-framebuffers"),debugFactories:!!et.get("debug-factories"),debugWebGL:!!et.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0};get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=z1;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(t){this.props={...sr.defaultProps,...t},this.id=this.props.id||sf(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(t){return kg(t)}isVertexFormatSupported(t){return!0}getTextureFormatInfo(t){return da.getInfo(t)}getTextureFormatCapabilities(t){let e=this._textureCaps[t];if(!e){const i=this._getDeviceTextureFormatCapabilities(t);e=this._getDeviceSpecificTextureFormatCapabilities(i),this._textureCaps[t]=e}return e}getMipLevelCount(t,e,i=1){const s=Math.max(t,e,i);return 1+Math.floor(Math.log2(s))}isExternalImage(t){return lM(t)}getExternalImageSize(t){return cM(t)}isTextureFormatSupported(t){return this.getTextureFormatCapabilities(t).create}isTextureFormatFilterable(t){return this.getTextureFormatCapabilities(t).filter}isTextureFormatRenderable(t){return this.getTextureFormatCapabilities(t).render}isTextureFormatCompressed(t){return da.isCompressed(t)}pushDebugGroup(t){this.commandEncoder.pushDebugGroup(t)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(t){this.commandEncoder?.insertDebugMarker(t)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(t,e,...i){return this.props.onError(t,e)?()=>{}:et.error(t.message,e,...i)}debug(){if(this.props.debug)debugger;else et.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(t){return this.commandEncoder.beginRenderPass(t)}beginComputePass(t){return this.commandEncoder.beginComputePass(t)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(t,e){throw new Error("not implemented")}readPixelsToBufferWebGL(t,e){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,e){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(t){return t.createCanvasContext===!0?{}:t.createCanvasContext}_getDeviceTextureFormatCapabilities(t){const e=da.getCapabilities(t),i=r=>(typeof r=="string"?this.features.has(r):r)??!0,s=i(e.create);return{format:t,create:s,render:s&&i(e.render),filter:s&&i(e.filter),blend:s&&i(e.blend),store:s&&i(e.store)}}_normalizeBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});const e={...t};if((t.usage||0)&Gt.INDEX&&(t.indexType||(t.data instanceof Uint32Array?e.indexType="uint32":t.data instanceof Uint16Array&&(e.indexType="uint16")),!e.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return e}}const hM="set luma.log.level=1 (or higher) to trace rendering",_v="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class Iu{static defaultProps={...sr.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=z1;log=et;VERSION="9.2.4";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw et.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),et.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");et.error("This version of luma.gl has already been initialized")()}et.log(1,`${this.VERSION} - ${hM}`)(),globalThis.luma=this}async createDevice(t={}){const e={...Iu.defaultProps,...t},i=this.selectAdapter(e.type,e.adapters);if(!i)throw new Error(_v);return e.waitForPageLoad&&await i.pageLoaded,await i.create(e)}async attachDevice(t,e){const i=this._getTypeFromHandle(t,e.adapters),s=i&&this.selectAdapter(i,e.adapters);if(!s)throw new Error(_v);return await s?.attach?.(t,e)}registerAdapters(t){for(const e of t)this.preregisteredAdapters.set(e.type,e)}getSupportedAdapters(t=[]){const e=this._getAdapterMap(t);return Array.from(e).map(([,i])=>i).filter(i=>i.isSupported?.()).map(i=>i.type)}getBestAvailableAdapterType(t=[]){const e=["webgpu","webgl","null"],i=this._getAdapterMap(t);for(const s of e)if(i.get(s)?.isSupported?.())return s;return null}selectAdapter(t,e=[]){let i=t;t==="best-available"&&(i=this.getBestAvailableAdapterType(e));const s=this._getAdapterMap(e);return i&&s.get(i)||null}enforceWebGL2(t=!0,e=[]){const s=this._getAdapterMap(e).get("webgl");s||et.warn("enforceWebGL2: webgl adapter not found")(),s?.enforceWebGL2?.(t)}setDefaultDeviceProps(t){Object.assign(Iu.defaultProps,t)}_getAdapterMap(t=[]){const e=new Map(this.preregisteredAdapters);for(const i of t)e.set(i.type,i);return e}_getTypeFromHandle(t,e=[]){return t instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&t instanceof GPUDevice||t?.queue?"webgpu":t===null?"null":(t instanceof WebGLRenderingContext?et.warn("WebGL1 is not supported",t)():et.warn("Unknown handle type",t)(),null)}}const zp=new Iu;class dM{get pageLoaded(){return _M()}}const pM=fr()&&typeof document<"u",gM=()=>pM&&document.readyState==="complete";let $c=null;function _M(){return $c||(gM()||typeof window>"u"?$c=Promise.resolve():$c=new Promise(n=>window.addEventListener("load",()=>n()))),$c}function mM(){let n,t;return{promise:new Promise((i,s)=>{n=i,t=s}),resolve:n,reject:t}}class Ys{static isHTMLCanvas(t){return typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement}static isOffscreenCanvas(t){return typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static defaultProps={id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1};id;props;canvas;htmlCanvas;offscreenCanvas;type;initialized;isInitialized=!1;isVisible=!0;cssWidth;cssHeight;devicePixelRatio;devicePixelWidth;devicePixelHeight;drawingBufferWidth;drawingBufferHeight;_initializedResolvers=mM();_resizeObserver;_intersectionObserver;_position;destroyed=!1;toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(t){if(this.props={...Ys.defaultProps,...t},t=this.props,this.initialized=this._initializedResolvers.promise,fr()?t.canvas?typeof t.canvas=="string"?this.canvas=bM(t.canvas):this.canvas=t.canvas:this.canvas=vM(t):this.canvas={width:t.width||1,height:t.height||1},Ys.isHTMLCanvas(this.canvas)?(this.id=t.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):Ys.isOffscreenCanvas(this.canvas)?(this.id=t.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=t.id||"node-canvas-context",this.type="node"),this.cssWidth=this.htmlCanvas?.clientWidth||this.canvas.width,this.cssHeight=this.htmlCanvas?.clientHeight||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],Ys.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(e=>this._handleIntersection(e)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(e=>this._handleResize(e));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}destroy(){this.destroyed=!0}setProps(t){return"useDevicePixels"in t&&(this.props.useDevicePixels=t.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const t=this.device.limits.maxTextureDimension2D;return[t,t]}setDrawingBufferSize(t,e){this.canvas.width=t,this.canvas.height=e,this.drawingBufferWidth=t,this.drawingBufferHeight=e}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(t,e=!0){const i=this.cssToDeviceRatio(),[s,r]=this.getDrawingBufferSize();return xM(t,i,s,r,e)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[t,e]=this.getDevicePixelSize();return t/e}cssToDeviceRatio(){try{const[t]=this.getDrawingBufferSize(),[e]=this.getCSSSize();return e?t/e:1}catch{return 1}}resize(t){this.setDrawingBufferSize(t.width,t.height)}_setAutoCreatedCanvasId(t){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}_handleIntersection(t){const e=t.find(s=>s.target===this.canvas);if(!e)return;const i=e.isIntersecting;this.isVisible!==i&&(this.isVisible=i,this.device.props.onVisibilityChange(this))}_handleResize(t){const e=t.find(f=>f.target===this.canvas);if(!e)return;this.cssWidth=e.contentBoxSize[0].inlineSize,this.cssHeight=e.contentBoxSize[0].blockSize;const i=this.getDevicePixelSize(),s=e.devicePixelContentBoxSize?.[0].inlineSize||e.contentBoxSize[0].inlineSize*devicePixelRatio,r=e.devicePixelContentBoxSize?.[0].blockSize||e.contentBoxSize[0].blockSize*devicePixelRatio,[l,c]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(s,l)),this.devicePixelHeight=Math.max(1,Math.min(r,c)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:i})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){const t=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*t,this.cssHeight*t)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const t=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:t}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(t=100){const e=setInterval(()=>{this.destroyed?clearInterval(e):this.updatePosition()},t)}updatePosition(){const t=this.htmlCanvas?.getBoundingClientRect();if(t){const e=[t.left,t.top];if(this._position??=e,e[0]!==this._position[0]||e[1]!==this._position[1]){const s=this._position;this._position=e,this.device.props.onPositionChange?.(this,{oldPosition:s})}}}}function yM(n){if(typeof n=="string"){const t=document.getElementById(n);if(!t)throw new Error(`${n} is not an HTML element`);return t}return n||document.body}function bM(n){const t=document.getElementById(n);if(!Ys.isHTMLCanvas(t))throw new Error("Object is not a canvas element");return t}function vM(n){const{width:t,height:e}=n,i=document.createElement("canvas");i.id=sf("lumagl-auto-created-canvas"),i.width=t||1,i.height=e||1,i.style.width=Number.isFinite(t)?`${t}px`:"100%",i.style.height=Number.isFinite(e)?`${e}px`:"100%",n?.visible||(i.style.visibility="hidden");const s=yM(n?.container||null);return s.insertBefore(i,s.firstChild),i}function xM(n,t,e,i,s){const r=n,l=mv(r[0],t,e);let c=yv(r[1],t,i,s),f=mv(r[0]+1,t,e);const d=f===e-1?f:f-1;f=yv(r[1]+1,t,i,s);let p;return s?(f=f===0?f:f+1,p=c,c=f):p=f===i-1?f:f-1,{x:l,y:c,width:Math.max(d-l+1,1),height:Math.max(p-c+1,1)}}function mv(n,t,e){return Math.min(Math.round(n*t),e-1)}function yv(n,t,e,i){return i?Math.max(0,e-1-Math.round(n*t)):Math.min(Math.round(n*t),e-1)}class rr extends Kt{static defaultProps={...Kt.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(t,e){e=rr.normalizeProps(t,e),super(t,e,rr.defaultProps)}static normalizeProps(t,e){return e}}const TM={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class Se extends Kt{static SAMPLE=4;static STORAGE=8;static RENDER=16;static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static RENDER_ATTACHMENT=16;dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(t,e){if(e=Se.normalizeProps(t,e),super(t,e,Se.defaultProps),this.dimension=this.props.dimension,this.baseDimension=TM[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(t.isExternalImage(e.data)){const i=t.getExternalImageSize(e.data);this.width=i?.width||1,this.height=i?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&et.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=t.incrementTimestamp()}setSampler(t){this.sampler=t instanceof rr?t:this.device.createSampler(t)}clone(t){return this.device.createTexture({...this.props,...t})}static normalizeProps(t,e){const i={...e},{width:s,height:r}=i;return typeof s=="number"&&(i.width=Math.max(1,Math.ceil(s))),typeof r=="number"&&(i.height=Math.max(1,Math.ceil(r))),i}_initializeData(t){this.device.isExternalImage(t)?this.copyExternalImage({image:t,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):t&&this.copyImageData({data:t,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(t){const{width:e,height:i,depth:s}=this,r={...Se.defaultCopyDataOptions,width:e,height:i,depth:s,...t},l=this.device.getTextureFormatInfo(this.format);if(!t.bytesPerRow&&!l.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return r.bytesPerRow=t.bytesPerRow||e*(l.bytesPerPixel||4),r.rowsPerImage=t.rowsPerImage||i,r}_normalizeCopyExternalImageOptions(t){const e=this.device.getExternalImageSize(t.image),i={...Se.defaultCopyExternalImageOptions,...e,...t};return i.width=Math.min(i.width,this.width-i.x),i.height=Math.min(i.height,this.height-i.y),i}static defaultProps={...Kt.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:Se.TEXTURE|Se.RENDER_ATTACHMENT|Se.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0};static defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"};static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}}class rf extends Kt{get[Symbol.toStringTag](){return"TextureView"}constructor(t,e){super(t,e,rf.defaultProps)}static defaultProps={...Kt.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}}function SM(n,t,e){let i="";const s=t.split(/\r?\n/),r=n.slice().sort((l,c)=>l.lineNum-c.lineNum);switch(e?.showSourceCode||"no"){case"all":let l=0;for(let c=1;c<=s.length;c++)for(i+=j1(s[c-1],c,e);r.length>l&&r[l].lineNum===c;){const f=r[l++];i+=Gd(f,s,f.lineNum,{...e,inlineSource:!1})}for(;r.length>l;){const c=r[l++];i+=Gd(c,[],0,{...e,inlineSource:!1})}return i;case"issues":case"no":for(const c of n)i+=Gd(c,s,c.lineNum,{inlineSource:e?.showSourceCode!=="no"});return i}}function Gd(n,t,e,i){if(i?.inlineSource){const r=AM(t,e),l=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${r}${l}${n.type.toUpperCase()}: ${n.message}

`}const s=n.type==="error"?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function AM(n,t,e){let i="";for(let s=t-2;s<=t;s++){const r=n[s-1];r!==void 0&&(i+=j1(r,t,e))}return i}function j1(n,t,e){const i=e?.html?EM(n):n;return`${wM(String(t),4)}: ${i}${e?.html?"<br/>":`
`}`}function wM(n,t){let e="";for(let i=n.length;i<t;++i)e+=" ";return e+n}function EM(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class af extends Kt{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(t,e){e={...e,debugShaders:e.debugShaders||t.props.debugShaders||"errors"},super(t,{id:RM(e),...e},af.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const e=await this.getCompilationInfo();t==="warnings"&&e?.length===0||this._displayShaderLog(e,this.id)}_displayShaderLog(t,e){if(typeof document>"u"||!document?.createElement)return;const i=e,s=`${this.stage} shader "${i}"`;let r=SM(t,this.source,{showSourceCode:"all",html:!0});const l=this.getTranslatedSource();l&&(r+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${l}</pre></code>`);const c=document.createElement("Button");c.innerHTML=`
<h1>Compilation error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${r}
</pre></code>`,c.style.top="10px",c.style.left="10px",c.style.position="absolute",c.style.zIndex="9999",c.style.width="100%",c.style.textAlign="left",document.body.appendChild(c),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),c.onclick=()=>{const d=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(d)}}static defaultProps={...Kt.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}}function RM(n){return CM(n.source)||n.id||sf(`unnamed ${n.stage}-shader`)}function CM(n,t="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return i?i[1]:t}class of extends Kt{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(t,e={}){super(t,e,of.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(t){const e=this.colorAttachments.map(s=>s.texture.clone(t)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:e,depthStencilAttachment:i})}resize(t){let e=!t;if(t){const[i,s]=Array.isArray(t)?t:[t.width,t.height];e=e||s!==this.height||i!==this.width,this.width=i,this.height=s}e&&(et.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((e,i)=>{if(typeof e=="string"){const s=this.createColorTexture(e,i);return this.attachResource(s),s.view}return e instanceof Se?e.view:e});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const e=this.createDepthStencilTexture(t);this.attachResource(e),this.depthStencilAttachment=e.view}else t instanceof Se?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,e){return this.device.createTexture({id:`${this.id}-color-attachment-${e}`,usage:Se.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Se.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}resizeAttachments(t,e){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:t,height:e});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:t,height:e});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}static defaultProps={...Kt.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null}}class Gs extends Kt{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(t,e){super(t,e,Gs.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}static defaultProps={...Kt.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}}}class $s extends Kt{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;get[Symbol.toStringTag](){return"RenderPass"}constructor(t,e){e=$s.normalizeProps(t,e),super(t,e,$s.defaultProps)}static normalizeProps(t,e){return e}static defaultProps={...Kt.defaultProps,framebuffer:null,parameters:void 0,clearColor:$s.defaultClearColor,clearColors:void 0,clearDepth:$s.defaultClearDepth,clearStencil:$s.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}}class Pu extends Kt{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(t,e){super(t,e,Pu.defaultProps),this.shaderLayout=e.shaderLayout}static defaultProps={...Kt.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class Ng extends Kt{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,e){super(t,e,Ng.defaultProps)}static defaultProps={...Kt.defaultProps,measureExecutionTime:void 0}}class Bg extends Kt{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,e){super(t,e,Bg.defaultProps)}static defaultProps={...Kt.defaultProps}}function W1(n){return PM[n]}function MM(n){const[t,e]=IM[n],i=t==="i32"||t==="u32",s=t!=="u32",r=OM[t]*e;return{primitiveType:t,components:e,byteLength:r,integer:i,signed:s}}const OM={f32:4,f16:2,i32:4,u32:4},IM={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},PM={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function $1(n,t){const e={};for(const i of n.attributes){const s=kM(n,t,i.name);s&&(e[i.name]=s)}return e}function DM(n,t,e=16){const i=$1(n,t),s=new Array(e).fill(null);for(const r of Object.values(i))s[r.location]=r;return s}function kM(n,t,e){const i=NM(n,e),s=BM(t,e);if(!i)return null;const r=MM(i.type),l=QC(r),c=s?.vertexFormat||l,f=kg(c);return{attributeName:s?.attributeName||i.name,bufferName:s?.bufferName||i.name,location:i.location,shaderType:i.type,primitiveType:r.primitiveType,shaderComponents:r.components,vertexFormat:c,bufferDataType:f.type,bufferComponents:f.components,normalized:f.normalized,integer:r.integer,stepMode:s?.stepMode||i.stepMode||"vertex",byteOffset:s?.byteOffset||0,byteStride:s?.byteStride||0}}function NM(n,t){const e=n.attributes.find(i=>i.name===t);return e||et.warn(`shader layout attribute "${t}" not present in shader`),e||null}function BM(n,t){UM(n);let e=FM(n,t);return e||(e=LM(n,t),e)?e:(et.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function UM(n){for(const t of n)(t.attributes&&t.format||!t.attributes&&!t.format)&&et.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function FM(n,t){for(const e of n)if(e.format&&e.name===t)return{attributeName:e.name,bufferName:t,stepMode:e.stepMode,vertexFormat:e.format,byteOffset:0,byteStride:e.byteStride||0};return null}function LM(n,t){for(const e of n){let i=e.byteStride;if(typeof e.byteStride!="number")for(const r of e.attributes||[]){const l=kg(r.format);i+=l.byteLength}const s=e.attributes?.find(r=>r.attribute===t);if(s)return{attributeName:s.attribute,bufferName:e.name,stepMode:e.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}class Ug extends Kt{static defaultProps={...Kt.defaultProps,shaderLayout:void 0,bufferLayout:[]};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(t,e){super(t,e,Ug.defaultProps),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=DM(e.shaderLayout,e.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(t,e){this.device.reportError(new Error("constant attributes not supported"),this)()}}class Fg extends Kt{static defaultProps={...Kt.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,e){super(t,e,Fg.defaultProps)}}class Lg extends Kt{get[Symbol.toStringTag](){return"QuerySet"}constructor(t,e){super(t,e,Lg.defaultProps)}static defaultProps={...Kt.defaultProps,type:void 0,count:void 0}}let Xc;function X1(n){return(!Xc||Xc.byteLength<n)&&(Xc=new ArrayBuffer(n)),Xc}function zM(n,t){const e=X1(n.BYTES_PER_ELEMENT*t);return new n(e,0,t)}function VM(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Du(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":VM(n)}const HM=1024;class jM{layout={};byteLength;constructor(t,e={}){let i=0;for(const[r,l]of Object.entries(t)){const c=W1(l),{type:f,components:d}=c,p=d*(e?.[r]??1);i=qC(i,p);const _=i;i+=p,this.layout[r]={type:f,size:p,offset:_}}i+=(4-i%4)%4;const s=i*4;this.byteLength=Math.max(s,HM)}getData(t){const e=X1(this.byteLength),i={i32:new Int32Array(e),u32:new Uint32Array(e),f32:new Float32Array(e),f16:new Uint16Array(e)};for(const[s,r]of Object.entries(t)){const l=this.layout[s];if(!l){et.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:c,size:f,offset:d}=l,p=i[c];if(f===1){if(typeof r!="number"&&typeof r!="boolean"){et.warn(`Supplied value for single component uniform ${s} is not a number: ${r}`)();continue}p[d]=Number(r)}else{if(!Du(r)){et.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${r}`)();continue}p.set(r,d)}}return new Uint8Array(e,0,this.byteLength)}has(t){return!!this.layout[t]}get(t){return this.layout[t]}}function WM(n,t,e=16){if(n!==t)return!1;const i=n,s=t;if(!Du(i))return!1;if(Du(s)&&i.length===s.length){for(let r=0;r<i.length;++r)if(s[r]!==i[r])return!1}return!0}function $M(n){return Du(n)?n.slice():n}class XM{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(t){if(this.name=t?.name||"unnamed",t?.name&&t?.shaderLayout){const e=t?.shaderLayout.bindings?.find(s=>s.type==="uniform"&&s.name===t?.name);if(!e)throw new Error(t?.name);const i=e;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(t){for(const[e,i]of Object.entries(t))this._setUniform(e,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${e}=${i}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,e){WM(this.uniforms[t],e)||(this.uniforms[t]=$M(e),this.modifiedUniforms[t]=!0,this.modified=!0)}}class YM{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(t){for(const[e,i]of Object.entries(t)){const s=e,r=new jM(i.uniformTypes??{},i.uniformSizes??{});this.uniformBufferLayouts.set(s,r);const l=new XM({name:e});l.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(s,l)}}destroy(){for(const t of this.uniformBuffers.values())t.destroy()}setUniforms(t){for(const[e,i]of Object.entries(t))this.uniformBlocks.get(e)?.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(t){return this.uniformBufferLayouts.get(t)?.byteLength||0}getUniformBufferData(t){const e=this.uniformBlocks.get(t)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(t)?.getData(e)}createUniformBuffer(t,e,i){i&&this.setUniforms(i);const s=this.getUniformBufferByteLength(e),r=t.createBuffer({usage:Gt.UNIFORM|Gt.COPY_DST,byteLength:s}),l=this.getUniformBufferData(e);return r.write(l),r}getManagedUniformBuffer(t,e){if(!this.uniformBuffers.get(e)){const i=this.getUniformBufferByteLength(e),s=t.createBuffer({usage:Gt.UNIFORM|Gt.COPY_DST,byteLength:i});this.uniformBuffers.set(e,s)}return this.uniformBuffers.get(e)}updateUniformBuffers(){let t=!1;for(const e of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(e);t||=i}return t&&et.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){const e=this.uniformBlocks.get(t);let i=this.uniformBuffers.get(t),s=!1;if(i&&e?.needsRedraw){s||=e.needsRedraw;const r=this.getUniformBufferData(t);i=this.uniformBuffers.get(t),i?.write(r);const l=this.uniformBlocks.get(t)?.getAllUniforms();et.log(4,`Writing to uniform buffer ${String(t)}`,r,l)()}return s}}class On{constructor(t,e){this.name=t,this.attributes=e,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class bv{constructor(t,e,i){this.name=t,this.type=e,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class us extends On{constructor(t,e){super(t,e),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class gs extends On{constructor(t,e){super(t,e),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class Vp extends On{constructor(t,e,i){super(t,i),this.format=e}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class ar extends On{constructor(t,e,i,s){super(t,i),this.format=e,this.access=s}get isTemplate(){return!0}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}}var ls;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(ls||(ls={}));class Yc{constructor(t,e,i,s,r,l,c){this.name=t,this.type=e,this.group=i,this.binding=s,this.attributes=r,this.resourceType=l,this.access=c}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class qM{constructor(t,e){this.name=t,this.type=e}}class KM{constructor(t,e,i,s){this.name=t,this.type=e,this.locationType=i,this.location=s,this.interpolation=null}}class vv{constructor(t,e,i,s){this.name=t,this.type=e,this.locationType=i,this.location=s}}class ZM{constructor(t,e,i,s){this.name=t,this.type=e,this.attributes=i,this.id=s}}class QM{constructor(t,e,i){this.name=t,this.type=e,this.attributes=i}}class GM{constructor(t,e=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=e,this.attributes=i}}class JM{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function tO(n){var t=(32768&n)>>15,e=(31744&n)>>10,i=1023&n;return e==0?(t?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):e==31?i?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,e-15)*(1+i/Math.pow(2,10))}const Y1=new Float32Array(1),eO=new Int32Array(Y1.buffer),Ue=new Uint16Array(1);function nO(n){Y1[0]=n;const t=eO[0],e=t>>31&1;let i=t>>23&255,s=8388607&t;if(i===255)return Ue[0]=e<<15|31744|(s!==0?512:0),Ue[0];if(i===0){if(s===0)return Ue[0]=e<<15,Ue[0];s|=8388608;let r=113;for(;!(8388608&s);)s<<=1,r--;return i=127-r,s&=8388607,i>0?(s=(s>>126-i)+(s>>127-i&1),Ue[0]=e<<15|i<<10|s>>13,Ue[0]):(Ue[0]=e<<15,Ue[0])}return i=i-127+15,i>=31?(Ue[0]=e<<15|31744,Ue[0]):i<=0?i<-10?(Ue[0]=e<<15,Ue[0]):(s=(8388608|s)>>1-i,Ue[0]=e<<15|s>>13,Ue[0]):(s>>=13,Ue[0]=e<<15|i<<10|s,Ue[0])}const zg=new Uint32Array(1),q1=new Float32Array(zg.buffer,0,1);function xv(n){const t=112+(n>>6&31)<<23|(63&n)<<17;return zg[0]=t,q1[0]}function iO(n,t,e,i,s,r,l,c,f){const d=i*(l>>=s)*(r>>=s)+e*l+t*c;switch(f){case"r8unorm":return[Bt(n,d,"8unorm",1)[0]];case"r8snorm":return[Bt(n,d,"8snorm",1)[0]];case"r8uint":return[Bt(n,d,"8uint",1)[0]];case"r8sint":return[Bt(n,d,"8sint",1)[0]];case"rg8unorm":{const p=Bt(n,d,"8unorm",2);return[p[0],p[1]]}case"rg8snorm":{const p=Bt(n,d,"8snorm",2);return[p[0],p[1]]}case"rg8uint":{const p=Bt(n,d,"8uint",2);return[p[0],p[1]]}case"rg8sint":{const p=Bt(n,d,"8sint",2);return[p[0],p[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const p=Bt(n,d,"8unorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8snorm":{const p=Bt(n,d,"8snorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8uint":{const p=Bt(n,d,"8uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba8sint":{const p=Bt(n,d,"8sint",4);return[p[0],p[1],p[2],p[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const p=Bt(n,d,"8unorm",4);return[p[2],p[1],p[0],p[3]]}case"r16uint":return[Bt(n,d,"16uint",1)[0]];case"r16sint":return[Bt(n,d,"16sint",1)[0]];case"r16float":return[Bt(n,d,"16float",1)[0]];case"rg16uint":{const p=Bt(n,d,"16uint",2);return[p[0],p[1]]}case"rg16sint":{const p=Bt(n,d,"16sint",2);return[p[0],p[1]]}case"rg16float":{const p=Bt(n,d,"16float",2);return[p[0],p[1]]}case"rgba16uint":{const p=Bt(n,d,"16uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16sint":{const p=Bt(n,d,"16sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16float":{const p=Bt(n,d,"16float",4);return[p[0],p[1],p[2],p[3]]}case"r32uint":return[Bt(n,d,"32uint",1)[0]];case"r32sint":return[Bt(n,d,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Bt(n,d,"32float",1)[0]];case"rg32uint":{const p=Bt(n,d,"32uint",2);return[p[0],p[1]]}case"rg32sint":{const p=Bt(n,d,"32sint",2);return[p[0],p[1]]}case"rg32float":{const p=Bt(n,d,"32float",2);return[p[0],p[1]]}case"rgba32uint":{const p=Bt(n,d,"32uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32sint":{const p=Bt(n,d,"32sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32float":{const p=Bt(n,d,"32float",4);return[p[0],p[1],p[2],p[3]]}case"rg11b10ufloat":{const p=new Uint32Array(n.buffer,d,1)[0],_=(4192256&p)>>11,y=(4290772992&p)>>22;return[xv(2047&p),xv(_),(function(b){const x=112+(b>>5&31)<<23|(31&b)<<18;return zg[0]=x,q1[0]})(y),1]}}return null}function Bt(n,t,e,i){const s=[0,0,0,0];for(let r=0;r<i;++r)switch(e){case"8unorm":s[r]=n[t]/255,t++;break;case"8snorm":s[r]=n[t]/255*2-1,t++;break;case"8uint":s[r]=n[t],t++;break;case"8sint":s[r]=n[t]-127,t++;break;case"16uint":s[r]=n[t]|n[t+1]<<8,t+=2;break;case"16sint":s[r]=(n[t]|n[t+1]<<8)-32768,t+=2;break;case"16float":s[r]=tO(n[t]|n[t+1]<<8),t+=2;break;case"32uint":case"32sint":s[r]=n[t]|n[t+1]<<8|n[t+2]<<16|n[t+3]<<24,t+=4;break;case"32float":s[r]=new Float32Array(n.buffer,t,1)[0],t+=4}return s}function zt(n,t,e,i,s){for(let r=0;r<i;++r)switch(e){case"8unorm":n[t]=255*s[r],t++;break;case"8snorm":n[t]=.5*(s[r]+1)*255,t++;break;case"8uint":n[t]=s[r],t++;break;case"8sint":n[t]=s[r]+127,t++;break;case"16uint":new Uint16Array(n.buffer,t,1)[0]=s[r],t+=2;break;case"16sint":new Int16Array(n.buffer,t,1)[0]=s[r],t+=2;break;case"16float":{const l=nO(s[r]);new Uint16Array(n.buffer,t,1)[0]=l,t+=2;break}case"32uint":new Uint32Array(n.buffer,t,1)[0]=s[r],t+=4;break;case"32sint":new Int32Array(n.buffer,t,1)[0]=s[r],t+=4;break;case"32float":new Float32Array(n.buffer,t,1)[0]=s[r],t+=4}return s}const Jd={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Bn{constructor(){this.id=Bn._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(t){t(this)}searchBlock(t,e){if(t){e(ku.instance);for(const i of t)i instanceof Array?this.searchBlock(i,e):i.search(e);e(Nu.instance)}}constEvaluate(t,e){throw new Error("Cannot evaluate node")}constEvaluateString(t){return this.constEvaluate(t).toString()}}Bn._id=0;class ku extends Bn{}ku.instance=new ku;class Nu extends Bn{}Nu.instance=new Nu;const K1=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class se extends Bn{constructor(){super()}}class al extends se{constructor(t,e,i,s,r,l){super(),this.calls=new Set,this.name=t,this.args=e,this.returnType=i,this.body=s,this.startLine=r,this.endLine=l}get astNodeType(){return"function"}search(t){if(this.attributes)for(const e of this.attributes)t(e);t(this);for(const e of this.args)t(e);this.searchBlock(this.body,t)}}class sO extends se{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}}class Z1 extends se{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"while"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class Hp extends se{constructor(t,e){super(),this.body=t,this.loopId=e}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}}class Q1 extends se{constructor(t,e,i,s){super(),this.init=t,this.condition=e,this.increment=i,this.body=s}get astNodeType(){return"for"}search(t){var e,i,s;(e=this.init)===null||e===void 0||e.search(t),(i=this.condition)===null||i===void 0||i.search(t),(s=this.increment)===null||s===void 0||s.search(t),this.searchBlock(this.body,t)}}class Ii extends se{constructor(t,e,i,s,r){super(),this.attributes=null,this.name=t,this.type=e,this.storage=i,this.access=s,this.value=r}get astNodeType(){return"var"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class Vg extends se{constructor(t,e,i){super(),this.attributes=null,this.name=t,this.type=e,this.value=i}get astNodeType(){return"override"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class Ko extends se{constructor(t,e,i,s,r){super(),this.attributes=null,this.name=t,this.type=e,this.storage=i,this.access=s,this.value=r}get astNodeType(){return"let"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class yu extends se{constructor(t,e,i,s,r){super(),this.attributes=null,this.name=t,this.type=e,this.storage=i,this.access=s,this.value=r}get astNodeType(){return"const"}constEvaluate(t,e){return this.value.constEvaluate(t,e)}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}var la,Fo,V,B;(n=>{n.increment="++",n.decrement="--"})(la||(la={})),(n=>{n.parse=function(t){const e=t;if(e=="parse")throw new Error("Invalid value for IncrementOperator");return n[e]}})(la||(la={}));class G1 extends se{constructor(t,e){super(),this.operator=t,this.variable=e}get astNodeType(){return"increment"}search(t){this.variable.search(t)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(Fo||(Fo={})),(n=>{n.parse=function(t){const e=t;if(e=="parse")throw new Error("Invalid value for AssignOperator");return e}})(Fo||(Fo={}));class J1 extends se{constructor(t,e,i){super(),this.operator=t,this.variable=e,this.value=i}get astNodeType(){return"assign"}search(t){this.variable.search(t),this.value.search(t)}}class Hg extends se{constructor(t,e){super(),this.name=t,this.args=e}get astNodeType(){return"call"}isBuiltin(){return K1.has(this.name)}search(t){for(const e of this.args)e.search(t);t(this)}}class t2 extends se{constructor(t,e){super(),this.body=t,this.continuing=e}get astNodeType(){return"loop"}search(t){var e;this.searchBlock(this.body,t),(e=this.continuing)===null||e===void 0||e.search(t)}}class e2 extends se{constructor(t,e){super(),this.condition=t,this.cases=e}get astNodeType(){return"switch"}search(t){t(this);for(const e of this.cases)e.search(t)}}class n2 extends se{constructor(t,e,i,s){super(),this.condition=t,this.body=e,this.elseif=i,this.else=s}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}}class i2 extends se{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class rO extends se{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}}class aO extends se{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}}class s2 extends se{constructor(t,e){super(),this.severity=t,this.rule=e}get astNodeType(){return"diagnostic"}}class jg extends se{constructor(t,e){super(),this.name=t,this.type=e}get astNodeType(){return"alias"}}class oO extends se{constructor(){super()}get astNodeType(){return"discard"}}class r2 extends se{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class a2 extends se{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class J extends se{constructor(t){super(),this.attributes=null,this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(t){let e=t[0];if(e.name==="f32")return e;for(let i=1;i<t.length;++i){const s=J._priority.get(e.name);J._priority.get(t[i].name)<s&&(e=t[i])}return e.name==="x32"?J.i32:e}getTypeName(){return this.name}}J.x32=new J("x32"),J.f32=new J("f32"),J.i32=new J("i32"),J.u32=new J("u32"),J.f16=new J("f16"),J.bool=new J("bool"),J.void=new J("void"),J._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Tv extends J{constructor(t){super(t)}}class Ci extends J{constructor(t,e,i,s){super(t),this.members=e,this.startLine=i,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let e=0;e<this.members.length;e++)if(this.members[e].name==t)return e;return-1}search(t){for(const e of this.members)t(e)}}class L extends J{constructor(t,e,i){super(t),this.format=e,this.access=i}get astNodeType(){return"template"}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}}L.vec2f=new L("vec2",J.f32,null),L.vec3f=new L("vec3",J.f32,null),L.vec4f=new L("vec4",J.f32,null),L.vec2i=new L("vec2",J.i32,null),L.vec3i=new L("vec3",J.i32,null),L.vec4i=new L("vec4",J.i32,null),L.vec2u=new L("vec2",J.u32,null),L.vec3u=new L("vec3",J.u32,null),L.vec4u=new L("vec4",J.u32,null),L.vec2h=new L("vec2",J.f16,null),L.vec3h=new L("vec3",J.f16,null),L.vec4h=new L("vec4",J.f16,null),L.vec2b=new L("vec2",J.bool,null),L.vec3b=new L("vec3",J.bool,null),L.vec4b=new L("vec4",J.bool,null),L.mat2x2f=new L("mat2x2",J.f32,null),L.mat2x3f=new L("mat2x3",J.f32,null),L.mat2x4f=new L("mat2x4",J.f32,null),L.mat3x2f=new L("mat3x2",J.f32,null),L.mat3x3f=new L("mat3x3",J.f32,null),L.mat3x4f=new L("mat3x4",J.f32,null),L.mat4x2f=new L("mat4x2",J.f32,null),L.mat4x3f=new L("mat4x3",J.f32,null),L.mat4x4f=new L("mat4x4",J.f32,null),L.mat2x2h=new L("mat2x2",J.f16,null),L.mat2x3h=new L("mat2x3",J.f16,null),L.mat2x4h=new L("mat2x4",J.f16,null),L.mat3x2h=new L("mat3x2",J.f16,null),L.mat3x3h=new L("mat3x3",J.f16,null),L.mat3x4h=new L("mat3x4",J.f16,null),L.mat4x2h=new L("mat4x2",J.f16,null),L.mat4x3h=new L("mat4x3",J.f16,null),L.mat4x4h=new L("mat4x4",J.f16,null),L.mat2x2i=new L("mat2x2",J.i32,null),L.mat2x3i=new L("mat2x3",J.i32,null),L.mat2x4i=new L("mat2x4",J.i32,null),L.mat3x2i=new L("mat3x2",J.i32,null),L.mat3x3i=new L("mat3x3",J.i32,null),L.mat3x4i=new L("mat3x4",J.i32,null),L.mat4x2i=new L("mat4x2",J.i32,null),L.mat4x3i=new L("mat4x3",J.i32,null),L.mat4x4i=new L("mat4x4",J.i32,null),L.mat2x2u=new L("mat2x2",J.u32,null),L.mat2x3u=new L("mat2x3",J.u32,null),L.mat2x4u=new L("mat2x4",J.u32,null),L.mat3x2u=new L("mat3x2",J.u32,null),L.mat3x3u=new L("mat3x3",J.u32,null),L.mat3x4u=new L("mat3x4",J.u32,null),L.mat4x2u=new L("mat4x2",J.u32,null),L.mat4x3u=new L("mat4x3",J.u32,null),L.mat4x4u=new L("mat4x4",J.u32,null);class bu extends J{constructor(t,e,i,s){super(t),this.storage=e,this.type=i,this.access=s}get astNodeType(){return"pointer"}}class Zo extends J{constructor(t,e,i,s){super(t),this.attributes=e,this.format=i,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class Lo extends J{constructor(t,e,i){super(t),this.format=e,this.access=i}get astNodeType(){return"sampler"}}class Wn extends Bn{constructor(){super(),this.postfix=null}}class or extends Wn{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class ti extends Wn{constructor(t,e){super(),this.type=t,this.args=e}get astNodeType(){return"createExpr"}search(t){if(t(this),this.args)for(const e of this.args)e.search(t)}constEvaluate(t,e){return e&&(e[0]=this.type),t.evalExpression(this,t.context)}}class Wg extends Wn{constructor(t,e){super(),this.cachedReturnValue=null,this.name=t,this.args=e}get astNodeType(){return"callExpr"}setCachedReturnValue(t){this.cachedReturnValue=t}get isBuiltin(){return K1.has(this.name)}constEvaluate(t,e){return t.evalExpression(this,t.context)}search(t){for(const e of this.args)e.search(t);t(this)}}class pn extends Wn{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}constEvaluate(t,e){return t.evalExpression(this,t.context)}}class o2 extends Wn{constructor(t,e){super(),this.name=t,this.initializer=e}get astNodeType(){return"constExpr"}constEvaluate(t,e){if(this.initializer){const i=t.evalExpression(this.initializer,t.context);return i!==null&&this.postfix?i.getSubData(t,this.postfix,t.context):i}return null}search(t){this.initializer.search(t)}}class xe extends Wn{constructor(t,e){super(),this.value=t,this.type=e}get astNodeType(){return"literalExpr"}constEvaluate(t,e){return e!==void 0&&(e[0]=this.type),this.value}get isScalar(){return this.value instanceof N}get isVector(){return this.value instanceof R||this.value instanceof gt}get scalarValue(){return this.value instanceof N?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof R||this.value instanceof gt?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class l2 extends Wn{constructor(t,e){super(),this.type=t,this.value=e}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}}class ma extends Wn{constructor(t){super(),this.index=t}search(t){this.index.search(t)}}class c2 extends Wn{constructor(){super()}}class ye extends c2{constructor(t,e){super(),this.operator=t,this.right=e}get astNodeType(){return"unaryOp"}constEvaluate(t,e){return t.evalExpression(this,t.context)}search(t){this.right.search(t)}}class Vn extends c2{constructor(t,e,i){super(),this.operator=t,this.left=e,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(t,e){return t.name===e.name?t:t.name==="f32"||e.name==="f32"?J.f32:t.name==="u32"||e.name==="u32"?J.u32:J.i32}constEvaluate(t,e){return t.evalExpression(this,t.context)}search(t){this.left.search(t),this.right.search(t)}}class u2 extends Bn{constructor(t){super(),this.body=t}search(t){t(this),this.searchBlock(this.body,t)}}class vu extends Wn{constructor(){super()}get astNodeType(){return"default"}}class f2 extends u2{constructor(t,e){super(e),this.selectors=t}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}}class h2 extends u2{constructor(t){super(t)}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}}class Sv extends Bn{constructor(t,e,i){super(),this.name=t,this.type=e,this.attributes=i}get astNodeType(){return"argument"}}class lO extends Bn{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class Av extends Bn{constructor(t,e,i){super(),this.name=t,this.type=e,this.attributes=i}get astNodeType(){return"member"}}class d2 extends Bn{constructor(t,e){super(),this.name=t,this.value=e}get astNodeType(){return"attribute"}}class Dn{constructor(t,e){this.parent=null,this.typeInfo=t,this.parent=e,this.id=Dn._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(t,e,i,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(t,e,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Dn._id=0;class jp extends Dn{constructor(){super(new On("void",null),null)}toString(){return"void"}}jp.void=new jp;class ia extends Dn{constructor(t){super(new Vp("pointer",t.typeInfo,null),null),this.reference=t}clone(){return this}setDataValue(t,e,i,s){this.reference.setDataValue(t,e,i,s)}getSubData(t,e,i){return e?this.reference.getSubData(t,e,i):this}toString(){return`&${this.reference.toString()}`}}class N extends Dn{constructor(t,e,i=null){super(e,i),t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array?this.data=t:this.typeInfo.name==="x32"?t-Math.floor(t)!==0?this.data=new Float32Array([t]):this.data=t>=0?new Uint32Array([t]):new Int32Array([t]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([t]):this.typeInfo.name==="u32"?this.data=new Uint32Array([t]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([t]):console.error("ScalarData2: Invalid type",e)}clone(){if(this.data instanceof Float32Array)return new N(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new N(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new N(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(t){this.data[0]=t}setDataValue(t,e,i,s){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(e instanceof N))return void console.error("SetDataValue: Invalid value",e);let r=e.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?r=Math.floor(r):this.typeInfo.name==="bool"&&(r=r?1:0),this.data[0]=r}getSubData(t,e,i){return e?(console.error("getSubData: Scalar data does not support postfix",e),null):this}toString(){return`${this.value}`}}function cO(n,t,e){const i=t.length;return i===2?e==="f32"?new R(new Float32Array(t),n.getTypeInfo("vec2f")):e==="i32"||e==="bool"?new R(new Int32Array(t),n.getTypeInfo("vec2i")):e==="u32"?new R(new Uint32Array(t),n.getTypeInfo("vec2u")):e==="f16"?new R(new Float32Array(t),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${e}`),null):i===3?e==="f32"?new R(new Float32Array(t),n.getTypeInfo("vec3f")):e==="i32"||e==="bool"?new R(new Int32Array(t),n.getTypeInfo("vec3i")):e==="u32"?new R(new Uint32Array(t),n.getTypeInfo("vec3u")):e==="f16"?new R(new Float32Array(t),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${e}`),null):i===4?e==="f32"?new R(new Float32Array(t),n.getTypeInfo("vec4f")):e==="i32"||e==="bool"?new R(new Int32Array(t),n.getTypeInfo("vec4i")):e==="u32"?new R(new Uint32Array(t),n.getTypeInfo("vec4u")):e==="f16"?new R(new Float32Array(t),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${e}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}class R extends Dn{constructor(t,e,i=null){if(super(e,i),t instanceof Float32Array||t instanceof Uint32Array||t instanceof Int32Array)this.data=t;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(t):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(t):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(t):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(t):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(t):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(t):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new R(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new R(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new R(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(t,e,i,s){i instanceof or?console.error("TODO: Set vector postfix"):e instanceof R?this.data=e.data:console.error("SetDataValue: Invalid value",e)}getSubData(t,e,i){if(e===null)return this;let s=t.getTypeInfo("f32");if(this.typeInfo instanceof ar)s=this.typeInfo.format||s;else{const l=this.typeInfo.name;l==="vec2f"||l==="vec3f"||l==="vec4f"?s=t.getTypeInfo("f32"):l==="vec2i"||l==="vec3i"||l==="vec4i"?s=t.getTypeInfo("i32"):l==="vec2b"||l==="vec3b"||l==="vec4b"?s=t.getTypeInfo("bool"):l==="vec2u"||l==="vec3u"||l==="vec4u"?s=t.getTypeInfo("u32"):l==="vec2h"||l==="vec3h"||l==="vec4h"?s=t.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${l}`)}let r=this;for(;e!==null&&r!==null;){if(e instanceof ma){const l=e.index;let c=-1;if(l instanceof xe){if(!(l.value instanceof N))return console.error(`GetSubData: Invalid array index ${l.value}`),null;c=l.value.value}else{const f=t.evalExpression(l,i);if(!(f instanceof N))return console.error("GetSubData: Unknown index type",l),null;c=f.value}if(c<0||c>=r.data.length)return console.error("GetSubData: Index out of range",c),null;if(r.data instanceof Float32Array){const f=new Float32Array(r.data.buffer,r.data.byteOffset+4*c,1);return new N(f,s)}if(r.data instanceof Int32Array){const f=new Int32Array(r.data.buffer,r.data.byteOffset+4*c,1);return new N(f,s)}if(r.data instanceof Uint32Array){const f=new Uint32Array(r.data.buffer,r.data.byteOffset+4*c,1);return new N(f,s)}throw"GetSubData: Invalid data type"}if(!(e instanceof or))return console.error("GetSubData: Unknown postfix",e),null;{const l=e.value.toLowerCase();if(l.length===1){let f=0;if(l==="x"||l==="r")f=0;else if(l==="y"||l==="g")f=1;else if(l==="z"||l==="b")f=2;else{if(l!=="w"&&l!=="a")return console.error(`GetSubData: Unknown member ${l}`),null;f=3}if(this.data instanceof Float32Array){let d=new Float32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new N(d,s,this)}if(this.data instanceof Int32Array){let d=new Int32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new N(d,s,this)}if(this.data instanceof Uint32Array){let d=new Uint32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new N(d,s,this)}}const c=[];for(const f of l)f==="x"||f==="r"?c.push(this.data[0]):f==="y"||f==="g"?c.push(this.data[1]):f==="z"||f==="b"?c.push(this.data[2]):f==="w"||f==="a"?c.push(this.data[3]):console.error(`GetDataValue: Unknown member ${f}`);r=cO(t,c,s.name)}e=e.postfix}return r}toString(){let t=`${this.data[0]}`;for(let e=1;e<this.data.length;++e)t+=`, ${this.data[e]}`;return t}}class gt extends Dn{constructor(t,e,i=null){super(e,i),t instanceof Float32Array?this.data=t:this.data=new Float32Array(t)}clone(){return new gt(new Float32Array(this.data),this.typeInfo,null)}setDataValue(t,e,i,s){i instanceof or?console.error("TODO: Set matrix postfix"):e instanceof gt?this.data=e.data:console.error("SetDataValue: Invalid value",e)}getSubData(t,e,i){if(e===null)return this;const s=this.typeInfo.name;if(t.getTypeInfo("f32"),this.typeInfo instanceof ar)this.typeInfo.format;else if(s.endsWith("f"))t.getTypeInfo("f32");else if(s.endsWith("i"))t.getTypeInfo("i32");else if(s.endsWith("u"))t.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;t.getTypeInfo("f16")}if(e instanceof ma){const r=e.index;let l=-1;if(r instanceof xe){if(!(r.value instanceof N))return console.error(`GetDataValue: Invalid array index ${r.value}`),null;l=r.value.value}else{const d=t.evalExpression(r,i);if(!(d instanceof N))return console.error("GetDataValue: Unknown index type",r),null;l=d.value}if(l<0||l>=this.data.length)return console.error("GetDataValue: Index out of range",l),null;const c=s.endsWith("h")?"h":"f";let f;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")f=new R(new Float32Array(this.data.buffer,this.data.byteOffset+2*l*4,2),t.getTypeInfo(`vec2${c}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")f=new R(new Float32Array(this.data.buffer,this.data.byteOffset+3*l*4,3),t.getTypeInfo(`vec3${c}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;f=new R(new Float32Array(this.data.buffer,this.data.byteOffset+4*l*4,4),t.getTypeInfo(`vec4${c}`))}return e.postfix?f.getSubData(t,e.postfix,i):f}return console.error("GetDataValue: Invalid postfix",e),null}toString(){let t=`${this.data[0]}`;for(let e=1;e<this.data.length;++e)t+=`, ${this.data[e]}`;return t}}class le extends Dn{constructor(t,e,i=0,s=null){super(e,s),this.buffer=t instanceof ArrayBuffer?t:t.buffer,this.offset=i}clone(){const t=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new le(t.buffer,this.typeInfo,0,null)}setDataValue(t,e,i,s){if(e===null)return void console.log("setDataValue: NULL data.");let r=this.offset,l=this.typeInfo;for(;i;){if(i instanceof ma)if(l instanceof gs){const c=i.index;if(c instanceof xe){if(!(c.value instanceof N))return void console.error(`SetDataValue: Invalid index type ${c.value}`);r+=c.value.value*l.stride}else{const f=t.evalExpression(c,s);if(!(f instanceof N))return void console.error("SetDataValue: Unknown index type",c);r+=f.value*l.stride}l=l.format}else console.error(`SetDataValue: Type ${l.getTypeName()} is not an array`);else{if(!(i instanceof or))return void console.error("SetDataValue: Unknown postfix type",i);{const c=i.value;if(l instanceof us){let f=!1;for(const d of l.members)if(d.name===c){r+=d.offset,l=d.type,f=!0;break}if(!f)return void console.error(`SetDataValue: Member ${c} not found`)}else if(l instanceof On){const f=l.getTypeName();let d=0;if(c==="x"||c==="r")d=0;else if(c==="y"||c==="g")d=1;else if(c==="z"||c==="b")d=2;else{if(c!=="w"&&c!=="a")return void console.error(`SetDataValue: Unknown member ${c}`);d=3}if(!(e instanceof N))return void console.error("SetDataValue: Invalid value",e);const p=e.value;return f==="vec2f"?void(new Float32Array(this.buffer,r,2)[d]=p):f==="vec3f"?void(new Float32Array(this.buffer,r,3)[d]=p):f==="vec4f"?void(new Float32Array(this.buffer,r,4)[d]=p):f==="vec2i"?void(new Int32Array(this.buffer,r,2)[d]=p):f==="vec3i"?void(new Int32Array(this.buffer,r,3)[d]=p):f==="vec4i"?void(new Int32Array(this.buffer,r,4)[d]=p):f==="vec2u"?void(new Uint32Array(this.buffer,r,2)[d]=p):f==="vec3u"?void(new Uint32Array(this.buffer,r,3)[d]=p):f==="vec4u"?void(new Uint32Array(this.buffer,r,4)[d]=p):void console.error(`SetDataValue: Type ${f} is not a struct`)}}}i=i.postfix}this.setData(t,e,l,r,s)}setData(t,e,i,s,r){const l=i.getTypeName();if(l!=="f32"&&l!=="f16")if(l!=="i32"&&l!=="atomic<i32>"&&l!=="x32")if(l!=="u32"&&l!=="atomic<u32>")if(l!=="bool"){if(l==="vec2f"||l==="vec2h"){const c=new Float32Array(this.buffer,s,2);return void(e instanceof R?(c[0]=e.data[0],c[1]=e.data[1]):(c[0]=e[0],c[1]=e[1]))}if(l==="vec3f"||l==="vec3h"){const c=new Float32Array(this.buffer,s,3);return void(e instanceof R?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2]):(c[0]=e[0],c[1]=e[1],c[2]=e[2]))}if(l==="vec4f"||l==="vec4h"){const c=new Float32Array(this.buffer,s,4);return void(e instanceof R?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2],c[3]=e.data[3]):(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=e[3]))}if(l==="vec2i"){const c=new Int32Array(this.buffer,s,2);return void(e instanceof R?(c[0]=e.data[0],c[1]=e.data[1]):(c[0]=e[0],c[1]=e[1]))}if(l==="vec3i"){const c=new Int32Array(this.buffer,s,3);return void(e instanceof R?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2]):(c[0]=e[0],c[1]=e[1],c[2]=e[2]))}if(l==="vec4i"){const c=new Int32Array(this.buffer,s,4);return void(e instanceof R?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2],c[3]=e.data[3]):(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=e[3]))}if(l==="vec2u"){const c=new Uint32Array(this.buffer,s,2);return void(e instanceof R?(c[0]=e.data[0],c[1]=e.data[1]):(c[0]=e[0],c[1]=e[1]))}if(l==="vec3u"){const c=new Uint32Array(this.buffer,s,3);return void(e instanceof R?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2]):(c[0]=e[0],c[1]=e[1],c[2]=e[2]))}if(l==="vec4u"){const c=new Uint32Array(this.buffer,s,4);return void(e instanceof R?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2],c[3]=e.data[3]):(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=e[3]))}if(l==="vec2b"){const c=new Uint32Array(this.buffer,s,2);return void(e instanceof R?(c[0]=e.data[0],c[1]=e.data[1]):(c[0]=e[0],c[1]=e[1]))}if(l==="vec3b"){const c=new Uint32Array(this.buffer,s,3);return void(e instanceof R?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2]):(c[0]=e[0],c[1]=e[1],c[2]=e[2]))}if(l==="vec4b"){const c=new Uint32Array(this.buffer,s,4);return void(e instanceof R?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2],c[3]=e.data[3]):(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=e[3]))}if(l==="mat2x2f"||l==="mat2x2h"){const c=new Float32Array(this.buffer,s,4);return void(e instanceof gt?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2],c[3]=e.data[3]):(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=e[3]))}if(l==="mat2x3f"||l==="mat2x3h"){const c=new Float32Array(this.buffer,s,6);return void(e instanceof gt?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2],c[3]=e.data[3],c[4]=e.data[4],c[5]=e.data[5]):(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=e[3],c[4]=e[4],c[5]=e[5]))}if(l==="mat2x4f"||l==="mat2x4h"){const c=new Float32Array(this.buffer,s,8);return void(e instanceof gt?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2],c[3]=e.data[3],c[4]=e.data[4],c[5]=e.data[5],c[6]=e.data[6],c[7]=e.data[7]):(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=e[3],c[4]=e[4],c[5]=e[5],c[6]=e[6],c[7]=e[7]))}if(l==="mat3x2f"||l==="mat3x2h"){const c=new Float32Array(this.buffer,s,6);return void(e instanceof gt?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2],c[3]=e.data[3],c[4]=e.data[4],c[5]=e.data[5]):(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=e[3],c[4]=e[4],c[5]=e[5]))}if(l==="mat3x3f"||l==="mat3x3h"){const c=new Float32Array(this.buffer,s,9);return void(e instanceof gt?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2],c[3]=e.data[3],c[4]=e.data[4],c[5]=e.data[5],c[6]=e.data[6],c[7]=e.data[7],c[8]=e.data[8]):(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=e[3],c[4]=e[4],c[5]=e[5],c[6]=e[6],c[7]=e[7],c[8]=e[8]))}if(l==="mat3x4f"||l==="mat3x4h"){const c=new Float32Array(this.buffer,s,12);return void(e instanceof gt?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2],c[3]=e.data[3],c[4]=e.data[4],c[5]=e.data[5],c[6]=e.data[6],c[7]=e.data[7],c[8]=e.data[8],c[9]=e.data[9],c[10]=e.data[10],c[11]=e.data[11]):(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=e[3],c[4]=e[4],c[5]=e[5],c[6]=e[6],c[7]=e[7],c[8]=e[8],c[9]=e[9],c[10]=e[10],c[11]=e[11]))}if(l==="mat4x2f"||l==="mat4x2h"){const c=new Float32Array(this.buffer,s,8);return void(e instanceof gt?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2],c[3]=e.data[3],c[4]=e.data[4],c[5]=e.data[5],c[6]=e.data[6],c[7]=e.data[7]):(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=e[3],c[4]=e[4],c[5]=e[5],c[6]=e[6],c[7]=e[7]))}if(l==="mat4x3f"||l==="mat4x3h"){const c=new Float32Array(this.buffer,s,12);return void(e instanceof gt?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2],c[3]=e.data[3],c[4]=e.data[4],c[5]=e.data[5],c[6]=e.data[6],c[7]=e.data[7],c[8]=e.data[8],c[9]=e.data[9],c[10]=e.data[10],c[11]=e.data[11]):(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=e[3],c[4]=e[4],c[5]=e[5],c[6]=e[6],c[7]=e[7],c[8]=e[8],c[9]=e[9],c[10]=e[10],c[11]=e[11]))}if(l==="mat4x4f"||l==="mat4x4h"){const c=new Float32Array(this.buffer,s,16);return void(e instanceof gt?(c[0]=e.data[0],c[1]=e.data[1],c[2]=e.data[2],c[3]=e.data[3],c[4]=e.data[4],c[5]=e.data[5],c[6]=e.data[6],c[7]=e.data[7],c[8]=e.data[8],c[9]=e.data[9],c[10]=e.data[10],c[11]=e.data[11],c[12]=e.data[12],c[13]=e.data[13],c[14]=e.data[14],c[15]=e.data[15]):(c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=e[3],c[4]=e[4],c[5]=e[5],c[6]=e[6],c[7]=e[7],c[8]=e[8],c[9]=e[9],c[10]=e[10],c[11]=e[11],c[12]=e[12],c[13]=e[13],c[14]=e[14],c[15]=e[15]))}if(e instanceof le){if(i===e.typeInfo)return void new Uint8Array(this.buffer,s,e.buffer.byteLength).set(new Uint8Array(e.buffer));console.error("SetDataValue: Type mismatch",l,e.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${l}`)}else e instanceof N&&(new Int32Array(this.buffer,s,1)[0]=e.value);else e instanceof N&&(new Uint32Array(this.buffer,s,1)[0]=e.value);else e instanceof N&&(new Int32Array(this.buffer,s,1)[0]=e.value);else e instanceof N&&(new Float32Array(this.buffer,s,1)[0]=e.value)}getSubData(t,e,i){var s,r,l;if(e===null)return this;let c=this.offset,f=this.typeInfo;for(;e;){if(e instanceof ma){const p=e.index,_=p instanceof Wn?t.evalExpression(p,i):p;let y=0;if(_ instanceof N?y=_.value:typeof _=="number"?y=_:console.error("GetDataValue: Invalid index type",p),f instanceof gs)c+=y*f.stride,f=f.format;else{const b=f.getTypeName();b==="mat4x4"||b==="mat4x4f"||b==="mat4x4h"?(c+=16*y,f=t.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${f.getTypeName()} is not an array`)}}else{if(!(e instanceof or))return console.error("GetDataValue: Unknown postfix type",e),null;{const p=e.value;if(f instanceof us){let _=!1;for(const y of f.members)if(y.name===p){c+=y.offset,f=y.type,_=!0;break}if(!_)return console.error(`GetDataValue: Member ${p} not found`),null}else if(f instanceof On){const _=f.getTypeName();if(_==="vec2f"||_==="vec3f"||_==="vec4f"||_==="vec2i"||_==="vec3i"||_==="vec4i"||_==="vec2u"||_==="vec3u"||_==="vec4u"||_==="vec2b"||_==="vec3b"||_==="vec4b"||_==="vec2h"||_==="vec3h"||_==="vec4h"||_==="vec2"||_==="vec3"||_==="vec4"){if(p.length>0&&p.length<5){let y="f";const b=[];for(let x=0;x<p.length;++x){const T=p[x].toLowerCase();let A=0;if(T==="x"||T==="r")A=0;else if(T==="y"||T==="g")A=1;else if(T==="z"||T==="b")A=2;else{if(T!=="w"&&T!=="a")return console.error(`Unknown member ${p}`),null;A=3}if(p.length===1){if(_.endsWith("f"))return this.buffer.byteLength<c+4*A+4?(console.log("Insufficient buffer data"),null):new N(new Float32Array(this.buffer,c+4*A,1),t.getTypeInfo("f32"),this);if(_.endsWith("h"))return new N(new Float32Array(this.buffer,c+4*A,1),t.getTypeInfo("f16"),this);if(_.endsWith("i"))return new N(new Int32Array(this.buffer,c+4*A,1),t.getTypeInfo("i32"),this);if(_.endsWith("b"))return new N(new Int32Array(this.buffer,c+4*A,1),t.getTypeInfo("bool"),this);if(_.endsWith("u"))return new N(new Uint32Array(this.buffer,c+4*A,1),t.getTypeInfo("i32"),this)}if(_==="vec2f")b.push(new Float32Array(this.buffer,c,2)[A]);else if(_==="vec3f"){if(c+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const E=new Float32Array(this.buffer,c,3);b.push(E[A])}else if(_==="vec4f")b.push(new Float32Array(this.buffer,c,4)[A]);else if(_==="vec2i")y="i",b.push(new Int32Array(this.buffer,c,2)[A]);else if(_==="vec3i")y="i",b.push(new Int32Array(this.buffer,c,3)[A]);else if(_==="vec4i")y="i",b.push(new Int32Array(this.buffer,c,4)[A]);else if(_==="vec2u"){y="u";const E=new Uint32Array(this.buffer,c,2);b.push(E[A])}else _==="vec3u"?(y="u",b.push(new Uint32Array(this.buffer,c,3)[A])):_==="vec4u"&&(y="u",b.push(new Uint32Array(this.buffer,c,4)[A]))}return b.length===2?f=t.getTypeInfo(`vec2${y}`):b.length===3?f=t.getTypeInfo(`vec3${y}`):b.length===4?f=t.getTypeInfo(`vec4${y}`):console.error(`GetDataValue: Invalid vector length ${b.length}`),new R(b,f,null)}return console.error(`GetDataValue: Unknown member ${p}`),null}return console.error(`GetDataValue: Type ${_} is not a struct`),null}}}e=e.postfix}const d=f.getTypeName();return d==="f32"?new N(new Float32Array(this.buffer,c,1),f,this):d==="i32"?new N(new Int32Array(this.buffer,c,1),f,this):d==="u32"?new N(new Uint32Array(this.buffer,c,1),f,this):d==="vec2f"?new R(new Float32Array(this.buffer,c,2),f,this):d==="vec3f"?new R(new Float32Array(this.buffer,c,3),f,this):d==="vec4f"?new R(new Float32Array(this.buffer,c,4),f,this):d==="vec2i"?new R(new Int32Array(this.buffer,c,2),f,this):d==="vec3i"?new R(new Int32Array(this.buffer,c,3),f,this):d==="vec4i"?new R(new Int32Array(this.buffer,c,4),f,this):d==="vec2u"?new R(new Uint32Array(this.buffer,c,2),f,this):d==="vec3u"?new R(new Uint32Array(this.buffer,c,3),f,this):d==="vec4u"?new R(new Uint32Array(this.buffer,c,4),f,this):f instanceof ar&&f.name==="atomic"?((s=f.format)===null||s===void 0?void 0:s.name)==="u32"?new N(new Uint32Array(this.buffer,c,1)[0],f.format,this):((r=f.format)===null||r===void 0?void 0:r.name)==="i32"?new N(new Int32Array(this.buffer,c,1)[0],f.format,this):(console.error(`GetDataValue: Invalid atomic format ${(l=f.format)===null||l===void 0?void 0:l.name}`),null):new le(this.buffer,f,c,this)}toString(){let t="";if(this.typeInfo instanceof gs)if(this.typeInfo.format.name==="f32"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}`;for(let i=1;i<e.length;++i)t+=`, ${e[i]}`}else if(this.typeInfo.format.name==="i32"){const e=new Int32Array(this.buffer,this.offset);t=`[${e[0]}`;for(let i=1;i<e.length;++i)t+=`, ${e[i]}`}else if(this.typeInfo.format.name==="u32"){const e=new Uint32Array(this.buffer,this.offset);t=`[${e[0]}`;for(let i=1;i<e.length;++i)t+=`, ${e[i]}`}else if(this.typeInfo.format.name==="vec2f"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}, ${e[1]}]`;for(let i=1;i<e.length/2;++i)t+=`, [${e[2*i]}, ${e[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}, ${e[1]}, ${e[2]}]`;for(let i=4;i<e.length;i+=4)t+=`, [${e[i]}, ${e[i+1]}, ${e[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}, ${e[1]}, ${e[2]}, ${e[3]}]`;for(let i=4;i<e.length;i+=4)t+=`, [${e[i]}, ${e[i+1]}, ${e[i+2]}, ${e[i+3]}]`}else t="[...]";else this.typeInfo instanceof us?t+="{...}":t="[...]";return t}}class Mi extends Dn{constructor(t,e,i,s){super(e,null),this.data=t,this.descriptor=i,this.view=s}clone(){return new Mi(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var t,e;const i=this.descriptor.size;return i instanceof Array&&i.length>0?(t=i[0])!==null&&t!==void 0?t:0:i instanceof Object&&(e=i.width)!==null&&e!==void 0?e:0}get height(){var t,e;const i=this.descriptor.size;return i instanceof Array&&i.length>1?(t=i[1])!==null&&t!==void 0?t:0:i instanceof Object&&(e=i.height)!==null&&e!==void 0?e:0}get depthOrArrayLayers(){var t,e;const i=this.descriptor.size;return i instanceof Array&&i.length>2?(t=i[2])!==null&&t!==void 0?t:0:i instanceof Object&&(e=i.depthOrArrayLayers)!==null&&e!==void 0?e:0}get format(){var t;return this.descriptor&&(t=this.descriptor.format)!==null&&t!==void 0?t:"rgba8unorm"}get sampleCount(){var t;return this.descriptor&&(t=this.descriptor.sampleCount)!==null&&t!==void 0?t:1}get mipLevelCount(){var t;return this.descriptor&&(t=this.descriptor.mipLevelCount)!==null&&t!==void 0?t:1}get dimension(){var t;return this.descriptor&&(t=this.descriptor.dimension)!==null&&t!==void 0?t:"2d"}getMipLevelSize(t){if(t>=this.mipLevelCount)return[0,0,0];const e=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<e.length;++i)e[i]=Math.max(1,e[i]>>t);return e}get texelByteSize(){const t=this.format,e=Jd[t];return e?e.isDepthStencil?4:e.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const t=this.format,e=Jd[t];return!!e&&e.isDepthStencil}getGpuSize(){const t=this.format,e=Jd[t],i=this.width;if(!t||i<=0||!e)return-1;const s=this.height,r=this.depthOrArrayLayers,l=this.dimension;return i/e.blockWidth*(l==="1d"?1:s/e.blockHeight)*e.bytesPerBlock*r}getPixel(t,e,i=0,s=0){const r=this.texelByteSize,l=this.bytesPerRow,c=this.height,f=this.data[s];return iO(new Uint8Array(f),t,e,i,s,c,l,r,this.format)}setPixel(t,e,i,s,r){const l=this.texelByteSize,c=this.bytesPerRow,f=this.height,d=this.data[s];(function(p,_,y,b,x,T,A,E,D,C){const O=b*(A>>=x)*(T>>=x)+y*A+_*E;switch(D){case"r8unorm":return void zt(p,O,"8unorm",1,C);case"r8snorm":return void zt(p,O,"8snorm",1,C);case"r8uint":return void zt(p,O,"8uint",1,C);case"r8sint":return void zt(p,O,"8sint",1,C);case"rg8unorm":return void zt(p,O,"8unorm",2,C);case"rg8snorm":return void zt(p,O,"8snorm",2,C);case"rg8uint":return void zt(p,O,"8uint",2,C);case"rg8sint":return void zt(p,O,"8sint",2,C);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void zt(p,O,"8unorm",4,C);case"rgba8snorm":return void zt(p,O,"8snorm",4,C);case"rgba8uint":return void zt(p,O,"8uint",4,C);case"rgba8sint":return void zt(p,O,"8sint",4,C);case"r16uint":return void zt(p,O,"16uint",1,C);case"r16sint":return void zt(p,O,"16sint",1,C);case"r16float":return void zt(p,O,"16float",1,C);case"rg16uint":return void zt(p,O,"16uint",2,C);case"rg16sint":return void zt(p,O,"16sint",2,C);case"rg16float":return void zt(p,O,"16float",2,C);case"rgba16uint":return void zt(p,O,"16uint",4,C);case"rgba16sint":return void zt(p,O,"16sint",4,C);case"rgba16float":return void zt(p,O,"16float",4,C);case"r32uint":return void zt(p,O,"32uint",1,C);case"r32sint":return void zt(p,O,"32sint",1,C);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void zt(p,O,"32float",1,C);case"rg32uint":return void zt(p,O,"32uint",2,C);case"rg32sint":return void zt(p,O,"32sint",2,C);case"rg32float":return void zt(p,O,"32float",2,C);case"rgba32uint":return void zt(p,O,"32uint",4,C);case"rgba32sint":return void zt(p,O,"32sint",4,C);case"rgba32float":return void zt(p,O,"32float",4,C);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(d),t,e,i,s,f,c,l,this.format,r)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(B||(B={}));class U{constructor(t,e,i){this.name=t,this.type=e,this.rule=i}toString(){return this.name}}class w{}V=w,w.none=new U("",B.reserved,""),w.eof=new U("EOF",B.token,""),w.reserved={asm:new U("asm",B.reserved,"asm"),bf16:new U("bf16",B.reserved,"bf16"),do:new U("do",B.reserved,"do"),enum:new U("enum",B.reserved,"enum"),f16:new U("f16",B.reserved,"f16"),f64:new U("f64",B.reserved,"f64"),handle:new U("handle",B.reserved,"handle"),i8:new U("i8",B.reserved,"i8"),i16:new U("i16",B.reserved,"i16"),i64:new U("i64",B.reserved,"i64"),mat:new U("mat",B.reserved,"mat"),premerge:new U("premerge",B.reserved,"premerge"),regardless:new U("regardless",B.reserved,"regardless"),typedef:new U("typedef",B.reserved,"typedef"),u8:new U("u8",B.reserved,"u8"),u16:new U("u16",B.reserved,"u16"),u64:new U("u64",B.reserved,"u64"),unless:new U("unless",B.reserved,"unless"),using:new U("using",B.reserved,"using"),vec:new U("vec",B.reserved,"vec"),void:new U("void",B.reserved,"void")},w.keywords={array:new U("array",B.keyword,"array"),atomic:new U("atomic",B.keyword,"atomic"),bool:new U("bool",B.keyword,"bool"),f32:new U("f32",B.keyword,"f32"),i32:new U("i32",B.keyword,"i32"),mat2x2:new U("mat2x2",B.keyword,"mat2x2"),mat2x3:new U("mat2x3",B.keyword,"mat2x3"),mat2x4:new U("mat2x4",B.keyword,"mat2x4"),mat3x2:new U("mat3x2",B.keyword,"mat3x2"),mat3x3:new U("mat3x3",B.keyword,"mat3x3"),mat3x4:new U("mat3x4",B.keyword,"mat3x4"),mat4x2:new U("mat4x2",B.keyword,"mat4x2"),mat4x3:new U("mat4x3",B.keyword,"mat4x3"),mat4x4:new U("mat4x4",B.keyword,"mat4x4"),ptr:new U("ptr",B.keyword,"ptr"),sampler:new U("sampler",B.keyword,"sampler"),sampler_comparison:new U("sampler_comparison",B.keyword,"sampler_comparison"),struct:new U("struct",B.keyword,"struct"),texture_1d:new U("texture_1d",B.keyword,"texture_1d"),texture_2d:new U("texture_2d",B.keyword,"texture_2d"),texture_2d_array:new U("texture_2d_array",B.keyword,"texture_2d_array"),texture_3d:new U("texture_3d",B.keyword,"texture_3d"),texture_cube:new U("texture_cube",B.keyword,"texture_cube"),texture_cube_array:new U("texture_cube_array",B.keyword,"texture_cube_array"),texture_multisampled_2d:new U("texture_multisampled_2d",B.keyword,"texture_multisampled_2d"),texture_storage_1d:new U("texture_storage_1d",B.keyword,"texture_storage_1d"),texture_storage_2d:new U("texture_storage_2d",B.keyword,"texture_storage_2d"),texture_storage_2d_array:new U("texture_storage_2d_array",B.keyword,"texture_storage_2d_array"),texture_storage_3d:new U("texture_storage_3d",B.keyword,"texture_storage_3d"),texture_depth_2d:new U("texture_depth_2d",B.keyword,"texture_depth_2d"),texture_depth_2d_array:new U("texture_depth_2d_array",B.keyword,"texture_depth_2d_array"),texture_depth_cube:new U("texture_depth_cube",B.keyword,"texture_depth_cube"),texture_depth_cube_array:new U("texture_depth_cube_array",B.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new U("texture_depth_multisampled_2d",B.keyword,"texture_depth_multisampled_2d"),texture_external:new U("texture_external",B.keyword,"texture_external"),u32:new U("u32",B.keyword,"u32"),vec2:new U("vec2",B.keyword,"vec2"),vec3:new U("vec3",B.keyword,"vec3"),vec4:new U("vec4",B.keyword,"vec4"),bitcast:new U("bitcast",B.keyword,"bitcast"),block:new U("block",B.keyword,"block"),break:new U("break",B.keyword,"break"),case:new U("case",B.keyword,"case"),continue:new U("continue",B.keyword,"continue"),continuing:new U("continuing",B.keyword,"continuing"),default:new U("default",B.keyword,"default"),diagnostic:new U("diagnostic",B.keyword,"diagnostic"),discard:new U("discard",B.keyword,"discard"),else:new U("else",B.keyword,"else"),enable:new U("enable",B.keyword,"enable"),fallthrough:new U("fallthrough",B.keyword,"fallthrough"),false:new U("false",B.keyword,"false"),fn:new U("fn",B.keyword,"fn"),for:new U("for",B.keyword,"for"),function:new U("function",B.keyword,"function"),if:new U("if",B.keyword,"if"),let:new U("let",B.keyword,"let"),const:new U("const",B.keyword,"const"),loop:new U("loop",B.keyword,"loop"),while:new U("while",B.keyword,"while"),private:new U("private",B.keyword,"private"),read:new U("read",B.keyword,"read"),read_write:new U("read_write",B.keyword,"read_write"),return:new U("return",B.keyword,"return"),requires:new U("requires",B.keyword,"requires"),storage:new U("storage",B.keyword,"storage"),switch:new U("switch",B.keyword,"switch"),true:new U("true",B.keyword,"true"),alias:new U("alias",B.keyword,"alias"),type:new U("type",B.keyword,"type"),uniform:new U("uniform",B.keyword,"uniform"),var:new U("var",B.keyword,"var"),override:new U("override",B.keyword,"override"),workgroup:new U("workgroup",B.keyword,"workgroup"),write:new U("write",B.keyword,"write"),r8unorm:new U("r8unorm",B.keyword,"r8unorm"),r8snorm:new U("r8snorm",B.keyword,"r8snorm"),r8uint:new U("r8uint",B.keyword,"r8uint"),r8sint:new U("r8sint",B.keyword,"r8sint"),r16uint:new U("r16uint",B.keyword,"r16uint"),r16sint:new U("r16sint",B.keyword,"r16sint"),r16float:new U("r16float",B.keyword,"r16float"),rg8unorm:new U("rg8unorm",B.keyword,"rg8unorm"),rg8snorm:new U("rg8snorm",B.keyword,"rg8snorm"),rg8uint:new U("rg8uint",B.keyword,"rg8uint"),rg8sint:new U("rg8sint",B.keyword,"rg8sint"),r32uint:new U("r32uint",B.keyword,"r32uint"),r32sint:new U("r32sint",B.keyword,"r32sint"),r32float:new U("r32float",B.keyword,"r32float"),rg16uint:new U("rg16uint",B.keyword,"rg16uint"),rg16sint:new U("rg16sint",B.keyword,"rg16sint"),rg16float:new U("rg16float",B.keyword,"rg16float"),rgba8unorm:new U("rgba8unorm",B.keyword,"rgba8unorm"),rgba8unorm_srgb:new U("rgba8unorm_srgb",B.keyword,"rgba8unorm_srgb"),rgba8snorm:new U("rgba8snorm",B.keyword,"rgba8snorm"),rgba8uint:new U("rgba8uint",B.keyword,"rgba8uint"),rgba8sint:new U("rgba8sint",B.keyword,"rgba8sint"),bgra8unorm:new U("bgra8unorm",B.keyword,"bgra8unorm"),bgra8unorm_srgb:new U("bgra8unorm_srgb",B.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new U("rgb10a2unorm",B.keyword,"rgb10a2unorm"),rg11b10float:new U("rg11b10float",B.keyword,"rg11b10float"),rg32uint:new U("rg32uint",B.keyword,"rg32uint"),rg32sint:new U("rg32sint",B.keyword,"rg32sint"),rg32float:new U("rg32float",B.keyword,"rg32float"),rgba16uint:new U("rgba16uint",B.keyword,"rgba16uint"),rgba16sint:new U("rgba16sint",B.keyword,"rgba16sint"),rgba16float:new U("rgba16float",B.keyword,"rgba16float"),rgba32uint:new U("rgba32uint",B.keyword,"rgba32uint"),rgba32sint:new U("rgba32sint",B.keyword,"rgba32sint"),rgba32float:new U("rgba32float",B.keyword,"rgba32float"),static_assert:new U("static_assert",B.keyword,"static_assert")},w.tokens={decimal_float_literal:new U("decimal_float_literal",B.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new U("hex_float_literal",B.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new U("int_literal",B.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new U("uint_literal",B.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new U("name",B.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new U("ident",B.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new U("and",B.token,"&"),and_and:new U("and_and",B.token,"&&"),arrow:new U("arrow ",B.token,"->"),attr:new U("attr",B.token,"@"),forward_slash:new U("forward_slash",B.token,"/"),bang:new U("bang",B.token,"!"),bracket_left:new U("bracket_left",B.token,"["),bracket_right:new U("bracket_right",B.token,"]"),brace_left:new U("brace_left",B.token,"{"),brace_right:new U("brace_right",B.token,"}"),colon:new U("colon",B.token,":"),comma:new U("comma",B.token,","),equal:new U("equal",B.token,"="),equal_equal:new U("equal_equal",B.token,"=="),not_equal:new U("not_equal",B.token,"!="),greater_than:new U("greater_than",B.token,">"),greater_than_equal:new U("greater_than_equal",B.token,">="),shift_right:new U("shift_right",B.token,">>"),less_than:new U("less_than",B.token,"<"),less_than_equal:new U("less_than_equal",B.token,"<="),shift_left:new U("shift_left",B.token,"<<"),modulo:new U("modulo",B.token,"%"),minus:new U("minus",B.token,"-"),minus_minus:new U("minus_minus",B.token,"--"),period:new U("period",B.token,"."),plus:new U("plus",B.token,"+"),plus_plus:new U("plus_plus",B.token,"++"),or:new U("or",B.token,"|"),or_or:new U("or_or",B.token,"||"),paren_left:new U("paren_left",B.token,"("),paren_right:new U("paren_right",B.token,")"),semicolon:new U("semicolon",B.token,";"),star:new U("star",B.token,"*"),tilde:new U("tilde",B.token,"~"),underscore:new U("underscore",B.token,"_"),xor:new U("xor",B.token,"^"),plus_equal:new U("plus_equal",B.token,"+="),minus_equal:new U("minus_equal",B.token,"-="),times_equal:new U("times_equal",B.token,"*="),division_equal:new U("division_equal",B.token,"/="),modulo_equal:new U("modulo_equal",B.token,"%="),and_equal:new U("and_equal",B.token,"&="),or_equal:new U("or_equal",B.token,"|="),xor_equal:new U("xor_equal",B.token,"^="),shift_right_equal:new U("shift_right_equal",B.token,">>="),shift_left_equal:new U("shift_left_equal",B.token,"<<=")},w.simpleTokens={"@":V.tokens.attr,"{":V.tokens.brace_left,"}":V.tokens.brace_right,":":V.tokens.colon,",":V.tokens.comma,"(":V.tokens.paren_left,")":V.tokens.paren_right,";":V.tokens.semicolon},w.literalTokens={"&":V.tokens.and,"&&":V.tokens.and_and,"->":V.tokens.arrow,"/":V.tokens.forward_slash,"!":V.tokens.bang,"[":V.tokens.bracket_left,"]":V.tokens.bracket_right,"=":V.tokens.equal,"==":V.tokens.equal_equal,"!=":V.tokens.not_equal,">":V.tokens.greater_than,">=":V.tokens.greater_than_equal,">>":V.tokens.shift_right,"<":V.tokens.less_than,"<=":V.tokens.less_than_equal,"<<":V.tokens.shift_left,"%":V.tokens.modulo,"-":V.tokens.minus,"--":V.tokens.minus_minus,".":V.tokens.period,"+":V.tokens.plus,"++":V.tokens.plus_plus,"|":V.tokens.or,"||":V.tokens.or_or,"*":V.tokens.star,"~":V.tokens.tilde,_:V.tokens.underscore,"^":V.tokens.xor,"+=":V.tokens.plus_equal,"-=":V.tokens.minus_equal,"*=":V.tokens.times_equal,"/=":V.tokens.division_equal,"%=":V.tokens.modulo_equal,"&=":V.tokens.and_equal,"|=":V.tokens.or_equal,"^=":V.tokens.xor_equal,">>=":V.tokens.shift_right_equal,"<<=":V.tokens.shift_left_equal},w.regexTokens={decimal_float_literal:V.tokens.decimal_float_literal,hex_float_literal:V.tokens.hex_float_literal,int_literal:V.tokens.int_literal,uint_literal:V.tokens.uint_literal,ident:V.tokens.ident},w.storage_class=[V.keywords.function,V.keywords.private,V.keywords.workgroup,V.keywords.uniform,V.keywords.storage],w.access_mode=[V.keywords.read,V.keywords.write,V.keywords.read_write],w.sampler_type=[V.keywords.sampler,V.keywords.sampler_comparison],w.sampled_texture_type=[V.keywords.texture_1d,V.keywords.texture_2d,V.keywords.texture_2d_array,V.keywords.texture_3d,V.keywords.texture_cube,V.keywords.texture_cube_array],w.multisampled_texture_type=[V.keywords.texture_multisampled_2d],w.storage_texture_type=[V.keywords.texture_storage_1d,V.keywords.texture_storage_2d,V.keywords.texture_storage_2d_array,V.keywords.texture_storage_3d],w.depth_texture_type=[V.keywords.texture_depth_2d,V.keywords.texture_depth_2d_array,V.keywords.texture_depth_cube,V.keywords.texture_depth_cube_array,V.keywords.texture_depth_multisampled_2d],w.texture_external_type=[V.keywords.texture_external],w.any_texture_type=[...V.sampled_texture_type,...V.multisampled_texture_type,...V.storage_texture_type,...V.depth_texture_type,...V.texture_external_type],w.texel_format=[V.keywords.r8unorm,V.keywords.r8snorm,V.keywords.r8uint,V.keywords.r8sint,V.keywords.r16uint,V.keywords.r16sint,V.keywords.r16float,V.keywords.rg8unorm,V.keywords.rg8snorm,V.keywords.rg8uint,V.keywords.rg8sint,V.keywords.r32uint,V.keywords.r32sint,V.keywords.r32float,V.keywords.rg16uint,V.keywords.rg16sint,V.keywords.rg16float,V.keywords.rgba8unorm,V.keywords.rgba8unorm_srgb,V.keywords.rgba8snorm,V.keywords.rgba8uint,V.keywords.rgba8sint,V.keywords.bgra8unorm,V.keywords.bgra8unorm_srgb,V.keywords.rgb10a2unorm,V.keywords.rg11b10float,V.keywords.rg32uint,V.keywords.rg32sint,V.keywords.rg32float,V.keywords.rgba16uint,V.keywords.rgba16sint,V.keywords.rgba16float,V.keywords.rgba32uint,V.keywords.rgba32sint,V.keywords.rgba32float],w.const_literal=[V.tokens.int_literal,V.tokens.uint_literal,V.tokens.decimal_float_literal,V.tokens.hex_float_literal,V.keywords.true,V.keywords.false],w.literal_or_ident=[V.tokens.ident,V.tokens.int_literal,V.tokens.uint_literal,V.tokens.decimal_float_literal,V.tokens.hex_float_literal,V.tokens.name],w.element_count_expression=[V.tokens.int_literal,V.tokens.uint_literal,V.tokens.ident],w.template_types=[V.keywords.vec2,V.keywords.vec3,V.keywords.vec4,V.keywords.mat2x2,V.keywords.mat2x3,V.keywords.mat2x4,V.keywords.mat3x2,V.keywords.mat3x3,V.keywords.mat3x4,V.keywords.mat4x2,V.keywords.mat4x3,V.keywords.mat4x4,V.keywords.atomic,V.keywords.bitcast,...V.any_texture_type],w.attribute_name=[V.tokens.ident,V.keywords.block,V.keywords.diagnostic],w.assignment_operators=[V.tokens.equal,V.tokens.plus_equal,V.tokens.minus_equal,V.tokens.times_equal,V.tokens.division_equal,V.tokens.modulo_equal,V.tokens.and_equal,V.tokens.or_equal,V.tokens.xor_equal,V.tokens.shift_right_equal,V.tokens.shift_left_equal],w.increment_operators=[V.tokens.plus_plus,V.tokens.minus_minus];class wv{constructor(t,e,i,s,r){this.type=t,this.lexeme=e,this.line=i,this.start=s,this.end=r}toString(){return this.lexeme}isTemplateType(){return w.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==w.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class uO{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new wv(w.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let l=1;for(;l>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),l--,l==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),l++)}return!0}}const e=w.simpleTokens[t];if(e)return this._addToken(e),!0;let i=w.none;const s=this._isAlpha(t),r=t==="_";if(this._isAlphaNumeric(t)){let l=this._peekAhead();for(;this._isAlphaNumeric(l);)t+=this._advance(),l=this._peekAhead()}if(s){const l=w.keywords[t];if(l)return this._addToken(l),!0}if(s||r)return this._addToken(w.tokens.ident),!0;for(;;){let l=this._findType(t);const c=this._peekAhead();if(t=="-"&&this._tokens.length>0){if(c=="=")return this._current++,t+=c,this._addToken(w.tokens.minus_equal),!0;if(c=="-")return this._current++,t+=c,this._addToken(w.tokens.minus_minus),!0;const f=this._tokens.length-1;if((w.literal_or_ident.indexOf(this._tokens[f].type)!=-1||this._tokens[f].type==w.tokens.paren_right)&&c!=">")return this._addToken(l),!0}if(t==">"&&(c==">"||c=="=")){let f=!1,d=this._tokens.length-1;for(let p=0;p<5&&d>=0&&w.assignment_operators.indexOf(this._tokens[d].type)===-1;++p,--d)if(this._tokens[d].type===w.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(f=!0);break}if(f)return this._addToken(l),!0}if(l===w.none){let f=t,d=0;const p=2;for(let _=0;_<p;++_)if(f+=this._peekAhead(_),l=this._findType(f),l!==w.none){d=_;break}if(l===w.none)return i!==w.none&&(this._current--,this._addToken(i),!0);t=f,this._current+=d+1}if(i=l,this._isAtEnd())break;t+=this._advance()}return i!==w.none&&(this._addToken(i),!0)}_findType(t){for(const i in w.regexTokens){const s=w.regexTokens[i];if(this._match(t,s.rule))return s}return w.literalTokens[t]||w.none}_match(t,e){const i=e.exec(t);return i&&i.index==0&&i[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return!this._isNumeric(t)&&!this._isWhitespace(t)&&t!=="_"&&t!=="."&&t!=="("&&t!==")"&&t!=="["&&t!=="]"&&t!=="{"&&t!=="}"&&t!==","&&t!==";"&&t!==":"&&t!=="="&&t!=="!"&&t!=="<"&&t!==">"&&t!=="+"&&t!=="-"&&t!=="*"&&t!=="/"&&t!=="%"&&t!=="&"&&t!=="|"&&t!=="^"&&t!=="~"&&t!=="@"&&t!=="#"&&t!=="?"&&t!=="'"&&t!=="`"&&t!=='"'&&t!=="\\"&&t!==`
`&&t!=="\r"&&t!=="	"&&t!=="\0"}_isNumeric(t){return t>="0"&&t<="9"}_isAlphaNumeric(t){return this._isAlpha(t)||this._isNumeric(t)||t==="_"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let e=this._source[this._current];return t=t||0,t++,this._current+=t,e}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){const e=this._source.substring(this._start,this._current);this._tokens.push(new wv(t,e,this._line,this._start,this._current))}}function rt(n){return Array.isArray(n)||n?.buffer instanceof ArrayBuffer}const Bu=new Float32Array(1),fO=new Uint32Array(Bu.buffer),hO=new Uint32Array(Bu.buffer),Uu=new Int32Array(1),dO=new Float32Array(Uu.buffer),pO=new Uint32Array(Uu.buffer),Fu=new Uint32Array(1),gO=new Float32Array(Fu.buffer),_O=new Int32Array(Fu.buffer);function Ev(n,t,e){if(t===e)return n;if(t==="f32"){if(e==="i32"||e==="x32")return Bu[0]=n,fO[0];if(e==="u32")return Bu[0]=n,hO[0]}else if(t==="i32"||t==="x32"){if(e==="f32")return Uu[0]=n,dO[0];if(e==="u32")return Uu[0]=n,pO[0]}else if(t==="u32"){if(e==="f32")return Fu[0]=n,gO[0];if(e==="i32"||e==="x32")return Fu[0]=n,_O[0]}return console.error(`Unsupported cast from ${t} to ${e}`),n}class mO{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}}class qc{constructor(t,e){this.align=t,this.size=e}}class ni{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new JM,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}updateAST(t){for(const e of t)e instanceof al&&this._functions.set(e.name,new mO(e));for(const e of t)if(e instanceof Ci){const i=this.getTypeInfo(e,null);i instanceof us&&this.structs.push(i)}for(const e of t)if(e instanceof jg)this.aliases.push(this._getAliasInfo(e));else{if(e instanceof Vg){const i=e,s=this._getAttributeNum(i.attributes,"id",0),r=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new ZM(i.name,r,i.attributes,s));continue}if(this._isUniformVar(e)){const i=e,s=this._getAttributeNum(i.attributes,"group",0),r=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=new Yc(i.name,l,s,r,i.attributes,ls.Uniform,i.access);c.access||(c.access="read"),this.uniforms.push(c);continue}if(this._isStorageVar(e)){const i=e,s=this._getAttributeNum(i.attributes,"group",0),r=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=this._isStorageTexture(l),f=new Yc(i.name,l,s,r,i.attributes,c?ls.StorageTexture:ls.Storage,i.access);f.access||(f.access="read"),this.storage.push(f);continue}if(this._isTextureVar(e)){const i=e,s=this._getAttributeNum(i.attributes,"group",0),r=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=this._isStorageTexture(l),f=new Yc(i.name,l,s,r,i.attributes,c?ls.StorageTexture:ls.Texture,i.access);f.access||(f.access="read"),c?this.storage.push(f):this.textures.push(f);continue}if(this._isSamplerVar(e)){const i=e,s=this._getAttributeNum(i.attributes,"group",0),r=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),c=new Yc(i.name,l,s,r,i.attributes,ls.Sampler,i.access);this.samplers.push(c);continue}}for(const e of t)if(e instanceof al){const i=this._getAttribute(e,"vertex"),s=this._getAttribute(e,"fragment"),r=this._getAttribute(e,"compute"),l=i||s||r,c=new GM(e.name,l?.name,e.attributes);c.attributes=e.attributes,c.startLine=e.startLine,c.endLine=e.endLine,this.functions.push(c),this._functions.get(e.name).info=c,l&&(this._functions.get(e.name).inUse=!0,c.inUse=!0,c.resources=this._findResources(e,!!l),c.inputs=this._getInputs(e.args),c.outputs=this._getOutputs(e.returnType),this.entry[l.name].push(c)),c.arguments=e.args.map(f=>new QM(f.name,this.getTypeInfo(f.type,f.attributes),f.attributes)),c.returnType=e.returnType?this.getTypeInfo(e.returnType,e.attributes):null;continue}for(const e of this._functions.values())e.info&&(e.info.inUse=e.inUse,this._addCalls(e.node,e.info.calls));for(const e of this._functions.values())e.node.search(i=>{var s,r,l;if(i instanceof d2){if(i.value)if(rt(i.value))for(const c of i.value)for(const f of this.overrides)c===f.name&&((s=e.info)===null||s===void 0||s.overrides.push(f));else for(const c of this.overrides)i.value===c.name&&((r=e.info)===null||r===void 0||r.overrides.push(c))}else if(i instanceof pn)for(const c of this.overrides)i.name===c.name&&((l=e.info)===null||l===void 0||l.overrides.push(c))});for(const e of this.uniforms)this._markStructsInUse(e.type);for(const e of this.storage)this._markStructsInUse(e.type)}getFunctionInfo(t){for(const e of this.functions)if(e.name==t)return e;return null}getStructInfo(t){for(const e of this.structs)if(e.name==t)return e;return null}getOverrideInfo(t){for(const e of this.overrides)if(e.name==t)return e;return null}_markStructsInUse(t){if(t)if(t.isStruct){if(t.inUse=!0,t.members)for(const e of t.members)this._markStructsInUse(e.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)t.format&&this._markStructsInUse(t.format);else{const e=this._getAlias(t.name);e&&this._markStructsInUse(e)}}_addCalls(t,e){var i;for(const s of t.calls){const r=(i=this._functions.get(s.name))===null||i===void 0?void 0:i.info;r&&e.add(r)}}findResource(t,e,i){if(i){for(const s of this.entry.compute)if(s.name===i){for(const r of s.resources)if(r.group==t&&r.binding==e)return r}for(const s of this.entry.vertex)if(s.name===i){for(const r of s.resources)if(r.group==t&&r.binding==e)return r}for(const s of this.entry.fragment)if(s.name===i){for(const r of s.resources)if(r.group==t&&r.binding==e)return r}}for(const s of this.uniforms)if(s.group==t&&s.binding==e)return s;for(const s of this.storage)if(s.group==t&&s.binding==e)return s;for(const s of this.textures)if(s.group==t&&s.binding==e)return s;for(const s of this.samplers)if(s.group==t&&s.binding==e)return s;return null}_findResource(t){for(const e of this.uniforms)if(e.name==t)return e;for(const e of this.storage)if(e.name==t)return e;for(const e of this.textures)if(e.name==t)return e;for(const e of this.samplers)if(e.name==t)return e;return null}_markStructsFromAST(t){const e=this.getTypeInfo(t,null);this._markStructsInUse(e)}_findResources(t,e){const i=[],s=this,r=[];return t.search(l=>{if(l instanceof ku)r.push({});else if(l instanceof Nu)r.pop();else if(l instanceof Ii){const c=l;e&&c.type!==null&&this._markStructsFromAST(c.type),r.length>0&&(r[r.length-1][c.name]=c)}else if(l instanceof ti){const c=l;e&&c.type!==null&&this._markStructsFromAST(c.type)}else if(l instanceof Ko){const c=l;e&&c.type!==null&&this._markStructsFromAST(c.type),r.length>0&&(r[r.length-1][c.name]=c)}else if(l instanceof pn){const c=l;if(r.length>0&&r[r.length-1][c.name])return;const f=s._findResource(c.name);f&&i.push(f)}else if(l instanceof Wg){const c=l,f=s._functions.get(c.name);f&&(e&&(f.inUse=!0),t.calls.add(f.node),f.resources===null&&(f.resources=s._findResources(f.node,e)),i.push(...f.resources))}else if(l instanceof Hg){const c=l,f=s._functions.get(c.name);f&&(e&&(f.inUse=!0),t.calls.add(f.node),f.resources===null&&(f.resources=s._findResources(f.node,e)),i.push(...f.resources))}}),[...new Map(i.map(l=>[l.name,l])).values()]}getBindGroups(){const t=[];function e(i,s){i>=t.length&&(t.length=i+1),t[i]===void 0&&(t[i]=[]),s>=t[i].length&&(t[i].length=s+1)}for(const i of this.uniforms)e(i.group,i.binding),t[i.group][i.binding]=i;for(const i of this.storage)e(i.group,i.binding),t[i.group][i.binding]=i;for(const i of this.textures)e(i.group,i.binding),t[i.group][i.binding]=i;for(const i of this.samplers)e(i.group,i.binding),t[i.group][i.binding]=i;return t}_getOutputs(t,e=void 0){if(e===void 0&&(e=[]),t instanceof Ci)this._getStructOutputs(t,e);else{const i=this._getOutputInfo(t);i!==null&&e.push(i)}return e}_getStructOutputs(t,e){for(const i of t.members)if(i.type instanceof Ci)this._getStructOutputs(i.type,e);else{const s=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(s!==null){const r=this.getTypeInfo(i.type,i.type.attributes),l=this._parseInt(s.value),c=new vv(i.name,r,s.name,l);e.push(c)}}}_getOutputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const i=this.getTypeInfo(t,t.attributes),s=this._parseInt(e.value);return new vv("",i,e.name,s)}return null}_getInputs(t,e=void 0){e===void 0&&(e=[]);for(const i of t)if(i.type instanceof Ci)this._getStructInputs(i.type,e);else{const s=this._getInputInfo(i);s!==null&&e.push(s)}return e}_getStructInputs(t,e){for(const i of t.members)if(i.type instanceof Ci)this._getStructInputs(i.type,e);else{const s=this._getInputInfo(i);s!==null&&e.push(s)}}_getInputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const i=this._getAttribute(t,"interpolation"),s=this.getTypeInfo(t.type,t.attributes),r=this._parseInt(e.value),l=new KM(t.name,s,e.name,r);return i!==null&&(l.interpolation=this._parseString(i.value)),l}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);const e=parseInt(t);return isNaN(e)?t:e}_getAlias(t){for(const e of this.aliases)if(e.name==t)return e.type;return null}_getAliasInfo(t){return new qM(t.name,this.getTypeInfo(t.type,null))}getTypeInfoByName(t){for(const e of this.structs)if(e.name==t)return e;for(const e of this.aliases)if(e.name==t)return e.type;return null}getTypeInfo(t,e=null){if(this._types.has(t))return this._types.get(t);if(t instanceof bu){const s=t.type?this.getTypeInfo(t.type,t.attributes):null,r=new Vp(t.name,s,e);return this._types.set(t,r),this._updateTypeInfo(r),r}if(t instanceof Zo){const s=t,r=s.format?this.getTypeInfo(s.format,s.attributes):null,l=new gs(s.name,e);return l.format=r,l.count=s.count,this._types.set(t,l),this._updateTypeInfo(l),l}if(t instanceof Ci){const s=t,r=new us(s.name,e);r.startLine=s.startLine,r.endLine=s.endLine;for(const l of s.members){const c=this.getTypeInfo(l.type,l.attributes);r.members.push(new bv(l.name,c,l.attributes))}return this._types.set(t,r),this._updateTypeInfo(r),r}if(t instanceof Lo){const s=t,r=s.format instanceof J,l=s.format?r?this.getTypeInfo(s.format,null):new On(s.format,null):null,c=new ar(s.name,l,e,s.access);return this._types.set(t,c),this._updateTypeInfo(c),c}if(t instanceof L){const s=t,r=s.format?this.getTypeInfo(s.format,null):null,l=new ar(s.name,r,e,s.access);return this._types.set(t,l),this._updateTypeInfo(l),l}const i=new On(t.name,e);return this._types.set(t,i),this._updateTypeInfo(i),i}_updateTypeInfo(t){var e,i,s;const r=this._getTypeSize(t);if(t.size=(e=r?.size)!==null&&e!==void 0?e:0,t instanceof gs&&t.format){const l=this._getTypeSize(t.format);t.stride=Math.max((i=l?.size)!==null&&i!==void 0?i:0,(s=l?.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(t.format)}t instanceof Vp&&this._updateTypeInfo(t.format),t instanceof us&&this._updateStructInfo(t)}_updateStructInfo(t){var e;let i=0,s=0,r=0,l=0;for(let c=0,f=t.members.length;c<f;++c){const d=t.members[c],p=this._getTypeSize(d);if(!p)continue;(e=this._getAlias(d.type.name))!==null&&e!==void 0||d.type;const _=p.align,y=p.size;i=this._roundUp(_,i+s),s=y,r=i,l=Math.max(l,_),d.offset=i,d.size=y,this._updateTypeInfo(d.type)}t.size=this._roundUp(l,r+s),t.align=l}_getTypeSize(t){var e,i;if(t==null)return null;const s=this._getAttributeNum(t.attributes,"size",0),r=this._getAttributeNum(t.attributes,"align",0);if(t instanceof bv&&(t=t.type),t instanceof On){const l=this._getAlias(t.name);l!==null&&(t=l)}{const l=ni._typeInfo[t.name];if(l!==void 0){const c=((e=t.format)===null||e===void 0?void 0:e.name)==="f16"?2:1;return new qc(Math.max(r,l.align/c),Math.max(s,l.size/c))}}{const l=ni._typeInfo[t.name.substring(0,t.name.length-1)];if(l){const c=t.name[t.name.length-1]==="h"?2:1;return new qc(Math.max(r,l.align/c),Math.max(s,l.size/c))}}if(t instanceof gs){let l=t,c=8,f=8;const d=this._getTypeSize(l.format);return d!==null&&(f=d.size,c=d.align),f=l.count*this._getAttributeNum((i=t?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(c,f)),s&&(f=s),new qc(Math.max(r,c),Math.max(s,f))}if(t instanceof us){let l=0,c=0,f=0,d=0,p=0;for(const _ of t.members){const y=this._getTypeSize(_.type);y!==null&&(l=Math.max(y.align,l),f=this._roundUp(y.align,f+d),d=y.size,p=f)}return c=this._roundUp(l,p+d),new qc(Math.max(r,l),Math.max(s,c))}return null}_isUniformVar(t){return t instanceof Ii&&t.storage=="uniform"}_isStorageVar(t){return t instanceof Ii&&t.storage=="storage"}_isTextureVar(t){return t instanceof Ii&&t.type!==null&&ni._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof Ii&&t.type!==null&&ni._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,e){const i=t;if(!i||!i.attributes)return null;const s=i.attributes;for(let r of s)if(r.name==e)return r;return null}_getAttributeNum(t,e,i){if(t===null)return i;for(let s of t)if(s.name==e){let r=s!==null&&s.value!==null?s.value:i;return r instanceof Array&&(r=r[0]),typeof r=="number"?r:typeof r=="string"?parseInt(r):i}return i}_roundUp(t,e){return Math.ceil(e/t)*t}}ni._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},ni._textureTypes=w.any_texture_type.map(n=>n.name),ni._samplerTypes=w.sampler_type.map(n=>n.name);let $g=0;class Xg{constructor(t,e,i){this.id=$g++,this.name=t,this.value=e,this.node=i}clone(){return new Xg(this.name,this.value,this.node)}}class Yg{constructor(t){this.id=$g++,this.name=t.name,this.node=t}clone(){return new Yg(this.node)}}class qg{constructor(t){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=$g++,t&&(this.parent=t,this.currentFunctionName=t.currentFunctionName)}getVariable(t){var e;return this.variables.has(t)?(e=this.variables.get(t))!==null&&e!==void 0?e:null:this.parent?this.parent.getVariable(t):null}getFunction(t){var e;return this.functions.has(t)?(e=this.functions.get(t))!==null&&e!==void 0?e:null:this.parent?this.parent.getFunction(t):null}createVariable(t,e,i){this.variables.set(t,new Xg(t,e,i??null))}setVariable(t,e,i){const s=this.getVariable(t);s!==null?s.value=e:this.createVariable(t,e,i)}getVariableValue(t){var e;const i=this.getVariable(t);return(e=i?.value)!==null&&e!==void 0?e:null}clone(){return new qg(this)}}class yO{evalExpression(t,e){return null}getTypeInfo(t){return null}getVariableName(t,e){return""}}class bO{constructor(t){this.exec=t}getTypeInfo(t){return this.exec.getTypeInfo(t)}All(t,e){const i=this.exec.evalExpression(t.args[0],e);let s=!0;if(i instanceof R)return i.data.forEach(r=>{r||(s=!1)}),new N(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${t.line}`)}Any(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R){const s=i.data.some(r=>r);return new N(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${t.line}`)}Select(t,e){const i=this.exec.evalExpression(t.args[2],e);if(!(i instanceof N))throw new Error(`Select() expects a bool condition. Line ${t.line}`);return i.value?this.exec.evalExpression(t.args[1],e):this.exec.evalExpression(t.args[0],e)}ArrayLength(t,e){let i=t.args[0];i instanceof ye&&(i=i.right);const s=this.exec.evalExpression(i,e);if(s instanceof le&&s.typeInfo.size===0){const r=s.typeInfo,l=s.buffer.byteLength/r.stride;return new N(l,this.getTypeInfo("u32"))}return new N(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.abs(r)),i.typeInfo);const s=i;return new N(Math.abs(s.value),s.typeInfo)}Acos(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.acos(r)),i.typeInfo);const s=i;return new N(Math.acos(s.value),i.typeInfo)}Acosh(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.acosh(r)),i.typeInfo);const s=i;return new N(Math.acosh(s.value),i.typeInfo)}Asin(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.asin(r)),i.typeInfo);const s=i;return new N(Math.asin(s.value),i.typeInfo)}Asinh(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.asinh(r)),i.typeInfo);const s=i;return new N(Math.asinh(s.value),i.typeInfo)}Atan(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.atan(r)),i.typeInfo);const s=i;return new N(Math.atan(s.value),i.typeInfo)}Atanh(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.atanh(r)),i.typeInfo);const s=i;return new N(Math.atanh(s.value),i.typeInfo)}Atan2(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof R&&s instanceof R)return new R(i.data.map((c,f)=>Math.atan2(c,s.data[f])),i.typeInfo);const r=i,l=s;return new N(Math.atan2(r.value,l.value),i.typeInfo)}Ceil(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.ceil(r)),i.typeInfo);const s=i;return new N(Math.ceil(s.value),i.typeInfo)}_clamp(t,e,i){return Math.min(Math.max(t,e),i)}Clamp(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(i instanceof R&&s instanceof R&&r instanceof R)return new R(i.data.map((d,p)=>this._clamp(d,s.data[p],r.data[p])),i.typeInfo);const l=i,c=s,f=r;return new N(this._clamp(l.value,c.value,f.value),i.typeInfo)}Cos(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.cos(r)),i.typeInfo);const s=i;return new N(Math.cos(s.value),i.typeInfo)}Cosh(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.cosh(r)),i.typeInfo);const s=i;return new N(Math.cos(s.value),i.typeInfo)}CountLeadingZeros(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.clz32(r)),i.typeInfo);const s=i;return new N(Math.clz32(s.value),i.typeInfo)}_countOneBits(t){let e=0;for(;t!==0;)1&t&&e++,t>>=1;return e}CountOneBits(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>this._countOneBits(r)),i.typeInfo);const s=i;return new N(this._countOneBits(s.value),i.typeInfo)}_countTrailingZeros(t){if(t===0)return 32;let e=0;for(;!(1&t);)t>>=1,e++;return e}CountTrailingZeros(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>this._countTrailingZeros(r)),i.typeInfo);const s=i;return new N(this._countTrailingZeros(s.value),i.typeInfo)}Cross(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof R&&s instanceof R){if(i.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${t.line}`),null;const r=i.data,l=s.data;return new R([r[1]*l[2]-l[1]*r[2],r[2]*l[0]-l[2]*r[0],r[0]*l[1]-l[0]*r[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${t.line}`),null}Degrees(t,e){const i=this.exec.evalExpression(t.args[0],e),s=180/Math.PI;return i instanceof R?new R(i.data.map(r=>r*s),i.typeInfo):new N(i.value*s,this.getTypeInfo("f32"))}Determinant(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof gt){const s=i.data,r=i.typeInfo.getTypeName(),l=r.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(r==="mat2x2"||r==="mat2x2f"||r==="mat2x2h")return new N(s[0]*s[3]-s[1]*s[2],l);if(r==="mat2x3"||r==="mat2x3f"||r==="mat2x3h")return new N(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),l);if(r==="mat2x4"||r==="mat2x4f"||r==="mat2x4h")console.error(`TODO: Determinant for ${r}`);else if(r==="mat3x2"||r==="mat3x2f"||r==="mat3x2h")console.error(`TODO: Determinant for ${r}`);else{if(r==="mat3x3"||r==="mat3x3f"||r==="mat3x3h")return new N(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),l);r==="mat3x4"||r==="mat3x4f"||r==="mat3x4h"||r==="mat4x2"||r==="mat4x2f"||r==="mat4x2h"||r==="mat4x3"||r==="mat4x3f"||r==="mat4x3h"?console.error(`TODO: Determinant for ${r}`):r!=="mat4x4"&&r!=="mat4x4f"&&r!=="mat4x4h"||console.error(`TODO: Determinant for ${r}`)}}return console.error(`Determinant expects a matrix argument. Line ${t.line}`),null}Distance(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof R&&s instanceof R){let c=0;for(let f=0;f<i.data.length;++f)c+=(i.data[f]-s.data[f])*(i.data[f]-s.data[f]);return new N(Math.sqrt(c),this.getTypeInfo("f32"))}const r=i,l=s;return new N(Math.abs(r.value-l.value),i.typeInfo)}_dot(t,e){let i=0;for(let s=0;s<t.length;++s)i+=e[s]*t[s];return i}Dot(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);return i instanceof R&&s instanceof R?new N(this._dot(i.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${t.line}`),null)}Dot4U8Packed(t,e){return console.error(`TODO: dot4U8Packed. Line ${t.line}`),null}Dot4I8Packed(t,e){return console.error(`TODO: dot4I8Packed. Line ${t.line}`),null}Exp(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.exp(r)),i.typeInfo);const s=i;return new N(Math.exp(s.value),i.typeInfo)}Exp2(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.pow(2,r)),i.typeInfo);const s=i;return new N(Math.pow(2,s.value),i.typeInfo)}ExtractBits(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${t.line}`),null;if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${t.line}`),null;const l=s.value,c=r.value;if(i instanceof R)return new R(i.data.map(d=>d>>l&(1<<c)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${t.line}`),null;const f=i.value;return new N(f>>l&(1<<c)-1,this.getTypeInfo("i32"))}FaceForward(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(i instanceof R&&s instanceof R&&r instanceof R){const l=this._dot(s.data,r.data);return new R(l<0?Array.from(i.data):i.data.map(c=>-c),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${t.line}`),null}_firstLeadingBit(t){return t===0?-1:31-Math.clz32(t)}FirstLeadingBit(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>this._firstLeadingBit(r)),i.typeInfo);const s=i;return new N(this._firstLeadingBit(s.value),i.typeInfo)}_firstTrailingBit(t){return t===0?-1:Math.log2(t&-t)}FirstTrailingBit(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>this._firstTrailingBit(r)),i.typeInfo);const s=i;return new N(this._firstTrailingBit(s.value),i.typeInfo)}Floor(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.floor(r)),i.typeInfo);const s=i;return new N(Math.floor(s.value),i.typeInfo)}Fma(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(i instanceof R&&s instanceof R&&r instanceof R)return i.data.length!==s.data.length||i.data.length!==r.data.length?(console.error(`Fma() expects vectors of the same length. Line ${t.line}`),null):new R(i.data.map((d,p)=>d*s.data[p]+r.data[p]),i.typeInfo);const l=i,c=s,f=r;return new N(l.value*c.value+f.value,l.typeInfo)}Fract(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>r-Math.floor(r)),i.typeInfo);const s=i;return new N(s.value-Math.floor(s.value),i.typeInfo)}Frexp(t,e){return console.error(`TODO: frexp. Line ${t.line}`),null}InsertBits(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e),l=this.exec.evalExpression(t.args[3],e);if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${t.line}`),null;const c=r.value,f=(1<<l.value)-1<<c,d=~f;if(i instanceof R&&s instanceof R)return new R(i.data.map((y,b)=>y&d|s.data[b]<<c&f),i.typeInfo);const p=i.value,_=s.value;return new N(p&d|_<<c&f,i.typeInfo)}InverseSqrt(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>1/Math.sqrt(r)),i.typeInfo);const s=i;return new N(1/Math.sqrt(s.value),i.typeInfo)}Ldexp(t,e){return console.error(`TODO: ldexp. Line ${t.line}`),null}Length(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R){let r=0;return i.data.forEach(l=>{r+=l*l}),new N(Math.sqrt(r),this.getTypeInfo("f32"))}const s=i;return new N(Math.abs(s.value),i.typeInfo)}Log(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.log(r)),i.typeInfo);const s=i;return new N(Math.log(s.value),i.typeInfo)}Log2(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.log2(r)),i.typeInfo);const s=i;return new N(Math.log2(s.value),i.typeInfo)}Max(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof R&&s instanceof R)return new R(i.data.map((c,f)=>Math.max(c,s.data[f])),i.typeInfo);const r=i,l=s;return new N(Math.max(r.value,l.value),i.typeInfo)}Min(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof R&&s instanceof R)return new R(i.data.map((c,f)=>Math.min(c,s.data[f])),i.typeInfo);const r=i,l=s;return new N(Math.min(r.value,l.value),i.typeInfo)}Mix(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(i instanceof R&&s instanceof R&&r instanceof R)return new R(i.data.map((f,d)=>i.data[d]*(1-r.data[d])+s.data[d]*r.data[d]),i.typeInfo);const l=s,c=r;return new N(i.value*(1-c.value)+l.value*c.value,i.typeInfo)}Modf(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof R&&s instanceof R)return new R(i.data.map((l,c)=>l%s.data[c]),i.typeInfo);const r=s;return new N(i.value%r.value,i.typeInfo)}Normalize(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R){const s=this.Length(t,e).value;return new R(i.data.map(r=>r/s),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${t.line}`),null}Pow(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof R&&s instanceof R)return new R(i.data.map((c,f)=>Math.pow(c,s.data[f])),i.typeInfo);const r=i,l=s;return new N(Math.pow(r.value,l.value),i.typeInfo)}QuantizeToF16(t,e){const i=this.exec.evalExpression(t.args[0],e);return i instanceof R?new R(i.data.map(s=>s),i.typeInfo):new N(i.value,i.typeInfo)}Radians(t,e){const i=this.exec.evalExpression(t.args[0],e);return i instanceof R?new R(i.data.map(s=>s*Math.PI/180),i.typeInfo):new N(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(t,e){let i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof R&&s instanceof R){const r=this._dot(i.data,s.data);return new R(i.data.map((l,c)=>l-2*r*s.data[c]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${t.line}`),null}Refract(t,e){let i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(i instanceof R&&s instanceof R&&r instanceof N){const l=this._dot(s.data,i.data);return new R(i.data.map((c,f)=>{const d=1-r.value*r.value*(1-l*l);if(d<0)return 0;const p=Math.sqrt(d);return r.value*c-(r.value*l+p)*s.data[f]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${t.line}`),null}ReverseBits(t,e){return console.error(`TODO: reverseBits. Line ${t.line}`),null}Round(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.round(r)),i.typeInfo);const s=i;return new N(Math.round(s.value),i.typeInfo)}Saturate(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.min(Math.max(r,0),1)),i.typeInfo);const s=i;return new N(Math.min(Math.max(s.value,0),1),i.typeInfo)}Sign(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.sign(r)),i.typeInfo);const s=i;return new N(Math.sign(s.value),i.typeInfo)}Sin(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.sin(r)),i.typeInfo);const s=i;return new N(Math.sin(s.value),i.typeInfo)}Sinh(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.sinh(r)),i.typeInfo);const s=i;return new N(Math.sinh(s.value),i.typeInfo)}_smoothstep(t,e,i){const s=Math.min(Math.max((i-t)/(e-t),0),1);return s*s*(3-2*s)}SmoothStep(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(r instanceof R&&i instanceof R&&s instanceof R)return new R(r.data.map((d,p)=>this._smoothstep(i.data[p],s.data[p],d)),r.typeInfo);const l=i,c=s,f=r;return new N(this._smoothstep(l.value,c.value,f.value),r.typeInfo)}Sqrt(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.sqrt(r)),i.typeInfo);const s=i;return new N(Math.sqrt(s.value),i.typeInfo)}Step(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(s instanceof R&&i instanceof R)return new R(s.data.map((l,c)=>l<i.data[c]?0:1),s.typeInfo);const r=i;return new N(s.value<r.value?0:1,r.typeInfo)}Tan(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.tan(r)),i.typeInfo);const s=i;return new N(Math.tan(s.value),i.typeInfo)}Tanh(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.tanh(r)),i.typeInfo);const s=i;return new N(Math.tanh(s.value),i.typeInfo)}_getTransposeType(t){const e=t.getTypeName();return e==="mat2x2f"||e==="mat2x2h"?t:e==="mat2x3f"?this.getTypeInfo("mat3x2f"):e==="mat2x3h"?this.getTypeInfo("mat3x2h"):e==="mat2x4f"?this.getTypeInfo("mat4x2f"):e==="mat2x4h"?this.getTypeInfo("mat4x2h"):e==="mat3x2f"?this.getTypeInfo("mat2x3f"):e==="mat3x2h"?this.getTypeInfo("mat2x3h"):e==="mat3x3f"||e==="mat3x3h"?t:e==="mat3x4f"?this.getTypeInfo("mat4x3f"):e==="mat3x4h"?this.getTypeInfo("mat4x3h"):e==="mat4x2f"?this.getTypeInfo("mat2x4f"):e==="mat4x2h"?this.getTypeInfo("mat2x4h"):e==="mat4x3f"?this.getTypeInfo("mat3x4f"):e==="mat4x3h"?this.getTypeInfo("mat3x4h"):(e==="mat4x4f"||e==="mat4x4h"||console.error(`Invalid matrix type ${e}`),t)}Transpose(t,e){const i=this.exec.evalExpression(t.args[0],e);if(!(i instanceof gt))return console.error(`Transpose() expects a matrix argument. Line ${t.line}`),null;const s=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){const r=i.data;return new gt([r[0],r[2],r[1],r[3]],s)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){const r=i.data;return new gt([r[0],r[3],r[6],r[1],r[4],r[7]],s)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){const r=i.data;return new gt([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13]],s)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){const r=i.data;return new gt([r[0],r[3],r[1],r[4],r[2],r[5]],s)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){const r=i.data;return new gt([r[0],r[3],r[6],r[1],r[4],r[7],r[2],r[5],r[8]],s)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){const r=i.data;return new gt([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14]],s)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){const r=i.data;return new gt([r[0],r[4],r[1],r[5],r[2],r[6]],s)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){const r=i.data;return new gt([r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10]],s)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){const r=i.data;return new gt([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],r[15]],s)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof R)return new R(i.data.map(r=>Math.trunc(r)),i.typeInfo);const s=i;return new N(Math.trunc(s.value),i.typeInfo)}Dpdx(t,e){return console.error(`TODO: dpdx. Line ${t.line}`),null}DpdxCoarse(t,e){return console.error(`TODO: dpdxCoarse. Line ${t.line}`),null}DpdxFine(t,e){return console.error("TODO: dpdxFine"),null}Dpdy(t,e){return console.error("TODO: dpdy"),null}DpdyCoarse(t,e){return console.error("TODO: dpdyCoarse"),null}DpdyFine(t,e){return console.error("TODO: dpdyFine"),null}Fwidth(t,e){return console.error("TODO: fwidth"),null}FwidthCoarse(t,e){return console.error("TODO: fwidthCoarse"),null}FwidthFine(t,e){return console.error("TODO: fwidthFine"),null}TextureDimensions(t,e){const i=t.args[0],s=t.args.length>1?this.exec.evalExpression(t.args[1],e).value:0;if(i instanceof pn){const r=i.name,l=e.getVariableValue(r);if(l instanceof Mi){if(s<0||s>=l.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${t.line}`),null;const c=l.getMipLevelSize(s),f=l.dimension;return f==="1d"?new N(c[0],this.getTypeInfo("u32")):f==="3d"?new R(c,this.getTypeInfo("vec3u")):f==="2d"?new R(c.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${f} not found. Line ${t.line}`),null)}return console.error(`Texture ${r} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${t.line}`),null}TextureGather(t,e){return console.error("TODO: textureGather"),null}TextureGatherCompare(t,e){return console.error("TODO: textureGatherCompare"),null}TextureLoad(t,e){const i=t.args[0],s=this.exec.evalExpression(t.args[1],e),r=t.args.length>2?this.exec.evalExpression(t.args[2],e).value:0;if(!(s instanceof R)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${t.line}`),null;if(i instanceof pn){const l=i.name,c=e.getVariableValue(l);if(c instanceof Mi){const f=Math.floor(s.data[0]),d=Math.floor(s.data[1]);if(f<0||f>=c.width||d<0||d>=c.height)return console.error(`Texture ${l} out of bounds. Line ${t.line}`),null;const p=c.getPixel(f,d,0,r);return p===null?(console.error(`Invalid texture format for textureLoad. Line ${t.line}`),null):new R(p,this.getTypeInfo("vec4f"))}return console.error(`Texture ${l} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${t.line}`),null}TextureNumLayers(t,e){const i=t.args[0];if(i instanceof pn){const s=i.name,r=e.getVariableValue(s);return r instanceof Mi?new N(r.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${t.line}`),null}TextureNumLevels(t,e){const i=t.args[0];if(i instanceof pn){const s=i.name,r=e.getVariableValue(s);return r instanceof Mi?new N(r.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${t.line}`),null}TextureNumSamples(t,e){const i=t.args[0];if(i instanceof pn){const s=i.name,r=e.getVariableValue(s);return r instanceof Mi?new N(r.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${t.line}`),null}TextureSample(t,e){return console.error("TODO: textureSample"),null}TextureSampleBias(t,e){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(t,e){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(t,e){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(t,e){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(t,e){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(t,e){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(t,e){const i=t.args[0],s=this.exec.evalExpression(t.args[1],e),r=t.args.length===4?this.exec.evalExpression(t.args[2],e).value:0,l=t.args.length===4?this.exec.evalExpression(t.args[3],e).data:this.exec.evalExpression(t.args[2],e).data;if(l.length!==4)return console.error(`Invalid value argument for textureStore. Line ${t.line}`),null;if(!(s instanceof R)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${t.line}`),null;if(i instanceof pn){const c=i.name,f=e.getVariableValue(c);if(f instanceof Mi){const d=f.getMipLevelSize(0),p=Math.floor(s.data[0]),_=Math.floor(s.data[1]);return p<0||p>=d[0]||_<0||_>=d[1]?(console.error(`Texture ${c} out of bounds. Line ${t.line}`),null):(f.setPixel(p,_,0,r,Array.from(l)),null)}return console.error(`Texture ${c} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${t.line}`),null}AtomicLoad(t,e){let i=t.args[0];i instanceof ye&&(i=i.right);const s=this.exec.getVariableName(i,e);return e.getVariable(s).value.getSubData(this.exec,i.postfix,e)}AtomicStore(t,e){let i=t.args[0];i instanceof ye&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let l=t.args[1];const c=this.exec.evalExpression(l,e),f=r.value.getSubData(this.exec,i.postfix,e);return f instanceof N&&c instanceof N&&(f.value=c.value),r.value instanceof le&&r.value.setDataValue(this.exec,f,i.postfix,e),null}AtomicAdd(t,e){let i=t.args[0];i instanceof ye&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let l=t.args[1];const c=this.exec.evalExpression(l,e),f=r.value.getSubData(this.exec,i.postfix,e),d=new N(f.value,f.typeInfo);return f instanceof N&&c instanceof N&&(f.value+=c.value),r.value instanceof le&&r.value.setDataValue(this.exec,f,i.postfix,e),d}AtomicSub(t,e){let i=t.args[0];i instanceof ye&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let l=t.args[1];const c=this.exec.evalExpression(l,e),f=r.value.getSubData(this.exec,i.postfix,e),d=new N(f.value,f.typeInfo);return f instanceof N&&c instanceof N&&(f.value-=c.value),r.value instanceof le&&r.value.setDataValue(this.exec,f,i.postfix,e),d}AtomicMax(t,e){let i=t.args[0];i instanceof ye&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let l=t.args[1];const c=this.exec.evalExpression(l,e),f=r.value.getSubData(this.exec,i.postfix,e),d=new N(f.value,f.typeInfo);return f instanceof N&&c instanceof N&&(f.value=Math.max(f.value,c.value)),r.value instanceof le&&r.value.setDataValue(this.exec,f,i.postfix,e),d}AtomicMin(t,e){let i=t.args[0];i instanceof ye&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let l=t.args[1];const c=this.exec.evalExpression(l,e),f=r.value.getSubData(this.exec,i.postfix,e),d=new N(f.value,f.typeInfo);return f instanceof N&&c instanceof N&&(f.value=Math.min(f.value,c.value)),r.value instanceof le&&r.value.setDataValue(this.exec,f,i.postfix,e),d}AtomicAnd(t,e){let i=t.args[0];i instanceof ye&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let l=t.args[1];const c=this.exec.evalExpression(l,e),f=r.value.getSubData(this.exec,i.postfix,e),d=new N(f.value,f.typeInfo);return f instanceof N&&c instanceof N&&(f.value=f.value&c.value),r.value instanceof le&&r.value.setDataValue(this.exec,f,i.postfix,e),d}AtomicOr(t,e){let i=t.args[0];i instanceof ye&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let l=t.args[1];const c=this.exec.evalExpression(l,e),f=r.value.getSubData(this.exec,i.postfix,e),d=new N(f.value,f.typeInfo);return f instanceof N&&c instanceof N&&(f.value=f.value|c.value),r.value instanceof le&&r.value.setDataValue(this.exec,f,i.postfix,e),d}AtomicXor(t,e){let i=t.args[0];i instanceof ye&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let l=t.args[1];const c=this.exec.evalExpression(l,e),f=r.value.getSubData(this.exec,i.postfix,e),d=new N(f.value,f.typeInfo);return f instanceof N&&c instanceof N&&(f.value=f.value^c.value),r.value instanceof le&&r.value.setDataValue(this.exec,f,i.postfix,e),d}AtomicExchange(t,e){let i=t.args[0];i instanceof ye&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let l=t.args[1];const c=this.exec.evalExpression(l,e),f=r.value.getSubData(this.exec,i.postfix,e),d=new N(f.value,f.typeInfo);return f instanceof N&&c instanceof N&&(f.value=c.value),r.value instanceof le&&r.value.setDataValue(this.exec,f,i.postfix,e),d}AtomicCompareExchangeWeak(t,e){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(t,e){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(t,e){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(t,e){return console.error("TODO: pack4xI8"),null}Pack4xU8(t,e){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(t,e){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(t,e){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(t,e){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(t,e){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(t,e){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(t,e){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(t,e){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(t,e){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(t,e){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(t,e){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(t,e){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(t,e){return console.error("TODO: unpack2x16float"),null}StorageBarrier(t,e){return null}TextureBarrier(t,e){return null}WorkgroupBarrier(t,e){return null}WorkgroupUniformLoad(t,e){return null}SubgroupAdd(t,e){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(t,e){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(t,e){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(t,e){return console.error("TODO: subgroupAll"),null}SubgroupAnd(t,e){return console.error("TODO: subgroupAnd"),null}SubgroupAny(t,e){return console.error("TODO: subgroupAny"),null}SubgroupBallot(t,e){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(t,e){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(t,e){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(t,e){return console.error("TODO: subgroupElect"),null}SubgroupMax(t,e){return console.error("TODO: subgroupMax"),null}SubgroupMin(t,e){return console.error("TODO: subgroupMin"),null}SubgroupMul(t,e){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(t,e){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(t,e){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(t,e){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(t,e){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(t,e){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(t,e){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(t,e){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(t,e){return console.error("TODO: subgroupXor"),null}QuadBroadcast(t,e){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(t,e){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(t,e){return console.error("TODO: quadSwapX"),null}QuadSwapY(t,e){return console.error("TODO: quadSwapY"),null}}const tp={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},je={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Fe extends yO{constructor(t,e){var i;super(),this.ast=t??[],this.reflection=new ni,this.reflection.updateAST(this.ast),this.context=(i=e?.clone())!==null&&i!==void 0?i:new qg,this.builtins=new bO(this),this.typeInfo={bool:this.getTypeInfo(J.bool),i32:this.getTypeInfo(J.i32),u32:this.getTypeInfo(J.u32),f32:this.getTypeInfo(J.f32),f16:this.getTypeInfo(J.f16),vec2f:this.getTypeInfo(L.vec2f),vec2u:this.getTypeInfo(L.vec2u),vec2i:this.getTypeInfo(L.vec2i),vec2h:this.getTypeInfo(L.vec2h),vec3f:this.getTypeInfo(L.vec3f),vec3u:this.getTypeInfo(L.vec3u),vec3i:this.getTypeInfo(L.vec3i),vec3h:this.getTypeInfo(L.vec3h),vec4f:this.getTypeInfo(L.vec4f),vec4u:this.getTypeInfo(L.vec4u),vec4i:this.getTypeInfo(L.vec4i),vec4h:this.getTypeInfo(L.vec4h),mat2x2f:this.getTypeInfo(L.mat2x2f),mat2x3f:this.getTypeInfo(L.mat2x3f),mat2x4f:this.getTypeInfo(L.mat2x4f),mat3x2f:this.getTypeInfo(L.mat3x2f),mat3x3f:this.getTypeInfo(L.mat3x3f),mat3x4f:this.getTypeInfo(L.mat3x4f),mat4x2f:this.getTypeInfo(L.mat4x2f),mat4x3f:this.getTypeInfo(L.mat4x3f),mat4x4f:this.getTypeInfo(L.mat4x4f)}}getVariableValue(t){var e,i;const s=(i=(e=this.context.getVariable(t))===null||e===void 0?void 0:e.value)!==null&&i!==void 0?i:null;if(s===null)return null;if(s instanceof N)return s.value;if(s instanceof R||s instanceof gt)return Array.from(s.data);if(s instanceof le&&s.typeInfo instanceof gs){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(t){(t=t??{}).constants&&this._setOverrides(t.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(t,e,i,s){const r=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,r),this._execStatements(this.ast,r);const l=r.getFunction(t);if(!l)return void console.error(`Function ${t} not found`);if(typeof e=="number")e=[e,1,1];else{if(e.length===0)return void console.error("Invalid dispatch count");e.length===1?e=[e[0],1,1]:e.length===2?e=[e[0],e[1],1]:e.length>3&&(e=[e[0],e[1],e[2]])}const c=e[0],f=e[1],d=e[2],p=this.getTypeInfo("vec3u");r.setVariable("@num_workgroups",new R(e,p));const _=this.reflection.getFunctionInfo(t);_===null&&console.error(`Function ${t} not found in reflection data`);for(const y in i)for(const b in i[y]){const x=i[y][b];r.variables.forEach(T=>{var A;const E=T.node;if(E?.attributes){let D=null,C=null;for(const O of E.attributes)O.name==="binding"?D=O.value:O.name==="group"&&(C=O.value);if(b==D&&y==C){let O=!1;for(const k of _.resources)if(k.name===T.name&&k.group===parseInt(y)&&k.binding===parseInt(b)){O=!0;break}if(O)if(x.texture!==void 0&&x.descriptor!==void 0){const k=new Mi(x.texture,this.getTypeInfo(E.type),x.descriptor,(A=x.texture.view)!==null&&A!==void 0?A:null);T.value=k}else x.uniform!==void 0?T.value=new le(x.uniform,this.getTypeInfo(E.type)):T.value=new le(x,this.getTypeInfo(E.type))}}})}for(let y=0;y<d;++y)for(let b=0;b<f;++b)for(let x=0;x<c;++x)r.setVariable("@workgroup_id",new R([x,b,y],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(l,[x,b,y],r)}execStatement(t,e){if(t instanceof i2)return this.evalExpression(t.value,e);if(t instanceof r2){if(t.condition){const i=this.evalExpression(t.condition,e);if(!(i instanceof N))throw new Error("Invalid break-if condition");if(!i.value)return null}return Fe._breakObj}if(t instanceof a2)return Fe._continueObj;if(t instanceof Ko)this._let(t,e);else if(t instanceof Ii)this._var(t,e);else if(t instanceof yu)this._const(t,e);else if(t instanceof al)this._function(t,e);else{if(t instanceof n2)return this._if(t,e);if(t instanceof e2)return this._switch(t,e);if(t instanceof Q1)return this._for(t,e);if(t instanceof Z1)return this._while(t,e);if(t instanceof t2)return this._loop(t,e);if(t instanceof Hp){const i=e.clone();return i.currentFunctionName=e.currentFunctionName,this._execStatements(t.body,i)}if(t instanceof J1)this._assign(t,e);else if(t instanceof G1)this._increment(t,e);else{if(t instanceof Ci)return null;if(t instanceof Vg){const i=t.name;e.getVariable(i)===null&&e.setVariable(i,new N(0,this.getTypeInfo("u32")))}else if(t instanceof Hg)this._call(t,e);else{if(t instanceof s2||t instanceof jg)return null;console.error("Invalid statement type.",t,`Line ${t.line}`)}}}return null}evalExpression(t,e){return t instanceof Vn?this._evalBinaryOp(t,e):t instanceof xe?this._evalLiteral(t,e):t instanceof pn?this._evalVariable(t,e):t instanceof Wg?this._evalCall(t,e):t instanceof ti?this._evalCreate(t,e):t instanceof o2?this._evalConst(t,e):t instanceof l2?this._evalBitcast(t,e):t instanceof ye?this._evalUnaryOp(t,e):(console.error("Invalid expression type",t,`Line ${t.line}`),null)}getTypeInfo(t){var e;if(t instanceof J){const s=this.reflection.getTypeInfo(t);if(s!==null)return s}let i=(e=this.typeInfo[t])!==null&&e!==void 0?e:null;return i!==null||(i=this.reflection.getTypeInfoByName(t)),i}_setOverrides(t,e){for(const i in t){const s=t[i],r=this.reflection.getOverrideInfo(i);r!==null?(r.type===null&&(r.type=this.getTypeInfo("u32")),r.type.name==="u32"||r.type.name==="i32"||r.type.name==="f32"||r.type.name==="f16"?e.setVariable(i,new N(s,r.type)):r.type.name==="bool"?e.setVariable(i,new N(s?1:0,r.type)):r.type.name==="vec2"||r.type.name==="vec3"||r.type.name==="vec4"||r.type.name==="vec2f"||r.type.name==="vec3f"||r.type.name==="vec4f"||r.type.name==="vec2i"||r.type.name==="vec3i"||r.type.name==="vec4i"||r.type.name==="vec2u"||r.type.name==="vec3u"||r.type.name==="vec4u"||r.type.name==="vec2h"||r.type.name==="vec3h"||r.type.name==="vec4h"?e.setVariable(i,new R(s,r.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(t,e,i){const s=[1,1,1];for(const p of t.node.attributes)if(p.name==="workgroup_size"){if(p.value.length>0){const _=i.getVariableValue(p.value[0]);s[0]=_ instanceof N?_.value:parseInt(p.value[0])}if(p.value.length>1){const _=i.getVariableValue(p.value[1]);s[1]=_ instanceof N?_.value:parseInt(p.value[1])}if(p.value.length>2){const _=i.getVariableValue(p.value[2]);s[2]=_ instanceof N?_.value:parseInt(p.value[2])}}const r=this.getTypeInfo("vec3u"),l=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new R(s,r));const c=s[0],f=s[1],d=s[2];for(let p=0,_=0;p<d;++p)for(let y=0;y<f;++y)for(let b=0;b<c;++b,++_){const x=[b,y,p],T=[b+e[0]*s[0],y+e[1]*s[1],p+e[2]*s[2]];i.setVariable("@local_invocation_id",new R(x,r)),i.setVariable("@global_invocation_id",new R(T,r)),i.setVariable("@local_invocation_index",new N(_,l)),this._dispatchExec(t,i)}}_dispatchExec(t,e){for(const i of t.node.args)for(const s of i.attributes)if(s.name==="builtin"){const r=`@${s.value}`,l=e.getVariable(r);l!==void 0&&e.variables.set(i.name,l)}this._execStatements(t.node.body,e)}getVariableName(t,e){for(;t instanceof ye;)t=t.right;return t instanceof pn?t.name:(console.error("Unknown variable type",t,"Line",t.line),null)}_execStatements(t,e){for(const i of t){if(i instanceof Array){const r=e.clone(),l=this._execStatements(i,r);if(l)return l;continue}const s=this.execStatement(i,e);if(s)return s}return null}_call(t,e){const i=e.clone();i.currentFunctionName=t.name;const s=e.getFunction(t.name);if(s){for(let r=0;r<s.node.args.length;++r){const l=s.node.args[r],c=this.evalExpression(t.args[r],i);i.setVariable(l.name,c,l)}this._execStatements(s.node.body,i)}else t.isBuiltin?this._callBuiltinFunction(t,i):this.getTypeInfo(t.name)&&this._evalCreate(t,e)}_increment(t,e){const i=this.getVariableName(t.variable,e),s=e.getVariable(i);s?t.operator==="++"?s.value instanceof N?s.value.value++:console.error(`Variable ${i} is not a scalar. Line ${t.line}`):t.operator==="--"?s.value instanceof N?s.value.value--:console.error(`Variable ${i} is not a scalar. Line ${t.line}`):console.error(`Unknown increment operator ${t.operator}. Line ${t.line}`):console.error(`Variable ${i} not found. Line ${t.line}`)}_getVariableData(t,e){if(t instanceof pn){const i=this.getVariableName(t,e),s=e.getVariable(i);return s===null?(console.error(`Variable ${i} not found. Line ${t.line}`),null):s.value.getSubData(this,t.postfix,e)}if(t instanceof ye){if(t.operator==="*"){const i=this._getVariableData(t.right,e);return i instanceof ia?i.reference.getSubData(this,t.postfix,e):(console.error(`Variable ${t.right} is not a pointer. Line ${t.line}`),null)}if(t.operator==="&"){const i=this._getVariableData(t.right,e);return new ia(i)}}return null}_assign(t,e){let i=null,s="<var>",r=null;if(t.variable instanceof ye){const f=this._getVariableData(t.variable,e),d=this.evalExpression(t.value,e),p=t.operator;if(p==="="){if(f instanceof N||f instanceof R||f instanceof gt){if(d instanceof N||d instanceof R||d instanceof gt&&f.data.length===d.data.length)return void f.data.set(d.data);console.error(`Invalid assignment. Line ${t.line}`)}else if(f instanceof le&&d instanceof le&&f.buffer.byteLength-f.offset>=d.buffer.byteLength-d.offset)return void(f.buffer.byteLength%4==0?new Uint32Array(f.buffer,f.offset,f.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(f.buffer,f.offset,f.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${t.line}`),null}if(p==="+=")return f instanceof N||f instanceof R||f instanceof gt?d instanceof N||d instanceof R||d instanceof gt?void f.data.set(d.data.map((_,y)=>f.data[y]+_)):void console.error(`Invalid assignment . Line ${t.line}`):void console.error(`Invalid assignment. Line ${t.line}`);if(p==="-=")return(f instanceof N||f instanceof R||f instanceof gt)&&(d instanceof N||d instanceof R||d instanceof gt)?void f.data.set(d.data.map((_,y)=>f.data[y]-_)):void console.error(`Invalid assignment. Line ${t.line}`)}if(t.variable instanceof ye){if(t.variable.operator==="*"){s=this.getVariableName(t.variable.right,e);const f=e.getVariable(s);if(!(f&&f.value instanceof ia))return void console.error(`Variable ${s} is not a pointer. Line ${t.line}`);i=f.value.reference;let d=t.variable.postfix;if(!d){let p=t.variable.right;for(;p instanceof ye;){if(p.postfix){d=p.postfix;break}p=p.right}}d&&(i=i.getSubData(this,d,e))}}else{r=t.variable.postfix,s=this.getVariableName(t.variable,e);const f=e.getVariable(s);if(f===null)return void console.error(`Variable ${s} not found. Line ${t.line}`);i=f.value}if(i instanceof ia&&(i=i.reference),i===null)return void console.error(`Variable ${s} not found. Line ${t.line}`);const l=this.evalExpression(t.value,e),c=t.operator;if(c!=="="){const f=i.getSubData(this,r,e);if(f instanceof R&&l instanceof N){const d=f.data,p=l.value;if(c==="+=")for(let _=0;_<d.length;++_)d[_]+=p;else if(c==="-=")for(let _=0;_<d.length;++_)d[_]-=p;else if(c==="*=")for(let _=0;_<d.length;++_)d[_]*=p;else if(c==="/=")for(let _=0;_<d.length;++_)d[_]/=p;else if(c==="%=")for(let _=0;_<d.length;++_)d[_]%=p;else if(c==="&=")for(let _=0;_<d.length;++_)d[_]&=p;else if(c==="|=")for(let _=0;_<d.length;++_)d[_]|=p;else if(c==="^=")for(let _=0;_<d.length;++_)d[_]^=p;else if(c==="<<=")for(let _=0;_<d.length;++_)d[_]<<=p;else if(c===">>=")for(let _=0;_<d.length;++_)d[_]>>=p;else console.error(`Invalid operator ${c}. Line ${t.line}`)}else if(f instanceof R&&l instanceof R){const d=f.data,p=l.data;if(d.length!==p.length)return void console.error(`Vector length mismatch. Line ${t.line}`);if(c==="+=")for(let _=0;_<d.length;++_)d[_]+=p[_];else if(c==="-=")for(let _=0;_<d.length;++_)d[_]-=p[_];else if(c==="*=")for(let _=0;_<d.length;++_)d[_]*=p[_];else if(c==="/=")for(let _=0;_<d.length;++_)d[_]/=p[_];else if(c==="%=")for(let _=0;_<d.length;++_)d[_]%=p[_];else if(c==="&=")for(let _=0;_<d.length;++_)d[_]&=p[_];else if(c==="|=")for(let _=0;_<d.length;++_)d[_]|=p[_];else if(c==="^=")for(let _=0;_<d.length;++_)d[_]^=p[_];else if(c==="<<=")for(let _=0;_<d.length;++_)d[_]<<=p[_];else if(c===">>=")for(let _=0;_<d.length;++_)d[_]>>=p[_];else console.error(`Invalid operator ${c}. Line ${t.line}`)}else{if(!(f instanceof N&&l instanceof N))return void console.error(`Invalid type for ${t.operator} operator. Line ${t.line}`);c==="+="?f.value+=l.value:c==="-="?f.value-=l.value:c==="*="?f.value*=l.value:c==="/="?f.value/=l.value:c==="%="?f.value%=l.value:c==="&="?f.value&=l.value:c==="|="?f.value|=l.value:c==="^="?f.value^=l.value:c==="<<="?f.value<<=l.value:c===">>="?f.value>>=l.value:console.error(`Invalid operator ${c}. Line ${t.line}`)}return void(i instanceof le&&i.setDataValue(this,f,r,e))}if(i instanceof le)i.setDataValue(this,l,r,e);else if(r){if(!(i instanceof R||i instanceof gt))return void console.error(`Variable ${s} is not a vector or matrix. Line ${t.line}`);if(r instanceof ma){const f=this.evalExpression(r.index,e).value;if(i instanceof R){if(!(l instanceof N))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[f]=l.value}else{if(!(i instanceof gt))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);{const d=this.evalExpression(r.index,e).value;if(d<0)return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);if(!(l instanceof R))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);{const p=i.typeInfo.getTypeName();if(p==="mat2x2"||p==="mat2x2f"||p==="mat2x2h"){if(!(d<2&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat2x3"||p==="mat2x3f"||p==="mat2x3h"){if(!(d<2&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else if(p==="mat2x4"||p==="mat2x4f"||p==="mat2x4h"){if(!(d<2&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}else if(p==="mat3x2"||p==="mat3x2f"||p==="mat3x2h"){if(!(d<3&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat3x3"||p==="mat3x3f"||p==="mat3x3h"){if(!(d<3&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else if(p==="mat3x4"||p==="mat3x4f"||p==="mat3x4h"){if(!(d<3&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}else if(p==="mat4x2"||p==="mat4x2f"||p==="mat4x2h"){if(!(d<4&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat4x3"||p==="mat4x3f"||p==="mat4x3h"){if(!(d<4&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else{if(p!=="mat4x4"&&p!=="mat4x4f"&&p!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);if(!(d<4&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}}}}}else if(r instanceof or){const f=r.value;if(!(i instanceof R))return void console.error(`Invalid assignment to ${f}. Variable ${s} is not a vector. Line ${t.line}`);if(l instanceof N){if(f.length>1)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${t.line}`);if(f==="x")i.data[0]=l.value;else if(f==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${t.line}`);i.data[1]=l.value}else if(f==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${t.line}`);i.data[2]=l.value}else if(f==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${t.line}`);i.data[3]=l.value}}else{if(!(l instanceof R))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);if(f.length!==l.data.length)return void console.error(`Invalid assignment to ${f} for variable ${s}. Line ${t.line}`);for(let d=0;d<f.length;++d){const p=f[d];if(p==="x"||p==="r")i.data[0]=l.data[d];else if(p==="y"||p==="g"){if(l.data.length<2)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${t.line}`);i.data[1]=l.data[d]}else if(p==="z"||p==="b"){if(l.data.length<3)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${t.line}`);i.data[2]=l.data[d]}else{if(p!=="w"&&p!=="a")return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${t.line}`);if(l.data.length<4)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${t.line}`);i.data[3]=l.data[d]}}}}}else i instanceof N&&l instanceof N?i.value=l.value:i instanceof R&&l instanceof R||i instanceof gt&&l instanceof gt?i.data.set(l.data):console.error(`Invalid assignment to ${s}. Line ${t.line}`)}_function(t,e){const i=new Yg(t);e.functions.set(t.name,i)}_const(t,e){let i=null;t.value!==null&&(i=this.evalExpression(t.value,e)),e.createVariable(t.name,i,t)}_let(t,e){let i=null;if(t.value!==null){if(i=this.evalExpression(t.value,e),i===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof ye||(i=i.clone())}else{const s=t.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const r=new ti(t.type,[]);i=this._evalCreate(r,e)}}e.createVariable(t.name,i,t)}_var(t,e){let i=null;if(t.value!==null){if(i=this.evalExpression(t.value,e),i===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof ye||(i=i.clone())}else{if(t.type===null)return void console.error(`Variable ${t.name} has no type. Line ${t.line}`);const s=t.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||t.type instanceof Zo||t.type instanceof Ci||t.type instanceof L){const r=new ti(t.type,[]);i=this._evalCreate(r,e)}}e.createVariable(t.name,i,t)}_switch(t,e){e=e.clone();const i=this.evalExpression(t.condition,e);if(!(i instanceof N))return console.error(`Invalid if condition. Line ${t.line}`),null;let s=null;for(const r of t.cases)if(r instanceof f2)for(const l of r.selectors){if(l instanceof vu){s=r;continue}const c=this.evalExpression(l,e);if(!(c instanceof N))return console.error(`Invalid case selector. Line ${t.line}`),null;if(c.value===i.value)return this._execStatements(r.body,e)}else r instanceof h2&&(s=r);return s?this._execStatements(s.body,e):null}_if(t,e){e=e.clone();const i=this.evalExpression(t.condition,e);if(!(i instanceof N))return console.error(`Invalid if condition. Line ${t.line}`),null;if(i.value)return this._execStatements(t.body,e);for(const s of t.elseif){const r=this.evalExpression(s.condition,e);if(!(r instanceof N))return console.error(`Invalid if condition. Line ${t.line}`),null;if(r.value)return this._execStatements(s.body,e)}return t.else?this._execStatements(t.else,e):null}_getScalarValue(t){return t instanceof N?t.value:(console.error("Expected scalar value.",t),0)}_for(t,e){for(e=e.clone(),this.execStatement(t.init,e);this._getScalarValue(this.evalExpression(t.condition,e));){const i=this._execStatements(t.body,e);if(i===Fe._breakObj)break;if(i!==null&&i!==Fe._continueObj)return i;this.execStatement(t.increment,e)}return null}_loop(t,e){for(e=e.clone();;){const i=this._execStatements(t.body,e);if(i===Fe._breakObj)break;if(i===Fe._continueObj){if(t.continuing&&this._execStatements(t.continuing.body,e)===Fe._breakObj)break}else if(i!==null)return i}return null}_while(t,e){for(e=e.clone();this._getScalarValue(this.evalExpression(t.condition,e));){const i=this._execStatements(t.body,e);if(i===Fe._breakObj)break;if(i!==Fe._continueObj&&i!==null)return i}return null}_evalBitcast(t,e){const i=this.evalExpression(t.value,e),s=t.type;if(i instanceof N){const r=Ev(i.value,i.typeInfo.name,s.name);return new N(r,this.getTypeInfo(s))}if(i instanceof R){const r=i.typeInfo.getTypeName();let l="";if(r.endsWith("f"))l="f32";else if(r.endsWith("i"))l="i32";else if(r.endsWith("u"))l="u32";else if(r.endsWith("b"))l="bool";else{if(!r.endsWith("h"))return console.error(`Unknown vector type ${r}. Line ${t.line}`),null;l="f16"}const c=s.getTypeName();let f="";if(c.endsWith("f"))f="f32";else if(c.endsWith("i"))f="i32";else if(c.endsWith("u"))f="u32";else if(c.endsWith("b"))f="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${f}. Line ${t.line}`),null;f="f16"}const d=(function(p,_,y){if(_===y)return p;const b=new Array(p.length);for(let x=0;x<p.length;x++)b[x]=Ev(p[x],_,y);return b})(Array.from(i.data),l,f);return new R(d,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${t.line}`),null}_evalConst(t,e){return e.getVariableValue(t.name).clone().getSubData(this,t.postfix,e)}_evalCreate(t,e){var i;if(t instanceof ti){if(t.type===null)return jp.void;switch(t.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(t,e);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(t,e);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(t,e)}}const s=t instanceof ti?t.type.name:t.name,r=t instanceof ti?this.getTypeInfo(t.type):this.getTypeInfo(t.name);if(r===null)return console.error(`Unknown type ${s}. Line ${t.line}`),null;if(r.size===0)return null;const l=new le(new ArrayBuffer(r.size),r,0);if(r instanceof us){if(t.args)for(let c=0;c<t.args.length;++c){const f=r.members[c],d=t.args[c],p=this.evalExpression(d,e);l.setData(this,p,f.type,f.offset,e)}}else if(r instanceof gs){let c=0;if(t.args)for(let f=0;f<t.args.length;++f){const d=t.args[f],p=this.evalExpression(d,e);r.format===null&&(((i=p.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?r.format=this.getTypeInfo("i32"):r.format=p.typeInfo),l.setData(this,p,r.format,c,e),c+=r.stride}}else console.error(`Unknown type "${s}". Line ${t.line}`);return t instanceof ti?l.getSubData(this,t.postfix,e):l}_evalLiteral(t,e){const i=this.getTypeInfo(t.type),s=i.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new N(t.scalarValue,i):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(t,e):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(t,e):t.value}_evalVariable(t,e){const i=e.getVariableValue(t.name);return i===null?i:i.getSubData(this,t.postfix,e)}_maxFormatTypeInfo(t){let e=t[0];if(e.name==="f32")return e;for(let i=1;i<t.length;++i){const s=Fe._priority.get(e.name);Fe._priority.get(t[i].name)<s&&(e=t[i])}return e.name==="x32"?this.getTypeInfo("i32"):e}_evalUnaryOp(t,e){const i=this.evalExpression(t.right,e);if(t.operator==="&")return new ia(i);if(t.operator==="*")return i instanceof ia?i.reference.getSubData(this,t.postfix,e):(console.error(`Invalid dereference. Line ${t.line}`),null);const s=i instanceof N?i.value:i instanceof R?Array.from(i.data):null;switch(t.operator){case"+":{if(rt(s)){const c=s.map((f,d)=>+f);return new R(c,i.typeInfo)}const r=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new N(+r,l)}case"-":{if(rt(s)){const c=s.map((f,d)=>-f);return new R(c,i.typeInfo)}const r=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new N(-r,l)}case"!":{if(rt(s)){const c=s.map((f,d)=>f?0:1);return new R(c,i.typeInfo)}const r=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new N(r?0:1,l)}case"~":{if(rt(s)){const c=s.map((f,d)=>~f);return new R(c,i.typeInfo)}const r=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new N(~r,l)}}return console.error(`Invalid unary operator ${t.operator}. Line ${t.line}`),null}_evalBinaryOp(t,e){const i=this.evalExpression(t.left,e),s=this.evalExpression(t.right,e),r=i instanceof N?i.value:i instanceof R||i instanceof gt?Array.from(i.data):null,l=s instanceof N?s.value:s instanceof R||s instanceof gt?Array.from(s.data):null;switch(t.operator){case"+":{if(rt(r)&&rt(l)){const p=r,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=p.map((b,x)=>b+_[x]);return new R(y,i.typeInfo)}if(rt(r)){const p=l,_=r.map((y,b)=>y+p);return new R(_,i.typeInfo)}if(rt(l)){const p=r,_=l.map((y,b)=>p+y);return new R(_,s.typeInfo)}const c=r,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(c+f,d)}case"-":{if(rt(r)&&rt(l)){const p=r,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=p.map((b,x)=>b-_[x]);return new R(y,i.typeInfo)}if(rt(r)){const p=l,_=r.map((y,b)=>y-p);return new R(_,i.typeInfo)}if(rt(l)){const p=r,_=l.map((y,b)=>p-y);return new R(_,s.typeInfo)}const c=r,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(c-f,d)}case"*":{if(rt(r)&&rt(l)){const p=r,_=l;if(i instanceof gt&&s instanceof gt){const y=(function(A,E,D,C){if(je[E.name]===void 0||je[C.name]===void 0)return null;const O=je[E.name][0],k=je[E.name][1],z=je[C.name][0];if(O!==je[C.name][1])return null;const Y=new Array(z*k);for(let q=0;q<k;q++)for(let G=0;G<z;G++){let at=0;for(let nt=0;nt<O;nt++)at+=A[nt*k+q]*D[G*O+nt];Y[q*z+G]=at}return Y})(p,i.typeInfo,_,s.typeInfo);if(y===null)return console.error(`Matrix multiplication failed. Line ${t.line}.`),null;const b=je[s.typeInfo.name][0],x=je[i.typeInfo.name][1],T=this.getTypeInfo(`mat${b}x${x}f`);return new gt(y,T)}if(i instanceof gt&&s instanceof R){const y=(function(b,x,T,A){if(je[x.name]===void 0||tp[A.name]===void 0)return null;const E=je[x.name][0],D=je[x.name][1];if(E!==T.length)return null;const C=new Array(D);for(let O=0;O<D;O++){let k=0;for(let z=0;z<E;z++)k+=b[z*D+O]*T[z];C[O]=k}return C})(p,i.typeInfo,_,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new R(y,s.typeInfo)}if(i instanceof R&&s instanceof gt){const y=(function(b,x,T,A){if(tp[x.name]===void 0||je[A.name]===void 0)return null;const E=je[A.name][0],D=je[A.name][1];if(D!==b.length)return null;const C=[];for(let O=0;O<E;O++){let k=0;for(let z=0;z<D;z++)k+=b[z]*T[z*E+O];C[O]=k}return C})(p,i.typeInfo,_,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new R(y,i.typeInfo)}{if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=p.map((b,x)=>b*_[x]);return new R(y,i.typeInfo)}}if(rt(r)){const p=l,_=r.map((y,b)=>y*p);return i instanceof gt?new gt(_,i.typeInfo):new R(_,i.typeInfo)}if(rt(l)){const p=r,_=l.map((y,b)=>p*y);return s instanceof gt?new gt(_,s.typeInfo):new R(_,s.typeInfo)}const c=r,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(c*f,d)}case"%":{if(rt(r)&&rt(l)){const p=r,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=p.map((b,x)=>b%_[x]);return new R(y,i.typeInfo)}if(rt(r)){const p=l,_=r.map((y,b)=>y%p);return new R(_,i.typeInfo)}if(rt(l)){const p=r,_=l.map((y,b)=>p%y);return new R(_,s.typeInfo)}const c=r,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(c%f,d)}case"/":{if(rt(r)&&rt(l)){const p=r,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=p.map((b,x)=>b/_[x]);return new R(y,i.typeInfo)}if(rt(r)){const p=l,_=r.map((y,b)=>y/p);return new R(_,i.typeInfo)}if(rt(l)){const p=r,_=l.map((y,b)=>p/y);return new R(_,s.typeInfo)}const c=r,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(c/f,d)}case"&":{if(rt(r)&&rt(l)){const p=r,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=p.map((b,x)=>b&_[x]);return new R(y,i.typeInfo)}if(rt(r)){const p=l,_=r.map((y,b)=>y&p);return new R(_,i.typeInfo)}if(rt(l)){const p=r,_=l.map((y,b)=>p&y);return new R(_,s.typeInfo)}const c=r,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(c&f,d)}case"|":{if(rt(r)&&rt(l)){const p=r,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=p.map((b,x)=>b|_[x]);return new R(y,i.typeInfo)}if(rt(r)){const p=l,_=r.map((y,b)=>y|p);return new R(_,i.typeInfo)}if(rt(l)){const p=r,_=l.map((y,b)=>p|y);return new R(_,s.typeInfo)}const c=r,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(c|f,d)}case"^":{if(rt(r)&&rt(l)){const p=r,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=p.map((b,x)=>b^_[x]);return new R(y,i.typeInfo)}if(rt(r)){const p=l,_=r.map((y,b)=>y^p);return new R(_,i.typeInfo)}if(rt(l)){const p=r,_=l.map((y,b)=>p^y);return new R(_,s.typeInfo)}const c=r,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(c^f,d)}case"<<":{if(rt(r)&&rt(l)){const p=r,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=p.map((b,x)=>b<<_[x]);return new R(y,i.typeInfo)}if(rt(r)){const p=l,_=r.map((y,b)=>y<<p);return new R(_,i.typeInfo)}if(rt(l)){const p=r,_=l.map((y,b)=>p<<y);return new R(_,s.typeInfo)}const c=r,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(c<<f,d)}case">>":{if(rt(r)&&rt(l)){const p=r,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const y=p.map((b,x)=>b>>_[x]);return new R(y,i.typeInfo)}if(rt(r)){const p=l,_=r.map((y,b)=>y>>p);return new R(_,i.typeInfo)}if(rt(l)){const p=r,_=l.map((y,b)=>p>>y);return new R(_,s.typeInfo)}const c=r,f=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(c>>f,d)}case">":if(rt(r)&&rt(l)){const c=r,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const d=c.map((p,_)=>p>f[_]?1:0);return new R(d,i.typeInfo)}if(rt(r)){const c=l,f=r.map((d,p)=>d>c?1:0);return new R(f,i.typeInfo)}if(rt(l)){const c=r,f=l.map((d,p)=>c>d?1:0);return new R(f,s.typeInfo)}return new N(r>l?1:0,this.getTypeInfo("bool"));case"<":if(rt(r)&&rt(l)){const c=r,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const d=c.map((p,_)=>p<f[_]?1:0);return new R(d,i.typeInfo)}if(rt(r)){const c=l,f=r.map((d,p)=>d<c?1:0);return new R(f,i.typeInfo)}if(rt(l)){const c=r,f=l.map((d,p)=>c<d?1:0);return new R(f,s.typeInfo)}return new N(r<l?1:0,this.getTypeInfo("bool"));case"==":if(rt(r)&&rt(l)){const c=r,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const d=c.map((p,_)=>p===f[_]?1:0);return new R(d,i.typeInfo)}if(rt(r)){const c=l,f=r.map((d,p)=>d==c?1:0);return new R(f,i.typeInfo)}if(rt(l)){const c=r,f=l.map((d,p)=>c==d?1:0);return new R(f,s.typeInfo)}return new N(r===l?1:0,this.getTypeInfo("bool"));case"!=":if(rt(r)&&rt(l)){const c=r,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const d=c.map((p,_)=>p!==f[_]?1:0);return new R(d,i.typeInfo)}if(rt(r)){const c=l,f=r.map((d,p)=>d!==c?1:0);return new R(f,i.typeInfo)}if(rt(l)){const c=r,f=l.map((d,p)=>c!==d?1:0);return new R(f,s.typeInfo)}return new N(r!==l?1:0,this.getTypeInfo("bool"));case">=":if(rt(r)&&rt(l)){const c=r,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const d=c.map((p,_)=>p>=f[_]?1:0);return new R(d,i.typeInfo)}if(rt(r)){const c=l,f=r.map((d,p)=>d>=c?1:0);return new R(f,i.typeInfo)}if(rt(l)){const c=r,f=l.map((d,p)=>c>=d?1:0);return new R(f,s.typeInfo)}return new N(r>=l?1:0,this.getTypeInfo("bool"));case"<=":if(rt(r)&&rt(l)){const c=r,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const d=c.map((p,_)=>p<=f[_]?1:0);return new R(d,i.typeInfo)}if(rt(r)){const c=l,f=r.map((d,p)=>d<=c?1:0);return new R(f,i.typeInfo)}if(rt(l)){const c=r,f=l.map((d,p)=>c<=d?1:0);return new R(f,s.typeInfo)}return new N(r<=l?1:0,this.getTypeInfo("bool"));case"&&":if(rt(r)&&rt(l)){const c=r,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const d=c.map((p,_)=>p&&f[_]?1:0);return new R(d,i.typeInfo)}if(rt(r)){const c=l,f=r.map((d,p)=>d&&c?1:0);return new R(f,i.typeInfo)}if(rt(l)){const c=r,f=l.map((d,p)=>c&&d?1:0);return new R(f,s.typeInfo)}return new N(r&&l?1:0,this.getTypeInfo("bool"));case"||":if(rt(r)&&rt(l)){const c=r,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const d=c.map((p,_)=>p||f[_]?1:0);return new R(d,i.typeInfo)}if(rt(r)){const c=l,f=r.map((d,p)=>d||c?1:0);return new R(f,i.typeInfo)}if(rt(l)){const c=r,f=l.map((d,p)=>c||d?1:0);return new R(f,s.typeInfo)}return new N(r||l?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${t.operator}. Line ${t.line}`),null}_evalCall(t,e){if(t.cachedReturnValue!==null)return t.cachedReturnValue;const i=e.clone();i.currentFunctionName=t.name;const s=e.getFunction(t.name);if(!s)return t.isBuiltin?this._callBuiltinFunction(t,i):this.getTypeInfo(t.name)?this._evalCreate(t,e):(console.error(`Unknown function "${t.name}". Line ${t.line}`),null);for(let r=0;r<s.node.args.length;++r){const l=s.node.args[r],c=this.evalExpression(t.args[r],i);i.createVariable(l.name,c,l)}return this._execStatements(s.node.body,i)}_callBuiltinFunction(t,e){switch(t.name){case"all":return this.builtins.All(t,e);case"any":return this.builtins.Any(t,e);case"select":return this.builtins.Select(t,e);case"arrayLength":return this.builtins.ArrayLength(t,e);case"abs":return this.builtins.Abs(t,e);case"acos":return this.builtins.Acos(t,e);case"acosh":return this.builtins.Acosh(t,e);case"asin":return this.builtins.Asin(t,e);case"asinh":return this.builtins.Asinh(t,e);case"atan":return this.builtins.Atan(t,e);case"atanh":return this.builtins.Atanh(t,e);case"atan2":return this.builtins.Atan2(t,e);case"ceil":return this.builtins.Ceil(t,e);case"clamp":return this.builtins.Clamp(t,e);case"cos":return this.builtins.Cos(t,e);case"cosh":return this.builtins.Cosh(t,e);case"countLeadingZeros":return this.builtins.CountLeadingZeros(t,e);case"countOneBits":return this.builtins.CountOneBits(t,e);case"countTrailingZeros":return this.builtins.CountTrailingZeros(t,e);case"cross":return this.builtins.Cross(t,e);case"degrees":return this.builtins.Degrees(t,e);case"determinant":return this.builtins.Determinant(t,e);case"distance":return this.builtins.Distance(t,e);case"dot":return this.builtins.Dot(t,e);case"dot4U8Packed":return this.builtins.Dot4U8Packed(t,e);case"dot4I8Packed":return this.builtins.Dot4I8Packed(t,e);case"exp":return this.builtins.Exp(t,e);case"exp2":return this.builtins.Exp2(t,e);case"extractBits":return this.builtins.ExtractBits(t,e);case"faceForward":return this.builtins.FaceForward(t,e);case"firstLeadingBit":return this.builtins.FirstLeadingBit(t,e);case"firstTrailingBit":return this.builtins.FirstTrailingBit(t,e);case"floor":return this.builtins.Floor(t,e);case"fma":return this.builtins.Fma(t,e);case"fract":return this.builtins.Fract(t,e);case"frexp":return this.builtins.Frexp(t,e);case"insertBits":return this.builtins.InsertBits(t,e);case"inverseSqrt":return this.builtins.InverseSqrt(t,e);case"ldexp":return this.builtins.Ldexp(t,e);case"length":return this.builtins.Length(t,e);case"log":return this.builtins.Log(t,e);case"log2":return this.builtins.Log2(t,e);case"max":return this.builtins.Max(t,e);case"min":return this.builtins.Min(t,e);case"mix":return this.builtins.Mix(t,e);case"modf":return this.builtins.Modf(t,e);case"normalize":return this.builtins.Normalize(t,e);case"pow":return this.builtins.Pow(t,e);case"quantizeToF16":return this.builtins.QuantizeToF16(t,e);case"radians":return this.builtins.Radians(t,e);case"reflect":return this.builtins.Reflect(t,e);case"refract":return this.builtins.Refract(t,e);case"reverseBits":return this.builtins.ReverseBits(t,e);case"round":return this.builtins.Round(t,e);case"saturate":return this.builtins.Saturate(t,e);case"sign":return this.builtins.Sign(t,e);case"sin":return this.builtins.Sin(t,e);case"sinh":return this.builtins.Sinh(t,e);case"smoothstep":return this.builtins.SmoothStep(t,e);case"sqrt":return this.builtins.Sqrt(t,e);case"step":return this.builtins.Step(t,e);case"tan":return this.builtins.Tan(t,e);case"tanh":return this.builtins.Tanh(t,e);case"transpose":return this.builtins.Transpose(t,e);case"trunc":return this.builtins.Trunc(t,e);case"dpdx":return this.builtins.Dpdx(t,e);case"dpdxCoarse":return this.builtins.DpdxCoarse(t,e);case"dpdxFine":return this.builtins.DpdxFine(t,e);case"dpdy":return this.builtins.Dpdy(t,e);case"dpdyCoarse":return this.builtins.DpdyCoarse(t,e);case"dpdyFine":return this.builtins.DpdyFine(t,e);case"fwidth":return this.builtins.Fwidth(t,e);case"fwidthCoarse":return this.builtins.FwidthCoarse(t,e);case"fwidthFine":return this.builtins.FwidthFine(t,e);case"textureDimensions":return this.builtins.TextureDimensions(t,e);case"textureGather":return this.builtins.TextureGather(t,e);case"textureGatherCompare":return this.builtins.TextureGatherCompare(t,e);case"textureLoad":return this.builtins.TextureLoad(t,e);case"textureNumLayers":return this.builtins.TextureNumLayers(t,e);case"textureNumLevels":return this.builtins.TextureNumLevels(t,e);case"textureNumSamples":return this.builtins.TextureNumSamples(t,e);case"textureSample":return this.builtins.TextureSample(t,e);case"textureSampleBias":return this.builtins.TextureSampleBias(t,e);case"textureSampleCompare":return this.builtins.TextureSampleCompare(t,e);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(t,e);case"textureSampleGrad":return this.builtins.TextureSampleGrad(t,e);case"textureSampleLevel":return this.builtins.TextureSampleLevel(t,e);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(t,e);case"textureStore":return this.builtins.TextureStore(t,e);case"atomicLoad":return this.builtins.AtomicLoad(t,e);case"atomicStore":return this.builtins.AtomicStore(t,e);case"atomicAdd":return this.builtins.AtomicAdd(t,e);case"atomicSub":return this.builtins.AtomicSub(t,e);case"atomicMax":return this.builtins.AtomicMax(t,e);case"atomicMin":return this.builtins.AtomicMin(t,e);case"atomicAnd":return this.builtins.AtomicAnd(t,e);case"atomicOr":return this.builtins.AtomicOr(t,e);case"atomicXor":return this.builtins.AtomicXor(t,e);case"atomicExchange":return this.builtins.AtomicExchange(t,e);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(t,e);case"pack4x8snorm":return this.builtins.Pack4x8snorm(t,e);case"pack4x8unorm":return this.builtins.Pack4x8unorm(t,e);case"pack4xI8":return this.builtins.Pack4xI8(t,e);case"pack4xU8":return this.builtins.Pack4xU8(t,e);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(t,e);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(t,e);case"pack2x16snorm":return this.builtins.Pack2x16snorm(t,e);case"pack2x16unorm":return this.builtins.Pack2x16unorm(t,e);case"pack2x16float":return this.builtins.Pack2x16float(t,e);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(t,e);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(t,e);case"unpack4xI8":return this.builtins.Unpack4xI8(t,e);case"unpack4xU8":return this.builtins.Unpack4xU8(t,e);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(t,e);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(t,e);case"unpack2x16float":return this.builtins.Unpack2x16float(t,e);case"storageBarrier":return this.builtins.StorageBarrier(t,e);case"textureBarrier":return this.builtins.TextureBarrier(t,e);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(t,e);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(t,e);case"subgroupAdd":return this.builtins.SubgroupAdd(t,e);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(t,e);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(t,e);case"subgroupAll":return this.builtins.SubgroupAll(t,e);case"subgroupAnd":return this.builtins.SubgroupAnd(t,e);case"subgroupAny":return this.builtins.SubgroupAny(t,e);case"subgroupBallot":return this.builtins.SubgroupBallot(t,e);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(t,e);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(t,e);case"subgroupElect":return this.builtins.SubgroupElect(t,e);case"subgroupMax":return this.builtins.SubgroupMax(t,e);case"subgroupMin":return this.builtins.SubgroupMin(t,e);case"subgroupMul":return this.builtins.SubgroupMul(t,e);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(t,e);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(t,e);case"subgroupOr":return this.builtins.SubgroupOr(t,e);case"subgroupShuffle":return this.builtins.SubgroupShuffle(t,e);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(t,e);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(t,e);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(t,e);case"subgroupXor":return this.builtins.SubgroupXor(t,e);case"quadBroadcast":return this.builtins.QuadBroadcast(t,e);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(t,e);case"quadSwapX":return this.builtins.QuadSwapX(t,e);case"quadSwapY":return this.builtins.QuadSwapY(t,e)}const i=e.getFunction(t.name);if(i){const s=e.clone();for(let r=0;r<i.node.args.length;++r){const l=i.node.args[r],c=this.evalExpression(t.args[r],s);s.setVariable(l.name,c,l)}return this._execStatements(i.node.body,s)}return null}_callConstructorValue(t,e){if(!t.args||t.args.length===0)return new N(0,this.getTypeInfo(t.type));const i=this.evalExpression(t.args[0],e);return i.typeInfo=this.getTypeInfo(t.type),i.getSubData(this,t.postfix,e).clone()}_callConstructorVec(t,e){const i=this.getTypeInfo(t.type),s=t.type.getTypeName(),r=tp[s];if(r===void 0)return console.error(`Invalid vec constructor ${s}. Line ${t.line}`),null;const l=[];if(t instanceof xe)if(t.isVector){const c=t.vectorValue;for(const f of c)l.push(f)}else l.push(t.scalarValue);else if(t.args)for(const c of t.args){const f=this.evalExpression(c,e);if(f instanceof R){const d=f.data;for(let p=0;p<d.length;++p){let _=d[p];l.push(_)}}else if(f instanceof N){let d=f.value;l.push(d)}}if(t.type instanceof L&&t.type.format===null&&(t.type.format=L.f32),l.length===0){const c=new Array(r).fill(0);return new R(c,i).getSubData(this,t.postfix,e)}if(l.length===1)for(;l.length<r;)l.push(l[0]);return l.length<r?(console.error(`Invalid vec constructor. Line ${t.line}`),null):new R(l.length>r?l.slice(0,r):l,i).getSubData(this,t.postfix,e)}_callConstructorMatrix(t,e){const i=this.getTypeInfo(t.type),s=t.type.getTypeName(),r=je[s];if(r===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${t.line}`),null;const l=[];if(t instanceof xe)if(t.isVector){const c=t.vectorValue;for(const f of c)l.push(f)}else l.push(t.scalarValue);else if(t.args)for(const c of t.args){const f=this.evalExpression(c,e);f instanceof R?l.push(...f.data):f instanceof N?l.push(f.value):f instanceof gt&&l.push(...f.data)}if(i instanceof ar&&i.format===null&&(i.format=this.getTypeInfo("f32")),l.length===0){const c=new Array(r[2]).fill(0);return new gt(c,i).getSubData(this,t.postfix,e)}return l.length!==r[2]?(console.error(`Invalid matrix constructor. Line ${t.line}`),null):new gt(l,i).getSubData(this,t.postfix,e)}}Fe._breakObj=new Dn(new On("BREAK",null),null),Fe._continueObj=new Dn(new On("CONTINUE",null),null),Fe._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class vO{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class xO{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new vO,this._exec=new Fe,this._forwardTypeCount=0}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;const e=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;e.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const s=i.arrayType,r=i.countNode;if(r instanceof pn){const l=r.name,c=this._context.constants.get(l);if(c)try{const f=c.constEvaluate(this._exec);s.count=f}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const i of e)i.search(s=>{s instanceof Av||s instanceof bu?s.type=this._forwardType(s.type):s instanceof Zo?s.format=this._forwardType(s.format):s instanceof Ii||s instanceof Ko||s instanceof yu?s.type=this._forwardType(s.type):s instanceof al?s.returnType=this._forwardType(s.returnType):s instanceof Sv&&(s.type=this._forwardType(s.type))});return e}_forwardType(t){if(t instanceof Tv){const e=this._getType(t.name);if(e)return e}else t instanceof bu?t.type=this._forwardType(t.type):t instanceof Zo&&(t.format=this._forwardType(t.format));return t}_initialize(t){if(t)if(typeof t=="string"){const e=new uO(t);this._tokens=e.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_updateNode(t,e){return t.line=e??this._currentLine,t}_error(t,e){return{token:t,message:e,toString:()=>`${e}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==w.eof}_match(t){if(t instanceof U)return!!this._check(t)&&(this._advance(),!0);for(let e=0,i=t.length;e<i;++e){const s=t[e];if(this._check(s))return this._advance(),!0}return!1}_consume(t,e){if(this._check(t))return this._advance();throw this._error(this._peek(),`${e}. Line:${this._currentLine}`)}_check(t){if(this._isAtEnd())return!1;const e=this._peek();if(t instanceof Array){const i=e.type;let s=!1;for(const r of t){if(i===r)return!0;r===w.tokens.name&&(s=!0)}if(s){const r=w.tokens.name.rule.exec(e.lexeme);if(r&&r.index==0&&r[0]==e.lexeme)return!0}return!1}if(e.type===t)return!0;if(t===w.tokens.name){const i=w.tokens.name.rule.exec(e.lexeme);return i&&i.index==0&&i[0]==e.lexeme}return!1}_advance(){var t,e;return this._currentLine=(e=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&e!==void 0?e:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(w.tokens.semicolon)&&!this._isAtEnd(););if(this._match(w.keywords.alias)){const e=this._type_alias();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(w.keywords.diagnostic)){const e=this._diagnostic();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(w.keywords.requires)){const e=this._requires_directive();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(w.keywords.enable)){const e=this._enable_directive();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}const t=this._attribute();if(this._check(w.keywords.var)){const e=this._global_variable_decl();return e!=null&&(e.attributes=t),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(w.keywords.override)){const e=this._override_variable_decl();return e!=null&&(e.attributes=t),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(w.keywords.let)){const e=this._global_let_decl();return e!=null&&(e.attributes=t),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(w.keywords.const)){const e=this._global_const_decl();return e!=null&&(e.attributes=t),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(w.keywords.struct)){const e=this._struct_decl();return e!=null&&(e.attributes=t),this._exec.reflection.updateAST([e]),e}if(this._check(w.keywords.fn)){const e=this._function_decl();return e!=null&&(e.attributes=t),this._exec.reflection.updateAST([e]),e}return null}_function_decl(){if(!this._match(w.keywords.fn))return null;const t=this._currentLine,e=this._consume(w.tokens.ident,"Expected function name.").toString();this._consume(w.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(w.tokens.paren_right))do{if(this._check(w.tokens.paren_right))break;const c=this._attribute(),f=this._consume(w.tokens.name,"Expected argument name.").toString();this._consume(w.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=d,i.push(this._updateNode(new Sv(f,p,c))))}while(this._match(w.tokens.comma));this._consume(w.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(w.tokens.arrow)){const c=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=c)}const r=this._compound_statement(),l=this._currentLine;return this._updateNode(new al(e,i,s,r,t,l),t)}_compound_statement(){const t=[];for(this._consume(w.tokens.brace_left,"Expected '{' for block.");!this._check(w.tokens.brace_right);){const e=this._statement();e!==null&&t.push(e)}return this._consume(w.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(w.tokens.semicolon)&&!this._isAtEnd(););if(this._check(w.tokens.attr)&&this._attribute(),this._check(w.keywords.if))return this._if_statement();if(this._check(w.keywords.switch))return this._switch_statement();if(this._check(w.keywords.loop))return this._loop_statement();if(this._check(w.keywords.for))return this._for_statement();if(this._check(w.keywords.while))return this._while_statement();if(this._check(w.keywords.continuing))return this._continuing_statement();if(this._check(w.keywords.static_assert))return this._static_assert_statement();if(this._check(w.tokens.brace_left))return this._compound_statement();let t=null;if(this._check(w.keywords.return))t=this._return_statement();else if(this._check([w.keywords.var,w.keywords.let,w.keywords.const]))t=this._variable_statement();else if(this._match(w.keywords.discard))t=this._updateNode(new oO);else if(this._match(w.keywords.break)){const e=this._updateNode(new r2);if(this._currentLoop.length>0){const i=this._currentLoop[this._currentLoop.length-1];e.loopId=i.id}t=e,this._check(w.keywords.if)&&(this._advance(),e.condition=this._optional_paren_expression())}else if(this._match(w.keywords.continue)){const e=this._updateNode(new a2);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${e.line}`);{const i=this._currentLoop[this._currentLoop.length-1];e.loopId=i.id}t=e}else t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return t!=null&&this._consume(w.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(w.keywords.static_assert))return null;const t=this._currentLine,e=this._optional_paren_expression();return this._updateNode(new sO(e),t)}_while_statement(){if(!this._match(w.keywords.while))return null;const t=this._updateNode(new Z1(null,null));return this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(w.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_continuing_statement(){const t=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(w.keywords.continuing))return null;const e=this._currentLine,i=this._compound_statement();return this._updateNode(new Hp(i,t),e)}_for_statement(){if(!this._match(w.keywords.for))return null;this._consume(w.tokens.paren_left,"Expected '('.");const t=this._updateNode(new Q1(null,null,null,null));return this._currentLoop.push(t),t.init=this._check(w.tokens.semicolon)?null:this._for_init(),this._consume(w.tokens.semicolon,"Expected ';'."),t.condition=this._check(w.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(w.tokens.semicolon,"Expected ';'."),t.increment=this._check(w.tokens.paren_right)?null:this._for_increment(),this._consume(w.tokens.paren_right,"Expected ')'."),this._check(w.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(w.keywords.var)){const t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let e=null;return this._match(w.tokens.equal)&&(e=this._short_circuit_or_expression()),this._updateNode(new Ii(t.name,t.type,t.storage,t.access,e),t.line)}if(this._match(w.keywords.let)){const t=this._currentLine,e=this._consume(w.tokens.name,"Expected name for let.").toString();let i=null;if(this._match(w.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}this._consume(w.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new Ko(e,i,null,null,s),t)}if(this._match(w.keywords.const)){const t=this._currentLine,e=this._consume(w.tokens.name,"Expected name for const.").toString();let i=null;if(this._match(w.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}this._consume(w.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return i===null&&s instanceof xe&&(i=s.type),this._updateNode(new yu(e,i,null,null,s),t)}return null}_increment_decrement_statement(){const t=this._current,e=this._unary_expression();if(e==null)return null;if(!this._check(w.increment_operators))return this._current=t,null;const i=this._consume(w.increment_operators,"Expected increment operator");return this._updateNode(new G1(i.type===w.tokens.plus_plus?la.increment:la.decrement,e))}_assignment_statement(){let t=null;const e=this._currentLine;if(this._check(w.tokens.brace_right))return null;let i=this._match(w.tokens.underscore);if(i||(t=this._unary_expression()),!i&&t==null)return null;const s=this._consume(w.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return this._updateNode(new J1(Fo.parse(s.lexeme),t,r),e)}_func_call_statement(){if(!this._check(w.tokens.ident))return null;const t=this._currentLine,e=this._current,i=this._consume(w.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=e,null):this._updateNode(new Hg(i.lexeme,s),t)}_loop_statement(){if(!this._match(w.keywords.loop))return null;this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Expected '{' for loop.");const t=this._updateNode(new t2([],null));this._currentLoop.push(t);let e=this._statement();for(;e!==null;){if(Array.isArray(e))for(let i of e)t.body.push(i);else t.body.push(e);if(e instanceof Hp){t.continuing=e;break}e=this._statement()}return this._currentLoop.pop(),this._consume(w.tokens.brace_right,"Expected '}' for loop."),t}_switch_statement(){if(!this._match(w.keywords.switch))return null;const t=this._updateNode(new e2(null,[]));if(this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Expected '{' for switch."),t.cases=this._switch_body(),t.cases==null||t.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(w.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),t}_switch_body(){const t=[];let e=!1;for(;this._check([w.keywords.default,w.keywords.case]);){if(this._match(w.keywords.case)){const i=this._case_selectors();for(const r of i)if(r instanceof vu){if(e)throw this._error(this._previous(),"Multiple default cases in switch statement.");e=!0;break}this._match(w.tokens.colon),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(w.tokens.brace_right,"Exected '}' for switch case."),t.push(this._updateNode(new f2(i,s)))}if(this._match(w.keywords.default)){if(e)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(w.tokens.colon),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(w.tokens.brace_right,"Exected '}' for switch default."),t.push(this._updateNode(new h2(i)))}}return t}_case_selectors(){const t=[];for(this._match(w.keywords.default)?t.push(this._updateNode(new vu)):t.push(this._shift_expression());this._match(w.tokens.comma);)this._match(w.keywords.default)?t.push(this._updateNode(new vu)):t.push(this._shift_expression());return t}_case_body(){if(this._match(w.keywords.fallthrough))return this._consume(w.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);const e=this._case_body();return e.length==0?t:[...t,e[0]]}_if_statement(){if(!this._match(w.keywords.if))return null;const t=this._currentLine,e=this._optional_paren_expression();this._check(w.tokens.attr)&&this._attribute();const i=this._compound_statement();let s=[];this._match_elseif()&&(this._check(w.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let r=null;return this._match(w.keywords.else)&&(this._check(w.tokens.attr)&&this._attribute(),r=this._compound_statement()),this._updateNode(new n2(e,i,s,r),t)}_match_elseif(){return this._tokens[this._current].type===w.keywords.else&&this._tokens[this._current+1].type===w.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(t=[]){const e=this._optional_paren_expression(),i=this._compound_statement();return t.push(this._updateNode(new lO(e,i))),this._match_elseif()&&(this._check(w.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(w.keywords.return))return null;const t=this._short_circuit_or_expression();return this._updateNode(new i2(t))}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(w.tokens.or_or);)t=this._updateNode(new Vn(this._previous().toString(),t,this._short_circuit_and_expr()));return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(w.tokens.and_and);)t=this._updateNode(new Vn(this._previous().toString(),t,this._inclusive_or_expression()));return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(w.tokens.or);)t=this._updateNode(new Vn(this._previous().toString(),t,this._exclusive_or_expression()));return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(w.tokens.xor);)t=this._updateNode(new Vn(this._previous().toString(),t,this._and_expression()));return t}_and_expression(){let t=this._equality_expression();for(;this._match(w.tokens.and);)t=this._updateNode(new Vn(this._previous().toString(),t,this._equality_expression()));return t}_equality_expression(){const t=this._relational_expression();return this._match([w.tokens.equal_equal,w.tokens.not_equal])?this._updateNode(new Vn(this._previous().toString(),t,this._relational_expression())):t}_relational_expression(){let t=this._shift_expression();for(;this._match([w.tokens.less_than,w.tokens.greater_than,w.tokens.less_than_equal,w.tokens.greater_than_equal]);)t=this._updateNode(new Vn(this._previous().toString(),t,this._shift_expression()));return t}_shift_expression(){let t=this._additive_expression();for(;this._match([w.tokens.shift_left,w.tokens.shift_right]);)t=this._updateNode(new Vn(this._previous().toString(),t,this._additive_expression()));return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([w.tokens.plus,w.tokens.minus]);)t=this._updateNode(new Vn(this._previous().toString(),t,this._multiplicative_expression()));return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([w.tokens.star,w.tokens.forward_slash,w.tokens.modulo]);)t=this._updateNode(new Vn(this._previous().toString(),t,this._unary_expression()));return t}_unary_expression(){return this._match([w.tokens.minus,w.tokens.bang,w.tokens.tilde,w.tokens.star,w.tokens.and])?this._updateNode(new ye(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const t=this._primary_expression(),e=this._postfix_expression();return e&&(t.postfix=e),t}_postfix_expression(){if(this._match(w.tokens.bracket_left)){const t=this._short_circuit_or_expression();this._consume(w.tokens.bracket_right,"Expected ']'.");const e=this._updateNode(new ma(t)),i=this._postfix_expression();return i&&(e.postfix=i),e}if(this._match(w.tokens.period)){const t=this._consume(w.tokens.name,"Expected member name."),e=this._postfix_expression(),i=this._updateNode(new or(t.lexeme));return e&&(i.postfix=e),i}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_getType(t){const e=this._getStruct(t);if(e!==null)return e;switch(t){case"void":return J.void;case"bool":return J.bool;case"i32":return J.i32;case"u32":return J.u32;case"f32":return J.f32;case"f16":return J.f16;case"vec2f":return L.vec2f;case"vec3f":return L.vec3f;case"vec4f":return L.vec4f;case"vec2i":return L.vec2i;case"vec3i":return L.vec3i;case"vec4i":return L.vec4i;case"vec2u":return L.vec2u;case"vec3u":return L.vec3u;case"vec4u":return L.vec4u;case"vec2h":return L.vec2h;case"vec3h":return L.vec3h;case"vec4h":return L.vec4h;case"mat2x2f":return L.mat2x2f;case"mat2x3f":return L.mat2x3f;case"mat2x4f":return L.mat2x4f;case"mat3x2f":return L.mat3x2f;case"mat3x3f":return L.mat3x3f;case"mat3x4f":return L.mat3x4f;case"mat4x2f":return L.mat4x2f;case"mat4x3f":return L.mat4x3f;case"mat4x4f":return L.mat4x4f;case"mat2x2h":return L.mat2x2h;case"mat2x3h":return L.mat2x3h;case"mat2x4h":return L.mat2x4h;case"mat3x2h":return L.mat3x2h;case"mat3x3h":return L.mat3x3h;case"mat3x4h":return L.mat3x4h;case"mat4x2h":return L.mat4x2h;case"mat4x3h":return L.mat4x3h;case"mat4x4h":return L.mat4x4h;case"mat2x2i":return L.mat2x2i;case"mat2x3i":return L.mat2x3i;case"mat2x4i":return L.mat2x4i;case"mat3x2i":return L.mat3x2i;case"mat3x3i":return L.mat3x3i;case"mat3x4i":return L.mat3x4i;case"mat4x2i":return L.mat4x2i;case"mat4x3i":return L.mat4x3i;case"mat4x4i":return L.mat4x4i;case"mat2x2u":return L.mat2x2u;case"mat2x3u":return L.mat2x3u;case"mat2x4u":return L.mat2x4u;case"mat3x2u":return L.mat3x2u;case"mat3x3u":return L.mat3x3u;case"mat3x4u":return L.mat3x4u;case"mat4x2u":return L.mat4x2u;case"mat4x3u":return L.mat4x3u;case"mat4x4u":return L.mat4x4u}return null}_validateTypeRange(t,e){if(e.name==="i32"){if(t<-2147483648||t>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${t}. Line: ${this._currentLine}.`)}else if(e.name==="u32"&&(t<0||t>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${t}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(w.tokens.ident)){const i=this._previous().toString();if(this._check(w.tokens.paren_left)){const s=this._argument_expression_list(),r=this._getType(i);return r!==null?this._updateNode(new ti(r,s)):this._updateNode(new Wg(i,s))}if(this._context.constants.has(i)){const s=this._context.constants.get(i);return this._updateNode(new o2(i,s.value))}return this._updateNode(new pn(i))}if(this._match(w.tokens.int_literal)){const i=this._previous().toString();let s=i.endsWith("i")||i.endsWith("i")?J.i32:i.endsWith("u")||i.endsWith("U")?J.u32:J.x32;const r=parseInt(i);return this._validateTypeRange(r,s),this._updateNode(new xe(new N(r,this._exec.getTypeInfo(s)),s))}if(this._match(w.tokens.uint_literal)){const i=parseInt(this._previous().toString());return this._validateTypeRange(i,J.u32),this._updateNode(new xe(new N(i,this._exec.getTypeInfo(J.u32)),J.u32))}if(this._match([w.tokens.decimal_float_literal,w.tokens.hex_float_literal])){let i=this._previous().toString(),s=i.endsWith("h");s&&(i=i.substring(0,i.length-1));const r=parseFloat(i);this._validateTypeRange(r,s?J.f16:J.f32);const l=s?J.f16:J.f32;return this._updateNode(new xe(new N(r,this._exec.getTypeInfo(l)),l))}if(this._match([w.keywords.true,w.keywords.false])){let i=this._previous().toString()===w.keywords.true.rule;return this._updateNode(new xe(new N(i?1:0,this._exec.getTypeInfo(J.bool)),J.bool))}if(this._check(w.tokens.paren_left))return this._paren_expression();if(this._match(w.keywords.bitcast)){this._consume(w.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(w.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new l2(i,s))}const t=this._type_decl(),e=this._argument_expression_list();return this._updateNode(new ti(t,e))}_argument_expression_list(){if(!this._match(w.tokens.paren_left))return null;const t=[];do{if(this._check(w.tokens.paren_right))break;const e=this._short_circuit_or_expression();t.push(e)}while(this._match(w.tokens.comma));return this._consume(w.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(w.tokens.paren_left);const t=this._short_circuit_or_expression();return this._match(w.tokens.paren_right),t}_paren_expression(){this._consume(w.tokens.paren_left,"Expected '('.");const t=this._short_circuit_or_expression();return this._consume(w.tokens.paren_right,"Expected ')'."),t}_struct_decl(){if(!this._match(w.keywords.struct))return null;const t=this._currentLine,e=this._consume(w.tokens.ident,"Expected name for struct.").toString();this._consume(w.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(w.tokens.brace_right);){const l=this._attribute(),c=this._consume(w.tokens.name,"Expected variable name.").toString();this._consume(w.tokens.colon,"Expected ':' for struct member type.");const f=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=f),this._check(w.tokens.brace_right)?this._match(w.tokens.comma):this._consume(w.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new Av(c,d,l)))}this._consume(w.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,r=this._updateNode(new Ci(e,i,t,s),t);return this._context.structs.set(e,r),r}_global_variable_decl(){const t=this._variable_decl();if(!t)return null;if(this._match(w.tokens.equal)){const e=this._const_expression();t.value=e}if(t.type!==null&&t.value instanceof xe){if(t.value.type.name!=="x32"&&t.type.getTypeName()!==t.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${t.value.type.name} to ${t.type.name}. Line:${this._currentLine}`);t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type),t.value.type=t.type}else t.type===null&&t.value instanceof xe&&(t.type=t.value.type.name==="x32"?J.i32:t.value.type,t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type));return t}_override_variable_decl(){const t=this._override_decl();return t&&this._match(w.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){var t;if(!this._match(w.keywords.const))return null;const e=this._consume(w.tokens.name,"Expected variable name"),i=this._currentLine;let s=null;if(this._match(w.tokens.colon)){const f=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=f)}let r=null;this._consume(w.tokens.equal,"const declarations require an assignment");const l=this._short_circuit_or_expression();try{let f=[J.f32],d=l.constEvaluate(this._exec,f);d instanceof N&&this._validateTypeRange(d.value,f[0]),f[0]instanceof L&&f[0].format===null&&d.typeInfo instanceof ar&&d.typeInfo.format!==null&&(d.typeInfo.format.name==="f16"?f[0].format=J.f16:d.typeInfo.format.name==="f32"?f[0].format=J.f32:d.typeInfo.format.name==="i32"?f[0].format=J.i32:d.typeInfo.format.name==="u32"?f[0].format=J.u32:d.typeInfo.format.name==="bool"?f[0].format=J.bool:console.error(`TODO: impelement template format type ${d.typeInfo.format.name}`)),r=this._updateNode(new xe(d,f[0])),this._exec.context.setVariable(e.toString(),d)}catch{r=l}if(s!==null&&r instanceof xe){if(r.type.name!=="x32"&&s.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${s.name}. Line:${this._currentLine}`);r.type=s,r.isScalar&&this._validateTypeRange(r.scalarValue,r.type)}else s===null&&r instanceof xe&&(s=(t=r?.type)!==null&&t!==void 0?t:J.f32,s===J.x32&&(s=J.i32));const c=this._updateNode(new yu(e.toString(),s,"","",r),i);return this._context.constants.set(c.name,c),c}_global_let_decl(){if(!this._match(w.keywords.let))return null;const t=this._currentLine,e=this._consume(w.tokens.name,"Expected variable name");let i=null;if(this._match(w.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}let s=null;if(this._match(w.tokens.equal)&&(s=this._const_expression()),i!==null&&s instanceof xe){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i}else i===null&&s instanceof xe&&(i=s.type.name==="x32"?J.i32:s.type);return s instanceof xe&&s.isScalar&&this._validateTypeRange(s.scalarValue,i),this._updateNode(new Ko(e.toString(),i,"","",s),t)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(w.keywords.var))return null;const t=this._currentLine;let e="",i="";this._match(w.tokens.less_than)&&(e=this._consume(w.storage_class,"Expected storage_class.").toString(),this._match(w.tokens.comma)&&(i=this._consume(w.access_mode,"Expected access_mode.").toString()),this._consume(w.tokens.greater_than,"Expected '>'."));const s=this._consume(w.tokens.name,"Expected variable name");let r=null;if(this._match(w.tokens.colon)){const l=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=l)}return this._updateNode(new Ii(s.toString(),r,e,i,null),t)}_override_decl(){if(!this._match(w.keywords.override))return null;const t=this._consume(w.tokens.name,"Expected variable name");let e=null;if(this._match(w.tokens.colon)){const i=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=i)}return this._updateNode(new Vg(t.toString(),e,null))}_diagnostic(){this._consume(w.tokens.paren_left,"Expected '('");const t=this._consume(w.tokens.ident,"Expected severity control name.");this._consume(w.tokens.comma,"Expected ','");let e=this._consume(w.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(w.tokens.period)&&(e+=`.${this._consume(w.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(w.tokens.paren_right,"Expected ')'"),this._updateNode(new s2(t.toString(),e))}_enable_directive(){const t=this._consume(w.tokens.ident,"identity expected.");return this._updateNode(new rO(t.toString()))}_requires_directive(){const t=[this._consume(w.tokens.ident,"identity expected.").toString()];for(;this._match(w.tokens.comma);){const e=this._consume(w.tokens.ident,"identity expected.");t.push(e.toString())}return this._updateNode(new aO(t))}_type_alias(){const t=this._consume(w.tokens.ident,"identity expected.");this._consume(w.tokens.equal,"Expected '=' for type alias.");let e=this._type_decl();if(e===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);const i=this._updateNode(new jg(t.toString(),e));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([w.tokens.ident,...w.texel_format,w.keywords.bool,w.keywords.f32,w.keywords.i32,w.keywords.u32])){const i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){const s=this._updateNode(new Tv(i));return this._forwardTypeCount++,s}return this._updateNode(new J(i))}let t=this._texture_sampler_types();if(t)return t;if(this._check(w.template_types)){let i=this._advance().toString(),s=null,r=null;return this._match(w.tokens.less_than)&&(s=this._type_decl(),r=null,this._match(w.tokens.comma)&&(r=this._consume(w.access_mode,"Expected access_mode for pointer").toString()),this._consume(w.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new L(i,s,r))}if(this._match(w.keywords.ptr)){let i=this._previous().toString();this._consume(w.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(w.storage_class,"Expected storage_class for pointer");this._consume(w.tokens.comma,"Expected ',' for pointer.");const r=this._type_decl();let l=null;return this._match(w.tokens.comma)&&(l=this._consume(w.access_mode,"Expected access_mode for pointer").toString()),this._consume(w.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new bu(i,s.toString(),r,l))}const e=this._attribute();if(this._match(w.keywords.array)){let i=null,s=-1;const r=this._previous();let l=null;if(this._match(w.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let f="";if(this._match(w.tokens.comma)){l=this._shift_expression();try{f=l.constEvaluate(this._exec).toString(),l=null}catch{f="1"}}this._consume(w.tokens.greater_than,"Expected '>' for array."),s=f?parseInt(f):0}const c=this._updateNode(new Zo(r.toString(),e,i,s));return l&&this._deferArrayCountEval.push({arrayType:c,countNode:l}),c}return null}_texture_sampler_types(){if(this._match(w.sampler_type))return this._updateNode(new Lo(this._previous().toString(),null,null));if(this._match(w.depth_texture_type))return this._updateNode(new Lo(this._previous().toString(),null,null));if(this._match(w.sampled_texture_type)||this._match(w.multisampled_texture_type)){const t=this._previous();this._consume(w.tokens.less_than,"Expected '<' for sampler type.");const e=this._type_decl();return this._consume(w.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Lo(t.toString(),e,null))}if(this._match(w.storage_texture_type)){const t=this._previous();this._consume(w.tokens.less_than,"Expected '<' for sampler type.");const e=this._consume(w.texel_format,"Invalid texel format.").toString();this._consume(w.tokens.comma,"Expected ',' after texel format.");const i=this._consume(w.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(w.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Lo(t.toString(),e,i))}return null}_attribute(){let t=[];for(;this._match(w.tokens.attr);){const e=this._consume(w.attribute_name,"Expected attribute name"),i=this._updateNode(new d2(e.toString(),null));if(this._match(w.tokens.paren_left)){if(i.value=this._consume(w.literal_or_ident,"Expected attribute value").toString(),this._check(w.tokens.comma)){this._advance();do{const s=this._consume(w.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(s)}while(this._match(w.tokens.comma))}this._consume(w.tokens.paren_right,"Expected ')'")}t.push(i)}return t.length==0?null:t}}class TO extends ni{constructor(t){super(),t&&this.update(t)}update(t){const e=new xO().parse(t);this.updateAST(e)}}function SO(n){const t={attributes:[],bindings:[]};let e;try{e=AO(n)}catch(r){return et.error(r.message)(),t}for(const r of e.uniforms){const l=[];for(const c of r.type?.members||[])l.push({name:c.name,type:Rv(c.type)});t.bindings.push({type:"uniform",name:r.name,group:r.group,location:r.binding,members:l})}for(const r of e.textures)t.bindings.push({type:"texture",name:r.name,group:r.group,location:r.binding});for(const r of e.samplers)t.bindings.push({type:"sampler",name:r.name,group:r.group,location:r.binding});const i=e.entry.vertex[0],s=i?.inputs.length||0;for(let r=0;r<s;r++){const l=i.inputs[r];if(l.locationType==="location"){const c=Rv(l.type);t.attributes.push({name:l.name,location:Number(l.location),type:c})}}return t}function Rv(n){return n?.format?`${n.name}<${n.format.name}>`:n.name}function AO(n){try{return new TO(n)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw typeof t=="object"&&t?.message&&(e+=`: ${t.message} `),typeof t=="object"&&t?.token&&(e+=t.token.line||""),new Error(e,{cause:t})}}const wO={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...wO}};const In=globalThis.mathgl.config;function EO(n,{precision:t=In.precision}={}){return n=RO(n),`${parseFloat(n.toPrecision(t))}`}function ya(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function fs(n,t,e){return MO(n,i=>Math.max(t,Math.min(e,i)))}function Lu(n,t,e){return ya(n)?n.map((i,s)=>Lu(i,t[s],e)):e*t+(1-e)*n}function ol(n,t,e){const i=In.EPSILON;try{if(n===t)return!0;if(ya(n)&&ya(t)){if(n.length!==t.length)return!1;for(let s=0;s<n.length;++s)if(!ol(n[s],t[s]))return!1;return!0}return n&&n.equals?n.equals(t):t&&t.equals?t.equals(n):typeof n=="number"&&typeof t=="number"?Math.abs(n-t)<=In.EPSILON*Math.max(1,Math.abs(n),Math.abs(t)):!1}finally{In.EPSILON=i}}function RO(n){return Math.round(n/In.EPSILON)*In.EPSILON}function CO(n){return n.clone?n.clone():new Array(n.length)}function MO(n,t,e){if(ya(n)){const i=n;e=e||CO(i);for(let s=0;s<e.length&&s<i.length;++s){const r=typeof n=="number"?n:n[s];e[s]=t(r,s,e)}return e}return t(n)}class p2 extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,e=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=t[i+e];return this.check()}toArray(t=[],e=0){for(let i=0;i<this.ELEMENTS;++i)t[e+i]=this[i];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:ya(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(In)}formatString(t){let e="";for(let i=0;i<this.ELEMENTS;++i)e+=(i>0?", ":"")+EO(this[i],t);return`${t.printTypes?this.constructor.name:""}[${e}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!ol(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,i){if(i===void 0)return this.lerp(this,t,e);for(let s=0;s<this.ELEMENTS;++s){const r=t[s],l=typeof e=="number"?e:e[s];this[s]=r+i*(l-r)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t[i]),e[i]);return this.check()}add(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]+=e[i];return this.check()}subtract(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]-=e[i];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(In.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t),e);return this.check()}get elements(){return this}}function OO(n,t){if(n.length!==t)return!1;for(let e=0;e<n.length;++e)if(!Number.isFinite(n[e]))return!1;return!0}function dn(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function ep(n,t,e=""){if(In.debug&&!OO(n,t))throw new Error(`math.gl: ${e} some fields set to invalid numbers'`);return n}function Cv(n,t){if(!n)throw new Error(`math.gl assertion ${t}`)}class IO extends p2{get x(){return this[0]}set x(t){this[0]=dn(t)}get y(){return this[1]}set y(t){this[1]=dn(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-t[i];e+=s*s}return dn(e)}dot(t){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*t[i];return dn(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]*=e[i];return this.check()}divide(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Cv(t>=0&&t<this.ELEMENTS,"index is out of range"),dn(this[t])}setComponent(t,e){return Cv(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}const xu=1e-6;let ba=typeof Float32Array<"u"?Float32Array:Array;function PO(){const n=new ba(2);return ba!=Float32Array&&(n[0]=0,n[1]=0),n}function Mv(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n}function DO(n,t){return n[0]=-t[0],n[1]=-t[1],n}function g2(n,t,e,i){const s=t[0],r=t[1];return n[0]=s+i*(e[0]-s),n[1]=r+i*(e[1]-r),n}function kO(n,t,e){const i=t[0],s=t[1];return n[0]=e[0]*i+e[4]*s+e[12],n[1]=e[1]*i+e[5]*s+e[13],n}(function(){const n=PO();return function(t,e,i,s,r,l){let c,f;for(e||(e=2),i||(i=0),s?f=Math.min(s*e+i,t.length):f=t.length,c=i;c<f;c+=e)n[0]=t[c],n[1]=t[c+1],r(n,n,l),t[c]=n[0],t[c+1]=n[1];return t}})();function NO(n,t,e){const i=t[0],s=t[1],r=e[3]*i+e[7]*s||1;return n[0]=(e[0]*i+e[4]*s)/r,n[1]=(e[1]*i+e[5]*s)/r,n}function _2(n,t,e){const i=t[0],s=t[1],r=t[2],l=e[3]*i+e[7]*s+e[11]*r||1;return n[0]=(e[0]*i+e[4]*s+e[8]*r)/l,n[1]=(e[1]*i+e[5]*s+e[9]*r)/l,n[2]=(e[2]*i+e[6]*s+e[10]*r)/l,n}function BO(n,t,e){const i=t[0],s=t[1];return n[0]=e[0]*i+e[2]*s,n[1]=e[1]*i+e[3]*s,n[2]=t[2],n}function UO(){const n=new ba(3);return ba!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function FO(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function LO(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n}function zO(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function VO(n,t,e){const i=t[0],s=t[1],r=t[2],l=e[0],c=e[1],f=e[2];return n[0]=s*f-r*c,n[1]=r*l-i*f,n[2]=i*c-s*l,n}function m2(n,t,e){const i=t[0],s=t[1],r=t[2];let l=e[3]*i+e[7]*s+e[11]*r+e[15];return l=l||1,n[0]=(e[0]*i+e[4]*s+e[8]*r+e[12])/l,n[1]=(e[1]*i+e[5]*s+e[9]*r+e[13])/l,n[2]=(e[2]*i+e[6]*s+e[10]*r+e[14])/l,n}function HO(n,t,e){const i=t[0],s=t[1],r=t[2];return n[0]=i*e[0]+s*e[3]+r*e[6],n[1]=i*e[1]+s*e[4]+r*e[7],n[2]=i*e[2]+s*e[5]+r*e[8],n}function jO(n,t,e){const i=e[0],s=e[1],r=e[2],l=e[3],c=t[0],f=t[1],d=t[2];let p=s*d-r*f,_=r*c-i*d,y=i*f-s*c,b=s*y-r*_,x=r*p-i*y,T=i*_-s*p;const A=l*2;return p*=A,_*=A,y*=A,b*=2,x*=2,T*=2,n[0]=c+p+b,n[1]=f+_+x,n[2]=d+y+T,n}function WO(n,t,e,i){const s=[],r=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],r[0]=s[0],r[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),r[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function $O(n,t,e,i){const s=[],r=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],r[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),r[1]=s[1],r[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function XO(n,t,e,i){const s=[],r=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],r[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),r[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),r[2]=s[2],n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function YO(n,t){const e=n[0],i=n[1],s=n[2],r=t[0],l=t[1],c=t[2],f=Math.sqrt((e*e+i*i+s*s)*(r*r+l*l+c*c)),d=f&&zO(n,t)/f;return Math.acos(Math.min(Math.max(d,-1),1))}const qO=FO;(function(){const n=UO();return function(t,e,i,s,r,l){let c,f;for(e||(e=3),i||(i=0),s?f=Math.min(s*e+i,t.length):f=t.length,c=i;c<f;c+=e)n[0]=t[c],n[1]=t[c+1],n[2]=t[c+2],r(n,n,l),t[c]=n[0],t[c+1]=n[1],t[c+2]=n[2];return t}})();const np=[0,0,0];let Kc;class si extends IO{static get ZERO(){return Kc||(Kc=new si(0,0,0),Object.freeze(Kc)),Kc}constructor(t=0,e=0,i=0){super(-0,-0,-0),arguments.length===1&&ya(t)?this.copy(t):(In.debug&&(dn(t),dn(e),dn(i)),this[0]=t,this[1]=e,this[2]=i)}set(t,e,i){return this[0]=t,this[1]=e,this[2]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return In.debug&&(dn(t.x),dn(t.y),dn(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=dn(t)}angle(t){return YO(this,t)}cross(t){return VO(this,this,t),this.check()}rotateX({radians:t,origin:e=np}){return WO(this,this,e,t),this.check()}rotateY({radians:t,origin:e=np}){return $O(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=np}){return XO(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return m2(this,this,t),this.check()}transformAsVector(t){return _2(this,this,t),this.check()}transformByMatrix3(t){return HO(this,this,t),this.check()}transformByMatrix2(t){return BO(this,this,t),this.check()}transformByQuaternion(t){return jO(this,this,t),this.check()}}class KO extends p2{toString(){let t="[";if(In.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let i=0;i<this.RANK;++i)t+=` ${this[i*this.RANK+e]}`}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=` ${this[e]}`}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,i){return this[e*this.RANK+t]=dn(i),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const i=t*this.RANK;for(let s=0;s<this.RANK;++s)e[s]=this[i+s];return e}setColumn(t,e){const i=t*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=e[s];return this}}function ZO(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function QO(n,t){if(n===t){const e=t[1],i=t[2],s=t[3],r=t[6],l=t[7],c=t[11];n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=e,n[6]=t[9],n[7]=t[13],n[8]=i,n[9]=r,n[11]=t[14],n[12]=s,n[13]=l,n[14]=c}else n[0]=t[0],n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=t[1],n[5]=t[5],n[6]=t[9],n[7]=t[13],n[8]=t[2],n[9]=t[6],n[10]=t[10],n[11]=t[14],n[12]=t[3],n[13]=t[7],n[14]=t[11],n[15]=t[15];return n}function Wp(n,t){const e=t[0],i=t[1],s=t[2],r=t[3],l=t[4],c=t[5],f=t[6],d=t[7],p=t[8],_=t[9],y=t[10],b=t[11],x=t[12],T=t[13],A=t[14],E=t[15],D=e*c-i*l,C=e*f-s*l,O=e*d-r*l,k=i*f-s*c,z=i*d-r*c,Y=s*d-r*f,q=p*T-_*x,G=p*A-y*x,at=p*E-b*x,nt=_*A-y*T,ot=_*E-b*T,xt=y*E-b*A;let dt=D*xt-C*ot+O*nt+k*at-z*G+Y*q;return dt?(dt=1/dt,n[0]=(c*xt-f*ot+d*nt)*dt,n[1]=(s*ot-i*xt-r*nt)*dt,n[2]=(T*Y-A*z+E*k)*dt,n[3]=(y*z-_*Y-b*k)*dt,n[4]=(f*at-l*xt-d*G)*dt,n[5]=(e*xt-s*at+r*G)*dt,n[6]=(A*O-x*Y-E*C)*dt,n[7]=(p*Y-y*O+b*C)*dt,n[8]=(l*ot-c*at+d*q)*dt,n[9]=(i*at-e*ot-r*q)*dt,n[10]=(x*z-T*O+E*D)*dt,n[11]=(_*O-p*z-b*D)*dt,n[12]=(c*G-l*nt-f*q)*dt,n[13]=(e*nt-i*G+s*q)*dt,n[14]=(T*C-x*k-A*D)*dt,n[15]=(p*k-_*C+y*D)*dt,n):null}function GO(n){const t=n[0],e=n[1],i=n[2],s=n[3],r=n[4],l=n[5],c=n[6],f=n[7],d=n[8],p=n[9],_=n[10],y=n[11],b=n[12],x=n[13],T=n[14],A=n[15],E=t*l-e*r,D=t*c-i*r,C=e*c-i*l,O=d*x-p*b,k=d*T-_*b,z=p*T-_*x,Y=t*z-e*k+i*O,q=r*z-l*k+c*O,G=d*C-p*D+_*E,at=b*C-x*D+T*E;return f*Y-s*q+A*G-y*at}function Js(n,t,e){const i=t[0],s=t[1],r=t[2],l=t[3],c=t[4],f=t[5],d=t[6],p=t[7],_=t[8],y=t[9],b=t[10],x=t[11],T=t[12],A=t[13],E=t[14],D=t[15];let C=e[0],O=e[1],k=e[2],z=e[3];return n[0]=C*i+O*c+k*_+z*T,n[1]=C*s+O*f+k*y+z*A,n[2]=C*r+O*d+k*b+z*E,n[3]=C*l+O*p+k*x+z*D,C=e[4],O=e[5],k=e[6],z=e[7],n[4]=C*i+O*c+k*_+z*T,n[5]=C*s+O*f+k*y+z*A,n[6]=C*r+O*d+k*b+z*E,n[7]=C*l+O*p+k*x+z*D,C=e[8],O=e[9],k=e[10],z=e[11],n[8]=C*i+O*c+k*_+z*T,n[9]=C*s+O*f+k*y+z*A,n[10]=C*r+O*d+k*b+z*E,n[11]=C*l+O*p+k*x+z*D,C=e[12],O=e[13],k=e[14],z=e[15],n[12]=C*i+O*c+k*_+z*T,n[13]=C*s+O*f+k*y+z*A,n[14]=C*r+O*d+k*b+z*E,n[15]=C*l+O*p+k*x+z*D,n}function zu(n,t,e){const i=e[0],s=e[1],r=e[2];let l,c,f,d,p,_,y,b,x,T,A,E;return t===n?(n[12]=t[0]*i+t[4]*s+t[8]*r+t[12],n[13]=t[1]*i+t[5]*s+t[9]*r+t[13],n[14]=t[2]*i+t[6]*s+t[10]*r+t[14],n[15]=t[3]*i+t[7]*s+t[11]*r+t[15]):(l=t[0],c=t[1],f=t[2],d=t[3],p=t[4],_=t[5],y=t[6],b=t[7],x=t[8],T=t[9],A=t[10],E=t[11],n[0]=l,n[1]=c,n[2]=f,n[3]=d,n[4]=p,n[5]=_,n[6]=y,n[7]=b,n[8]=x,n[9]=T,n[10]=A,n[11]=E,n[12]=l*i+p*s+x*r+t[12],n[13]=c*i+_*s+T*r+t[13],n[14]=f*i+y*s+A*r+t[14],n[15]=d*i+b*s+E*r+t[15]),n}function Kg(n,t,e){const i=e[0],s=e[1],r=e[2];return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i,n[4]=t[4]*s,n[5]=t[5]*s,n[6]=t[6]*s,n[7]=t[7]*s,n[8]=t[8]*r,n[9]=t[9]*r,n[10]=t[10]*r,n[11]=t[11]*r,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function JO(n,t,e,i){let s=i[0],r=i[1],l=i[2],c=Math.sqrt(s*s+r*r+l*l),f,d,p,_,y,b,x,T,A,E,D,C,O,k,z,Y,q,G,at,nt,ot,xt,dt,mt;return c<xu?null:(c=1/c,s*=c,r*=c,l*=c,d=Math.sin(e),f=Math.cos(e),p=1-f,_=t[0],y=t[1],b=t[2],x=t[3],T=t[4],A=t[5],E=t[6],D=t[7],C=t[8],O=t[9],k=t[10],z=t[11],Y=s*s*p+f,q=r*s*p+l*d,G=l*s*p-r*d,at=s*r*p-l*d,nt=r*r*p+f,ot=l*r*p+s*d,xt=s*l*p+r*d,dt=r*l*p-s*d,mt=l*l*p+f,n[0]=_*Y+T*q+C*G,n[1]=y*Y+A*q+O*G,n[2]=b*Y+E*q+k*G,n[3]=x*Y+D*q+z*G,n[4]=_*at+T*nt+C*ot,n[5]=y*at+A*nt+O*ot,n[6]=b*at+E*nt+k*ot,n[7]=x*at+D*nt+z*ot,n[8]=_*xt+T*dt+C*mt,n[9]=y*xt+A*dt+O*mt,n[10]=b*xt+E*dt+k*mt,n[11]=x*xt+D*dt+z*mt,t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n)}function y2(n,t,e){const i=Math.sin(e),s=Math.cos(e),r=t[4],l=t[5],c=t[6],f=t[7],d=t[8],p=t[9],_=t[10],y=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=r*s+d*i,n[5]=l*s+p*i,n[6]=c*s+_*i,n[7]=f*s+y*i,n[8]=d*s-r*i,n[9]=p*s-l*i,n[10]=_*s-c*i,n[11]=y*s-f*i,n}function tI(n,t,e){const i=Math.sin(e),s=Math.cos(e),r=t[0],l=t[1],c=t[2],f=t[3],d=t[8],p=t[9],_=t[10],y=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=r*s-d*i,n[1]=l*s-p*i,n[2]=c*s-_*i,n[3]=f*s-y*i,n[8]=r*i+d*s,n[9]=l*i+p*s,n[10]=c*i+_*s,n[11]=f*i+y*s,n}function b2(n,t,e){const i=Math.sin(e),s=Math.cos(e),r=t[0],l=t[1],c=t[2],f=t[3],d=t[4],p=t[5],_=t[6],y=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=r*s+d*i,n[1]=l*s+p*i,n[2]=c*s+_*i,n[3]=f*s+y*i,n[4]=d*s-r*i,n[5]=p*s-l*i,n[6]=_*s-c*i,n[7]=y*s-f*i,n}function eI(n,t){const e=t[0],i=t[1],s=t[2],r=t[3],l=e+e,c=i+i,f=s+s,d=e*l,p=i*l,_=i*c,y=s*l,b=s*c,x=s*f,T=r*l,A=r*c,E=r*f;return n[0]=1-_-x,n[1]=p+E,n[2]=y-A,n[3]=0,n[4]=p-E,n[5]=1-d-x,n[6]=b+T,n[7]=0,n[8]=y+A,n[9]=b-T,n[10]=1-d-_,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function nI(n,t,e,i,s,r,l){const c=1/(e-t),f=1/(s-i),d=1/(r-l);return n[0]=r*2*c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r*2*f,n[6]=0,n[7]=0,n[8]=(e+t)*c,n[9]=(s+i)*f,n[10]=(l+r)*d,n[11]=-1,n[12]=0,n[13]=0,n[14]=l*r*2*d,n[15]=0,n}function iI(n,t,e,i,s){const r=1/Math.tan(t/2);if(n[0]=r/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0){const l=1/(i-s);n[10]=(s+i)*l,n[14]=2*s*i*l}else n[10]=-1,n[14]=-2*i;return n}const sI=iI;function rI(n,t,e,i,s,r,l){const c=1/(t-e),f=1/(i-s),d=1/(r-l);return n[0]=-2*c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*d,n[11]=0,n[12]=(t+e)*c,n[13]=(s+i)*f,n[14]=(l+r)*d,n[15]=1,n}const aI=rI;function oI(n,t,e,i){let s,r,l,c,f,d,p,_,y,b;const x=t[0],T=t[1],A=t[2],E=i[0],D=i[1],C=i[2],O=e[0],k=e[1],z=e[2];return Math.abs(x-O)<xu&&Math.abs(T-k)<xu&&Math.abs(A-z)<xu?ZO(n):(_=x-O,y=T-k,b=A-z,s=1/Math.sqrt(_*_+y*y+b*b),_*=s,y*=s,b*=s,r=D*b-C*y,l=C*_-E*b,c=E*y-D*_,s=Math.sqrt(r*r+l*l+c*c),s?(s=1/s,r*=s,l*=s,c*=s):(r=0,l=0,c=0),f=y*c-b*l,d=b*r-_*c,p=_*l-y*r,s=Math.sqrt(f*f+d*d+p*p),s?(s=1/s,f*=s,d*=s,p*=s):(f=0,d=0,p=0),n[0]=r,n[1]=f,n[2]=_,n[3]=0,n[4]=l,n[5]=d,n[6]=y,n[7]=0,n[8]=c,n[9]=p,n[10]=b,n[11]=0,n[12]=-(r*x+l*T+c*A),n[13]=-(f*x+d*T+p*A),n[14]=-(_*x+y*T+b*A),n[15]=1,n)}function lI(){const n=new ba(4);return ba!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function cI(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n}function yl(n,t,e){const i=t[0],s=t[1],r=t[2],l=t[3];return n[0]=e[0]*i+e[4]*s+e[8]*r+e[12]*l,n[1]=e[1]*i+e[5]*s+e[9]*r+e[13]*l,n[2]=e[2]*i+e[6]*s+e[10]*r+e[14]*l,n[3]=e[3]*i+e[7]*s+e[11]*r+e[15]*l,n}(function(){const n=lI();return function(t,e,i,s,r,l){let c,f;for(e||(e=4),i||(i=0),s?f=Math.min(s*e+i,t.length):f=t.length,c=i;c<f;c+=e)n[0]=t[c],n[1]=t[c+1],n[2]=t[c+2],n[3]=t[c+3],r(n,n,l),t[c]=n[0],t[c+1]=n[1],t[c+2]=n[2],t[c+3]=n[3];return t}})();var $p;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})($p||($p={}));const uI=45*Math.PI/180,fI=1,ip=.1,sp=500,hI=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ri extends KO{static get IDENTITY(){return pI()}static get ZERO(){return dI()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return $p}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,i,s,r,l,c,f,d,p,_,y,b,x,T,A){return this[0]=t,this[1]=e,this[2]=i,this[3]=s,this[4]=r,this[5]=l,this[6]=c,this[7]=f,this[8]=d,this[9]=p,this[10]=_,this[11]=y,this[12]=b,this[13]=x,this[14]=T,this[15]=A,this.check()}setRowMajor(t,e,i,s,r,l,c,f,d,p,_,y,b,x,T,A){return this[0]=t,this[1]=r,this[2]=d,this[3]=b,this[4]=e,this[5]=l,this[6]=p,this[7]=x,this[8]=i,this[9]=c,this[10]=_,this[11]=T,this[12]=s,this[13]=f,this[14]=y,this[15]=A,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(hI)}fromObject(t){return this.check()}fromQuaternion(t){return eI(this,t),this.check()}frustum(t){const{left:e,right:i,bottom:s,top:r,near:l=ip,far:c=sp}=t;return c===1/0?gI(this,e,i,s,r,l):nI(this,e,i,s,r,l,c),this.check()}lookAt(t){const{eye:e,center:i=[0,0,0],up:s=[0,1,0]}=t;return oI(this,e,i,s),this.check()}ortho(t){const{left:e,right:i,bottom:s,top:r,near:l=ip,far:c=sp}=t;return aI(this,e,i,s,r,l,c),this.check()}orthographic(t){const{fovy:e=uI,aspect:i=fI,focalDistance:s=1,near:r=ip,far:l=sp}=t;Ov(e);const c=e/2,f=s*Math.tan(c),d=f*i;return this.ortho({left:-d,right:d,bottom:-f,top:f,near:r,far:l})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:i=1,near:s=.1,far:r=500}=t;return Ov(e),sI(this,e,i,s,r),this.check()}determinant(){return GO(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const i=this.getScale(e),s=1/i[0],r=1/i[1],l=1/i[2];return t[0]=this[0]*s,t[1]=this[1]*r,t[2]=this[2]*l,t[3]=0,t[4]=this[4]*s,t[5]=this[5]*r,t[6]=this[6]*l,t[7]=0,t[8]=this[8]*s,t[9]=this[9]*r,t[10]=this[10]*l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const i=this.getScale(e),s=1/i[0],r=1/i[1],l=1/i[2];return t[0]=this[0]*s,t[1]=this[1]*r,t[2]=this[2]*l,t[3]=this[4]*s,t[4]=this[5]*r,t[5]=this[6]*l,t[6]=this[8]*s,t[7]=this[9]*r,t[8]=this[10]*l,t}transpose(){return QO(this,this),this.check()}invert(){return Wp(this,this),this.check()}multiplyLeft(t){return Js(this,t,this),this.check()}multiplyRight(t){return Js(this,this,t),this.check()}rotateX(t){return y2(this,this,t),this.check()}rotateY(t){return tI(this,this,t),this.check()}rotateZ(t){return b2(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return JO(this,this,t,e),this.check()}scale(t){return Kg(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return zu(this,this,t),this.check()}transform(t,e){return t.length===4?(e=yl(e||[-0,-0,-0,-0],t,this),ep(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:i}=t;let s;switch(i){case 2:s=kO(e||[-0,-0],t,this);break;case 3:s=m2(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return ep(s,t.length),s}transformAsVector(t,e){let i;switch(t.length){case 2:i=NO(e||[-0,-0],t,this);break;case 3:i=_2(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return ep(i,t.length),i}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,i){return this.identity().translate([t,e,i])}}let Zc,Qc;function dI(){return Zc||(Zc=new ri([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Zc)),Zc}function pI(){return Qc||(Qc=new ri,Object.freeze(Qc)),Qc}function Ov(n){if(n>Math.PI*2)throw Error("expected radians")}function gI(n,t,e,i,s,r){const l=2*r/(e-t),c=2*r/(s-i),f=(e+t)/(e-t),d=(s+i)/(s-i),p=-1,_=-1,y=-2*r;return n[0]=l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=c,n[6]=0,n[7]=0,n[8]=f,n[9]=d,n[10]=p,n[11]=_,n[12]=0,n[13]=0,n[14]=y,n[15]=0,n}function v2(n,t=[],e=0){const i=Math.fround(n),s=n-i;return t[e]=i,t[e+1]=s,t}function _I(n){return n-Math.fround(n)}function mI(n){const t=new Float32Array(32);for(let e=0;e<4;++e)for(let i=0;i<4;++i){const s=e*4+i;v2(n[i*4+e],t,s*2)}return t}const yI=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,bI={name:"fp32",vs:yI},vI=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,xI={ONE:1},TI={name:"fp64arithmetic",vs:vI,defaultUniforms:xI,uniformTypes:{ONE:"f32"},fp64ify:v2,fp64LowPart:_I,fp64ifyMatrix4:mI},SI=[0,1,1,1],AI=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,wI=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,Iv={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:SI},vs:AI,fs:wI,getUniforms:EI};function EI(n={},t){const e={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)e.isHighlightActive=!1;else{e.isHighlightActive=!0;const i=n.highlightedObjectColor.slice(0,3);e.highlightedObjectColor=i}if(n.highlightColor){const i=Array.from(n.highlightColor,s=>s/255);Number.isFinite(i[3])||(i[3]=1),e.highlightColor=i}return n.isActive!==void 0&&(e.isActive=!!n.isActive,e.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(e.useFloatColors=!!n.useFloatColors),e}const Pv=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,RI={name:"layer",vs:Pv,fs:Pv,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},CI=`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,MI={name:"color",dependencies:[],source:CI,getUniforms:n=>({}),uniformTypes:{opacity:"f32"}},OI=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,x2="#define SMOOTH_EDGE_RADIUS 0.5",II=`${x2}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,PI=`${x2}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,T2={name:"geometry",source:OI,vs:II,fs:PI},DI=25;var be;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(be||(be={}));var Te;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(Te||(Te={}));var vt;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(vt||(vt={}));const kI="compute",NI="auto",Xp="manipulation",Tu="none",Yp="pan-x",qp="pan-y";function BI(n){if(n.includes(Tu))return Tu;const t=n.includes(Yp),e=n.includes(qp);return t&&e?Tu:t||e?t?Yp:qp:n.includes(Xp)?Xp:NI}class UI{constructor(t,e){this.actions="",this.manager=t,this.set(e)}set(t){t===kI&&(t=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=t,this.actions=t)}update(){this.set(this.manager.options.touchAction)}compute(){let t=[];for(const e of this.manager.recognizers)e.options.enable&&(t=t.concat(e.getTouchAction()));return BI(t.join(" "))}}function Vu(n){return n.trim().split(/\s+/g)}function rp(n,t,e){if(n)for(const i of Vu(t))n.addEventListener(i,e,!1)}function ap(n,t,e){if(n)for(const i of Vu(t))n.removeEventListener(i,e,!1)}function Dv(n){return(n.ownerDocument||n).defaultView}function FI(n,t){let e=n;for(;e;){if(e===t)return!0;e=e.parentNode}return!1}function S2(n){const t=n.length;if(t===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let e=0,i=0,s=0;for(;s<t;)e+=n[s].clientX,i+=n[s].clientY,s++;return{x:Math.round(e/t),y:Math.round(i/t)}}function kv(n){const t=[];let e=0;for(;e<n.pointers.length;)t[e]={clientX:Math.round(n.pointers[e].clientX),clientY:Math.round(n.pointers[e].clientY)},e++;return{timeStamp:Date.now(),pointers:t,center:S2(t),deltaX:n.deltaX,deltaY:n.deltaY}}function A2(n,t){const e=t.x-n.x,i=t.y-n.y;return Math.sqrt(e*e+i*i)}function Nv(n,t){const e=t.clientX-n.clientX,i=t.clientY-n.clientY;return Math.sqrt(e*e+i*i)}function LI(n,t){const e=t.x-n.x,i=t.y-n.y;return Math.atan2(i,e)*180/Math.PI}function Bv(n,t){const e=t.clientX-n.clientX,i=t.clientY-n.clientY;return Math.atan2(i,e)*180/Math.PI}function w2(n,t){return n===t?Te.None:Math.abs(n)>=Math.abs(t)?n<0?Te.Left:Te.Right:t<0?Te.Up:Te.Down}function zI(n,t){const e=t.center;let i=n.offsetDelta,s=n.prevDelta;const r=n.prevInput;return(t.eventType===be.Start||r?.eventType===be.End)&&(s=n.prevDelta={x:r?.deltaX||0,y:r?.deltaY||0},i=n.offsetDelta={x:e.x,y:e.y}),{deltaX:s.x+(e.x-i.x),deltaY:s.y+(e.y-i.y)}}function E2(n,t,e){return{x:t/n||0,y:e/n||0}}function VI(n,t){return Nv(t[0],t[1])/Nv(n[0],n[1])}function HI(n,t){return Bv(t[1],t[0])-Bv(n[1],n[0])}function jI(n,t){const e=n.lastInterval||t,i=t.timeStamp-e.timeStamp;let s,r,l,c;if(t.eventType!==be.Cancel&&(i>DI||e.velocity===void 0)){const f=t.deltaX-e.deltaX,d=t.deltaY-e.deltaY,p=E2(i,f,d);r=p.x,l=p.y,s=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,c=w2(f,d),n.lastInterval=t}else s=e.velocity,r=e.velocityX,l=e.velocityY,c=e.direction;t.velocity=s,t.velocityX=r,t.velocityY=l,t.direction=c}function WI(n,t){const{session:e}=n,{pointers:i}=t,{length:s}=i;e.firstInput||(e.firstInput=kv(t)),s>1&&!e.firstMultiple?e.firstMultiple=kv(t):s===1&&(e.firstMultiple=!1);const{firstInput:r,firstMultiple:l}=e,c=l?l.center:r.center,f=t.center=S2(i);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-r.timeStamp,t.angle=LI(c,f),t.distance=A2(c,f);const{deltaX:d,deltaY:p}=zI(e,t);t.deltaX=d,t.deltaY=p,t.offsetDirection=w2(t.deltaX,t.deltaY);const _=E2(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=_.x,t.overallVelocityY=_.y,t.overallVelocity=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,t.scale=l?VI(l.pointers,i):1,t.rotation=l?HI(l.pointers,i):0,t.maxPointers=e.prevInput?t.pointers.length>e.prevInput.maxPointers?t.pointers.length:e.prevInput.maxPointers:t.pointers.length;let y=n.element;return FI(t.srcEvent.target,y)&&(y=t.srcEvent.target),t.target=y,jI(e,t),t}function $I(n,t,e){const i=e.pointers.length,s=e.changedPointers.length,r=t&be.Start&&i-s===0,l=t&(be.End|be.Cancel)&&i-s===0;e.isFirst=!!r,e.isFinal=!!l,r&&(n.session={}),e.eventType=t;const c=WI(n,e);n.emit("hammer.input",c),n.recognize(c),n.session.prevInput=c}let XI=class{constructor(t){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=t,this.element=t.element,this.target=t.options.inputTarget||t.element}callback(t,e){$I(this.manager,t,e)}init(){rp(this.element,this.evEl,this.domHandler),rp(this.target,this.evTarget,this.domHandler),rp(Dv(this.element),this.evWin,this.domHandler)}destroy(){ap(this.element,this.evEl,this.domHandler),ap(this.target,this.evTarget,this.domHandler),ap(Dv(this.element),this.evWin,this.domHandler)}};const YI={pointerdown:be.Start,pointermove:be.Move,pointerup:be.End,pointercancel:be.Cancel,pointerout:be.Cancel},qI="pointerdown",KI="pointermove pointerup pointercancel";class ZI extends XI{constructor(t){super(t),this.evEl=qI,this.evWin=KI,this.store=this.manager.session.pointerEvents=[],this.init()}handler(t){const{store:e}=this;let i=!1;const s=YI[t.type],r=t.pointerType,l=r==="touch";let c=e.findIndex(f=>f.pointerId===t.pointerId);s&be.Start&&(t.buttons||l)?c<0&&(e.push(t),c=e.length-1):s&(be.End|be.Cancel)&&(i=!0),!(c<0)&&(e[c]=t,this.callback(s,{pointers:e,changedPointers:[t],eventType:s,pointerType:r,srcEvent:t}),i&&e.splice(c,1))}}const QI=["","webkit","Moz","MS","ms","o"];function GI(n,t){const e=t[0].toUpperCase()+t.slice(1);for(const i of QI){const s=i?i+e:t;if(s in n)return s}}const JI=1,Uv=2,Fv={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class t4{constructor(t,e){this.options={...Fv,...e,cssProps:{...Fv.cssProps,...e.cssProps},inputTarget:e.inputTarget||t},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new ZI(this),this.touchAction=new UI(this,this.options.touchAction),this.toggleCssProps(!0)}set(t){return Object.assign(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this}stop(t){this.session.stopped=t?Uv:JI}recognize(t){const{session:e}=this;if(e.stopped)return;this.session.prevented&&t.srcEvent.preventDefault();let i;const{recognizers:s}=this;let{curRecognizer:r}=e;(!r||r&&r.state&vt.Recognized)&&(r=e.curRecognizer=null);let l=0;for(;l<s.length;)i=s[l],e.stopped!==Uv&&(!r||i===r||i.canRecognizeWith(r))?i.recognize(t):i.reset(),!r&&i.state&(vt.Began|vt.Changed|vt.Ended)&&(r=e.curRecognizer=i),l++}get(t){const{recognizers:e}=this;for(let i=0;i<e.length;i++)if(e[i].options.event===t)return e[i];return null}add(t){if(Array.isArray(t)){for(const i of t)this.add(i);return this}const e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t}remove(t){if(Array.isArray(t)){for(const i of t)this.remove(i);return this}const e=typeof t=="string"?this.get(t):t;if(e){const{recognizers:i}=this,s=i.indexOf(e);s!==-1&&(i.splice(s,1),this.touchAction.update())}return this}on(t,e){if(!t||!e)return;const{handlers:i}=this;for(const s of Vu(t))i[s]=i[s]||[],i[s].push(e)}off(t,e){if(!t)return;const{handlers:i}=this;for(const s of Vu(t))e?i[s]&&i[s].splice(i[s].indexOf(e),1):delete i[s]}emit(t,e){const i=this.handlers[t]&&this.handlers[t].slice();if(!i||!i.length)return;const s=e;s.type=t,s.preventDefault=function(){e.srcEvent.preventDefault()};let r=0;for(;r<i.length;)i[r](s),r++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(t){const{element:e}=this;if(e){for(const[i,s]of Object.entries(this.options.cssProps)){const r=GI(e.style,i);t?(this.oldCssProps[r]=e.style[r],e.style[r]=s):e.style[r]=this.oldCssProps[r]||""}t||(this.oldCssProps={})}}}let e4=1;function n4(){return e4++}function Lv(n){return n&vt.Cancelled?"cancel":n&vt.Ended?"end":n&vt.Changed?"move":n&vt.Began?"start":""}class R2{constructor(t){this.options=t,this.id=n4(),this.state=vt.Possible,this.simultaneous={},this.requireFail=[]}set(t){return Object.assign(this.options,t),this.manager.touchAction.update(),this}recognizeWith(t){if(Array.isArray(t)){for(const s of t)this.recognizeWith(s);return this}let e;if(typeof t=="string"){if(e=this.manager.get(t),!e)throw new Error(`Cannot find recognizer ${t}`)}else e=t;const{simultaneous:i}=this;return i[e.id]||(i[e.id]=e,e.recognizeWith(this)),this}dropRecognizeWith(t){if(Array.isArray(t)){for(const i of t)this.dropRecognizeWith(i);return this}let e;return typeof t=="string"?e=this.manager.get(t):e=t,e&&delete this.simultaneous[e.id],this}requireFailure(t){if(Array.isArray(t)){for(const s of t)this.requireFailure(s);return this}let e;if(typeof t=="string"){if(e=this.manager.get(t),!e)throw new Error(`Cannot find recognizer ${t}`)}else e=t;const{requireFail:i}=this;return i.indexOf(e)===-1&&(i.push(e),e.requireFailure(this)),this}dropRequireFailure(t){if(Array.isArray(t)){for(const i of t)this.dropRequireFailure(i);return this}let e;if(typeof t=="string"?e=this.manager.get(t):e=t,e){const i=this.requireFail.indexOf(e);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(t=>t.options.enable)}canRecognizeWith(t){return!!this.simultaneous[t.id]}emit(t){if(!t)return;const{state:e}=this;e<vt.Ended&&this.manager.emit(this.options.event+Lv(e),t),this.manager.emit(this.options.event,t),t.additionalEvent&&this.manager.emit(t.additionalEvent,t),e>=vt.Ended&&this.manager.emit(this.options.event+Lv(e),t)}tryEmit(t){this.canEmit()?this.emit(t):this.state=vt.Failed}canEmit(){let t=0;for(;t<this.requireFail.length;){if(!(this.requireFail[t].state&(vt.Failed|vt.Possible)))return!1;t++}return!0}recognize(t){const e={...t};if(!this.options.enable){this.reset(),this.state=vt.Failed;return}this.state&(vt.Recognized|vt.Cancelled|vt.Failed)&&(this.state=vt.Possible),this.state=this.process(e),this.state&(vt.Began|vt.Changed|vt.Ended|vt.Cancelled)&&this.tryEmit(e)}getEventNames(){return[this.options.event]}reset(){}}class C2 extends R2{attrTest(t){const e=this.options.pointers;return e===0||t.pointers.length===e}process(t){const{state:e}=this,{eventType:i}=t,s=e&(vt.Began|vt.Changed),r=this.attrTest(t);return s&&(i&be.Cancel||!r)?e|vt.Cancelled:s||r?i&be.End?e|vt.Ended:e&vt.Began?e|vt.Changed:vt.Began:vt.Failed}}class zv extends R2{constructor(t={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...t}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Xp]}process(t){const{options:e}=this,i=t.pointers.length===e.pointers,s=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&be.Start&&this.count===0)return this.failTimeout();if(s&&r&&i){if(t.eventType!==be.End)return this.failTimeout();const l=this.pTime?t.timeStamp-this.pTime<e.interval:!0,c=!this.pCenter||A2(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,!c||!l?this.count=1:this.count+=1,this._input=t,this.count%e.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=vt.Recognized,this.tryEmit(this._input)},e.interval),vt.Began):vt.Recognized}return vt.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=vt.Failed},this.options.interval),vt.Failed}reset(){clearTimeout(this._timer)}emit(t){this.state===vt.Recognized&&(t.tapCount=this.count,this.manager.emit(this.options.event,t))}}const i4=["","start","move","end","cancel","up","down","left","right"];class Vv extends C2{constructor(t={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Te.All,...t}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:t}}=this,e=[];return t&Te.Horizontal&&e.push(qp),t&Te.Vertical&&e.push(Yp),e}getEventNames(){return i4.map(t=>this.options.event+t)}directionTest(t){const{options:e}=this;let i=!0,{distance:s}=t,{direction:r}=t;const l=t.deltaX,c=t.deltaY;return r&e.direction||(e.direction&Te.Horizontal?(r=l===0?Te.None:l<0?Te.Left:Te.Right,i=l!==this.pX,s=Math.abs(t.deltaX)):(r=c===0?Te.None:c<0?Te.Up:Te.Down,i=c!==this.pY,s=Math.abs(t.deltaY))),t.direction=r,i&&s>e.threshold&&!!(r&e.direction)}attrTest(t){return super.attrTest(t)&&(!!(this.state&vt.Began)||!(this.state&vt.Began)&&this.directionTest(t))}emit(t){this.pX=t.deltaX,this.pY=t.deltaY;const e=Te[t.direction].toLowerCase();e&&(t.additionalEvent=this.options.event+e),super.emit(t)}}const s4=["","start","move","end","cancel","in","out"];class r4 extends C2{constructor(t={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...t})}getTouchAction(){return[Tu]}getEventNames(){return s4.map(t=>this.options.event+t)}attrTest(t){return super.attrTest(t)&&(Math.abs(t.scale-1)>this.options.threshold||!!(this.state&vt.Began))}emit(t){if(t.scale!==1){const e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}super.emit(t)}}class lf{constructor(t,e,i){this.element=t,this.callback=e,this.options=i}}const a4=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",o4=a4.indexOf("firefox")!==-1,Hv=4.000244140625,l4=40,c4=.25;class u4 extends lf{constructor(t,e,i){super(t,e,{enable:!0,...i}),this.handleEvent=s=>{if(!this.options.enable)return;let r=s.deltaY;globalThis.WheelEvent&&(o4&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(r/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(r*=l4)),r!==0&&r%Hv===0&&(r=Math.floor(r/Hv)),s.shiftKey&&r&&(r=r*c4),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-r,srcEvent:s,pointerType:"mouse",target:s.target})},t.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(t,e){t==="wheel"&&(this.options.enable=e)}}const jv=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class f4 extends lf{constructor(t,e,i){super(t,e,{enable:!0,...i}),this.handleEvent=r=>{this.handleOverEvent(r),this.handleOutEvent(r),this.handleEnterEvent(r),this.handleLeaveEvent(r),this.handleMoveEvent(r)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,jv.forEach(r=>t.addEventListener(r,this.handleEvent))}destroy(){jv.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){switch(t){case"pointermove":this.enableMoveEvent=e;break;case"pointerover":this.enableOverEvent=e;break;case"pointerout":this.enableOutEvent=e;break;case"pointerenter":this.enableEnterEvent=e;break;case"pointerleave":this.enableLeaveEvent=e;break}}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit("pointerover",t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit("pointerout",t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit("pointerenter",t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit("pointerleave",t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const Wv=["keydown","keyup"];class h4 extends lf{constructor(t,e,i){super(t,e,{enable:!0,tabIndex:0,...i}),this.handleEvent=s=>{const r=s.target||s.srcElement;r.tagName==="INPUT"&&r.type==="text"||r.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,t.tabIndex=this.options.tabIndex,t.style.outline="none",Wv.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){Wv.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t==="keydown"&&(this.enableDownEvent=e),t==="keyup"&&(this.enableUpEvent=e)}}class d4 extends lf{constructor(t,e,i){super(t,e,i),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t==="contextmenu"&&(this.options.enable=e)}}const $v=1,Kp=2,Xv=4,p4={pointerdown:$v,pointermove:Kp,pointerup:Xv,mousedown:$v,mousemove:Kp,mouseup:Xv},g4=0,_4=1,m4=2,y4=1,b4=2,v4=4;function x4(n){const t=p4[n.srcEvent.type];if(!t)return null;const{buttons:e,button:i}=n.srcEvent;let s=!1,r=!1,l=!1;return t===Kp?(s=!!(e&y4),r=!!(e&v4),l=!!(e&b4)):(s=i===g4,r=i===_4,l=i===m4),{leftButton:s,middleButton:r,rightButton:l}}function T4(n,t){const e=n.center;if(!e)return null;const i=t.getBoundingClientRect(),s=i.width/t.offsetWidth||1,r=i.height/t.offsetHeight||1,l={x:(e.x-i.left-t.clientLeft)/s,y:(e.y-i.top-t.clientTop)/r};return{center:e,offsetCenter:l}}const S4={srcElement:"root",priority:0};class A4{constructor(t,e){this.handleEvent=i=>{if(this.isEmpty())return;const s=this._normalizeEvent(i);let r=i.srcEvent.target;for(;r&&r!==s.rootElement;){if(this._emit(s,r),s.handled)return;r=r.parentNode}this._emit(s,"root")},this.eventManager=t,this.recognizerName=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,i,s=!1,r=!1){const{handlers:l,handlersByElement:c}=this,f={...S4,...i};let d=c.get(f.srcElement);d||(d=[],c.set(f.srcElement,d));const p={type:t,handler:e,srcElement:f.srcElement,priority:f.priority};s&&(p.once=!0),r&&(p.passive=!0),l.push(p),this._active=this._active||!p.passive;let _=d.length-1;for(;_>=0&&!(d[_].priority>=p.priority);)_--;d.splice(_+1,0,p)}remove(t,e){const{handlers:i,handlersByElement:s}=this;for(let r=i.length-1;r>=0;r--){const l=i[r];if(l.type===t&&l.handler===e){i.splice(r,1);const c=s.get(l.srcElement);c.splice(c.indexOf(l),1),c.length===0&&s.delete(l.srcElement)}}this._active=i.some(r=>!r.passive)}_emit(t,e){const i=this.handlersByElement.get(e);if(i){let s=!1;const r=()=>{t.handled=!0},l=()=>{t.handled=!0,s=!0},c=[];for(let f=0;f<i.length;f++){const{type:d,handler:p,once:_}=i[f];if(p({...t,type:d,stopPropagation:r,stopImmediatePropagation:l}),_&&c.push(i[f]),s)break}for(let f=0;f<c.length;f++){const{type:d,handler:p}=c[f];this.remove(d,p)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...x4(t),...T4(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}function w4(n){if("recognizer"in n)return n;let t;const e=Array.isArray(n)?[...n]:[n];if(typeof e[0]=="function"){const i=e.shift(),s=e.shift()||{};t=new i(s)}else t=e.shift();return{recognizer:t,recognizeWith:typeof e[0]=="string"?[e[0]]:e[0],requireFailure:typeof e[1]=="string"?[e[1]]:e[1]}}class E4{constructor(t=null,e={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...e},this.events=new Map,this.element=t,!!t){this.manager=new t4(t,this.options);for(const i of this.options.recognizers){const{recognizer:s,recognizeWith:r,requireFailure:l}=w4(i);this.manager.add(s),r&&s.recognizeWith(r),l&&s.requireFailure(l)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new u4(t,this._onOtherEvent,{enable:!1}),this.moveInput=new f4(t,this._onOtherEvent,{enable:!1}),this.keyInput=new h4(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new d4(t,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(t,e,i){this._addEventHandler(t,e,i,!1)}once(t,e,i){this._addEventHandler(t,e,i,!0)}watch(t,e,i){this._addEventHandler(t,e,i,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:i}=this;if(!i)return;const s=i.get(t);s&&(s.set({enable:e}),i.touchAction.update()),this.wheelInput?.enableEventType(t,e),this.moveInput?.enableEventType(t,e),this.keyInput?.enableEventType(t,e),this.contextmenuInput?.enableEventType(t,e)}_addEventHandler(t,e,i,s,r){if(typeof t!="string"){i=e;for(const[d,p]of Object.entries(t))this._addEventHandler(d,p,i,s,r);return}const{manager:l,events:c}=this;if(!l)return;let f=c.get(t);if(!f){const d=this._getRecognizerName(t)||t;f=new A4(this,d),c.set(t,f),l&&l.on(t,f.handleEvent)}f.add(t,e,i,s,r),f.isEmpty()||this._toggleRecognizer(f.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const[r,l]of Object.entries(t))this._removeEventHandler(r,l);return}const{events:i}=this,s=i.get(t);if(s&&(s.remove(t,e),s.isEmpty())){const{recognizerName:r}=s;let l=!1;for(const c of i.values())if(c.recognizerName===r&&!c.isEmpty()){l=!0;break}l||this._toggleRecognizer(r,!1)}}_getRecognizerName(t){return this.manager.recognizers.find(e=>e.getEventNames().includes(t))?.options.event}}const Ut={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ut,"IDENTITY",{get:()=>(Qt.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const En={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},lr={common:0,meters:1,pixels:2},Zp={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Yv={multipan:[Vv,{threshold:10,direction:Te.Vertical,pointers:2}],pinch:[r4,{},null,["multipan"]],pan:[Vv,{threshold:1},["pinch"],["multipan"]],dblclick:[zv,{event:"dblclick",taps:2}],click:[zv,{event:"click"},null,["dblclick"]]};function R4(n,t){if(n===t)return!0;if(Array.isArray(n)){const e=n.length;if(!t||t.length!==e)return!1;for(let i=0;i<e;i++)if(n[i]!==t[i])return!1;return!0}return!1}function bl(n){let t={},e;return i=>{for(const s in i)if(!R4(i[s],t[s])){e=n(i),t=i;break}return e}}const qv=[0,0,0,0],C4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],M2=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],M4=[0,0,0],O2=[0,0,0],O4=bl(D4);function I2(n,t,e=O2){e.length<3&&(e=[e[0],e[1],0]);let i=e,s,r=!0;switch(t===Ut.LNGLAT_OFFSETS||t===Ut.METER_OFFSETS?s=e:s=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case En.WEB_MERCATOR:(t===Ut.LNGLAT||t===Ut.CARTESIAN)&&(s=[0,0,0],r=!1);break;case En.WEB_MERCATOR_AUTO_OFFSET:t===Ut.LNGLAT?i=s:t===Ut.CARTESIAN&&(i=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],s=n.unprojectPosition(i),i[0]-=e[0],i[1]-=e[1],i[2]-=e[2]);break;case En.IDENTITY:i=n.position.map(Math.fround),i[2]=i[2]||0;break;case En.GLOBE:r=!1,s=null;break;default:r=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:r}}function I4(n,t,e){const{viewMatrixUncentered:i,projectionMatrix:s}=n;let{viewMatrix:r,viewProjectionMatrix:l}=n,c=qv,f=qv,d=n.cameraPosition;const{geospatialOrigin:p,shaderCoordinateOrigin:_,offsetMode:y}=I2(n,t,e);return y&&(f=n.projectPosition(p||_),d=[d[0]-f[0],d[1]-f[1],d[2]-f[2]],f[3]=1,c=yl([],f,l),r=i||r,l=Js([],s,r),l=Js([],l,C4)),{viewMatrix:r,viewProjectionMatrix:l,projectionCenter:c,originCommon:f,cameraPosCommon:d,shaderCoordinateOrigin:_,geospatialOrigin:p}}function P4({viewport:n,devicePixelRatio:t=1,modelMatrix:e=null,coordinateSystem:i=Ut.DEFAULT,coordinateOrigin:s=O2,autoWrapLongitude:r=!1}){i===Ut.DEFAULT&&(i=n.isGeospatial?Ut.LNGLAT:Ut.CARTESIAN);const l=O4({viewport:n,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:s});return l.wrapLongitude=r,l.modelMatrix=e||M2,l}function D4({viewport:n,devicePixelRatio:t,coordinateSystem:e,coordinateOrigin:i}){const{projectionCenter:s,viewProjectionMatrix:r,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:d}=I4(n,e,i),p=n.getDistanceScales(),_=[n.width*t,n.height*t],y=yl([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,b={coordinateSystem:e,projectionMode:n.projectionMode,coordinateOrigin:f,commonOrigin:l.slice(0,3),center:s,pseudoMeters:!!n._pseudoMeters,viewportSize:_,devicePixelRatio:t,focalDistance:y,commonUnitsPerMeter:p.unitsPerMeter,commonUnitsPerWorldUnit:p.unitsPerMeter,commonUnitsPerWorldUnit2:M4,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:r,modelMatrix:M2,cameraPosition:c};if(d){const x=n.getDistanceScales(d);switch(e){case Ut.METER_OFFSETS:b.commonUnitsPerWorldUnit=x.unitsPerMeter,b.commonUnitsPerWorldUnit2=x.unitsPerMeter2;break;case Ut.LNGLAT:case Ut.LNGLAT_OFFSETS:n._pseudoMeters||(b.commonUnitsPerMeter=x.unitsPerMeter),b.commonUnitsPerWorldUnit=x.unitsPerDegree,b.commonUnitsPerWorldUnit2=x.unitsPerDegree2;break;case Ut.CARTESIAN:b.commonUnitsPerWorldUnit=[1,1,x.unitsPerMeter[2]],b.commonUnitsPerWorldUnit2=[0,0,x.unitsPerMeter2[2]];break}}return b}const k4=Object.keys(Ut).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${Ut[n]};`).join(""),N4=Object.keys(En).map(n=>`const PROJECTION_MODE_${n}: i32 = ${En[n]};`).join(""),B4=Object.keys(lr).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${lr[n]};`).join(""),U4=`${k4}
${N4}
${B4}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,F4=`${U4}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,L4=Object.keys(Ut).map(n=>`const int COORDINATE_SYSTEM_${n} = ${Ut[n]};`).join(""),z4=Object.keys(En).map(n=>`const int PROJECTION_MODE_${n} = ${En[n]};`).join(""),V4=Object.keys(lr).map(n=>`const int UNIT_${n.toUpperCase()} = ${lr[n]};`).join(""),H4=`${L4}
${z4}
${V4}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,j4={};function W4(n=j4){return"viewport"in n?P4(n):{}}const Zg={name:"project",dependencies:[bI,T2],source:F4,vs:H4,getUniforms:W4,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},$4=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,X4=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,P2={name:"project32",dependencies:[Zg],source:$4,vs:X4};function Y4(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function pa(n,t){const e=yl([],t,n);return cI(e,e,1/e[3]),e}function Kv(n,t){const e=n%t;return e<0?t+e:e}function Qp(n,t,e){return n<t?t:n>e?e:n}function q4(n){return Math.log(n)*Math.LOG2E}const Qg=Math.log2||q4;function Pi(n,t){if(!n)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const Hn=Math.PI,D2=Hn/4,Pn=Hn/180,Gp=180/Hn,va=512,Hu=4003e4,Gc=85.051129,K4=1.5;function Z4(n){return Qg(n)}function ju(n){const[t,e]=n;Pi(Number.isFinite(t)),Pi(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const i=t*Pn,s=e*Pn,r=va*(i+Hn)/(2*Hn),l=va*(Hn+Math.log(Math.tan(D2+s*.5)))/(2*Hn);return[r,l]}function xa(n){const[t,e]=n,i=t/va*(2*Hn)-Hn,s=2*(Math.atan(Math.exp(e/va*(2*Hn)-Hn))-D2);return[i*Gp,s*Gp]}function Q4(n){const{latitude:t}=n;Pi(Number.isFinite(t));const e=Math.cos(t*Pn);return Z4(Hu*e)-9}function op(n){const t=Math.cos(n*Pn);return va/Hu/t}function Jp(n){const{latitude:t,longitude:e,highPrecision:i=!1}=n;Pi(Number.isFinite(t)&&Number.isFinite(e));const s=va,r=Math.cos(t*Pn),l=s/360,c=l/r,f=s/Hu/r,d={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[l,c,f],degreesPerUnit:[1/l,1/c,1/f]};if(i){const p=Pn*Math.tan(t*Pn)/r,_=l*p/2,y=s/Hu*p,b=y/c*f;d.unitsPerDegree2=[0,_,y],d.unitsPerMeter2=[b,0,b]}return d}function k2(n,t){const[e,i,s]=n,[r,l,c]=t,{unitsPerMeter:f,unitsPerMeter2:d}=Jp({longitude:e,latitude:i,highPrecision:!0}),p=ju(n);p[0]+=r*(f[0]+d[0]*l),p[1]+=l*(f[1]+d[1]*l);const _=xa(p),y=(s||0)+(c||0);return Number.isFinite(s)||Number.isFinite(c)?[_[0],_[1],y]:_}function G4(n){const{height:t,pitch:e,bearing:i,altitude:s,scale:r,center:l}=n,c=Y4();zu(c,c,[0,0,-s]),y2(c,c,-e*Pn),b2(c,c,i*Pn);const f=r/t;return Kg(c,c,[f,f,f]),l&&zu(c,c,LO([],l)),c}function J4(n){const{width:t,height:e,altitude:i,pitch:s=0,offset:r,center:l,scale:c,nearZMultiplier:f=1,farZMultiplier:d=1}=n;let{fovy:p=Wu(K4)}=n;i!==void 0&&(p=Wu(i));const _=p*Pn,y=s*Pn,b=N2(p);let x=b;l&&(x+=l[2]*c/Math.cos(y)/e);const T=_*(.5+(r?r[1]:0)/e),A=Math.sin(T)*x/Math.sin(Qp(Math.PI/2-y-T,.01,Math.PI-.01)),E=Math.sin(y)*A+x,D=x*10,C=Math.min(E*d,D);return{fov:_,aspect:t/e,focalDistance:b,near:f,far:C}}function Wu(n){return 2*Math.atan(.5/n)*Gp}function N2(n){return .5/Math.tan(.5*n*Pn)}function B2(n,t){const[e,i,s=0]=n;return Pi(Number.isFinite(e)&&Number.isFinite(i)&&Number.isFinite(s)),pa(t,[e,i,s,1])}function Gg(n,t,e=0){const[i,s,r]=n;if(Pi(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(r))return pa(t,[i,s,r,1]);const l=pa(t,[i,s,0,1]),c=pa(t,[i,s,1,1]),f=l[2],d=c[2],p=f===d?0:((e||0)-f)/(d-f);return g2([],l,c,p)}function tP(n){const{width:t,height:e,bounds:i,minExtent:s=0,maxZoom:r=24,offset:l=[0,0]}=n,[[c,f],[d,p]]=i,_=eP(n.padding),y=ju([c,Qp(p,-Gc,Gc)]),b=ju([d,Qp(f,-Gc,Gc)]),x=[Math.max(Math.abs(b[0]-y[0]),s),Math.max(Math.abs(b[1]-y[1]),s)],T=[t-_.left-_.right-Math.abs(l[0])*2,e-_.top-_.bottom-Math.abs(l[1])*2];Pi(T[0]>0&&T[1]>0);const A=T[0]/x[0],E=T[1]/x[1],D=(_.right-_.left)/2/A,C=(_.top-_.bottom)/2/E,O=[(b[0]+y[0])/2+D,(b[1]+y[1])/2+C],k=xa(O),z=Math.min(r,Qg(Math.abs(Math.min(A,E))));return Pi(Number.isFinite(z)),{longitude:k[0],latitude:k[1],zoom:z}}function eP(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(Pi(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const Zv=Math.PI/180;function nP(n,t=0){const{width:e,height:i,unproject:s}=n,r={targetZ:t},l=s([0,i],r),c=s([e,i],r);let f,d;const p=n.fovy?.5*n.fovy*Zv:Math.atan(.5/n.altitude),_=(90-n.pitch)*Zv;return p>_-.01?(f=Qv(n,0,t),d=Qv(n,e,t)):(f=s([0,0],r),d=s([e,0],r)),[l,c,d,f]}function Qv(n,t,e){const{pixelUnprojectionMatrix:i}=n,s=pa(i,[t,0,1,1]),r=pa(i,[t,n.height,1,1]),c=(e*n.distanceScales.unitsPerMeter[2]-s[2])/(r[2]-s[2]),f=g2([],s,r,c),d=xa(f);return d.push(e),d}const Gv=512;function iP(n){const{width:t,height:e,pitch:i=0}=n;let{longitude:s,latitude:r,zoom:l,bearing:c=0}=n;(s<-180||s>180)&&(s=Kv(s+180,360)-180),(c<-180||c>180)&&(c=Kv(c+180,360)-180);const f=Qg(e/Gv);if(l<=f)l=f,r=0;else{const d=e/2/Math.pow(2,l),p=xa([0,d])[1];if(r<p)r=p;else{const _=xa([0,Gv-d])[1];r>_&&(r=_)}}return{width:t,height:e,longitude:s,latitude:r,zoom:l,pitch:i,bearing:c}}const U2=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,sP=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,rP=`
${U2}
${sP}
`,aP=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,oP=`
${U2}
${aP}
`,lP=bl(dP),cP=bl(pP),uP=[0,0,0,1],fP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function hP(n,t){const[e,i,s]=n,r=Gg([e,i,s],t);return Number.isFinite(s)?r:[r[0],r[1],0]}function dP({viewport:n,center:t}){return new ri(n.viewProjectionMatrix).invert().transform(t)}function pP({viewport:n,shadowMatrices:t}){const e=[],i=n.pixelUnprojectionMatrix,s=n.isGeospatial?void 0:1,r=[[0,0,s],[n.width,0,s],[0,n.height,s],[n.width,n.height,s],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(l=>hP(l,i));for(const l of t){const c=l.clone().translate(new si(n.center).negate()),f=r.map(p=>c.transform(p)),d=new ri().ortho({left:Math.min(...f.map(p=>p[0])),right:Math.max(...f.map(p=>p[0])),bottom:Math.min(...f.map(p=>p[1])),top:Math.max(...f.map(p=>p[1])),near:Math.min(...f.map(p=>-p[2])),far:Math.max(...f.map(p=>-p[2]))});e.push(d.multiplyRight(l))}return e}function gP(n){const{shadowEnabled:t=!0,project:e}=n;if(!t||!e||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const i=Zg.getUniforms(e),s=lP({viewport:e.viewport,center:i.center}),r=[],l=cP({shadowMatrices:n.shadowMatrices,viewport:e.viewport}).slice();for(let f=0;f<n.shadowMatrices.length;f++){const d=l[f],p=d.clone().translate(new si(e.viewport.center).negate());i.coordinateSystem===Ut.LNGLAT&&i.projectionMode===En.WEB_MERCATOR?(l[f]=p,r[f]=s):(l[f]=d.clone().multiplyRight(fP),r[f]=p.transform(s))}const c={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||uP,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let f=0;f<l.length;f++)c[`viewProjectionMatrix${f}`]=l[f],c[`projectCenter${f}`]=r[f];for(let f=0;f<2;f++)c[`shadow_uShadowMap${f}`]=n.shadowMaps&&n.shadowMaps[f]||n.dummyShadowMap;return c}const Jv={name:"shadow",dependencies:[Zg],vs:rP,fs:oP,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:gP,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},F2={...Iv,defaultUniforms:{...Iv.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},_P=[T2],mP=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],yP=[];function bP(n){const t=Xs.getDefaultShaderAssembler();for(const i of _P)t.addDefaultModule(i);t._hookFunctions.length=0;const e=n==="glsl"?mP:yP;for(const i of e)t.addShaderHook(i);return t}const vP=[255,255,255],xP=1;let TP=0;class SP{constructor(t={}){this.type="ambient";const{color:e=vP}=t,{intensity:i=xP}=t;this.id=t.id||`ambient-${TP++}`,this.color=e,this.intensity=i}}const AP=[255,255,255],wP=1,EP=[0,0,-1];let RP=0;class tx{constructor(t={}){this.type="directional";const{color:e=AP}=t,{intensity:i=wP}=t,{direction:s=EP}=t,{_shadow:r=!1}=t;this.id=t.id||`directional-${RP++}`,this.color=e,this.intensity=i,this.type="directional",this.direction=new si(s).normalize().toArray(),this.shadow=r}getProjectedLight(t){return this}}class CP{constructor(t,e={id:"pass"}){const{id:i}=e;this.id=i,this.device=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class Jg extends CP{constructor(){super(...arguments),this._lastRenderIndex=-1}render(t){const[e,i]=this.device.canvasContext.getDrawingBufferSize(),s=t.clearCanvas??!0,r=t.clearColor??(s?[0,0,0,0]:!1),l=s?1:!1,c=s?0:!1,f=t.colorMask??15,d={viewport:[0,0,e,i]};t.colorMask&&(d.colorMask=f),t.scissorRect&&(d.scissorRect=t.scissorRect);const p=this.device.beginRenderPass({framebuffer:t.target,parameters:d,clearColor:r,clearDepth:l,clearStencil:c});try{return this._drawLayers(p,t)}finally{p.end(),this.device.submit()}}_drawLayers(t,e){const{target:i,shaderModuleProps:s,viewports:r,views:l,onViewportActive:c,clearStack:f=!0}=e;e.pass=e.pass||"unknown",f&&(this._lastRenderIndex=-1);const d=[];for(const p of r){const _=l&&l[p.id];c?.(p);const y=this._getDrawLayerParams(p,e),b=p.subViewports||[p];for(const x of b){const T=this._drawLayersInViewport(t,{target:i,shaderModuleProps:s,viewport:x,view:_,pass:e.pass,layers:e.layers},y);d.push(T)}}return d}_getDrawLayerParams(t,{layers:e,pass:i,isPicking:s=!1,layerFilter:r,cullRect:l,effects:c,shaderModuleProps:f},d=!1){const p=[],_=L2(this._lastRenderIndex+1),y={layer:e[0],viewport:t,isPicking:s,renderPass:i,cullRect:l},b={};for(let x=0;x<e.length;x++){const T=e[x],A=this._shouldDrawLayer(T,y,r,b),E={shouldDrawLayer:A};A&&!d&&(E.shouldDrawLayer=!0,E.layerRenderIndex=_(T,A),E.shaderModuleProps=this._getShaderModuleProps(T,c,i,f),E.layerParameters={...T.context.deck?.props.parameters,...this.getLayerParameters(T,x,t)}),p[x]=E}return p}_drawLayersInViewport(t,{layers:e,shaderModuleProps:i,pass:s,target:r,viewport:l,view:c},f){const d=MP(this.device,{shaderModuleProps:i,target:r,viewport:l});if(c){const{clear:_,clearColor:y,clearDepth:b,clearStencil:x}=c.props;if(_){let T=[0,0,0,0],A=1,E=0;Array.isArray(y)?T=[...y.slice(0,3),y[3]||255].map(C=>C/255):y===!1&&(T=!1),b!==void 0&&(A=b),x!==void 0&&(E=x),this.device.beginRenderPass({framebuffer:r,parameters:{viewport:d,scissorRect:d},clearColor:T,clearDepth:A,clearStencil:E}).end()}}const p={totalCount:e.length,visibleCount:0,compositeCount:0,pickableCount:0};t.setParameters({viewport:d});for(let _=0;_<e.length;_++){const y=e[_],b=f[_],{shouldDrawLayer:x}=b;if(x&&y.props.pickable&&p.pickableCount++,y.isComposite&&p.compositeCount++,y.isDrawable&&b.shouldDrawLayer){const{layerRenderIndex:T,shaderModuleProps:A,layerParameters:E}=b;p.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,T),A.project&&(A.project.viewport=l),y.context.renderPass=t;try{y._drawLayer({renderPass:t,shaderModuleProps:A,uniforms:{layerIndex:T},parameters:E})}catch(D){y.raiseError(D,`drawing ${y} to ${s}`)}}}return p}shouldDrawLayer(t){return!0}getShaderModuleProps(t,e,i){return null}getLayerParameters(t,e,i){return t.props.parameters}_shouldDrawLayer(t,e,i,s){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let l=t.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(e))return!1;e.layer=l,l=l.parent}if(i){const c=e.layer.id;if(c in s||(s[c]=i(e)),!s[c])return!1}return t.activateViewport(e.viewport),!0}_getShaderModuleProps(t,e,i,s){const r=this.device.canvasContext.cssToDeviceRatio(),l=t.internalState?.propsInTransition||t.props,c={layer:l,picking:{isActive:!1},project:{viewport:t.context.viewport,devicePixelRatio:r,modelMatrix:l.modelMatrix,coordinateSystem:l.coordinateSystem,coordinateOrigin:l.coordinateOrigin,autoWrapLongitude:t.wrapLongitude}};if(e)for(const f of e)ex(c,f.getShaderModuleProps?.(t,c));return ex(c,this.getShaderModuleProps(t,e,c),s)}}function L2(n=0,t={}){const e={},i=(s,r)=>{const l=s.props._offset,c=s.id,f=s.parent&&s.parent.id;let d;if(f&&!(f in t)&&i(s.parent,!1),f in e){const p=e[f]=e[f]||L2(t[f],t);d=p(s,r),e[c]=p}else Number.isFinite(l)?(d=l+(t[f]||0),e[c]=null):d=n;return r&&d>=n&&(n=d+1),t[c]=d,d};return i}function MP(n,{shaderModuleProps:t,target:e,viewport:i}){const s=t?.project?.devicePixelRatio??n.canvasContext.cssToDeviceRatio(),[,r]=n.canvasContext.getDrawingBufferSize(),l=e?e.height:r,c=i;return[c.x*s,l-(c.y+c.height)*s,c.width*s,c.height*s]}function ex(n,...t){for(const e of t)if(e)for(const i in e)n[i]?Object.assign(n[i],e[i]):n[i]=e[i];return n}class OP extends Jg{constructor(t,e){super(t,e);const i=t.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),s=t.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=t.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(t){const e=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),s=t.viewports[0],r=s.width*i,l=s.height*i,c=[1,1,1,1];(r!==e.width||l!==e.height)&&e.resize({width:r,height:l}),super.render({...t,clearColor:c,target:e,pass:"shadow"})}getLayerParameters(t,e,i){return{...t.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getShaderModuleProps(t,e,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}const IP={color:[255,255,255],intensity:1},nx=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],PP=[0,0,0,200/255];class z2{constructor(t={}){this.id="lighting-effect",this.shadowColor=PP,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(t)}setup(t){this.context=t;const{device:e,deck:i}=t;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(e),i._addDefaultShaderModule(Jv),this.dummyShadowMap=e.createTexture({width:1,height:1}))}setProps(t){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const e in t){const i=t[e];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=t}preRender({layers:t,layerFilter:e,viewports:i,onViewportActive:s,views:r}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:t,layerFilter:e,viewports:i,onViewportActive:s,views:r,shaderModuleProps:{shadow:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(t,e){const i=this.shadow?{project:e.project,shadowMaps:this.shadowPasses.map(l=>l.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(l=>l.getProjectedLight({layer:t})),pointLights:this.pointLights.map(l=>l.getProjectedLight({layer:t}))},r=t.props.material;return{shadow:i,lighting:s,phongMaterial:r,gouraudMaterial:r}}cleanup(t){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,t.deck._removeDefaultShaderModule(Jv))}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const i=new ri().lookAt({eye:new si(e.direction).negate()});t.push(i)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const i=new OP(t);this.shadowPasses[e]=i}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:i}=this;!t&&e.length===0&&i.length===0&&(this.ambientLight=new SP(IP),this.directionalLights.push(new tx(nx[0]),new tx(nx[1])))}}class DP{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,{size:i=1,type:s,padding:r=0,copy:l=!1,initialize:c=!1,maxCount:f}){const d=s||t&&t.constructor||Float32Array,p=e*i+r;if(ArrayBuffer.isView(t)){if(p<=t.length)return t;if(p*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new d(t.buffer,0,p)}let _=1/0;f&&(_=f*i+r);const y=this._allocate(d,p,c,_);return t&&l?y.set(t):c||y.fill(0,0,4),this._release(t),y}release(t){this._release(t)}_allocate(t,e,i,s){let r=Math.max(Math.ceil(e*this.opts.overAlloc),1);r>s&&(r=s);const l=this._pool,c=t.BYTES_PER_ELEMENT*r,f=l.findIndex(d=>d.byteLength>=c);if(f>=0){const d=new t(l.splice(f,1)[0],0,r);return i&&d.fill(0),d}return new t(r)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:i}=t,{byteLength:s}=i,r=e.findIndex(l=>l.byteLength>=s);r<0?e.push(i):(r>0||e.length<this.opts.poolSize)&&e.splice(r,0,i),e.length>this.opts.poolSize&&e.shift()}}const Ta=new DP;function zo(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function kP(n){return[n[12],n[13],n[14]]}function NP(n){return{left:sa(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:sa(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:sa(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:sa(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:sa(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:sa(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const ix=new si;function sa(n,t,e,i){ix.set(n,t,e);const s=ix.len();return{distance:i/s,normal:new si(-n/s,-t/s,-e/s)}}function BP(n){return n-Math.fround(n)}let Oo;function lp(n,t){const{size:e=1,startIndex:i=0}=t,s=t.endIndex!==void 0?t.endIndex:n.length,r=(s-i)/e;Oo=Ta.allocate(Oo,r,{type:Float32Array,size:e*2});let l=i,c=0;for(;l<s;){for(let f=0;f<e;f++){const d=n[l++];Oo[c+f]=d,Oo[c+f+e]=BP(d)}c+=e*2}return Oo.subarray(0,r*e*2)}function UP(n){let t=null,e=!1;for(const i of n)i&&(t?(e||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],e=!0),t[0][0]=Math.min(t[0][0],i[0][0]),t[0][1]=Math.min(t[0][1],i[0][1]),t[1][0]=Math.max(t[1][0],i[1][0]),t[1][1]=Math.max(t[1][1],i[1][1])):t=i);return t}const FP=Math.PI/180,LP=zo(),sx=[0,0,0],zP={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function VP({width:n,height:t,orthographic:e,fovyRadians:i,focalDistance:s,padding:r,near:l,far:c}){const f=n/t,d=e?new ri().orthographic({fovy:i,aspect:f,focalDistance:s,near:l,far:c}):new ri().perspective({fovy:i,aspect:f,near:l,far:c});if(r){const{left:p=0,right:_=0,top:y=0,bottom:b=0}=r,x=fs((p+n-_)/2,0,n)-n/2,T=fs((y+t-b)/2,0,t)-t/2;d[8]-=x*2/n,d[9]+=T*2/t}return d}class vl{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||zP,this.focalDistance=t.focalDistance||1,this.position=t.position||sx,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:i}=t;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?En.WEB_MERCATOR:En.WEB_MERCATOR_AUTO_OFFSET:En.IDENTITY}equals(t){return t instanceof vl?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&ol(t.projectionMatrix,this.projectionMatrix)&&ol(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:e=!0}={}){const i=this.projectPosition(t),s=B2(i,this.pixelProjectionMatrix),[r,l]=s,c=e?l:this.height-l;return t.length===2?[r,c]:[r,c,s[2]]}unproject(t,{topLeft:e=!0,targetZ:i}={}){const[s,r,l]=t,c=e?r:this.height-r,f=i&&i*this.distanceScales.unitsPerMeter[2],d=Gg([s,c,l],this.pixelUnprojectionMatrix,f),[p,_,y]=this.unprojectPosition(d);return Number.isFinite(l)?[p,_,y]:Number.isFinite(i)?[p,_,i]:[p,_]}projectPosition(t){const[e,i]=this.projectFlat(t),s=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,i,s]}unprojectPosition(t){const[e,i]=this.unprojectFlat(t),s=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,i,s]}projectFlat(t){if(this.isGeospatial){const e=ju(t);return e[1]=fs(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?xa(t):t}getBounds(t={}){const e={targetZ:t.z||0},i=this.unproject([0,0],e),s=this.unproject([this.width,0],e),r=this.unproject([0,this.height],e),l=this.unproject([this.width,this.height],e);return[Math.min(i[0],s[0],r[0],l[0]),Math.min(i[1],s[1],r[1],l[1]),Math.max(i[0],s[0],r[0],l[0]),Math.max(i[1],s[1],r[1],l[1])]}getDistanceScales(t){return t&&this.isGeospatial?Jp({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:e,width:i=1,height:s=1}){return t<this.x+this.width&&this.x<t+i&&e<this.y+this.height&&this.y<e+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,NP(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,i=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=Q4({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||Jp({latitude:i,longitude:e}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:r,modelMatrix:l}=t;let c=sx;if(r&&(c=l?new ri(l).transformAsVector(r,[]):r),this.isGeospatial){const f=this.projectPosition([e,i,0]);this.center=new si(c).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(c)}_initMatrices(t){const{viewMatrix:e=LP,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:r,fovy:l=75,near:c=.1,far:f=1e3,padding:d=null,focalDistance:p=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=new ri().multiplyRight(e).translate(new si(this.center).negate()),this.projectionMatrix=i||VP({width:this.width,height:this.height,orthographic:s,fovyRadians:r||l*FP,focalDistance:p,padding:d,near:c,far:f});const _=zo();Js(_,_,this.projectionMatrix),Js(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=Wp([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=kP(this.viewMatrixInverse);const y=zo(),b=zo();Kg(y,y,[this.width/2,-this.height/2,1]),zu(y,y,[1,-1,0]),Js(b,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=b,this.pixelUnprojectionMatrix=Wp(zo(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Qt.warn("Pixel project matrix not invertible")()}}vl.displayName="Viewport";class Sa extends vl{constructor(t={}){const{latitude:e=0,longitude:i=0,zoom:s=0,pitch:r=0,bearing:l=0,nearZMultiplier:c=.1,farZMultiplier:f=1.01,nearZ:d,farZ:p,orthographic:_=!1,projectionMatrix:y,repeat:b=!1,worldOffset:x=0,position:T,padding:A,legacyMeterSizes:E=!1}=t;let{width:D,height:C,altitude:O=1.5}=t;const k=Math.pow(2,s);D=D||1,C=C||1;let z,Y=null;if(y)O=y[5]/2,z=Wu(O);else{t.fovy?(z=t.fovy,O=N2(z)):z=Wu(O);let G;if(A){const{top:at=0,bottom:nt=0}=A;G=[0,fs((at+C-nt)/2,0,C)-C/2]}Y=J4({width:D,height:C,scale:k,center:T&&[0,0,T[2]*op(e)],offset:G,pitch:r,fovy:z,nearZMultiplier:c,farZMultiplier:f}),Number.isFinite(d)&&(Y.near=d),Number.isFinite(p)&&(Y.far=p)}let q=G4({height:C,pitch:r,bearing:l,scale:k,altitude:O});x&&(q=new ri().translate([512*x,0,0]).multiplyLeft(q)),super({...t,width:D,height:C,viewMatrix:q,longitude:i,latitude:e,zoom:s,...Y,fovy:z,focalDistance:O}),this.latitude=e,this.longitude=i,this.zoom=s,this.pitch=r,this.bearing=l,this.altitude=O,this.fovy=z,this.orthographic=_,this._subViewports=b?[]:null,this._pseudoMeters=E,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),i=Math.ceil((t[2]-180)/360);for(let s=e;s<=i;s++){const r=s?new Sa({...this,worldOffset:s}):this;this._subViewports.push(r)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,i]=this.projectFlat(t),s=(t[2]||0)*op(t[1]);return[e,i,s]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,i]=this.unprojectFlat(t),s=(t[2]||0)/op(i);return[e,i,s]}addMetersToLngLat(t,e){return k2(t,e)}panByPosition(t,e){const i=Gg(e,this.pixelUnprojectionMatrix),s=this.projectFlat(t),r=Mv([],s,DO([],i)),l=Mv([],this.center,r),[c,f]=this.unprojectFlat(l);return{longitude:c,latitude:f}}getBounds(t={}){const e=nP(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t,e={}){const{width:i,height:s}=this,{longitude:r,latitude:l,zoom:c}=tP({width:i,height:s,bounds:t,...e});return new Sa({width:i,height:s,longitude:r,latitude:l,zoom:c})}}Sa.displayName="WebMercatorViewport";const rx=[0,0,0];function cp(n,t,e=!1){const i=t.projectPosition(n);if(e&&t instanceof Sa){const[s,r,l=0]=n,c=t.getDistanceScales([s,r]);i[2]=l*c.unitsPerMeter[2]}return i}function HP(n){const{viewport:t,modelMatrix:e,coordinateOrigin:i}=n;let{coordinateSystem:s,fromCoordinateSystem:r,fromCoordinateOrigin:l}=n;return s===Ut.DEFAULT&&(s=t.isGeospatial?Ut.LNGLAT:Ut.CARTESIAN),r===void 0&&(r=s),l===void 0&&(l=i),{viewport:t,coordinateSystem:s,coordinateOrigin:i,modelMatrix:e,fromCoordinateSystem:r,fromCoordinateOrigin:l}}function V2(n,{viewport:t,modelMatrix:e,coordinateSystem:i,coordinateOrigin:s,offsetMode:r}){let[l,c,f=0]=n;switch(e&&([l,c,f]=yl([],[l,c,f,1],e)),i){case Ut.LNGLAT:return cp([l,c,f],t,r);case Ut.LNGLAT_OFFSETS:return cp([l+s[0],c+s[1],f+(s[2]||0)],t,r);case Ut.METER_OFFSETS:return cp(k2(s,[l,c,f]),t,r);case Ut.CARTESIAN:default:return t.isGeospatial?[l+s[0],c+s[1],f+s[2]]:t.projectPosition([l,c,f])}}function jP(n,t){const{viewport:e,coordinateSystem:i,coordinateOrigin:s,modelMatrix:r,fromCoordinateSystem:l,fromCoordinateOrigin:c}=HP(t),{autoOffset:f=!0}=t,{geospatialOrigin:d=rx,shaderCoordinateOrigin:p=rx,offsetMode:_=!1}=f?I2(e,i,s):{},y=V2(n,{viewport:e,modelMatrix:r,coordinateSystem:l,coordinateOrigin:c,offsetMode:_});if(_){const b=e.projectPosition(d||p);qO(y,y,b)}return y}let WP=1,$P=1;class H2{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(t){const{delay:e=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:r=1}=t,l=WP++,c={time:0,delay:e,duration:i,rate:s,repeat:r};return this._setChannelTime(c,this.time),this.channels.set(l,c),l}removeChannel(t){this.channels.delete(t);for(const[e,i]of this.animations)i.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return e===void 0?!1:this.time>=e.delay+e.duration*e.repeat}getTime(t){if(t===void 0)return this.time;const e=this.channels.get(t);return e===void 0?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const s of e)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:r,channel:l}=s;r.setTime(this.getTime(l))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const i=$P++;return this.animations.set(i,{animation:t,channel:e}),t.setTime(this.getTime(e)),i}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const i=e-t.delay,s=t.duration*t.repeat;i>=s?t.time=t.duration*t.rate:(t.time=Math.max(0,i)%t.duration,t.time*=t.rate)}}function XP(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function YP(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let qP=0;class t_{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:zp.stats.get(`animation-loop-${qP++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(t){if(this.props={...t_.defaultAnimationLoopProps,...t},t=this.props,!t.device)throw new Error("No device provided");this.stats=t.stats||new ef({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(t){this.props.onError(t),this._error=t}setNeedsRedraw(t){return this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.props.autoResizeViewport=t.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let t;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(t!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(t){const e=t instanceof Error?t:new Error("Unknown error");throw this.props.onError(e),e}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(t){this.display&&(this.display.destroy(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(){this._running&&(this._animationFrameId=XP(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(YP(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(t){if(this.display){this.display._renderFrame(t);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){const t=this.device?.getDefaultCanvasContext();if(!this.device||!t)throw new Error("loop");const e=t?.canvas,i=t.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:t,canvas:e,useDevicePixels:i,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:t,height:e,aspect:i}=this._getSizeAndAspect();(t!==this.animationProps.width||e!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",this.canvas instanceof HTMLCanvasElement&&t.appendChild(this.canvas),t.appendChild(e);const i=this.props.onAddHTML(e);i&&(e.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[t,e]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1];let i=1;const s=this.device?.getDefaultCanvasContext().canvas;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:t>0&&e>0&&(i=t/e),{width:t,height:e,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(t){t instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[t.offsetX,t.offsetY])}_onMouseleave(t){this._getAnimationProps()._mousePosition=null}}const up={};function xl(n="id"){up[n]=up[n]||1;const t=up[n]++;return`${n}-${t}`}class ax{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(t){if(this.id=t.id||xl("geometry"),this.topology=t.topology,this.indices=t.indices||null,this.attributes=t.attributes,this.vertexCount=t.vertexCount,this.bufferLayout=t.bufferLayout||[],this.indices&&!(this.indices.usage&Gt.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(t){return t.byteLength/12}}function KP(n,t){if(t instanceof ax)return t;const e=ZP(n,t),{attributes:i,bufferLayout:s}=QP(n,t);return new ax({topology:t.topology||"triangle-list",bufferLayout:s,vertexCount:t.vertexCount,indices:e,attributes:i})}function ZP(n,t){if(!t.indices)return;const e=t.indices.value;return n.createBuffer({usage:Gt.INDEX,data:e})}function QP(n,t){const e=[],i={};for(const[r,l]of Object.entries(t.attributes)){let c=r;switch(r){case"POSITION":c="positions";break;case"NORMAL":c="normals";break;case"TEXCOORD_0":c="texCoords";break;case"COLOR_0":c="colors";break}if(l){i[c]=n.createBuffer({data:l.value,id:`${r}-buffer`});const{value:f,size:d,normalized:p}=l;e.push({name:c,format:ZC(f,d,p)})}}const s=t._calculateVertexCount(t.attributes,t.indices);return{attributes:i,bufferLayout:e,vertexCount:s}}class e_{static defaultProps={...Gs.defaultProps};static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new e_(t),t._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(t){this.device=t,this.cachingEnabled=t.props._cachePipelines,this.destroyPolicy=t.props._cacheDestroyPolicy,this.debug=t.props.debugFactories}createRenderPipeline(t){if(!this.cachingEnabled)return this.device.createRenderPipeline(t);const e={...Gs.defaultProps,...t},i=this._renderPipelineCache,s=this._hashRenderPipeline(e);let r=i[s]?.pipeline;return r?(i[s].useCount++,this.debug&&et.warn(`${this}: ${i[s].pipeline} reused, count=${i[s].useCount}, (id=${t.id})`)()):(r=this.device.createRenderPipeline({...e,id:e.id?`${e.id}-cached`:xl("unnamed-cached")}),r.hash=s,i[s]={pipeline:r,useCount:1},this.debug&&et.warn(`${this}: ${r} created, count=${i[s].useCount}`)()),r}createComputePipeline(t){if(!this.cachingEnabled)return this.device.createComputePipeline(t);const e={...Pu.defaultProps,...t},i=this._computePipelineCache,s=this._hashComputePipeline(e);let r=i[s]?.pipeline;return r?(i[s].useCount++,this.debug&&et.warn(`${this}: ${i[s].pipeline} reused, count=${i[s].useCount}, (id=${t.id})`)()):(r=this.device.createComputePipeline({...e,id:e.id?`${e.id}-cached`:void 0}),r.hash=s,i[s]={pipeline:r,useCount:1},this.debug&&et.warn(`${this}: ${r} created, count=${i[s].useCount}`)()),r}release(t){if(!this.cachingEnabled){t.destroy();return}const e=this._getCache(t),i=t.hash;e[i].useCount--,e[i].useCount===0?(this._destroyPipeline(t),this.debug&&et.warn(`${this}: ${t} released and destroyed`)()):e[i].useCount<0?(et.error(`${this}: ${t} released, useCount < 0, resetting`)(),e[i].useCount=0):this.debug&&et.warn(`${this}: ${t} released, count=${e[i].useCount}`)()}_destroyPipeline(t){const e=this._getCache(t);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete e[t.hash],t.destroy(),!0}}_getCache(t){let e;if(t instanceof Pu&&(e=this._computePipelineCache),t instanceof Gs&&(e=this._renderPipelineCache),!e)throw new Error(`${this}`);if(!e[t.hash])throw new Error(`${this}: ${t} matched incorrect entry`);return e}_hashComputePipeline(t){const{type:e}=this.device,i=this._getHash(t.shader.source);return`${e}/C/${i}`}_hashRenderPipeline(t){const e=t.vs?this._getHash(t.vs.source):0,i=t.fs?this._getHash(t.fs.source):0,s="-",r=this._getHash(JSON.stringify(t.bufferLayout)),{type:l}=this.device;switch(l){case"webgl":return`${l}/R/${e}/${i}V${s}BL${r}`;case"webgpu":default:const c=this._getHash(JSON.stringify(t.parameters));return`${l}/R/${e}/${i}V${s}T${t.topology}P${c}BL${r}`}}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}}class n_{static defaultProps={...af.defaultProps};static getDefaultShaderFactory(t){return t._lumaData.defaultShaderFactory||=new n_(t),t._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(t){this.device=t,this.cachingEnabled=t.props._cacheShaders,this.destroyPolicy=t.props._cacheDestroyPolicy,this.debug=!0}createShader(t){if(!this.cachingEnabled)return this.device.createShader(t);const e=this._hashShader(t);let i=this._cache[e];if(i)i.useCount++,this.debug&&et.warn(`${this}: Reusing shader ${i.shader.id} count=${i.useCount}`)();else{const s=this.device.createShader({...t,id:t.id?`${t.id}-cached`:void 0});this._cache[e]=i={shader:s,useCount:1},this.debug&&et.warn(`${this}: Created new shader ${s.id}`)()}return i.shader}release(t){if(!this.cachingEnabled){t.destroy();return}const e=this._hashShader(t),i=this._cache[e];if(i)if(i.useCount--,i.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[e],i.shader.destroy(),this.debug&&et.warn(`${this}: Releasing shader ${t.id}, destroyed`)());else{if(i.useCount<0)throw new Error(`ShaderFactory: Shader ${t.id} released too many times`);this.debug&&et.warn(`${this}: Releasing shader ${t.id} count=${i.useCount}`)()}}_hashShader(t){return`${t.stage}:${t.source}`}}function GP(n,t){const e={},i="Values";if(n.attributes.length===0&&!n.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(const s of n.attributes)if(s){const r=`${s.location} ${s.name}: ${s.type}`;e[`in ${r}`]={[i]:s.stepMode||"vertex"}}for(const s of n.varyings||[]){const r=`${s.location} ${s.name}`;e[`out ${r}`]={[i]:JSON.stringify(s)}}return e}let Ee=null,fp=null;function JP(n,{id:t,minimap:e,opaque:i,top:s="0",left:r="0",rgbaScale:l=1}){Ee||(Ee=document.createElement("canvas"),Ee.id=t,Ee.title=t,Ee.style.zIndex="100",Ee.style.position="absolute",Ee.style.top=s,Ee.style.left=r,Ee.style.border="blue 5px solid",Ee.style.transform="scaleY(-1)",document.body.appendChild(Ee),fp=Ee.getContext("2d")),(Ee.width!==n.width||Ee.height!==n.height)&&(Ee.width=n.width/2,Ee.height=n.height/2,Ee.style.width="400px",Ee.style.height="400px");const c=n.device.readPixelsToArrayWebGL(n),f=fp?.createImageData(n.width,n.height);if(f){for(let p=0;p<c.length;p+=4)f.data[0+p+0]=c[p+0]*l,f.data[0+p+1]=c[p+1]*l,f.data[0+p+2]=c[p+2]*l,f.data[0+p+3]=i?255:c[p+3]*l;fp?.putImageData(f,0,0)}}function tg(n,t,e){if(n===t)return!0;if(!e||!n||!t)return!1;if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let i=0;i<n.length;i++)if(!tg(n[i],t[i],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof n=="object"&&typeof t=="object"){const i=Object.keys(n),s=Object.keys(t);if(i.length!==s.length)return!1;for(const r of i)if(!t.hasOwnProperty(r)||!tg(n[r],t[r],e-1))return!1;return!0}return!1}class hp{bufferLayouts;constructor(t){this.bufferLayouts=t}getBufferLayout(t){return this.bufferLayouts.find(e=>e.name===t)||null}getAttributeNamesForBuffer(t){return t.attributes?t.attributes?.map(e=>e.attribute):[t.name]}mergeBufferLayouts(t,e){const i=[...t];for(const s of e){const r=i.findIndex(l=>l.name===s.name);r<0?i.push(s):i[r]=s}return i}getBufferIndex(t){const e=this.bufferLayouts.findIndex(i=>i.name===t);return e===-1&&et.warn(`BufferLayout: Missing buffer for "${t}".`)(),e}}function tD(n,t){const e=Object.fromEntries(n.attributes.map(s=>[s.name,s.location])),i=t.slice();return i.sort((s,r)=>{const l=s.attributes?s.attributes.map(p=>p.attribute):[s.name],c=r.attributes?r.attributes.map(p=>p.attribute):[r.name],f=Math.min(...l.map(p=>e[p])),d=Math.min(...c.map(p=>e[p]));return f-d}),i}function eD(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function nD(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function iD(n){return eD(n)||nD(n)}function sD(n){return iD(n)||typeof n=="number"||typeof n=="boolean"}function rD(n){const t={bindings:{},uniforms:{}};return Object.keys(n).forEach(e=>{const i=n[e];sD(i)?t.uniforms[e]=i:t.bindings[e]=i}),t}class aD{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(t,e){Object.assign(this.options,e);const i=Og(Object.values(t).filter(s=>s.dependencies));for(const s of i)t[s.name]=s;et.log(1,"Creating ShaderInputs with modules",Object.keys(t))(),this.modules=t,this.moduleUniforms={},this.moduleBindings={};for(const[s,r]of Object.entries(t))this._addModule(r),r.name&&s!==r.name&&!this.options.disableWarnings&&et.warn(`Module name: ${s} vs ${r.name}`)()}destroy(){}setProps(t){for(const e of Object.keys(t)){const i=e,s=t[i]||{},r=this.modules[i];if(!r){this.options.disableWarnings||et.warn(`Module ${e} not found`)();continue}const l=this.moduleUniforms[i],c=this.moduleBindings[i],f=r.getUniforms?.(s,l)||s,{uniforms:d,bindings:p}=rD(f);this.moduleUniforms[i]={...l,...d},this.moduleBindings[i]={...c,...p}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const t={};for(const e of Object.values(this.moduleBindings))Object.assign(t,e);return t}getDebugTable(){const t={};for(const[e,i]of Object.entries(this.moduleUniforms))for(const[s,r]of Object.entries(i))t[`${e}.${s}`]={type:this.modules[e].uniformTypes?.[s],value:String(r)};return t}_addModule(t){const e=t.name;this.moduleUniforms[e]=t.defaultUniforms||{},this.moduleBindings[e]={}}}let oD="";async function lD(n,t){const e=new Image;return e.crossOrigin="anonymous",e.src=n.startsWith("http")?n:oD+n,await e.decode(),t?await createImageBitmap(e,t):await createImageBitmap(e)}const cD=["+X","-X","+Y","-Y","+Z","-Z"],uD=["+X","-X","+Y","-Y","+Z","-Z"];class Qo{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(t,e){this.device=t;const i=xl("async-texture");this.props={...Qo.defaultProps,id:i,...e},this.id=this.props.id,e={...e},typeof e?.data=="string"&&e.dimension==="2d"&&(e.data=lD(e.data)),e.mipmaps&&(e.mipLevels="auto"),this.ready=new Promise((s,r)=>{this.resolveReady=()=>{this.isReady=!0,s()},this.rejectReady=r}),this.initAsync(e)}async initAsync(t){const e=t.data,i=await j2(e).then(void 0,this.rejectReady);if(this.destroyed)return;const s=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(i);if(!s)throw new Error("Texture size could not be determined");const r={...s,...t,data:void 0,mipLevels:1},l=this.device.getMipLevelCount(r.width,r.height);if(r.mipLevels=this.props.mipLevels==="auto"?l:Math.min(l,this.props.mipLevels),this.texture=this.device.createTexture(r),this.sampler=this.texture.sampler,this.view=this.texture.view,t.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,i);break;case"2d":this._setTexture2DData(i);break;case"3d":this._setTexture3DData(this.texture,i);break;case"2d-array":this._setTextureArrayData(this.texture,i);break;case"cube":this._setTextureCubeData(this.texture,i);break;case"cube-array":this._setTextureCubeArrayData(this.texture,i);break}this.props.mipmaps&&this.generateMipmaps(),et.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(t={}){this.texture.setSampler(t instanceof rr?t:this.device.createSampler(t))}resize(t){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(t.width===this.texture.width&&t.height===this.texture.height)return!1;if(this.texture){const e=this.texture;this.texture=e.clone(t),e.destroy()}return!0}isTextureLevelData(t){const e=t?.data;return ArrayBuffer.isView(e)}getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return this.getTextureDataSize(t[0]);if(this.device.isExternalImage(t))return this.device.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const i=Object.values(t)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}setTextureData(t){}_setTexture1DData(t,e){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(t,e=0){if(!this.texture)throw new Error("Texture not initialized");const i=this._normalizeTextureData(t);i.length>1&&this.props.mipmaps!==!1&&et.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const r=i[s];this.device.isExternalImage(r)?this.texture.copyExternalImage({image:r,depth:e,mipLevel:s,flipY:!0}):this.texture.copyImageData({data:r.data,mipLevel:s})}}_setTexture3DData(t,e){if(this.texture?.props.dimension!=="3d")throw new Error(this.id);for(let i=0;i<e.length;i++)this._setTexture2DData(e[i],i)}_setTextureCubeData(t,e){if(this.texture?.props.dimension!=="cube")throw new Error(this.id);for(const[i,s]of Object.entries(e)){const r=uD.indexOf(i);this._setTexture2DData(s,r)}}_setTextureArrayData(t,e){if(this.texture?.props.dimension!=="2d-array")throw new Error(this.id);for(let i=0;i<e.length;i++)this._setTexture2DData(e[i],i)}_setTextureCubeArrayData(t,e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(t,e,i,s=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&et.warn(`${this.id} has mipmap and multiple LODs.`)();const r=cD.indexOf(i);this._setTexture2DData(e,r)}_normalizeTextureData(t){const e=this.texture;let i;return ArrayBuffer.isView(t)?i=[{data:t,width:e.width,height:e.height}]:Array.isArray(t)?i=t:i=[t],i}static defaultProps={...Se.defaultProps,data:null,mipmaps:!1}}async function j2(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(j2));if(n&&typeof n=="object"&&n.constructor===Object){const t=n,e=await Promise.all(Object.values(t)),i=Object.keys(t),s={};for(let r=0;r<i.length;r++)s[i[r]]=e[r];return s}return n}const Fs=2,fD=1e4;class Aa{static defaultProps={...Gs.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Xs.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(t,e){this.props={...Aa.defaultProps,...e},e=this.props,this.id=e.id||xl("model"),this.device=t,Object.assign(this.userData,e.userData);const i=Object.fromEntries(this.props.modules?.map(f=>[f.name,f])||[]),s=e.shaderInputs||new aD(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const r=dD(t),l=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:f,getUniforms:d}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:r,...this.props,modules:l});this.source=f,this._getModuleUniforms=d,this.props.shaderLayout||=SO(this.source)}else{const{vs:f,fs:d,getUniforms:p}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:r,...this.props,modules:l});this.vs=f,this.fs=d,this._getModuleUniforms=p}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,e.geometry&&this.setGeometry(e.geometry),this.pipelineFactory=e.pipelineFactory||e_.getDefaultPipelineFactory(this.device),this.shaderFactory=e.shaderFactory||n_.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in e&&(this.isInstanced=e.isInstanced),e.instanceCount&&this.setInstanceCount(e.instanceCount),e.vertexCount&&this.setVertexCount(e.vertexCount),e.indexBuffer&&this.setIndexBuffer(e.indexBuffer),e.attributes&&this.setAttributes(e.attributes),e.constantAttributes&&this.setConstantAttributes(e.constantAttributes),e.bindings&&this.setBindings(e.bindings),e.transformFeedback&&(this.transformFeedback=e.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const t=this._needsRedraw;return this._needsRedraw=!1,t}setNeedsRedraw(t){this._needsRedraw||=t}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(t){const e=this._areBindingsLoading();if(e)return et.info(Fs,`>>> DRAWING ABORTED ${this.id}: ${e} not loaded`)(),!1;try{t.pushDebugGroup(`${this}.predraw(${t})`),this.predraw()}finally{t.popDebugGroup()}let i;try{t.pushDebugGroup(`${this}.draw(${t})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings});const{indexBuffer:r}=this.vertexArray,l=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:t,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:l,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{t.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(t),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(t){this._gpuGeometry?.destroy();const e=t&&KP(this.device,t);if(e){this.setTopology(e.topology||"triangle-list");const i=new hp(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(e.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(e)}this._gpuGeometry=e}setTopology(t){t!==this.topology&&(this.topology=t,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(t){const e=new hp(this.bufferLayout);this.bufferLayout=this._gpuGeometry?e.mergeBufferLayouts(t,this._gpuGeometry.bufferLayout):t,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(t){tg(t,this.parameters,2)||(this.parameters=t,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(t){this.instanceCount=t,this.isInstanced===void 0&&t>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(t){this.vertexCount=t,this.setNeedsRedraw("vertexCount")}setShaderInputs(t){this.shaderInputs=t,this._uniformStore=new YM(this.shaderInputs.modules);for(const[e,i]of Object.entries(this.shaderInputs.modules))if(hD(i)){const s=this._uniformStore.getManagedUniformBuffer(this.device,e);this.bindings[`${e}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(t){Object.assign(this.bindings,t),this.setNeedsRedraw("bindings")}setTransformFeedback(t){this.transformFeedback=t,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(t){this.vertexArray.setIndexBuffer(t),this.setNeedsRedraw("indexBuffer")}setAttributes(t,e){const i=e?.disableWarnings??this.props.disableWarnings;t.indices&&et.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=tD(this.pipeline.shaderLayout,this.bufferLayout);const s=new hp(this.bufferLayout);for(const[r,l]of Object.entries(t)){const c=s.getBufferLayout(r);if(!c){i||et.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const f=s.getAttributeNamesForBuffer(c);let d=!1;for(const p of f){const _=this._attributeInfos[p];if(_){const y=this.device.type==="webgpu"?s.getBufferIndex(_.bufferName):_.location;this.vertexArray.setBuffer(y,l),d=!0}}!d&&!i&&et.warn(`Model(${this.id}): Ignoring buffer "${l.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(t,e){for(const[i,s]of Object.entries(t)){const r=this._attributeInfos[i];r?this.vertexArray.setConstantWebGL(r.location,s):(e?.disableWarnings??this.props.disableWarnings)||et.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const t of Object.values(this.bindings))if(t instanceof Qo&&!t.isReady)return t.id;return!1}_getBindings(){const t={};for(const[e,i]of Object.entries(this.bindings))i instanceof Qo?i.isReady&&(t[e]=i.texture):t[e]=i;return t}_getBindingsUpdateTimestamp(){let t=0;for(const e of Object.values(this.bindings))e instanceof rf?t=Math.max(t,e.texture.updateTimestamp):e instanceof Gt||e instanceof Se?t=Math.max(t,e.updateTimestamp):e instanceof Qo?t=e.texture?Math.max(t,e.texture.updateTimestamp):1/0:e instanceof rr||(t=Math.max(t,e.buffer.updateTimestamp));return t}_setGeometryAttributes(t){const e={...t.attributes};for(const[i]of Object.entries(e))!this.pipeline.shaderLayout.attributes.find(s=>s.name===i)&&i!=="positions"&&delete e[i];this.vertexCount=t.vertexCount,this.setIndexBuffer(t.indices||null),this.setAttributes(t.attributes,{disableWarnings:!0}),this.setAttributes(e,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(t){this._pipelineNeedsUpdate||=t,this.setNeedsRedraw(t)}_updatePipeline(){if(this._pipelineNeedsUpdate){let t=null,e=null;this.pipeline&&(et.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),t=this.pipeline.vs,e=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=i:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:s}),this._attributeInfos=$1(this.pipeline.shaderLayout,this.bufferLayout),t&&this.shaderFactory.release(t),e&&this.shaderFactory.release(e)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const t=et.level>3?0:fD;et.level<2||Date.now()-this._lastLogTime<t||(this._lastLogTime=Date.now(),this._logOpen=!0,et.group(Fs,`>>> DRAWING MODEL ${this.id}`,{collapsed:et.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const t=GP(this.pipeline.shaderLayout,this.id);et.table(Fs,t)();const e=this.shaderInputs.getDebugTable();et.table(Fs,e)();const i=this._getAttributeDebugTable();et.table(Fs,this._attributeInfos)(),et.table(Fs,i)(),et.groupEnd(Fs)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(t){const e=this.device.props.debugFramebuffers;if(this._drawCount++,!e)return;const i=t.props.framebuffer;i&&JP(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const t={};for(const[e,i]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[i.location];t[i.location]={name:e,type:i.shaderType,values:s?this._getBufferOrConstantValues(s,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:e}=this.vertexArray,i=e.indexType==="uint32"?new Uint32Array(e.debugData):new Uint16Array(e.debugData);t.indices={name:"indices",type:e.indexType,values:i.toString()}}return t}_getBufferOrConstantValues(t,e){const i=Pg(e);return(t instanceof Gt?new i(t.debugData):t).toString()}}function hD(n){return!!(n.uniformTypes&&!pD(n.uniformTypes))}function dD(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function pD(n){for(const t in n)return!1;return!0}class wa{device;model;transformFeedback;static defaultProps={...Aa.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(t){return t?.info?.type==="webgl"}constructor(t,e=wa.defaultProps){if(!wa.isSupported(t))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=t,this.model=new Aa(this.device,{id:e.id||"buffer-transform-model",fs:e.fs||HC(),topology:e.topology||"point-list",varyings:e.outputs||e.varyings,...e}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:e.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){t?.inputBuffers&&this.model.setAttributes(t.inputBuffers),t?.outputBuffers&&this.transformFeedback.setBuffers(t.outputBuffers);const e=this.device.beginRenderPass(t);this.model.draw(e),e.end()}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){const e=this.getBuffer(t);if(!e)throw new Error("BufferTransform#getBuffer");if(e instanceof Gt)return e.readAsync();const{buffer:i,byteOffset:s=0,byteLength:r=i.byteLength}=e;return i.readAsync(s,r)}}class W2{id;topology;vertexCount;indices;attributes;userData={};constructor(t){const{attributes:e={},indices:i=null,vertexCount:s=null}=t;this.id=t.id||xl("geometry"),this.topology=t.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[r,l]of Object.entries(e)){const c=ArrayBuffer.isView(l)?{value:l}:l;if(!ArrayBuffer.isView(c.value))throw new Error(`${this._print(r)}: must be typed array or object with value as typed array`);if((r==="POSITION"||r==="positions")&&!c.size&&(c.size=3),r==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=c}else this.attributes[r]=c}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,e){return this}_calculateVertexCount(t,e){if(e)return e.value.length;let i=1/0;for(const s of Object.values(t)){const{value:r,size:l,constant:c}=s;!c&&r&&l!==void 0&&l>=1&&(i=Math.min(i,r.length/l))}return i}}const gD={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class $2 extends Jg{constructor(){super(...arguments),this._colorEncoderState=null}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:e,views:i,viewports:s,onViewportActive:r,pickingFBO:l,deviceRect:{x:c,y:f,width:d,height:p},cullRect:_,effects:y,pass:b="picking",pickZ:x,shaderModuleProps:T}){this.pickZ=x;const A=this._resetColorEncoder(x),E=[c,f,d,p],D=super.render({target:l,layers:t,layerFilter:e,views:i,viewports:s,onViewportActive:r,cullRect:_,effects:y?.filter(O=>O.useInPicking),pass:b,isPicking:!0,shaderModuleProps:T,clearColor:[0,0,0,0],colorMask:15,scissorRect:E});return this._colorEncoderState=null,{decodePickingColor:A&&mD.bind(null,A),stats:D}}shouldDrawLayer(t){const{pickable:e,operation:i}=t.props;return e&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(t,e,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(t,e,i){const s={...t.props.parameters},{pickable:r,operation:l}=t.props;return!this._colorEncoderState||l.includes("terrain")?s.blend=!1:r&&l.includes("draw")&&(Object.assign(s,gD),s.blend=!0,s.blendColor=_D(this._colorEncoderState,t,i)),s}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function _D(n,t,e){const{byLayer:i,byAlpha:s}=n;let r,l=i.get(t);return l?(l.viewports.push(e),r=l.a):(r=i.size+1,r<=255?(l={a:r,layer:t,viewports:[e]},i.set(t,l),s[r]=l):(Qt.warn("Too many pickable layers, only picking the first 255")(),r=0)),[0,0,0,r/255]}function mD(n,t){const e=n.byAlpha[t[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(t)}}const oa={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},$u=Symbol.for("component"),tr=Symbol.for("propTypes"),dp=Symbol.for("deprecatedProps"),ga=Symbol.for("asyncPropDefaults"),cr=Symbol.for("asyncPropOriginal"),hs=Symbol.for("asyncPropResolved");function X2(n,t=()=>!0){return Array.isArray(n)?Y2(n,t,[]):t(n)?[n]:[]}function Y2(n,t,e){let i=-1;for(;++i<n.length;){const s=n[i];Array.isArray(s)?Y2(s,t,e):t(s)&&e.push(s)}return e}function yD({target:n,source:t,start:e=0,count:i=1}){const s=t.length,r=i*s;let l=0;for(let c=e;l<s;l++)n[c++]=t[l];for(;l<r;)l<r-l?(n.copyWithin(e+l,e,e+l),l*=2):(n.copyWithin(e+l,e,e+r-l),l=r);return n}class bD{constructor(t,e,i){this._loadCount=0,this._subscribers=new Set,this.id=t,this.context=i,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const i=++this._loadCount;let s=t;typeof t=="string"&&(s=kp(t)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(r=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=r)}).catch(r=>{this._loadCount===i&&(this.isLoaded=!0,this._error=r||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const r of this._subscribers)r.onChange(this.getData())}}class vD{constructor(t){this.protocol=t.protocol||"resource://",this._context={device:t.device,gl:t.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:e,forceUpdate:i=!1,persistent:s=!0}){let r=this._resources[t];r?r.setData(e,i):(r=new bD(t,e,this._context),this._resources[t]=r),r.persistent=s}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const e=this._consumers[t];if(e){for(const i in e){const s=e[i],r=this._resources[s.resourceId];r&&r.unsubscribe(s)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:e,consumerId:i,requestId:s="default"}){const{_resources:r,protocol:l}=this;t.startsWith(l)&&(t=t.replace(l,""),r[t]||this.add({resourceId:t,data:null,persistent:!1}));const c=r[t];if(this._track(i,s,c,e),c)return c.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,i,s){const r=this._consumers,l=r[t]=r[t]||{};let c=l[e];const f=c&&c.resourceId&&this._resources[c.resourceId];f&&(f.unsubscribe(c),this.prune()),i&&(c?(c.onChange=s,c.resourceId=i.id):c={onChange:s,resourceId:i.id},l[e]=c,i.subscribe(c))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];!e.persistent&&!e.inUse()&&(e.delete(),delete this._resources[t])}}}const xD="layerManager.setLayers",TD="layerManager.activateViewport";class SD{constructor(t,e){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=c=>{We(TD,this,c),c&&(this.context.viewport=c)};const{deck:i,stats:s,viewport:r,timeline:l}=e||{};this.layers=[],this.resourceManager=new vD({device:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:t,gl:t?.gl,deck:i,shaderAssembler:bP(t?.info?.shadingLanguage||"glsl"),defaultShaderModules:[RI],renderPass:void 0,stats:s||new ef({id:"deck.gl"}),viewport:r||new vl({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new H2,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(t);e=e||s}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(e=>t.find(i=>e.id.indexOf(i)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){We(xD,this,e,t),this._lastRenderedLayers=t;const i=X2(t,Boolean);for(const s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw(`updating layers: ${t}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}addDefaultShaderModule(t){const{defaultShaderModules:e}=this.context;e.find(i=>i.name===t.name)||(e.push(t),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(t){const{defaultShaderModules:e}=this.context,i=e.findIndex(s=>s.name===t.name);i>=0&&(e.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(t,e,i){i.raiseError(e,`${t} of ${i}`)}_updateLayers(t,e){const i={};for(const l of t)i[l.id]?Qt.warn(`Multiple old layers with same id ${l.id}`)():i[l.id]=l;if(this._defaultShaderModulesChanged){for(const l of t)l.setNeedsUpdate(),l.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(e,i,s),this._finalizeOldLayers(i);let r=!1;for(const l of s)if(l.hasUniformTransition()){r=`Uniform transition in ${l}`;break}this._needsUpdate=r,this.layers=s}_updateSublayersRecursively(t,e,i){for(const s of t){s.context=this.context;const r=e[s.id];r===null&&Qt.warn(`Multiple new layers with same id ${s.id}`)(),e[s.id]=null;let l=null;try{this._debug&&r!==s&&s.validateProps(),r?(this._transferLayerState(r,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),l=s.isComposite?s.getSubLayers():null}catch(c){this._handleError("matching",c,s)}l&&this._updateSublayersRecursively(l,e,i)}}_finalizeOldLayers(t){for(const e in t){const i=t[e];i&&this._finalizeLayer(i)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=oa.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=oa.MATCHED,e!==t&&(t.lifecycle=oa.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||`finalized ${t}`,t.lifecycle=oa.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=oa.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function Rn(n,t,e){if(n===t)return!0;if(!e||!n||!t)return!1;if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let i=0;i<n.length;i++)if(!Rn(n[i],t[i],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof n=="object"&&typeof t=="object"){const i=Object.keys(n),s=Object.keys(t);if(i.length!==s.length)return!1;for(const r of i)if(!t.hasOwnProperty(r)||!Rn(n[r],t[r],e-1))return!1;return!0}return!1}class AD{constructor(t){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return this.views.find(e=>e.id===t)}getViewState(t){const e=typeof t=="string"?this.getView(t):t,i=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(i):i}getViewport(t){return this._viewportMap[t]}unproject(t,e){const i=this.getViewports(),s={x:t[0],y:t[1]};for(let r=i.length-1;r>=0;--r){const l=i[r];if(l.containsPixel(s)){const c=t.slice();return c[0]-=l.x,c[1]-=l.y,l.unproject(c,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=X2(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!Rn(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):Qt.warn("missing `viewState` or `initialViewState`")()}_createController(t,e){const i=e.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:r=>this.getView(t.id)?.makeViewport({viewState:r,width:this.width,height:this.height})})}_updateController(t,e,i,s){const r=t.controller;if(r&&i){const l={...e,...r,id:t.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!s||s.constructor!==r.type)&&(s=this._createController(t,l)),s&&s.setProps(l),s}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=t.length;s--;){const r=t[s],l=this.getViewState(r),c=r.makeViewport({viewState:l,width:this.width,height:this.height});let f=e[r.id];const d=!!r.controller;d&&!f&&(i=!0),(i||!d)&&f&&(f.finalize(),f=null),this.controllers[r.id]=this._updateController(r,l,c,f),c&&this._viewports.unshift(c)}for(const s in e){const r=e[s];r&&!this.controllers[s]&&r.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length?!0:t.some((i,s)=>!t[s].equals(e[s]))}}const wD=/([0-9]+\.?[0-9]*)(%|px)/;function ss(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const t=wD.exec(n);if(t&&t.length>=3){const e=t[2]==="%",i=parseFloat(t[1]);return{position:e?i/100:i,relative:e}}default:throw new Error(`Could not parse position string ${n}`)}}function rs(n,t){return n.relative?Math.round(n.position*t):n.position}class Ea{constructor(t){const{id:e,x:i=0,y:s=0,width:r="100%",height:l="100%",padding:c=null}=t;this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=ss(i),this._y=ss(s),this._width=ss(r),this._height=ss(l),this._padding=c&&{left:ss(c.left||0),right:ss(c.right||0),top:ss(c.top||0),bottom:ss(c.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.constructor===t.constructor&&Rn(this.props,t.props,2)}clone(t){const e=this.constructor;return new e({...this.props,...t})}makeViewport({width:t,height:e,viewState:i}){i=this.filterViewState(i);const s=this.getDimensions({width:t,height:e});if(!s.height||!s.width)return null;const r=this.getViewportType(i);return new r({...i,...this.props,...s})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:t?.id||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const i in this.props.viewState)i!=="id"&&(e[i]=this.props.viewState[i]);return e}return t}getDimensions({width:t,height:e}){const i={x:rs(this._x,t),y:rs(this._y,e),width:rs(this._width,t),height:rs(this._height,e)};return this._padding&&(i.padding={left:rs(this._padding.left,t),top:rs(this._padding.top,e),right:rs(this._padding.right,t),bottom:rs(this._padding.bottom,e)}),i}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class cf{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){this.cancel(),this.settings=t,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:t,settings:e}=this;this._handle=t.addChannel({delay:t.getTime(),duration:e.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const ox=()=>{},eg={BREAK:1,SNAP_TO_END:2,IGNORE:3},ED=n=>n,RD=eg.BREAK;class CD{constructor(t){this._onTransitionUpdate=e=>{const{time:i,settings:{interpolator:s,startProps:r,endProps:l,duration:c,easing:f}}=e,d=f(i/c),p=s.interpolateProps(r,l,d);this.propsInTransition=this.getControllerState({...this.props,...p}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new cf(t.timeline),this.onViewStateChange=t.onViewStateChange||ox,this.onStateChange=t.onStateChange||ox}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const i=this.props;if(this.props=t,!i||this._shouldIgnoreViewportChange(i,t))return!1;if(this._isTransitionEnabled(t)){let s=i;if(this.transition.inProgress){const{interruption:r,endProps:l}=this.transition.settings;s={...i,...r===eg.SNAP_TO_END?l:this.propsInTransition||i}}this._triggerTransition(s,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:i}=t;return(e>0||e==="auto")&&!!i}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===eg.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0}_triggerTransition(t,e){const i=this.getControllerState(t),s=this.getControllerState(e).shortestPathFrom(i),r=e.transitionInterpolator,l=r.getDuration?r.getDuration(t,e):e.transitionDuration;if(l===0)return;const c=r.initializeProps(t,s);this.propsInTransition={};const f={duration:l,easing:e.transitionEasing||ED,interpolator:r,interruption:e.transitionInterruption||RD,startProps:c.start,endProps:c.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t?.(e)}}}function ke(n,t){if(!n)throw new Error(t||"deck.gl: assertion failed.")}class MD{constructor(t){const{compare:e,extract:i,required:s}=t;this._propsToCompare=e,this._propsToExtract=i||e,this._requiredProps=s}arePropsEqual(t,e){for(const i of this._propsToCompare)if(!(i in t)||!(i in e)||!ol(t[i],e[i]))return!1;return!0}initializeProps(t,e){const i={},s={};for(const r of this._propsToExtract)(r in t||r in e)&&(i[r]=t[r],s[r]=e[r]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const i=t[e];ke(Number.isFinite(i)||Array.isArray(i),`${e} is required for transition`)})}}const OD=["longitude","latitude","zoom","bearing","pitch"],ID=["longitude","latitude","zoom"];class q2 extends MD{constructor(t={}){const e=Array.isArray(t)?t:t.transitionProps,i=Array.isArray(t)?{}:t;i.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:OD,required:ID},super(i.transitionProps),this.opts=i}initializeProps(t,e){const i=super.initializeProps(t,e),{makeViewport:s,around:r}=this.opts;if(s&&r){const l=s(t),c=s(e),f=l.unproject(r);i.start.around=r,Object.assign(i.end,{around:c.project(f),aroundPosition:f,width:e.width,height:e.height})}return i}interpolateProps(t,e,i){const s={};for(const r of this._propsToExtract)s[r]=Lu(t[r]||0,e[r]||0,i);if(e.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...e,...s});Object.assign(s,r.panByPosition(e.aroundPosition,Lu(t.around,e.around,i)))}return s}}const Ai={transitionDuration:0},PD=300,Jc=n=>1-(1-n)*(1-n),ra={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Ls={};class DD{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new CD({...t,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events)this._events[t]&&this.eventManager?.off(t,this.handleEvent);this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"multipanstart":return e?!1:this._onMultiPanStart(t);case"multipanmove":return this._onMultiPan(t);case"multipanend":return this._onMultiPanEnd(t);case"dblclick":return this._onDoubleClick(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:i}=this.props,{offsetCenter:s}=t;return[s.x-e,s.y-i]}isPointInBounds(t,e){const{width:i,height:s}=this.props;if(e&&e.handled)return!1;const r=t[0]>=0&&t[0]<=i&&t[1]>=0&&t[1]<=s;return r&&e&&e.stopPropagation(),r}isFunctionKeyPressed(t){const{srcEvent:e}=t;return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:e===!0?PD:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:r=!0,doubleClickZoom:l=!0,touchZoom:c=!0,touchRotate:f=!1,keyboard:d=!0}=t,p=!!this.onViewStateChange;this.toggleEvents(ra.WHEEL,p&&i),this.toggleEvents(ra.PAN,p),this.toggleEvents(ra.PINCH,p&&(c||f)),this.toggleEvents(ra.MULTI_PAN,p&&f),this.toggleEvents(ra.DOUBLE_CLICK,p&&l),this.toggleEvents(ra.KEYBOARD,p&&d),this.scrollZoom=i,this.dragPan=s,this.dragRotate=r,this.doubleClickZoom=l,this.touchZoom=c,this.touchRotate=f,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(i=>{this._events[i]!==e&&(this._events[i]=e,e?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(t,e=null,i={}){const s={...t.getViewportProps(),...e},r=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(i),r){const l=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:l,viewId:this.props.id})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let i=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:e});return this._panMove=i,this.updateViewport(s,Ai,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),i=this.controllerState.pan({pos:e});return this.updateViewport(i,Ai,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const i=this.getCenter(t),s=[i[0]+t.velocityX*e/2,i[1]+t.velocityY*e/2],r=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Jc},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),i=this.controllerState.rotate({pos:e});return this.updateViewport(i,Ai,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const i=this.getCenter(t),s=[i[0]+t.velocityX*e/2,i[1]+t.velocityY*e/2],r=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Jc},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;t.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:r}=t;let l=2/(1+Math.exp(-Math.abs(r*i)));r<0&&l!==0&&(l=1/l);const c=s?{...this._getTransitionProps({around:e}),transitionDuration:250}:Ai,f=this.controllerState.zoom({pos:e,scale:l});return this.updateViewport(f,c,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.controllerState.rotateStart({pos:e});return this.updateViewport(i,Ai,{isDragging:!0}),!0}_onMultiPan(t){if(!this.touchRotate||!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const i=this.controllerState.rotate({pos:e});return this.updateViewport(i,Ai,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const i=this.getCenter(t),s=[i[0],i[1]+=t.velocityY*e/2],r=this.controllerState.rotate({pos:s});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Jc},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return Ls._startPinchRotation=t.rotation,Ls._lastPinchEvent=t,this.updateViewport(i,Ai,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:i}=t,s=this.getCenter(t);e=e.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=t;e=e.rotate({deltaAngleX:Ls._startPinchRotation-i})}return this.updateViewport(e,Ai,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Ls._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:i}=Ls;if(this.touchZoom&&e&&i&&t.scale!==i.scale){const s=this.getCenter(t);let r=this.controllerState.rotateEnd();const l=Math.log2(t.scale),c=(l-Math.log2(i.scale))/(t.deltaTime-i.deltaTime),f=Math.pow(2,l+c*e/2);r=r.zoom({pos:s,scale:f}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:s}),transitionDuration:e,transitionEasing:Jc},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Ls._startPinchRotation=null,Ls._lastPinchEvent=null,!0}_onDoubleClick(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.isFunctionKeyPressed(t),s=this.controllerState.zoom({pos:e,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:r,rotateSpeedY:l}=this.keyboard===!0?{}:this.keyboard,{controllerState:c}=this;let f;const d={};switch(t.srcEvent.code){case"Minus":f=e?c.zoomOut(i).zoomOut(i):c.zoomOut(i),d.isZooming=!0;break;case"Equal":f=e?c.zoomIn(i).zoomIn(i):c.zoomIn(i),d.isZooming=!0;break;case"ArrowLeft":e?(f=c.rotateLeft(r),d.isRotating=!0):(f=c.moveLeft(s),d.isPanning=!0);break;case"ArrowRight":e?(f=c.rotateRight(r),d.isRotating=!0):(f=c.moveRight(s),d.isPanning=!0);break;case"ArrowUp":e?(f=c.rotateUp(l),d.isRotating=!0):(f=c.moveUp(s),d.isPanning=!0);break;case"ArrowDown":e?(f=c.rotateDown(l),d.isRotating=!0):(f=c.moveDown(s),d.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),d),!0}_getTransitionProps(t){const{transition:e}=this;return!e||!e.transitionInterpolator?Ai:t?{...e,transitionInterpolator:new q2({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e}}class kD{constructor(t,e){this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}const lx=5,ND=1.2;class BD extends kD{constructor(t){const{width:e,height:i,latitude:s,longitude:r,zoom:l,bearing:c=0,pitch:f=0,altitude:d=1.5,position:p=[0,0,0],maxZoom:_=20,minZoom:y=0,maxPitch:b=60,minPitch:x=0,startPanLngLat:T,startZoomLngLat:A,startRotatePos:E,startBearing:D,startPitch:C,startZoom:O,normalize:k=!0}=t;ke(Number.isFinite(r)),ke(Number.isFinite(s)),ke(Number.isFinite(l)),super({width:e,height:i,latitude:s,longitude:r,zoom:l,bearing:c,pitch:f,altitude:d,maxZoom:_,minZoom:y,maxPitch:b,minPitch:x,normalize:k,position:p},{startPanLngLat:T,startZoomLngLat:A,startRotatePos:E,startBearing:D,startPitch:C,startZoom:O}),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:e}){const i=this.getState().startPanLngLat||this._unproject(e);if(!i)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(i,t);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:r,startPitch:l}=this.getState();if(!s||r===void 0||l===void 0)return this;let c;return t?c=this._getNewRotation(t,s,l,r):c={bearing:r+e,pitch:l+i},this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:e,scale:i}){let{startZoom:s,startZoomLngLat:r}=this.getState();if(r||(s=this.getViewportProps().zoom,r=this._unproject(e)||this._unproject(t)),!r)return this;const{maxZoom:l,minZoom:c}=this.getViewportProps();let f=s+Math.log2(i);f=fs(f,c,l);const d=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...d.panByPosition(r,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:r}=i;return Math.abs(s-e.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(r-e.longitude)>180&&(i.longitude=r<0?r+360:r-360),i}applyConstraints(t){const{maxZoom:e,minZoom:i,zoom:s}=t;t.zoom=fs(s,i,e);const{maxPitch:r,minPitch:l,pitch:c}=t;t.pitch=fs(c,l,r);const{normalize:f=!0}=t;return f&&Object.assign(t,iP(t)),t}_zoomFromCenter(t){const{width:e,height:i}=this.getViewportProps();return this.zoom({pos:[e/2,i/2],scale:t})}_panFromCenter(t){const{width:e,height:i}=this.getViewportProps();return this.pan({startPos:[e/2,i/2],pos:[e/2+t[0],i/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,i,s){const r=t[0]-e[0],l=t[1]-e[1],c=t[1],f=e[1],{width:d,height:p}=this.getViewportProps(),_=r/d;let y=0;l>0?Math.abs(p-f)>lx&&(y=l/(f-p)*ND):l<0&&f>lx&&(y=1-c/f),y=fs(y,-1,1);const{minPitch:b,maxPitch:x}=this.getViewportProps(),T=s+180*_;let A=i;return y>0?A=i+y*(x-i):y<0&&(A=i-y*(b-i)),{pitch:A,bearing:T}}}class UD extends DD{constructor(){super(...arguments),this.ControllerState=BD,this.transition={transitionDuration:300,transitionInterpolator:new q2({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class K2 extends Ea{constructor(t={}){super(t)}getViewportType(){return Sa}get ControllerType(){return UD}}K2.displayName="MapView";const FD=new z2;function LD(n,t){const e=n.order??1/0,i=t.order??1/0;return e-i}class zD{constructor(t){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=t,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find(i=>i.id===t.id)){const i=e.findIndex(s=>LD(s,t)>0);i<0?e.push(t):e.splice(i,0,t),t.setup(this._context),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(Rn(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const s of this.effects)e[s.id]=s;const i=[];for(const s of t){const r=e[s.id];let l=s;r&&r!==s?r.setProps?(r.setProps(s.props),l=r):r.cleanup(this._context):r||s.setup(this._context),i.push(l),delete e[s.id]}for(const s in e)e[s].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),t.some(s=>s instanceof z2)||this._resolvedEffects.push(FD),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class VD extends Jg{shouldDrawLayer(t){const{operation:e}=t.props;return e.includes("draw")||e.includes("terrain")}}const HD="deckRenderer.renderLayers";class jD{constructor(t){this.device=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new VD(t),this.pickLayersPass=new $2(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t};i.effects&&this._preRender(i.effects,i);const s=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const r=e.render({...i,target:s});i.effects&&(this.lastPostProcessEffect&&(i.clearCanvas=t.clearCanvas===void 0?!0:t.clearCanvas),this._postRender(i.effects,i)),this.renderCount++,We(HD,this,r,t)}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const i of t)e.preRenderStats[i.id]=i.preRender(e),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this,e=this.device.canvasContext.getDrawingBufferSize(),[i,s]=e;t.length===0&&[0,1].map(r=>{const l=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:i,height:s});t.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[l]}))});for(const r of t)r.resize(e)}_postRender(t,e){const{renderBuffers:i}=this,s={...e,inputBuffer:i[0],swapBuffer:i[1]};for(const r of t)if(r.postRender){s.target=r.id===this.lastPostProcessEffect?e.target:void 0;const l=r.postRender(s);s.inputBuffer=l,s.swapBuffer=l===i[0]?i[1]:i[0]}}}const WD={pickedColor:null,pickedObjectIndex:-1};function cx({pickedColors:n,decodePickingColor:t,deviceX:e,deviceY:i,deviceRadius:s,deviceRect:r}){const{x:l,y:c,width:f,height:d}=r;let p=s*s,_=-1,y=0;for(let b=0;b<d;b++){const x=b+c-i,T=x*x;if(T>p)y+=4*f;else for(let A=0;A<f;A++){if(n[y+3]-1>=0){const D=A+l-e,C=D*D+T;C<=p&&(p=C,_=y)}y+=4}}if(_>=0){const b=n.slice(_,_+4),x=t(b);if(x){const T=Math.floor(_/4/f),A=_/4-T*f;return{...x,pickedColor:b,pickedX:l+A,pickedY:c+T}}Qt.error("Picked non-existent layer. Is picking buffer corrupt?")()}return WD}function ux({pickedColors:n,decodePickingColor:t}){const e=new Map;if(n){for(let i=0;i<n.length;i+=4)if(n[i+3]-1>=0){const r=n.slice(i,i+4),l=r.join(",");if(!e.has(l)){const c=t(r);c?e.set(l,{...c,color:r}):Qt.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(e.values())}function ng({pickInfo:n,viewports:t,pixelRatio:e,x:i,y:s,z:r}){let l=t[0];t.length>1&&(l=$D(n?.pickedViewports||t,{x:i,y:s}));let c;if(l){const f=[i-l.x,s-l.y];r!==void 0&&(f[2]=r),c=l.unproject(f)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:c,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:e}}function fx(n){const{pickInfo:t,lastPickedInfo:e,mode:i,layers:s}=n,{pickedColor:r,pickedLayer:l,pickedObjectIndex:c}=t,f=l?[l]:[];if(i==="hover"){const _=e.index,y=e.layerId,b=l?l.props.id:null;if(b!==y||c!==_){if(b!==y){const x=s.find(T=>T.props.id===y);x&&f.unshift(x)}e.layerId=b,e.index=c,e.info=null}}const d=ng(n),p=new Map;return p.set(null,d),f.forEach(_=>{let y={...d};_===l&&(y.color=r,y.index=c,y.picked=!0),y=ig({layer:_,info:y,mode:i});const b=y.layer;_===l&&i==="hover"&&(e.info=y),p.set(b.id,y),i==="hover"&&b.updateAutoHighlight(y)}),p}function ig({layer:n,info:t,mode:e}){for(;n&&t;){const i=t.layer||null;t.sourceLayer=i,t.layer=n,t=n.getPickingInfo({info:t,mode:e,sourceLayer:i}),n=n.parent}return t}function $D(n,t){for(let e=n.length-1;e>=0;e--){const i=n[e];if(i.containsPixel(t))return i}return n[0]}class XD{constructor(t){this._pickable=!0,this.device=t,this.pickLayersPass=new $2(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(t){return this._pickClosestObjectAsync(t)}pickObjectsAsync(t){return this._pickVisibleObjectsAsync(t)}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:e,layers:i,viewports:s},r=this.lastPickedInfo.info){const l=r&&r.layer&&r.layer.id,c=r&&r.viewport&&r.viewport.id,f=l?i.find(y=>y.id===l):null,d=c&&s.find(y=>y.id===c)||s[0],p=d&&d.unproject([t-d.x,e-d.y]);return{...r,...{x:t,y:e,viewport:d,coordinate:p,layer:f}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}const{canvas:t}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:t.width,height:t.height}),this.depthFBO?.resize({width:t.width,height:t.height})}_getPickable(t){if(this._pickable===!1)return null;const e=t.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return e.length?e:null}async _pickClosestObjectAsync({layers:t,views:e,viewports:i,x:s,y:r,radius:l=0,depth:c=1,mode:f="query",unproject3D:d,onViewportActive:p,effects:_}){const y=this.device.canvasContext.cssToDeviceRatio(),b=this._getPickable(t);if(!b||i.length===0)return{result:[],emptyInfo:ng({viewports:i,x:s,y:r,pixelRatio:y})};this._resizeBuffer();const x=this.device.canvasContext.cssToDevicePixels([s,r],!0),T=[x.x+Math.floor(x.width/2),x.y+Math.floor(x.height/2)],A=Math.round(l*y),{width:E,height:D}=this.pickingFBO,C=this._getPickingRect({deviceX:T[0],deviceY:T[1],deviceRadius:A,deviceWidth:E,deviceHeight:D}),O={x:s-l,y:r-l,width:l*2+1,height:l*2+1};let k;const z=[],Y=new Set;for(let q=0;q<c;q++){let G;if(C){const nt=this._drawAndSample({layers:b,views:e,viewports:i,onViewportActive:p,deviceRect:C,cullRect:O,effects:_,pass:`picking:${f}`});G=cx({...nt,deviceX:T[0],deviceY:T[1],deviceRadius:A,deviceRect:C})}else G={pickedColor:null,pickedObjectIndex:-1};let at;if(G.pickedLayer&&d&&this.depthFBO){const{pickedColors:nt}=this._drawAndSample({layers:[G.pickedLayer],views:e,viewports:i,onViewportActive:p,deviceRect:{x:G.pickedX,y:G.pickedY,width:1,height:1},cullRect:O,effects:_,pass:`picking:${f}:z`},!0);nt[3]&&(at=nt[0])}G.pickedLayer&&q+1<c&&(Y.add(G.pickedLayer),G.pickedLayer.disablePickingIndex(G.pickedObjectIndex)),k=fx({pickInfo:G,lastPickedInfo:this.lastPickedInfo,mode:f,layers:b,viewports:i,x:s,y:r,z:at,pixelRatio:y});for(const nt of k.values())nt.layer&&z.push(nt);if(!G.pickedColor)break}for(const q of Y)q.restorePickingColors();return{result:z,emptyInfo:k.get(null)}}_pickClosestObject({layers:t,views:e,viewports:i,x:s,y:r,radius:l=0,depth:c=1,mode:f="query",unproject3D:d,onViewportActive:p,effects:_}){const y=this.device.canvasContext.cssToDeviceRatio(),b=this._getPickable(t);if(!b||i.length===0)return{result:[],emptyInfo:ng({viewports:i,x:s,y:r,pixelRatio:y})};this._resizeBuffer();const x=this.device.canvasContext.cssToDevicePixels([s,r],!0),T=[x.x+Math.floor(x.width/2),x.y+Math.floor(x.height/2)],A=Math.round(l*y),{width:E,height:D}=this.pickingFBO,C=this._getPickingRect({deviceX:T[0],deviceY:T[1],deviceRadius:A,deviceWidth:E,deviceHeight:D}),O={x:s-l,y:r-l,width:l*2+1,height:l*2+1};let k;const z=[],Y=new Set;for(let q=0;q<c;q++){let G;if(C){const nt=this._drawAndSample({layers:b,views:e,viewports:i,onViewportActive:p,deviceRect:C,cullRect:O,effects:_,pass:`picking:${f}`});G=cx({...nt,deviceX:T[0],deviceY:T[1],deviceRadius:A,deviceRect:C})}else G={pickedColor:null,pickedObjectIndex:-1};let at;if(G.pickedLayer&&d&&this.depthFBO){const{pickedColors:nt}=this._drawAndSample({layers:[G.pickedLayer],views:e,viewports:i,onViewportActive:p,deviceRect:{x:G.pickedX,y:G.pickedY,width:1,height:1},cullRect:O,effects:_,pass:`picking:${f}:z`},!0);nt[3]&&(at=nt[0])}G.pickedLayer&&q+1<c&&(Y.add(G.pickedLayer),G.pickedLayer.disablePickingIndex(G.pickedObjectIndex)),k=fx({pickInfo:G,lastPickedInfo:this.lastPickedInfo,mode:f,layers:b,viewports:i,x:s,y:r,z:at,pixelRatio:y});for(const nt of k.values())nt.layer&&z.push(nt);if(!G.pickedColor)break}for(const q of Y)q.restorePickingColors();return{result:z,emptyInfo:k.get(null)}}async _pickVisibleObjectsAsync({layers:t,views:e,viewports:i,x:s,y:r,width:l=1,height:c=1,mode:f="query",maxObjects:d=null,onViewportActive:p,effects:_}){const y=this._getPickable(t);if(!y||i.length===0)return[];this._resizeBuffer();const b=this.device.canvasContext.cssToDeviceRatio(),x=this.device.canvasContext.cssToDevicePixels([s,r],!0),T=x.x,A=x.y+x.height,E=this.device.canvasContext.cssToDevicePixels([s+l,r+c],!0),D=E.x+E.width,C=E.y,O={x:T,y:C,width:D-T,height:A-C},k=this._drawAndSample({layers:y,views:e,viewports:i,onViewportActive:p,deviceRect:O,cullRect:{x:s,y:r,width:l,height:c},effects:_,pass:`picking:${f}`}),z=ux(k),Y=new Map,q=[],G=Number.isFinite(d);for(let at=0;at<z.length&&!(G&&q.length>=d);at++){const nt=z[at];let ot={color:nt.pickedColor,layer:null,index:nt.pickedObjectIndex,picked:!0,x:s,y:r,pixelRatio:b};ot=ig({layer:nt.pickedLayer,info:ot,mode:f});const xt=ot.layer.id;Y.has(xt)||Y.set(xt,new Set);const dt=Y.get(xt),mt=ot.object??ot.index;dt.has(mt)||(dt.add(mt),q.push(ot))}return q}_pickVisibleObjects({layers:t,views:e,viewports:i,x:s,y:r,width:l=1,height:c=1,mode:f="query",maxObjects:d=null,onViewportActive:p,effects:_}){const y=this._getPickable(t);if(!y||i.length===0)return[];this._resizeBuffer();const b=this.device.canvasContext.cssToDeviceRatio(),x=this.device.canvasContext.cssToDevicePixels([s,r],!0),T=x.x,A=x.y+x.height,E=this.device.canvasContext.cssToDevicePixels([s+l,r+c],!0),D=E.x+E.width,C=E.y,O={x:T,y:C,width:D-T,height:A-C},k=this._drawAndSample({layers:y,views:e,viewports:i,onViewportActive:p,deviceRect:O,cullRect:{x:s,y:r,width:l,height:c},effects:_,pass:`picking:${f}`}),z=ux(k),Y=new Map,q=[],G=Number.isFinite(d);for(let at=0;at<z.length&&!(G&&q.length>=d);at++){const nt=z[at];let ot={color:nt.pickedColor,layer:null,index:nt.pickedObjectIndex,picked:!0,x:s,y:r,pixelRatio:b};ot=ig({layer:nt.pickedLayer,info:ot,mode:f});const xt=ot.layer.id;Y.has(xt)||Y.set(xt,new Set);const dt=Y.get(xt),mt=ot.object??ot.index;dt.has(mt)||(dt.add(mt),q.push(ot))}return q}async _drawAndSampleAsync({layers:t,views:e,viewports:i,onViewportActive:s,deviceRect:r,cullRect:l,effects:c,pass:f},d=!1){const p=d?this.depthFBO:this.pickingFBO,_={layers:t,layerFilter:this.layerFilter,views:e,viewports:i,onViewportActive:s,pickingFBO:p,deviceRect:r,cullRect:l,effects:c,pass:f,pickZ:d,preRenderStats:{},isPicking:!0};for(const D of c)D.useInPicking&&(_.preRenderStats[D.id]=D.preRender(_));const{decodePickingColor:y}=this.pickLayersPass.render(_),{x:b,y:x,width:T,height:A}=r,E=new(d?Float32Array:Uint8Array)(T*A*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:b,sourceY:x,sourceWidth:T,sourceHeight:A,target:E}),{pickedColors:E,decodePickingColor:y}}_drawAndSample({layers:t,views:e,viewports:i,onViewportActive:s,deviceRect:r,cullRect:l,effects:c,pass:f},d=!1){const p=d?this.depthFBO:this.pickingFBO,_={layers:t,layerFilter:this.layerFilter,views:e,viewports:i,onViewportActive:s,pickingFBO:p,deviceRect:r,cullRect:l,effects:c,pass:f,pickZ:d,preRenderStats:{},isPicking:!0};for(const D of c)D.useInPicking&&(_.preRenderStats[D.id]=D.preRender(_));const{decodePickingColor:y}=this.pickLayersPass.render(_),{x:b,y:x,width:T,height:A}=r,E=new(d?Float32Array:Uint8Array)(T*A*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:b,sourceY:x,sourceWidth:T,sourceHeight:A,target:E}),{pickedColors:E,decodePickingColor:y}}_getPickingRect({deviceX:t,deviceY:e,deviceRadius:i,deviceWidth:s,deviceHeight:r}){const l=Math.max(0,t-i),c=Math.max(0,e-i),f=Math.min(s,t+i+1)-l,d=Math.min(r,e+i+1)-c;return f<=0||d<=0?null:{x:l,y:c,width:f,height:d}}}const YD={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},qD="top-left",hx="__root";class KD{constructor({deck:t,parentElement:e}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,e?.classList.add("deck-widget-container"),this.parentElement=e}getWidgets(){return this.resolvedWidgets}setProps(t){if(t.widgets&&!Rn(t.widgets,this.widgets,1)){const e=t.widgets.filter(Boolean);this._setWidgets(e)}}finalize(){for(const t of this.getWidgets())this._removeWidget(t);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const t in this.containers)this.containers[t].remove()}addDefault(t){this.defaultWidgets.find(e=>e.id===t.id)||(this._addWidget(t),this.defaultWidgets.push(t),this._setWidgets(this.widgets))}onRedraw({viewports:t,layers:e}){const i=t.reduce((s,r)=>(s[r.id]=r,s),{});for(const s of this.getWidgets()){const{viewId:r}=s;if(r){const l=i[r];l&&(s.onViewportChange&&s.onViewportChange(l),s.onRedraw?.({viewports:[l],layers:e}))}else{if(s.onViewportChange)for(const l of t)s.onViewportChange(l);s.onRedraw?.({viewports:t,layers:e})}}this.lastViewports=i,this._updateContainers()}onHover(t,e){for(const i of this.getWidgets()){const{viewId:s}=i;(!s||s===t.viewport?.id)&&i.onHover?.(t,e)}}onEvent(t,e){const i=Zp[e.type];if(i)for(const s of this.getWidgets()){const{viewId:r}=s;(!r||r===t.viewport?.id)&&s[i]?.(t,e)}}_setWidgets(t){const e={};for(const i of this.resolvedWidgets)e[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)e[i.id]=null,this.resolvedWidgets.push(i);for(let i of t){const s=e[i.id];s?s.viewId!==i.viewId||s.placement!==i.placement?(this._removeWidget(s),this._addWidget(i)):i!==s&&(s.setProps(i.props),i=s):this._addWidget(i),e[i.id]=null,this.resolvedWidgets.push(i)}for(const i in e){const s=e[i];s&&this._removeWidget(s)}this.widgets=t}_addWidget(t){const{viewId:e=null,placement:i=qD}=t;t.widgetManager=this,t.deck=this.deck,t.rootElement=t._onAdd({deck:this.deck,viewId:e}),t.rootElement&&this._getContainer(e,i).append(t.rootElement),t.updateHTML()}_removeWidget(t){t.onRemove?.(),t.rootElement&&t.rootElement.remove(),t.rootElement=void 0,t.deck=void 0,t.widgetManager=void 0}_getContainer(t,e){const i=t||hx;let s=this.containers[i];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",this.parentElement?.append(s),this.containers[i]=s);let r=s.querySelector(`.${e}`);return r||(r=globalThis.document.createElement("div"),r.className=e,r.style.position="absolute",r.style.zIndex="2",Object.assign(r.style,YD[e]),s.append(r)),r}_updateContainers(){const t=this.deck.width,e=this.deck.height;for(const i in this.containers){const s=this.lastViewports[i]||null,r=i===hx||s,l=this.containers[i];r?(l.style.display="block",l.style.left=`${s?s.x:0}px`,l.style.top=`${s?s.y:0}px`,l.style.width=`${s?s.width:t}px`,l.style.height=`${s?s.height:e}px`):l.style.display="none"}}}function dx(n,t){t&&Object.entries(t).map(([e,i])=>{e.startsWith("--")?n.style.setProperty(e,i):n.style[e]=i})}function ZD(n,t){t&&Object.keys(t).map(e=>{e.startsWith("--")?n.style.removeProperty(e):n.style[e]=""})}class i_{constructor(t){this.viewId=null,this.props={...this.constructor.defaultProps,...t},this.id=this.props.id}setProps(t){const e=this.props,i=this.rootElement;i&&e.className!==t.className&&(e.className&&i.classList.remove(e.className),t.className&&i.classList.add(t.className)),i&&!Rn(e.style,t.style,1)&&(ZD(i,e.style),dx(i,t.style)),Object.assign(this.props,t),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const t=["deck-widget",this.className,this.props.className],e=document.createElement("div");return t.filter(i=>typeof i=="string"&&i.length>0).forEach(i=>e.classList.add(i)),dx(e,this.props.style),e}_onAdd(t){return this.onAdd(t)??this.onCreateRootElement()}onAdd(t){}onRemove(){}onViewportChange(t){}onRedraw(t){}onHover(t,e){}onClick(t,e){}onDrag(t,e){}onDragStart(t,e){}onDragEnd(t,e){}}i_.defaultProps={id:"widget",style:{},className:""};const QD={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Z2 extends i_{constructor(t={}){super(t),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(t)}onCreateRootElement(){const t=document.createElement("div");return t.className=this.className,Object.assign(t.style,QD),t}onRenderHTML(t){}onViewportChange(t){this.isVisible&&t.id===this.lastViewport?.id&&t!==this.lastViewport&&this.setTooltip(null)}onHover(t){const{deck:e}=this,i=e&&e.props.getTooltip;if(!i)return;const s=i(t);this.lastViewport=t.viewport,this.setTooltip(s,t.x,t.y)}setTooltip(t,e,i){const s=this.rootElement;if(s){if(typeof t=="string")s.innerText=t;else if(t)t.text&&(s.innerText=t.text),t.html&&(s.innerHTML=t.html),t.className&&(s.className=t.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${e}px, ${i}px)`,t&&typeof t=="object"&&"style"in t&&Object.assign(s.style,t.style)}}}Z2.defaultProps={...i_.defaultProps};const GD="modulepreload",JD=function(n){return"/"+n},px={},gx=function(t,e,i){let s=Promise.resolve();if(e&&e.length>0){let d=function(p){return Promise.all(p.map(_=>Promise.resolve(_).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};var l=d;document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),f=c?.nonce||c?.getAttribute("nonce");s=d(e.map(p=>{if(p=JD(p),p in px)return;px[p]=!0;const _=p.endsWith(".css"),y=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${y}`))return;const b=document.createElement("link");if(b.rel=_?"stylesheet":GD,_||(b.as="script"),b.crossOrigin="",b.href=p,f&&b.setAttribute("nonce",f),document.head.appendChild(b),_)return new Promise((x,T)=>{b.addEventListener("load",x),b.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${p}`)))})}))}function r(c){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=c,window.dispatchEvent(f),!f.defaultPrevented)throw c}return s.then(c=>{for(const f of c||[])f.status==="rejected"&&r(f.reason);return t().catch(r)})};var ca;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(ca||(ca={}));const tk={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},ek=n=>({drawBuffersWEBGL(t){return n.drawBuffers(t)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),nk=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(t){return n.deleteVertexArray(t)},isVertexArrayOES(t){return n.isVertexArray(t)},bindVertexArrayOES(t){return n.bindVertexArray(t)}}),ik=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...t){return n.drawArraysInstanced(...t)},drawElementsInstancedANGLE(...t){return n.drawElementsInstanced(...t)},vertexAttribDivisorANGLE(...t){return n.vertexAttribDivisor(...t)}});function sk(n=!0){const t=HTMLCanvasElement.prototype;if(!n&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(e,i){if(e==="webgl"||e==="experimental-webgl"){const s=this.originalGetContext("webgl2",i);return s instanceof HTMLElement&&rk(s),s}return this.originalGetContext(e,i)}}function rk(n){n.getExtension("EXT_color_buffer_float");const t={...tk,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:ek(n),OES_vertex_array_object:nk(n),ANGLE_instanced_arrays:ik(n)},e=n.getExtension;n.getExtension=function(s){const r=e.call(n,s);return r||(s in t?t[s]:null)};const i=n.getSupportedExtensions;n.getSupportedExtensions=function(){return(i.apply(n)||[])?.concat(Object.keys(t))}}async function Q2(n,t){const e=document.getElementsByTagName("head")[0];if(!e)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",n),new Promise((s,r)=>{i.onload=s,i.onerror=l=>r(new Error(`Unable to load script '${n}': ${l}`)),e.appendChild(i)})}const ak=1;let fn=null,_x=!1;const s_={debugSpectorJS:et.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function ok(n){if(!globalThis.SPECTOR)try{await Q2(n.debugSpectorJSUrl||s_.debugSpectorJSUrl)}catch(t){et.warn(String(t))}}function lk(n){if(n={...s_,...n},!n.debugSpectorJS)return null;if(!fn&&globalThis.SPECTOR&&!globalThis.luma?.spector){et.probe(ak,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;fn=new t,globalThis.luma&&(globalThis.luma.spector=fn)}if(!fn)return null;if(_x||(_x=!0,fn.spyCanvases(),fn?.onCaptureStarted.add(t=>et.info("Spector capture started:",t)()),fn?.onCapture.add(t=>{et.info("Spector capture complete:",t)(),fn?.getResultUI(),fn?.resultView.display(),fn?.resultView.addCapture(t)})),n.gl){const t=n.gl,e=t.device;fn?.startCapture(n.gl,500),t.device=e,new Promise(i=>setTimeout(i,2e3)).then(i=>{et.info("Spector capture stopped after 2 seconds")(),fn?.stopCapture()})}return fn}const ck="https://unpkg.com/webgl-debug@2.0.1/index.js";function G2(n){return n.luma=n.luma||{},n.luma}async function uk(){fr()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Q2(ck))}function fk(n,t={}){return t.debugWebGL||t.traceWebGL?dk(n,t):hk(n)}function hk(n){const t=G2(n);return t.realContext?t.realContext:n}function dk(n,t){if(!globalThis.WebGLDebugUtils)return et.warn("webgl-debug not loaded")(),n;const e=G2(n);if(e.debugContext)return e.debugContext;globalThis.WebGLDebugUtils.init({...ca,...n});const i=globalThis.WebGLDebugUtils.makeDebugContext(n,pk.bind(null,t),gk.bind(null,t));for(const l in ca)!(l in i)&&typeof ca[l]=="number"&&(i[l]=ca[l]);class s{}Object.setPrototypeOf(i,Object.getPrototypeOf(n)),Object.setPrototypeOf(s,i);const r=Object.create(s);return e.realContext=n,e.debugContext=r,r.debug=!0,r}function mx(n,t){t=Array.from(t).map(i=>i===void 0?"undefined":i);let e=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,t);return e=`${e.slice(0,100)}${e.length>100?"...":""}`,`gl.${n}(${e})`}function pk(n,t,e,i){i=Array.from(i).map(c=>c===void 0?"undefined":c);const s=globalThis.WebGLDebugUtils.glEnumToString(t),r=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,i),l=`${s} in gl.${e}(${r})`;et.error(l)();debugger}function gk(n,t,e){let i="";et.level>=1&&(i=mx(t,e),n.traceWebGL&&et.log(1,i)());for(const s of e)if(s===void 0){i=i||mx(t,e);debugger}}const tu=1;class _k extends dM{type="webgl";constructor(){super(),sr.defaultProps={...sr.defaultProps,...s_}}enforceWebGL2(t){sk(t)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext&&et.warn("WebGL1 is not supported",t)(),!1)}async attach(t,e={}){const{WebGLDevice:i}=await gx(async()=>{const{WebGLDevice:r}=await Promise.resolve().then(()=>Dx);return{WebGLDevice:r}},void 0);if(t instanceof i)return t;if(t?.device instanceof i)return t.device;if(!mk(t))throw new Error("Invalid WebGL2RenderingContext");const s=e.createCanvasContext===!0?{}:e.createCanvasContext;return new i({...e,_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1,...s}})}async create(t={}){const{WebGLDevice:e}=await gx(async()=>{const{WebGLDevice:i}=await Promise.resolve().then(()=>Dx);return{WebGLDevice:i}},void 0);et.groupCollapsed(tu,"WebGLDevice created")();try{const i=[];(t.debugWebGL||t.debug)&&i.push(uk()),t.debugSpectorJS&&i.push(ok(t));const s=await Promise.allSettled(i);for(const c of s)c.status==="rejected"&&et.error(`Failed to initialize debug libraries ${c.reason}`)();const r=new e(t),l=`${r._reused?"Reusing":"Created"} device with WebGL2 ${r.props.debug?"debug ":""}context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return et.probe(tu,l)(),et.table(tu,r.info)(),r}finally{et.groupEnd(tu)()}}}function mk(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const pp=new _k,r_={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},me=(n,t,e)=>t?n.enable(e):n.disable(e),yx=(n,t,e)=>n.hint(e,t),hn=(n,t,e)=>n.pixelStorei(e,t),bx=(n,t,e)=>{const i=e===36006?36009:36008;return n.bindFramebuffer(i,t)},Io=(n,t,e)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[e];n.bindBuffer(s,t)};function gp(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const yk={3042:me,32773:(n,t)=>n.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,t)=>n.clearColor(...t),3107:(n,t)=>n.colorMask(...t),2884:me,2885:(n,t)=>n.cullFace(t),2929:me,2931:(n,t)=>n.clearDepth(t),2932:(n,t)=>n.depthFunc(t),2928:(n,t)=>n.depthRange(...t),2930:(n,t)=>n.depthMask(t),3024:me,35723:yx,35725:(n,t)=>n.useProgram(t),36007:(n,t)=>n.bindRenderbuffer(36161,t),36389:(n,t)=>n.bindTransformFeedback?.(36386,t),34229:(n,t)=>n.bindVertexArray(t),36006:bx,36010:bx,34964:Io,36662:Io,36663:Io,35053:Io,35055:Io,2886:(n,t)=>n.frontFace(t),33170:yx,2849:(n,t)=>n.lineWidth(t),32823:me,32824:"polygonOffset",10752:"polygonOffset",35977:me,32926:me,32928:me,32938:"sampleCoverage",32939:"sampleCoverage",3089:me,3088:(n,t)=>n.scissor(...t),2960:me,2961:(n,t)=>n.clearStencil(t),2968:(n,t)=>n.stencilMaskSeparate(1028,t),36005:(n,t)=>n.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,t)=>n.viewport(...t),34383:me,10754:me,12288:me,12289:me,12290:me,12291:me,12292:me,12293:me,12294:me,12295:me,3333:hn,3317:hn,37440:hn,37441:hn,37443:hn,3330:hn,3332:hn,3331:hn,3314:hn,32878:hn,3316:hn,3315:hn,32877:hn,framebuffer:(n,t)=>{const e=t&&"handle"in t?t.handle:t;return n.bindFramebuffer(36160,e)},blend:(n,t)=>t?n.enable(3042):n.disable(3042),blendColor:(n,t)=>n.blendColor(...t),blendEquation:(n,t)=>{const e=typeof t=="number"?[t,t]:t;n.blendEquationSeparate(...e)},blendFunc:(n,t)=>{const e=t?.length===2?[...t,...t]:t;n.blendFuncSeparate(...e)},clearColor:(n,t)=>n.clearColor(...t),clearDepth:(n,t)=>n.clearDepth(t),clearStencil:(n,t)=>n.clearStencil(t),colorMask:(n,t)=>n.colorMask(...t),cull:(n,t)=>t?n.enable(2884):n.disable(2884),cullFace:(n,t)=>n.cullFace(t),depthTest:(n,t)=>t?n.enable(2929):n.disable(2929),depthFunc:(n,t)=>n.depthFunc(t),depthMask:(n,t)=>n.depthMask(t),depthRange:(n,t)=>n.depthRange(...t),dither:(n,t)=>t?n.enable(3024):n.disable(3024),derivativeHint:(n,t)=>{n.hint(35723,t)},frontFace:(n,t)=>n.frontFace(t),mipmapHint:(n,t)=>n.hint(33170,t),lineWidth:(n,t)=>n.lineWidth(t),polygonOffsetFill:(n,t)=>t?n.enable(32823):n.disable(32823),polygonOffset:(n,t)=>n.polygonOffset(...t),sampleCoverage:(n,t)=>n.sampleCoverage(t[0],t[1]||!1),scissorTest:(n,t)=>t?n.enable(3089):n.disable(3089),scissor:(n,t)=>n.scissor(...t),stencilTest:(n,t)=>t?n.enable(2960):n.disable(2960),stencilMask:(n,t)=>{t=gp(t)?t:[t,t];const[e,i]=t;n.stencilMaskSeparate(1028,e),n.stencilMaskSeparate(1029,i)},stencilFunc:(n,t)=>{t=gp(t)&&t.length===3?[...t,...t]:t;const[e,i,s,r,l,c]=t;n.stencilFuncSeparate(1028,e,i,s),n.stencilFuncSeparate(1029,r,l,c)},stencilOp:(n,t)=>{t=gp(t)&&t.length===3?[...t,...t]:t;const[e,i,s,r,l,c]=t;n.stencilOpSeparate(1028,e,i,s),n.stencilOpSeparate(1029,r,l,c)},viewport:(n,t)=>n.viewport(...t)};function oe(n,t,e){return t[n]!==void 0?t[n]:e[n]}const bk={blendEquation:(n,t,e)=>n.blendEquationSeparate(oe(32777,t,e),oe(34877,t,e)),blendFunc:(n,t,e)=>n.blendFuncSeparate(oe(32969,t,e),oe(32968,t,e),oe(32971,t,e),oe(32970,t,e)),polygonOffset:(n,t,e)=>n.polygonOffset(oe(32824,t,e),oe(10752,t,e)),sampleCoverage:(n,t,e)=>n.sampleCoverage(oe(32938,t,e),oe(32939,t,e)),stencilFuncFront:(n,t,e)=>n.stencilFuncSeparate(1028,oe(2962,t,e),oe(2967,t,e),oe(2963,t,e)),stencilFuncBack:(n,t,e)=>n.stencilFuncSeparate(1029,oe(34816,t,e),oe(36003,t,e),oe(36004,t,e)),stencilOpFront:(n,t,e)=>n.stencilOpSeparate(1028,oe(2964,t,e),oe(2965,t,e),oe(2966,t,e)),stencilOpBack:(n,t,e)=>n.stencilOpSeparate(1029,oe(34817,t,e),oe(34818,t,e),oe(34819,t,e))},vx={enable:(n,t)=>n({[t]:!0}),disable:(n,t)=>n({[t]:!1}),pixelStorei:(n,t,e)=>n({[t]:e}),hint:(n,t,e)=>n({[t]:e}),useProgram:(n,t)=>n({35725:t}),bindRenderbuffer:(n,t,e)=>n({36007:e}),bindTransformFeedback:(n,t,e)=>n({36389:e}),bindVertexArray:(n,t)=>n({34229:t}),bindFramebuffer:(n,t,e)=>{switch(t){case 36160:return n({36006:e,36010:e});case 36009:return n({36006:e});case 36008:return n({36010:e});default:return null}},bindBuffer:(n,t,e)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return i?n({[i]:e}):{valueChanged:!0}},blendColor:(n,t,e,i,s)=>n({32773:new Float32Array([t,e,i,s])}),blendEquation:(n,t)=>n({32777:t,34877:t}),blendEquationSeparate:(n,t,e)=>n({32777:t,34877:e}),blendFunc:(n,t,e)=>n({32969:t,32968:e,32971:t,32970:e}),blendFuncSeparate:(n,t,e,i,s)=>n({32969:t,32968:e,32971:i,32970:s}),clearColor:(n,t,e,i,s)=>n({3106:new Float32Array([t,e,i,s])}),clearDepth:(n,t)=>n({2931:t}),clearStencil:(n,t)=>n({2961:t}),colorMask:(n,t,e,i,s)=>n({3107:[t,e,i,s]}),cullFace:(n,t)=>n({2885:t}),depthFunc:(n,t)=>n({2932:t}),depthRange:(n,t,e)=>n({2928:new Float32Array([t,e])}),depthMask:(n,t)=>n({2930:t}),frontFace:(n,t)=>n({2886:t}),lineWidth:(n,t)=>n({2849:t}),polygonOffset:(n,t,e)=>n({32824:t,10752:e}),sampleCoverage:(n,t,e)=>n({32938:t,32939:e}),scissor:(n,t,e,i,s)=>n({3088:new Int32Array([t,e,i,s])}),stencilMask:(n,t)=>n({2968:t,36005:t}),stencilMaskSeparate:(n,t,e)=>n({[t===1028?2968:36005]:e}),stencilFunc:(n,t,e,i)=>n({2962:t,2967:e,2963:i,34816:t,36003:e,36004:i}),stencilFuncSeparate:(n,t,e,i,s)=>n({[t===1028?2962:34816]:e,[t===1028?2967:36003]:i,[t===1028?2963:36004]:s}),stencilOp:(n,t,e,i)=>n({2964:t,2965:e,2966:i,34817:t,34818:e,34819:i}),stencilOpSeparate:(n,t,e,i,s)=>n({[t===1028?2964:34817]:e,[t===1028?2965:34818]:i,[t===1028?2966:34819]:s}),viewport:(n,t,e,i,s)=>n({2978:[t,e,i,s]})},Zn=(n,t)=>n.isEnabled(t),xx={3042:Zn,2884:Zn,2929:Zn,3024:Zn,32823:Zn,32926:Zn,32928:Zn,3089:Zn,2960:Zn,35977:Zn},vk=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Ia(n,t){if(Tk(t))return;const e={};for(const s in t){const r=Number(s),l=yk[s];l&&(typeof l=="string"?e[l]=!0:l(n,t[s],r))}const i=n.state&&n.state.cache;if(i)for(const s in e){const r=bk[s];r(n,t,i)}}function J2(n,t=r_){if(typeof t=="number"){const s=t,r=xx[s];return r?r(n,s):n.getParameter(s)}const e=Array.isArray(t)?t:Object.keys(t),i={};for(const s of e){const r=xx[s];i[s]=r?r(n,Number(s)):n.getParameter(Number(s))}return i}function xk(n){Ia(n,r_)}function Tk(n){for(const t in n)return!1;return!0}function Sk(n,t){if(n===t)return!0;if(Tx(n)&&Tx(t)&&n.length===t.length){for(let e=0;e<n.length;++e)if(n[e]!==t[e])return!1;return!0}return!1}function Tx(n){return Array.isArray(n)||ArrayBuffer.isView(n)}class er{static get(t){return t.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(t,e){this.gl=t,this.log=e?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){const t=this.stateStack[this.stateStack.length-1];Ia(this.gl,t),this.stateStack.pop()}trackState(t,e){if(this.cache=e?.copyState?J2(t):Object.assign({},r_),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,wk(t);for(const i in vx){const s=vx[i];Ak(t,i,s)}Sx(t,"getParameter"),Sx(t,"isEnabled")}_updateCache(t){let e=!1,i;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const r in t){const l=t[r],c=this.cache[r];Sk(l,c)||(e=!0,i=c,s&&!(r in s)&&(s[r]=c),this.cache[r]=l)}return{valueChanged:e,oldValue:i}}}function Sx(n,t){const e=n[t].bind(n);n[t]=function(s){if(s===void 0||vk.has(s))return e(s);const r=er.get(n);return s in r.cache||(r.cache[s]=e(s)),r.enable?r.cache[s]:e(s)},Object.defineProperty(n[t],"name",{value:`${t}-from-cache`,configurable:!1})}function Ak(n,t,e){if(!n[t])return;const i=n[t].bind(n);n[t]=function(...r){const l=er.get(n),{valueChanged:c,oldValue:f}=e(l._updateCache,...r);return c&&i(...r),f},Object.defineProperty(n[t],"name",{value:`${t}-to-cache`,configurable:!1})}function wk(n){const t=n.useProgram.bind(n);n.useProgram=function(i){const s=er.get(n);s.program!==i&&(t(i),s.program=i)}}function Ek(n,t,e){let i="";const s={preserveDrawingBuffer:!0,...e};let r=null;if(r||=n.getContext("webgl2",s),s.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!r&&!e.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,r=n.getContext("webgl2",s),r.luma||={},r.luma.softwareRenderer=!0),r||(r=n.getContext("webgl",{}),r&&(r=null,i||="Your browser only supports WebGL1")),!r)throw i||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:l,onContextRestored:c}=t;return n.addEventListener("webglcontextlost",f=>l(f),!1),n.addEventListener("webglcontextrestored",f=>c(f),!1),r.luma||={},r}function Ra(n,t,e){return e[t]===void 0&&(e[t]=n.getExtension(t)||null),e[t]}function Rk(n,t){const e=n.getParameter(7936),i=n.getParameter(7937);Ra(n,"WEBGL_debug_renderer_info",t);const s=t.WEBGL_debug_renderer_info,r=n.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),l=n.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),c=r||e,f=l||i,d=n.getParameter(7938),p=t3(c,f),_=Ck(c,f),y=Mk(c,f);return{type:"webgl",gpu:p,gpuType:y,gpuBackend:_,vendor:c,renderer:f,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function t3(n,t){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(n)||/Apple/i.exec(t)?"apple":/AMD/i.exec(n)||/AMD/i.exec(t)||/ATI/i.exec(n)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(t)?"software":"unknown"}function Ck(n,t){return/Metal/i.exec(n)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(t)?"opengl":"unknown"}function Mk(n,t){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(t))return"cpu";switch(t3(n,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function e3(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const Vo="WEBGL_compressed_texture_s3tc",Ho="WEBGL_compressed_texture_s3tc_srgb",ua="EXT_texture_compression_rgtc",fa="EXT_texture_compression_bptc",Ok="WEBGL_compressed_texture_etc",Ik="WEBGL_compressed_texture_astc",Pk="WEBGL_compressed_texture_etc1",Dk="WEBGL_compressed_texture_pvrtc",kk="WEBGL_compressed_texture_atc",Ax="EXT_texture_norm16",wx="EXT_render_snorm",Nk="EXT_color_buffer_float",a_={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[wx],"norm16-renderable-webgl":[Ax],"snorm16-renderable-webgl":[Ax,wx],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Vo,Ho,ua,fa],"texture-compression-bc5-webgl":[ua],"texture-compression-bc7-webgl":[fa],"texture-compression-etc2":[Ok],"texture-compression-astc":[Ik],"texture-compression-etc1-webgl":[Pk],"texture-compression-pvrtc-webgl":[Dk],"texture-compression-atc-webgl":[kk]};function Bk(n){return n in a_}function Uk(n,t,e){return(a_[t]||[]).every(s=>Ra(n,s,e))}const o_={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:Nk,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Vo},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Ho},"bc1-rgba-unorm":{gl:33777,x:Vo},"bc1-rgba-unorm-srgb":{gl:35916,x:Ho},"bc2-rgba-unorm":{gl:33778,x:Vo},"bc2-rgba-unorm-srgb":{gl:35918,x:Ho},"bc3-rgba-unorm":{gl:33779,x:Vo},"bc3-rgba-unorm-srgb":{gl:35919,x:Ho},"bc4-r-unorm":{gl:36283,x:ua},"bc4-r-snorm":{gl:36284,x:ua},"bc5-rg-unorm":{gl:36285,x:ua},"bc5-rg-snorm":{gl:36286,x:ua},"bc6h-rgb-ufloat":{gl:36495,x:fa},"bc6h-rgb-float":{gl:36494,x:fa},"bc7-rgba-unorm":{gl:36492,x:fa},"bc7-rgba-unorm-srgb":{gl:36493,x:fa},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function Fk(n,t,e){let i=t.create;const s=o_[t.format];return s?.gl===void 0&&(i=!1),s?.x&&(i=i&&!!Ra(n,s.x,e)),{format:t.format,create:i&&t.create,render:i&&t.render,filter:i&&t.filter,blend:i&&t.blend,store:i&&t.store}}function n3(n){const t=o_[n],e=Vk(n),i=da.getInfo(n);return i.compressed&&(t.dataFormat=e),{internalFormat:e,format:t?.dataFormat||zk(i.channels,i.integer,i.normalized,e),type:i.dataType?e3(i.dataType):t?.types?.[0]||5121,compressed:i.compressed||!1}}function Lk(n){switch(da.getInfo(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function zk(n,t,e,i){if(i===6408||i===6407)return i;switch(n){case"r":return t&&!e?36244:6403;case"rg":return t&&!e?33320:33319;case"rgb":return t&&!e?36248:6407;case"rgba":return t&&!e?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function Vk(n){const e=o_[n]?.gl;if(e===void 0)throw new Error(`Unsupported texture format ${n}`);return e}const Ex={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class Hk extends fM{gl;extensions;testedFeatures=new Set;constructor(t,e,i){super([],i),this.gl=t,this.extensions=e,Ra(t,"EXT_color_buffer_float",e)}*[Symbol.iterator](){const t=this.getFeatures();for(const e of t)this.has(e)&&(yield e);return[]}has(t){return this.disabledFeatures?.[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),Bk(t)&&Uk(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(e=>e!=="polygon-mode-webgl");for(const e of t)this.has(e)}getFeatures(){return[...Object.keys(Ex),...Object.keys(a_)]}getWebGLFeature(t){const e=Ex[t];return typeof e=="string"?!!Ra(this.gl,e,this.extensions):!!e}}class jk extends uM{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(t){super(),this.gl=t}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class Go extends of{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(t,e){super(t,e);const i=e.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(t._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let e=0;e<this.colorAttachments.length;++e){const i=this.colorAttachments[e];if(i){const s=36064+e;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const e=Lk(this.depthStencilAttachment.props.format);this._attachTextureView(e,this.depthStencilAttachment)}if(this.device.props.debug){const e=this.gl.checkFramebufferStatus(36160);if(e!==36053)throw new Error(`Framebuffer ${$k(e)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,e){const{gl:i}=this.device,{texture:s}=e,r=e.props.baseMipLevel,l=e.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,t,s.handle,r,l);break;case 34067:const c=Wk(l);i.framebufferTexture2D(36160,t,c,s.handle,r);break;case 3553:i.framebufferTexture2D(36160,t,3553,s.handle,r);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function Wk(n){return n<34069?n+34069:n}function $k(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class Xk extends Ys{device;handle=null;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(t,e){super(e),this.device=t,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new Go(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const _p={};function Yk(n="id"){_p[n]=_p[n]||1;const t=_p[n]++;return`${n}-${t}`}class Jo extends Gt{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength=0;bytesUsed=0;constructor(t,e={}){super(t,e),this.device=t,this.gl=this.device.gl;const i=typeof e=="object"?e.handle:void 0;this.handle=i||this.gl.createBuffer(),t._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=qk(this.props.usage),this.glUsage=Kk(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,e.data?this._initWithData(e.data,e.byteOffset,e.byteLength):this._initWithByteLength(e.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(t,e=0,i=t.byteLength+e){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,e,t),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(t,e,i),this.trackAllocatedMemory(i)}_initWithByteLength(t){let e=t;t===0&&(e=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,e,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}write(t,e=0){const i=ArrayBuffer.isView(t)?t:new Uint8Array(t),s=36663;this.gl.bindBuffer(s,this.handle),this.gl.bufferSubData(s,e,i),this.gl.bindBuffer(s,null),this._setDebugData(t,e,t.byteLength)}async mapAndWriteAsync(t,e=0,i=this.byteLength-e){const s=new ArrayBuffer(i);await t(s,"copied"),this.write(s,e)}async readAsync(t=0,e){return this.readSyncWebGL(t,e)}async mapAndReadAsync(t,e=0,i){const s=await this.readAsync(e,i);return await t(s.buffer,"copied")}readSyncWebGL(t=0,e){e=e??this.byteLength-t;const i=new Uint8Array(e),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,i,s,e),this.gl.bindBuffer(36662,null),this._setDebugData(i,t,e),i}}function qk(n){return n&Gt.INDEX?34963:n&Gt.VERTEX?34962:n&Gt.UNIFORM?35345:34962}function Kk(n){return n&Gt.INDEX||n&Gt.VERTEX?35044:n&Gt.UNIFORM?35048:35044}function Zk(n){const t=n.split(/\r?\n/),e=[];for(const i of t){if(i.length<=1)continue;const s=i.split(":");if(s.length===2){const[_,y]=s;e.push({message:y.trim(),type:Rx(_),lineNum:0,linePos:0});continue}const[r,l,c,...f]=s;let d=parseInt(c,10);isNaN(d)&&(d=0);let p=parseInt(l,10);isNaN(p)&&(p=0),e.push({message:f.join(":").trim(),type:Rx(r),lineNum:d,linePos:p})}return e}function Rx(n){const t=["warning","error","info"],e=n.toLowerCase();return t.includes(e)?e:"info"}class Qk extends af{device;handle;constructor(t,e){switch(super(t,e),this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}t._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?Zk(t):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:e}=this.device;if(e.shaderSource(this.handle,t),e.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}et.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),et.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async s=>await new Promise(r=>setTimeout(r,s));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function Gk(n,t,e,i){if(nN(t))return i(n);const s=n;s.pushState();try{return Jk(n,t),Ia(s.gl,e),i(n)}finally{s.popState()}}function Jk(n,t){const e=n,{gl:i}=e;if(t.cullMode)switch(t.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(t.frontFace&&i.frontFace(nr("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&n.features.has("depth-clip-control")&&i.enable(34383),t.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&n.features.has("provoking-vertex-webgl")){const r=e.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,l=nr("provokingVertex",t.provokingVertex,{first:36429,last:36430});r?.provokingVertexWEBGL(l)}if((t.polygonMode||t.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(t.polygonMode){const r=e.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,l=nr("polygonMode",t.polygonMode,{fill:6914,line:6913});r?.polygonModeWEBGL(1028,l),r?.polygonModeWEBGL(1029,l)}t.polygonOffsetLine&&i.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&i.enable(12288),t.clipDistance1&&i.enable(12289),t.clipDistance2&&i.enable(12290),t.clipDistance3&&i.enable(12291),t.clipDistance4&&i.enable(12292),t.clipDistance5&&i.enable(12293),t.clipDistance6&&i.enable(12294),t.clipDistance7&&i.enable(12295)),t.depthWriteEnabled!==void 0&&i.depthMask(eN("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(sg("depthCompare",t.depthCompare))),t.stencilWriteMask){const s=t.stencilWriteMask;i.stencilMaskSeparate(1028,s),i.stencilMaskSeparate(1029,s)}if(t.stencilReadMask&&et.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const s=t.stencilReadMask||4294967295,r=sg("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,r,0,s),i.stencilFuncSeparate(1029,r,0,s)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const s=mp("stencilPassOperation",t.stencilPassOperation),r=mp("stencilFailOperation",t.stencilFailOperation),l=mp("stencilDepthFailOperation",t.stencilDepthFailOperation);i.stencilOpSeparate(1028,r,l,s),i.stencilOpSeparate(1029,r,l,s)}switch(t.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break}if(t.blendColorOperation||t.blendAlphaOperation){const s=Cx("blendColorOperation",t.blendColorOperation||"add"),r=Cx("blendAlphaOperation",t.blendAlphaOperation||"add");i.blendEquationSeparate(s,r);const l=eu("blendColorSrcFactor",t.blendColorSrcFactor||"one"),c=eu("blendColorDstFactor",t.blendColorDstFactor||"zero"),f=eu("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),d=eu("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");i.blendFuncSeparate(l,c,f,d)}}function sg(n,t){return nr(n,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function mp(n,t){return nr(n,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Cx(n,t){return nr(n,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function eu(n,t,e="color"){return nr(n,t,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:e==="color"?32769:32771,"one-minus-constant":e==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function tN(n,t){return`Illegal parameter ${t} for ${n}`}function nr(n,t,e){if(!(t in e))throw new Error(tN(n,t));return e[t]}function eN(n,t){return t}function nN(n){let t=!0;for(const e in n){t=!1;break}return t}function i3(n){const t={};return n.addressModeU&&(t[10242]=yp(n.addressModeU)),n.addressModeV&&(t[10243]=yp(n.addressModeV)),n.addressModeW&&(t[32882]=yp(n.addressModeW)),n.magFilter&&(t[10240]=rg(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(t[10241]=iN(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(t[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(t[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(t[34892]=34894),n.compare&&(t[34893]=sg("compare",n.compare)),n.maxAnisotropy&&(t[34046]=n.maxAnisotropy),t}function yp(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function rg(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function iN(n,t="none"){if(!t)return rg(n);switch(t){case"none":return rg(n);case"nearest":switch(n){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(n){case"nearest":return 9986;case"linear":return 9987}}}class sN extends rr{device;handle;parameters;constructor(t,e){super(t,e),this.device=t,this.parameters=i3(e),this.handle=e.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[e,i]of Object.entries(t)){const s=Number(e);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}function ll(n,t,e){if(rN(t))return e(n);const{nocatch:i=!0}=t,s=er.get(n);s.push(),Ia(n,t);let r;if(i)r=e(n),s.pop();else try{r=e(n)}finally{s.pop()}return r}function rN(n){for(const t in n)return!1;return!0}class ha extends rf{device;gl;handle;texture;constructor(t,e){super(t,{...Se.defaultProps,...e}),this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=e.texture}}class tl extends Se{device;gl;handle;sampler=void 0;view;glTarget;glFormat;glType;glInternalFormat;compressed;_textureUnit=0;constructor(t,e){super(t,e),this.device=t,this.gl=this.device.gl;const i=n3(this.props.format);this.glTarget=aN(this.props.dimension),this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:s,width:r,height:l,depth:c,mipLevels:f,glTarget:d,glInternalFormat:p}=this;switch(s){case"2d":case"cube":this.gl.texStorage2D(d,f,p,r,l);break;case"2d-array":case"3d":this.gl.texStorage3D(d,f,p,r,l,c);break;default:throw new Error(s)}this.gl.bindTexture(this.glTarget,null),this._initializeData(e.data),this.setSampler(this.props.sampler),this.view=new ha(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new ha(this.device,{...t,texture:this})}setSampler(t={}){super.setSampler(t);const e=i3(this.sampler.props);this._setSamplerParameters(e)}copyImageData(t){const e=this._normalizeCopyImageDataOptions(t),i=e.data,{width:s,height:r,depth:l}=this,{mipLevel:c=0,byteOffset:f=0,x:d=0,y:p=0,z:_=0}=e,{glFormat:y,glType:b,compressed:x}=this,T=Mx(this.glTarget,this.dimension,_);let A;if(!this.compressed){const{bytesPerPixel:D}=this.device.getTextureFormatInfo(this.format);if(D){if(e.bytesPerRow%D!==0)throw new Error(`bytesPerRow (${e.bytesPerRow}) must be a multiple of bytesPerPixel (${D}) for ${this.format}`);A=e.bytesPerRow/D}}const E=this.compressed?{}:{...A!==void 0?{3314:A}:{},32878:e.rowsPerImage};this.gl.bindTexture(T,this.handle),ll(this.gl,E,()=>{switch(this.dimension){case"2d":case"cube":x?this.gl.compressedTexSubImage2D(T,c,d,p,s,r,y,i,f):this.gl.texSubImage2D(T,c,d,p,s,r,y,b,i,f);break;case"2d-array":case"3d":x?this.gl.compressedTexSubImage3D(T,c,d,p,_,s,r,l,y,i,f):this.gl.texSubImage3D(T,c,d,p,_,s,r,l,y,b,i,f);break;default:}}),this.gl.bindTexture(T,null)}copyExternalImage(t){const e=this._normalizeCopyExternalImageOptions(t);if(e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:i,glType:s}=this,{image:r,depth:l,mipLevel:c,x:f,y:d,z:p,width:_,height:y}=e,b=Mx(this.glTarget,this.dimension,l),x=e.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),ll(this.gl,x,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(b,c,f,d,_,y,i,s,r);break;case"2d-array":case"3d":this.gl.texSubImage3D(b,c,f,d,p,_,y,l,i,s,r);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:e.width,height:e.height}}generateMipmapsWebGL(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(et.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!t?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){et.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(t){et.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[e,i]of Object.entries(t)){const s=Number(e),r=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,r);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,s,r);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,s,r);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,r);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,s,r);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(t){const{gl:e}=this;return t!==void 0&&(this._textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.glTarget,this.handle),t}_unbind(t){const{gl:e}=this;return t!==void 0&&(this._textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.glTarget,null),t}}function aN(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function Mx(n,t,e){return t==="cube"?34069+e:n}function oN(n){return fN[n]}function l_(n){return uN[n]}function lN(n){return!!s3[n]}function cN(n){return s3[n]}const uN={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},s3={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},fN={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function hN(n,t){const e={attributes:[],bindings:[]};e.attributes=dN(n,t);const i=_N(n,t);for(const c of i){const f=c.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));e.bindings.push({type:"uniform",name:c.name,group:0,location:c.location,visibility:(c.vertex?1:0)&(c.fragment?2:0),minBindingSize:c.byteLength,uniforms:f})}const s=gN(n,t);let r=0;for(const c of s)if(lN(c.type)){const{viewDimension:f,sampleType:d}=cN(c.type);e.bindings.push({type:"texture",name:c.name,group:0,location:r,viewDimension:f,sampleType:d}),c.textureUnit=r,r+=1}s.length&&(e.uniforms=s);const l=pN(n,t);return l?.length&&(e.varyings=l),e}function dN(n,t){const e=[],i=n.getProgramParameter(t,35721);for(let s=0;s<i;s++){const r=n.getActiveAttrib(t,s);if(!r)throw new Error("activeInfo");const{name:l,type:c}=r,f=n.getAttribLocation(t,l);if(f>=0){const d=l_(c),p=/instance/i.test(l)?"instance":"vertex";e.push({name:l,location:f,stepMode:p,type:d})}}return e.sort((s,r)=>s.location-r.location),e}function pN(n,t){const e=[],i=n.getProgramParameter(t,35971);for(let s=0;s<i;s++){const r=n.getTransformFeedbackVarying(t,s);if(!r)throw new Error("activeInfo");const{name:l,type:c,size:f}=r,d=l_(c),{type:p,components:_}=W1(d);e.push({location:s,name:l,type:p,size:f*_})}return e.sort((s,r)=>s.location-r.location),e}function gN(n,t){const e=[],i=n.getProgramParameter(t,35718);for(let s=0;s<i;s++){const r=n.getActiveUniform(t,s);if(!r)throw new Error("activeInfo");const{name:l,size:c,type:f}=r,{name:d,isArray:p}=mN(l);let _=n.getUniformLocation(t,d);const y={location:_,name:d,size:c,type:f,isArray:p};if(e.push(y),y.size>1)for(let b=0;b<y.size;b++){const x=`${d}[${b}]`;_=n.getUniformLocation(t,x);const T={...y,name:x,location:_};e.push(T)}}return e}function _N(n,t){const e=(r,l)=>n.getActiveUniformBlockParameter(t,r,l),i=[],s=n.getProgramParameter(t,35382);for(let r=0;r<s;r++){const l={name:n.getActiveUniformBlockName(t,r)||"",location:e(r,35391),byteLength:e(r,35392),vertex:e(r,35396),fragment:e(r,35398),uniformCount:e(r,35394),uniforms:[]},c=e(r,35395)||[],f=n.getActiveUniforms(t,c,35383),d=n.getActiveUniforms(t,c,35384),p=n.getActiveUniforms(t,c,35387),_=n.getActiveUniforms(t,c,35388);for(let y=0;y<l.uniformCount;++y){const b=n.getActiveUniform(t,c[y]);if(!b)throw new Error("activeInfo");const x=l_(f[y]);l.uniforms.push({name:b.name,format:x,type:f[y],arrayLength:d[y],byteOffset:p[y],byteStride:_[y]})}i.push(l)}return i.sort((r,l)=>r.location-l.location),i}function mN(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!e||e.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:e[1],length:e[2]?1:0,isArray:!!e[2]}}function yN(n,t,e,i){const s=n;let r=i;r===!0&&(r=1),r===!1&&(r=0);const l=typeof r=="number"?[r]:r;switch(e){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return n.uniform1i(t,i);case 5126:return n.uniform1fv(t,l);case 35664:return n.uniform2fv(t,l);case 35665:return n.uniform3fv(t,l);case 35666:return n.uniform4fv(t,l);case 5124:return n.uniform1iv(t,l);case 35667:return n.uniform2iv(t,l);case 35668:return n.uniform3iv(t,l);case 35669:return n.uniform4iv(t,l);case 35670:return n.uniform1iv(t,l);case 35671:return n.uniform2iv(t,l);case 35672:return n.uniform3iv(t,l);case 35673:return n.uniform4iv(t,l);case 5125:return s.uniform1uiv(t,l,1);case 36294:return s.uniform2uiv(t,l,2);case 36295:return s.uniform3uiv(t,l,3);case 36296:return s.uniform4uiv(t,l,4);case 35674:return n.uniformMatrix2fv(t,!1,l);case 35675:return n.uniformMatrix3fv(t,!1,l);case 35676:return n.uniformMatrix4fv(t,!1,l);case 35685:return s.uniformMatrix2x3fv(t,!1,l);case 35686:return s.uniformMatrix2x4fv(t,!1,l);case 35687:return s.uniformMatrix3x2fv(t,!1,l);case 35688:return s.uniformMatrix3x4fv(t,!1,l);case 35689:return s.uniformMatrix4x2fv(t,!1,l);case 35690:return s.uniformMatrix4x3fv(t,!1,l)}throw new Error("Illegal uniform")}function bN(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function vN(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const Ox=4;class xN extends Gs{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}constructor(t,e){super(t,e),this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=e.vs,this.fs=e.fs;const{varyings:i,bufferMode:s=35981}=e;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),et.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=hN(this.device.gl,this.handle),et.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=e.shaderLayout?TN(this.introspectedLayout,e.shaderLayout):this.introspectedLayout}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(t,e){for(const[i,s]of Object.entries(t)){const r=this.shaderLayout.bindings.find(l=>l.name===i)||this.shaderLayout.bindings.find(l=>l.name===`${i}Uniforms`);if(!r){const l=this.shaderLayout.bindings.map(c=>`"${c.name}"`).join(", ");e?.disableWarnings||et.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${l}`,s)();continue}switch(s||et.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),r.type){case"uniform":if(!(s instanceof Jo)&&!(s.buffer instanceof Jo))throw new Error("buffer value");break;case"texture":if(!(s instanceof ha||s instanceof tl||s instanceof Go))throw new Error(`${this} Bad texture binding for ${i}`);break;case"sampler":et.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(r.type)}this.bindings[i]=s}}draw(t){const{renderPass:e,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:r,vertexCount:l,instanceCount:c,isInstanced:f=!1,firstVertex:d=0,transformFeedback:p}=t,_=bN(s),y=!!r.indexBuffer,b=r.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return et.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return et.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),r.bindBeforeRender(e),p&&p.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const x=e;return Gk(this.device,i,x.glParameters,()=>{y&&f?this.device.gl.drawElementsInstanced(_,l||0,b,d,c||0):y?this.device.gl.drawElements(_,l||0,b,d):f?this.device.gl.drawArraysInstanced(_,d,l||0,c||0):this.device.gl.drawArrays(_,d,l||0),p&&p.end()}),r.unbindAfterRender(e),!0}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),et.time(Ox,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),et.timeEnd(Ox,`linkProgram for ${this.id}`)(),et.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}et.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),et.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const e=this._getLinkStatus();this._reportLinkStatus(e)}async _reportLinkStatus(t){switch(t){case"success":return;default:const e=t==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${e} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${e} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break}const i=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${e} during ${t}: ${i}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const t=async s=>await new Promise(r=>setTimeout(r,s));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const e of this.shaderLayout.bindings)!this.bindings[e.name]&&!this.bindings[e.name.replace(/Uniforms$/,"")]&&(et.warn(`Binding ${e.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let e=0,i=0;for(const s of this.shaderLayout.bindings){const r=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!r)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:l}=s,c=t.getUniformBlockIndex(this.handle,l);if(c===4294967295)throw new Error(`Invalid uniform block name ${l}`);t.uniformBlockBinding(this.handle,i,c),r instanceof Jo?t.bindBufferBase(35345,i,r.handle):t.bindBufferRange(35345,i,r.buffer.handle,r.offset||0,r.size||r.buffer.byteLength-r.offset),i+=1;break;case"texture":if(!(r instanceof ha||r instanceof tl||r instanceof Go))throw new Error("texture");let f;if(r instanceof ha)f=r.texture;else if(r instanceof tl)f=r;else if(r instanceof Go&&r.colorAttachments[0]instanceof ha)et.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),f=r.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+e),t.bindTexture(f.glTarget,f.handle),e+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:e,location:i,type:s,textureUnit:r}=t,l=this.uniforms[e]??r;l!==void 0&&yN(this.device.gl,i,s,l)}}}function TN(n,t){const e={...n,attributes:n.attributes.map(i=>({...i}))};for(const i of t?.attributes||[]){const s=e.attributes.find(r=>r.name===i.name);s?(s.type=i.type||s.type,s.stepMode=i.stepMode||s.stepMode):et.warn(`shader layout attribute ${i.name} not present in shader`)}return e}class SN extends Bg{device;handle=null;commands=[];constructor(t){super(t,{}),this.device=t}_executeCommands(t=this.commands){for(const e of t)switch(e.name){case"copy-buffer-to-buffer":AN(this.device,e.options);break;case"copy-buffer-to-texture":wN(this.device,e.options);break;case"copy-texture-to-buffer":EN(this.device,e.options);break;case"copy-texture-to-texture":RN(this.device,e.options);break;default:throw new Error(e.name)}}}function AN(n,t){const e=t.sourceBuffer,i=t.destinationBuffer;n.gl.bindBuffer(36662,e.handle),n.gl.bindBuffer(36663,i.handle),n.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function wN(n,t){throw new Error("Not implemented")}function EN(n,t){const{sourceTexture:e,mipLevel:i=0,aspect:s="all",width:r=t.sourceTexture.width,height:l=t.sourceTexture.height,depthOrArrayLayers:c=0,origin:f=[0,0],destinationBuffer:d,byteOffset:p=0,bytesPerRow:_,rowsPerImage:y}=t;if(s!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||c!==0||_||y)throw new Error("not implemented");const{framebuffer:b,destroyFramebuffer:x}=r3(e);let T;try{const A=d,E=r||b.width,D=l||b.height,C=n3(b.colorAttachments[0].texture.props.format),O=C.format,k=C.type;n.gl.bindBuffer(35051,A.handle),T=n.gl.bindFramebuffer(36160,b.handle),n.gl.readPixels(f[0],f[1],E,D,O,k,p)}finally{n.gl.bindBuffer(35051,null),T!==void 0&&n.gl.bindFramebuffer(36160,T),x&&b.destroy()}}function RN(n,t){const{sourceTexture:e,destinationMipLevel:i=0,origin:s=[0,0],destinationOrigin:r=[0,0],destinationTexture:l}=t;let{width:c=t.destinationTexture.width,height:f=t.destinationTexture.height}=t;const{framebuffer:d,destroyFramebuffer:p}=r3(e),[_,y]=s,[b,x,T]=r,A=n.gl.bindFramebuffer(36160,d.handle);let E,D;if(l instanceof tl)E=l,c=Number.isFinite(c)?c:E.width,f=Number.isFinite(f)?f:E.height,E._bind(0),D=E.glTarget;else throw new Error("invalid destination");switch(D){case 3553:case 34067:n.gl.copyTexSubImage2D(D,i,b,x,_,y,c,f);break;case 35866:case 32879:n.gl.copyTexSubImage3D(D,i,b,x,T,_,y,c,f);break}E&&E._unbind(),n.gl.bindFramebuffer(36160,A),p&&d.destroy()}function r3(n){if(n instanceof Se){const{width:t,height:e,id:i}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${i}`,width:t,height:e,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}const CN=[1,2,4,8];class MN extends $s{device;handle=null;glParameters={};constructor(t,e){super(t,e),this.device=t;let i;if(!e?.parameters?.viewport)if(e?.framebuffer){const{width:r,height:l}=e.framebuffer;i=[0,0,r,l]}else{const[r,l]=t.getDefaultCanvasContext().getDrawingBufferSize();i=[0,0,r,l]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const s=this.props.framebuffer;if(this.props.framebuffer&&s?.handle){const r=this.props.framebuffer.colorAttachments.map((l,c)=>36064+c);this.device.gl.drawBuffers(r)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const e={...this.glParameters};e.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(e.depthMask=!this.props.depthReadOnly),e.stencilMask=this.props.stencilReadOnly?0:1,e[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(e.viewport=t.viewport.slice(0,4),e.depthRange=[t.viewport[4],t.viewport[5]]):e.viewport=t.viewport),t.scissorRect&&(e.scissorTest=!0,e.scissor=t.scissorRect),t.blendConstant&&(e.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=t.stencilReference),"colorMask"in t&&(e.colorMask=CN.map(i=>!!(i&t.colorMask))),this.glParameters=e,Ia(this.device.gl,e)}beginOcclusionQuery(t){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const t={...this.glParameters};let e=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(e|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(e|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(e|=1024,t.clearStencil=this.props.clearStencil),e!==0&&ll(this.device.gl,t,()=>{this.device.gl.clear(e)})}clearColorBuffer(t=0,e=[0,0,0,0]){ll(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(e.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,e);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,e);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,e);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class Ix extends Ng{device;handle=null;commandBuffer;constructor(t,e){super(t,e),this.device=t,this.commandBuffer=new SN(t)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(t){return new MN(this.device,t)}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,e,i){}}function ON(n){const{target:t,source:e,start:i=0,count:s=1}=n,r=e.length,l=s*r;let c=0;for(let f=i;c<r;c++)t[f++]=e[c];for(;c<l;)c<l-c?(t.copyWithin(i+c,i,i+c),c*=2):(t.copyWithin(i+c,i,i+l-c),c=l);return n.target}class c_ extends Ug{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(t){return qw()==="Chrome"}constructor(t,e){super(t,e),this.device=t,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const e=t;if(e&&e.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,e?e.handle:null),this.indexBuffer=e,this.device.gl.bindVertexArray(null)}setBuffer(t,e){const i=e;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:r,stride:l,offset:c,normalized:f,integer:d,divisor:p}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),d?this.device.gl.vertexAttribIPointer(t,s,r,l,c):this.device.gl.vertexAttribPointer(t,s,r,f,l,c),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,p||0),this.attributes[t]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,e){this._enable(t,!1),this.attributes[t]=e}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const e=this.attributes[t];ArrayBuffer.isView(e)&&this.device.setConstantAttributeWebGL(t,e)}}_getAccessor(t){const e=this.attributeInfos[t];if(!e)throw new Error(`Unknown attribute location ${t}`);const i=e3(e.bufferDataType);return{size:e.bufferComponents,type:i,stride:e.byteStride,offset:e.byteOffset,normalized:e.normalized,integer:e.integer,divisor:e.stepMode==="instance"?1:0}}_enable(t,e=!0){const s=c_.isConstantAttributeZeroSupported(this.device)||t!==0;(e||s)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),e?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,e){const i=IN(e),s=i.byteLength*t,r=i.length*t;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),l||=!PN(i,this.bufferValue),l){const c=zM(e.constructor,r);ON({target:c,source:i,start:0,count:r}),this.buffer.write(c),this.bufferValue=e}return this.buffer}}function IN(n){return Array.isArray(n)?new Float32Array(n):n}function PN(n,t){if(!n||!t||n.length!==t.length||n.constructor!==t.constructor)return!1;for(let e=0;e<n.length;++e)if(n[e]!==t[e])return!1;return!0}class DN extends Fg{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(t,e){super(t,e),this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,e.buffers&&this.setBuffers(e.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(vN(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])})}setBuffer(t,e){const i=this._getVaryingIndex(t),{buffer:s,byteLength:r,byteOffset:l}=this._getBufferRange(e);if(i<0){this.unusedBuffers[t]=s,et.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[i]={buffer:s,byteLength:r,byteOffset:l},this.bindOnUse||this._bindBuffer(i,s,l,r)}getBuffer(t){if(Px(t))return this.buffers[t]||null;const e=this._getVaryingIndex(t);return e>=0?this.buffers[e]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let e;return this._bound?e=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,e=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),e}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof Jo)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:e,byteOffset:i=0,byteLength:s=t.buffer.byteLength}=t;return{buffer:e,byteOffset:i,byteLength:s}}_getVaryingIndex(t){if(Px(t))return Number(t);for(const e of this.layout.varyings||[])if(t===e.name)return e.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:e,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),e,s,i)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,e,i=0,s){const r=e&&e.handle;!r||s===void 0?this.gl.bindBufferBase(35982,t,r):this.gl.bindBufferRange(35982,t,r,i,s)}}function Px(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class kN extends Lg{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(t,e){if(super(t,e),this.device=t,e.count>1)throw new Error("WebGL QuerySet can only have one value");const i=this.device.gl.createQuery();if(!i)throw new Error("WebGL query not supported");this.handle=i,Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((i,s)=>{const r=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):e++>t?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(r)};requestAnimationFrame(r)}),this._pollingPromise}}function a3(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function NN(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function BN(n){return UN[n]}const UN={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function FN(n,t){const{sourceX:e=0,sourceY:i=0,sourceAttachment:s=0}=t||{};let{target:r=null,sourceWidth:l,sourceHeight:c,sourceDepth:f,sourceFormat:d,sourceType:p}=t||{};const{framebuffer:_,deleteFramebuffer:y}=o3(n),{gl:b,handle:x}=_;l||=_.width,c||=_.height;const T=_.colorAttachments[s]?.texture;if(!T)throw new Error(`Invalid framebuffer attachment ${s}`);f=T?.depth||1,d||=T?.glFormat||6408,p||=T?.glType||5121,r=VN(r,p,d,l,c);const A=Ig(r);p=p||oN(A);const E=b.bindFramebuffer(36160,x);return b.readBuffer(36064+s),b.readPixels(e,i,l,c,d,p,r),b.readBuffer(36064),b.bindFramebuffer(36160,E||null),y&&_.destroy(),r}function LN(n,t){const{target:e,sourceX:i=0,sourceY:s=0,sourceFormat:r=6408,targetByteOffset:l=0}=t||{};let{sourceWidth:c,sourceHeight:f,sourceType:d}=t||{};const{framebuffer:p,deleteFramebuffer:_}=o3(n);c=c||p.width,f=f||p.height;const y=p;d=d||5121;let b=e;if(!b){const T=a3(r),A=NN(d),E=l+c*f*T*A;b=y.device.createBuffer({byteLength:E})}const x=n.device.createCommandEncoder();return x.copyTextureToBuffer({sourceTexture:n,width:c,height:f,origin:[i,s],destinationBuffer:b,byteOffset:l}),x.destroy(),_&&p.destroy(),b}function o3(n){return n instanceof of?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:zN(n),deleteFramebuffer:!0}}function zN(n,t){const{device:e,width:i,height:s,id:r}=n;return e.createFramebuffer({...t,id:`framebuffer-for-${r}`,width:i,height:s,colorAttachments:[n]})}function VN(n,t,e,i,s,r){if(n)return n;t||=5121;const l=BN(t),c=Pg(l),f=a3(e);return new c(i*s*f)}class ag extends sr{type="webgl";handle;features;limits;info;canvasContext;preferredColorFormat="rgba8unorm";preferredDepthFormat="depth24plus";commandEncoder;lost;_resolveContextLost;gl;_constants;_extensions={};_polyfilled=!1;spectorJS;get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(t){switch(t){case"unorm8x4-bgra":return!1;default:return!0}}constructor(t){super({...t,id:t.id||Yk("webgl-device")});const e=sr._getCanvasContextProps(t);if(!e)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=e.canvas?.gl?.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new Xk(this,e),this.lost=new Promise(p=>{this._resolveContextLost=p});const s={...t.webgl};e.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),t.powerPreference!==void 0&&(s.powerPreference=t.powerPreference);const l=this.props._handle||Ek(this.canvasContext.canvas,{onContextLost:p=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:p=>console.log("WebGL context restored")},s);if(!l)throw new Error("WebGL context creation failed");if(i=l.device,i){if(t._reuseDevices)return et.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=l,this.gl=l,this.spectorJS=lk({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=Rk(this.gl,this._extensions),this.limits=new jk(this.gl),this.features=new Hk(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new er(this.gl,{log:(...p)=>et.log(1,...p)()}).trackState(this.gl,{copyState:!1});const f=t.debugWebGL||t.debug,d=t.debugWebGL;f&&(this.gl=fk(this.gl,{debugWebGL:f,traceWebGL:d}),et.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(et.level=Math.max(et.level,1))),this.commandEncoder=new Ix(this,{id:`${this}-command-encoder`})}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const e=this._normalizeBufferProps(t);return new Jo(this,e)}createTexture(t){return new tl(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new sN(this,t)}createShader(t){return new Qk(this,t)}createFramebuffer(t){return new Go(this,t)}createVertexArray(t){return new c_(this,t)}createTransformFeedback(t){return new DN(this,t)}createQuerySet(t){return new kN(this,t)}createRenderPipeline(t){return new xN(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(t={}){return new Ix(this,t)}submit(t){t||(t=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),t._executeCommands()}readPixelsToArrayWebGL(t,e){return FN(t,e)}readPixelsToBufferWebGL(t,e){return LN(t,e)}setParametersWebGL(t){Ia(this.gl,t)}getParametersWebGL(t){return J2(this.gl,t)}withParametersWebGL(t,e){return ll(this.gl,t,e)}resetWebGL(){et.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),xk(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return Fk(this.gl,t,this._extensions)}loseDevice(){let t=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(t=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){er.get(this.gl).push()}popState(){er.get(this.gl).pop()}getGLKey(t,e){const i=Number(t);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return e?.emptyIfUnknown?"":String(t)}getGLKeys(t){const e={emptyIfUnknown:!0};return Object.entries(t).reduce((i,[s,r])=>(i[`${s}:${this.getGLKey(s,e)}`]=`${r}:${this.getGLKey(r,e)}`,i),{})}setConstantAttributeWebGL(t,e){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[t];switch(s&&$N(s,e)&&et.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=e,e.constructor){case Float32Array:HN(this,t,e);break;case Int32Array:jN(this,t,e);break;case Uint32Array:WN(this,t,e);break;default:throw new Error("constant")}}getExtension(t){return Ra(this.gl,t,this._extensions),this._extensions}_setWebGLDebugMetadata(t,e,i){t.luma=e;const s={props:i.spector,id:i.spector.id};t.__SPECTOR_Metadata=s}}function HN(n,t,e){switch(e.length){case 1:n.gl.vertexAttrib1fv(t,e);break;case 2:n.gl.vertexAttrib2fv(t,e);break;case 3:n.gl.vertexAttrib3fv(t,e);break;case 4:n.gl.vertexAttrib4fv(t,e);break}}function jN(n,t,e){n.gl.vertexAttribI4iv(t,e)}function WN(n,t,e){n.gl.vertexAttribI4uiv(t,e)}function $N(n,t){if(!n||!t||n.length!==t.length||n.constructor!==t.constructor)return!1;for(let e=0;e<n.length;++e)if(n[e]!==t[e])return!1;return!0}const Dx=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:ag},Symbol.toStringTag,{value:"Module"}));function as(){}const XN=({isDragging:n})=>n?"grabbing":"grab",l3={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:as,onWebGLInitialized:as,onResize:as,onViewStateChange:as,onInteractionStateChange:as,onBeforeRender:as,onAfterRender:as,onLoad:as,onError:n=>Qt.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:XN,getTooltip:null,debug:!1,drawPickingColors:!1};class u_{constructor(t){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new ef({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:s}=this;if(i.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(i.leftButton||i.rightButton)return;{const r=i.offsetCenter;if(!r)return;s.x=r.x,s.y=r.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=i},this._onEvent=i=>{const s=Zp[i.type],r=i.offsetCenter;if(!s||!r||!this.layerManager)return;const l=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:l,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:f}=c,d=f&&(f[s]||f.props[s]),p=this.props[s];let _=!1;d&&(_=d.call(f,c,i)),_||(p?.(c,i),this.widgetManager.onEvent(c,i))},this._onPointerDown=i=>{if(this.device?.type==="webgpu")return;const s=i.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo},this.props={...l3,...t},t=this.props,t.viewState&&t.initialViewState&&Qt.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,t.device&&(this.device=t.device);let e=this.device;!e&&t.gl&&(t.gl instanceof WebGLRenderingContext&&Qt.error("WebGL1 context not supported.")(),e=pp.attach(t.gl,this.props.deviceProps)),e||(e=this._createDevice(t)),this.animationLoop=this._createAnimationLoop(e,t),this.setProps(t),t._typedArrayManagerProps&&Ta.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&Qt.removed("onLayerHover","onHover")(),"onLayerClick"in t&&Qt.removed("onLayerClick","onClick")(),t.initialViewState&&!Rn(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);if(Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),t.device&&t.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==t.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),Qt.log(`recreating animation loop for new device! id=${t.device.id}`)(),this.animationLoop=this._createAnimationLoop(t.device,t),this.animationLoop.start()),this.animationLoop?.setProps(e),t.useDevicePixels!==void 0&&this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){this.device.canvasContext.props.useDevicePixels=t.useDevicePixels;const i=this.device.canvasContext.canvas,s={target:i,contentBoxSize:[{inlineSize:i.clientWidth,blockSize:i.clientHeight}],devicePixelContentBoxSize:[{inlineSize:i.clientWidth,blockSize:i.clientHeight}],borderBoxSize:[{inlineSize:i.clientWidth,blockSize:i.clientHeight}]};this.device.canvasContext._handleResize([s])}this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e),this.widgetManager.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(t),s=this.layerManager.needsRedraw(t),r=this.effectManager.needsRedraw(t),l=this.deckRenderer.needsRedraw(t);return e=e||i||s||r||l,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return this.viewManager!==null}getViews(){return ke(this.viewManager),this.viewManager.views}getViewports(t){return ke(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,e=!1){for(const i in t)this.layerManager.resourceManager.add({resourceId:i,data:t[i],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_addDefaultShaderModule(t){this.layerManager.addDefaultShaderModule(t)}_removeDefaultShaderModule(t){this.layerManager?.removeDefaultShaderModule(t)}_pick(t,e,i){ke(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(e).timeStart();const r=this.deckPicker[t]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(e).timeEnd(),r}_createCanvas(t){let e=t.canvas;return typeof e=="string"&&(e=document.getElementById(e),ke(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",t.width&&typeof t.width=="number"&&(e.width=t.width),t.height&&typeof t.height=="number"&&(e.height=t.height),(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:i}=t;if(e||e===0){const s=Number.isFinite(e)?`${e}px`:e;this.canvas.style.width=s}if(i||i===0){const s=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=t.style?.position||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:t}=this;if(!t)return;const e=t.clientWidth??t.width,i=t.clientHeight??t.height;(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,this.viewManager?.setProps({width:e,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:e,height:i}))}_createAnimationLoop(t,e){const{gl:i,onError:s}=e;return new t_({device:t,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:r=>this._setDevice(r.device),onRender:this._onRenderFrame.bind(this),onError:s})}_createDevice(t){const e=this.props.deviceProps?.createCanvasContext,i=typeof e=="object"?e:void 0,s={adapters:[],...t.deviceProps};s.adapters.includes(pp)||s.adapters.push(pp);const r={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0};return zp.createDevice({_reuseDevices:!0,type:"webgl",...s,createCanvasContext:{...r,...i,canvas:this._createCanvas(t),useDevicePixels:this.props.useDevicePixels,autoResize:!0}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:t}=this.props,e=Array.isArray(t)?t:t?[t]:[new K2({id:"default-view"})];return e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:t}=this;if(t.event){const{result:e,emptyInfo:i}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=e.length>0;let s=i,r=!1;for(const l of e)s=l,r=l.layer?.onHover(l,t.event)||r;r||(this.props.onHover?.(s,t.event),this.widgetManager.onHover(s,t.event)),t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(t){if(this.device=t,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const e=new H2;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new E4(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Yv).map(s=>{const[r,l,c,f]=Yv[s],d=this.props.eventRecognizerOptions?.[s],p={...l,...d,event:s};return{recognizer:new r(p),recognizeWith:c,requestFailure:f}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in Zp)this.eventManager.on(s,this._onEvent);this.viewManager=new AD({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new SD(this.device,{deck:this,stats:this.stats,viewport:i,timeline:e}),this.effectManager=new zD({deck:this,device:this.device}),this.deckRenderer=new jD(this.device),this.deckPicker=new XD(this.device),this.widgetManager=new KD({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new Z2),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{device:i,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:s});const r={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e};this.deckRenderer?.renderLayers(r),r.pass==="screen"&&this.widgetManager.onRedraw({viewports:r.viewports,layers:r.layers}),this.props.onAfterRender({device:i,gl:s})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Qt.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const i=zp.stats.get("Memory Usage");t.bufferMemory=i.get("Buffer Memory").count,t.textureMemory=i.get("Texture Memory").count,t.renderbufferMemory=i.get("Renderbuffer Memory").count,t.gpuMemory=i.get("GPU Memory").count}}u_.defaultProps=l3;u_.VERSION=gC;function YN(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Pg(n)}}const qN=Ig;function nu(n,t,e){const i=e==="webgpu"&&t.type==="uint8"?"unorm8":t.type;return{attribute:n,format:t.size>1?`${i}x${t.size}`:t.type,byteOffset:t.offset||0}}function qs(n){return n.stride||n.size*n.bytesPerElement}function KN(n,t){return n.type===t.type&&n.size===t.size&&qs(n)===qs(t)&&(n.offset||0)===(t.offset||0)}function og(n,t){t.offset&&Qt.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const e=qs(n),i=t.vertexOffset!==void 0?t.vertexOffset:n.vertexOffset||0,s=t.elementOffset||0,r=i*e+s*n.bytesPerElement+(n.offset||0);return{...t,offset:r,stride:e}}function ZN(n,t){const e=og(n,t);return{high:e,low:{...e,offset:e.offset+n.size*4}}}class QN{constructor(t,e,i){this._buffer=null,this.device=t,this.id=e.id||"",this.size=e.size||1;const s=e.logicalType||e.type,r=s==="float64";let{defaultValue:l}=e;l=Number.isFinite(l)?[l]:l||new Array(this.size).fill(0);let c;r?c="float32":!s&&e.isIndexed?c="uint32":c=s||"float32";let f=YN(s||c);this.doublePrecision=r,r&&e.fp64===!1&&(f=Float32Array),this.value=null,this.settings={...e,defaultType:f,defaultValue:l,logicalType:s,type:c,normalized:c.includes("norm"),size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*qs(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ta.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,e=null){const i={};if(this.state.constant){const s=this.value;if(e){const r=og(this.getAccessor(),e),l=r.offset/s.BYTES_PER_ELEMENT,c=r.size||this.size;i[t]=s.subarray(l,l+c)}else i[t]=s}else i[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${t}64Low`]=i[t]:i[`${t}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(t=this.id,e=null){const i=this.getAccessor(),s=[],r={name:this.id,byteStride:qs(i),attributes:s};if(this.doublePrecision){const l=ZN(i,e||{});s.push(nu(t,{...i,...l.high},this.device.type),nu(`${t}64Low`,{...i,...l.low},this.device.type))}else if(e){const l=og(i,e);s.push(nu(t,{...i,...l},this.device.type))}else s.push(nu(t,i,this.device.type));return r}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:i,size:s}=this,r=i*s;if(e&&r&&e.length>=r){const l=new Array(s).fill(1/0),c=new Array(s).fill(-1/0);for(let f=0;f<r;)for(let d=0;d<s;d++){const p=e[f++];p<l[d]&&(l[d]=p),p>c[d]&&(c[d]=p)}t=[l,c]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let i;ArrayBuffer.isView(t)?i={value:t}:t instanceof Gt?i={buffer:t}:i=t;const s={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)s.type="float32";else{const l=qN(i.value);s.type=s.normalized?l.replace("int","norm"):l}s.bytesPerElement=i.value.BYTES_PER_ELEMENT,s.stride=qs(s)}if(e.bounds=null,i.constant){let r=i.value;if(r=this._normalizeValue(r,[],0),this.settings.normalized&&(r=this.normalizeConstant(r)),!(!e.constant||!this._areValuesEqual(r,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=ArrayBuffer.isView(r)?r:new Float32Array(r)}else if(i.buffer){const r=i.buffer;e.externalBuffer=r,e.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let r=i.value;e.externalBuffer=null,e.constant=!1,this.value=r;let{buffer:l}=this;const c=qs(s),f=(s.vertexOffset||0)*c;if(this.doublePrecision&&r instanceof Float64Array&&(r=lp(r,s)),this.settings.isIndexed){const p=this.settings.defaultType;r.constructor!==p&&(r=new p(r))}const d=r.byteLength+f+c*2;(!l||l.byteLength<d)&&(l=this._createBuffer(d)),l.write(r,f)}return this.setAccessor(s),!0}updateSubBuffer(t={}){this.state.bounds=null;const e=this.value,{startOffset:i=0,endOffset:s}=t;this.buffer.write(this.doublePrecision&&e instanceof Float64Array?lp(e,{size:this.size,startIndex:i,endIndex:s}):e.subarray(i,s),i*e.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,e=!1){const{state:i}=this,s=i.allocatedValue,r=Ta.allocate(s,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=r;const{byteOffset:l}=this;let{buffer:c}=this;return(!c||c.byteLength<r.byteLength+l)&&(c=this._createBuffer(r.byteLength+l),e&&s&&c.write(s instanceof Float64Array?lp(s,this):s,l)),i.allocatedValue=r,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=e.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${e.constructor.name}`);!(e instanceof i)&&this.settings.normalized&&!("normalized"in t)&&Qt.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(t).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(e=>e/255);case"unorm16":return new Float32Array(t).map(e=>e/65535);default:return t}}_normalizeValue(t,e,i){const{defaultValue:s,size:r}=this.settings;if(Number.isFinite(t))return e[i]=t,e;if(!t){let l=r;for(;--l>=0;)e[i+l]=s[l];return e}switch(r){case 4:e[i+3]=Number.isFinite(t[3])?t[3]:s[3];case 3:e[i+2]=Number.isFinite(t[2])?t[2]:s[2];case 2:e[i+1]=Number.isFinite(t[1])?t[1]:s[1];case 1:e[i+0]=Number.isFinite(t[0])?t[0]:s[0];break;default:let l=r;for(;--l>=0;)e[i+l]=Number.isFinite(t[l])?t[l]:s[l]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:i}=this;for(let s=0;s<i;s++)if(t[s]!==e[s])return!1;return!0}_createBuffer(t){this._buffer&&this._buffer.destroy();const{isIndexed:e,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(e?Gt.INDEX:Gt.VERTEX)|Gt.COPY_DST,indexType:e?i:void 0,byteLength:t}),this._buffer}}const kx=[],Nx=[];function c3(n,t=0,e=1/0){let i=kx;const s={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?i=n:n.length>0&&(Nx.length=n.length,i=Nx):i=kx,(t>0||Number.isFinite(e))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,e),s.index=t-1),{iterable:i,objectInfo:s}}function u3(n){return n&&n[Symbol.asyncIterator]}function f3(n,t){const{size:e,stride:i,offset:s,startIndices:r,nested:l}=t,c=n.BYTES_PER_ELEMENT,f=i?i/c:e,d=s?s/c:0,p=Math.floor((n.length-d)/f);return(_,{index:y,target:b})=>{if(!r){const E=y*f+d;for(let D=0;D<e;D++)b[D]=n[E+D];return b}const x=r[y],T=r[y+1]||p;let A;if(l){A=new Array(T-x);for(let E=x;E<T;E++){const D=E*f+d;b=new Array(e);for(let C=0;C<e;C++)b[C]=n[D+C];A[E-x]=b}}else if(f===e)A=n.subarray(x*e+d,T*e+d);else{A=new n.constructor((T-x)*e);let E=0;for(let D=x;D<T;D++){const C=D*f+d;for(let O=0;O<e;O++)A[E++]=n[C+O]}}return A}}const GN=[],Su=[[0,1/0]];function JN(n,t){if(n===Su||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return n;const e=[],i=n.length;let s=0;for(let r=0;r<i;r++){const l=n[r];l[1]<t[0]?(e.push(l),s=r+1):l[0]>t[1]?e.push(l):t=[Math.min(l[0],t[0]),Math.max(l[1],t[1])]}return e.splice(s,0,t),e}const t6={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function h3(n,t){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const e=n.type||"interpolation";return{...t6[e],...t,...n,type:e}}class d3 extends QN{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Su}),this.constant=!1,this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}layoutChanged(){return this.state.layoutChanged}setAccessor(t){var e;(e=this.state).layoutChanged||(e.layoutChanged=!KN(t,this.getAccessor())),super.setAccessor(t)}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,i=this.settings.transition,s=Array.isArray(e)?t[e.find(r=>t[r])]:t[e];return h3(s,i)}setNeedsUpdate(t=this.id,e){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:i=0,endRow:s=1/0}=e;this.state.updateRanges=JN(this.state.updateRanges,[i,s])}else this.state.updateRanges=Su}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=GN}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(t,e.updateRanges!==Su),!0):!1}updateBuffer({numInstances:t,data:e,props:i,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:l,noAlloc:c}}=this;let f=!0;if(l){for(const[d,p]of r)l.call(s,this,{data:e,startRow:d,endRow:p,props:i,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,p]of r){const _=Number.isFinite(d)?this.getVertexOffset(d):0,y=Number.isFinite(p)?this.getVertexOffset(p):c||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:_,endOffset:y})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(t,e){const i=this.device.type==="webgpu";if(i||e===void 0||typeof e=="function"){if(i&&typeof e!="function"){const l=this._normalizeValue(e,[],0);this._areValuesEqual(l,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const s=this.settings.transform&&t?this.settings.transform.call(t,e):e;return this.setData({constant:!0,value:s})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t,e=null){const{state:i,settings:s}=this;if(!t)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===t)return this.clearNeedsUpdate(),!0;if(i.binaryValue=t,this.setNeedsRedraw(),s.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const l=t;ke(ArrayBuffer.isView(l.value),`invalid ${s.accessor}`);const c=!!l.size&&l.size!==this.size;return i.binaryAccessor=f3(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:e,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getValue(){const t=this.settings.shaderAttributes,e=super.getValue();if(!t)return e;for(const i in t)Object.assign(e,super.getValue(i,t[i]));return e}getBufferLayout(t){this.state.layoutChanged=!1;const e=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?i.stepMode=t?t.isInstanced?"instance":"vertex":"instance":i.stepMode=s??"vertex",!e)return i;for(const r in e){const l=super._getBufferLayout(r,e[r]);i.attributes.push(...l.attributes)}return i}_autoUpdater(t,{data:e,startRow:i,endRow:s,props:r,numInstances:l}){if(t.constant&&this.context.device.type!=="webgpu")return;const{settings:c,state:f,value:d,size:p,startIndices:_}=t,{accessor:y,transform:b}=c;let x=f.binaryAccessor||(typeof y=="function"?y:r[y]);typeof x!="function"&&typeof y=="string"&&(x=()=>r[y]),ke(typeof x=="function",`accessor "${y}" is not a function`);let T=t.getVertexOffset(i);const{iterable:A,objectInfo:E}=c3(e,i,s);for(const D of A){E.index++;let C=x(D,E);if(b&&(C=b.call(this,C)),_){const O=(E.index<_.length-1?_[E.index+1]:l)-_[E.index];if(C&&Array.isArray(C[0])){let k=T;for(const z of C)t._normalizeValue(z,d,k),k+=p}else C&&C.length>p?d.set(C,T):(t._normalizeValue(C,E.target,0),yD({target:d,source:E.target,start:T,count:O}));T+=O*p}else t._normalizeValue(C,d,T),T+=p}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let i=!0;switch(e){case 4:i=i&&Number.isFinite(t[3]);case 3:i=i&&Number.isFinite(t[2]);case 2:i=i&&Number.isFinite(t[1]);case 1:i=i&&Number.isFinite(t[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function bp(n){const{source:t,target:e,start:i=0,size:s,getData:r}=n,l=n.end||e.length,c=t.length,f=l-i;if(c>f){e.set(t.subarray(0,f),i);return}if(e.set(t,i),!r)return;let d=c;for(;d<f;){const p=r(d,t);for(let _=0;_<s;_++)e[i+d]=p[_]||0,d++}}function e6({source:n,target:t,size:e,getData:i,sourceStartIndices:s,targetStartIndices:r}){if(!s||!r)return bp({source:n,target:t,size:e,getData:i}),t;let l=0,c=0;const f=i&&((p,_)=>i(p+c,_)),d=Math.min(s.length,r.length);for(let p=1;p<d;p++){const _=s[p]*e,y=r[p]*e;bp({source:n.subarray(l,_),target:t,start:c,end:y,size:e,getData:f}),l=_,c=y}return c<t.length&&bp({source:[],target:t,start:c,size:e,getData:f}),t}function n6(n){const{device:t,settings:e,value:i}=n,s=new d3(t,e);return s.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:e.normalized}),s}function p3(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function g3(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function _3(n){n.push(n.shift())}function i6(n,t){const{doublePrecision:e,settings:i,value:s,size:r}=n,l=e&&s instanceof Float64Array?2:1;let c=0;const{shaderAttributes:f}=n.settings;if(f)for(const d of Object.values(f))c=Math.max(c,d.vertexOffset??0);return(i.noAlloc?s.length:(t+c)*r)*l}function m3({device:n,source:t,target:e}){return(!e||e.byteLength<t.byteLength)&&(e?.destroy(),e=n.createBuffer({byteLength:t.byteLength,usage:t.usage})),e}function y3({device:n,buffer:t,attribute:e,fromLength:i,toLength:s,fromStartIndices:r,getData:l=c=>c}){const c=e.doublePrecision&&e.value instanceof Float64Array?2:1,f=e.size*c,d=e.byteOffset,p=e.settings.bytesPerElement<4?d/e.settings.bytesPerElement*4:d,_=e.startIndices,y=r&&_,b=e.isConstant;if(!y&&t&&i>=s)return t;const x=e.value instanceof Float64Array?Float32Array:e.value.constructor,T=b?e.value:new x(e.getBuffer().readSyncWebGL(d,s*x.BYTES_PER_ELEMENT).buffer);if(e.settings.normalized&&!b){const C=l;l=(O,k)=>e.normalizeConstant(C(O,k))}const A=b?(C,O)=>l(T,O):(C,O)=>l(T.subarray(C+d,C+d+f),O),E=t?new Float32Array(t.readSyncWebGL(p,i*4).buffer):new Float32Array(0),D=new Float32Array(s);return e6({source:E,target:D,sourceStartIndices:r,targetStartIndices:_,size:f,getData:A}),(!t||t.byteLength<D.byteLength+p)&&(t?.destroy(),t=n.createBuffer({byteLength:D.byteLength+p,usage:35050})),t.write(D,p),t}class b3{constructor({device:t,attribute:e,timeline:i}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new cf(i),this.attribute=e,this.attributeInTransition=n6(e),this.currentStartIndices=e.startIndices}get inProgress(){return this.transition.inProgress}start(t,e,i=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=i6(this.attribute,e),this.transition.start({...t,duration:i})}update(){const t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const t of this.buffers)t.destroy();this.buffers.length=0}}class s6 extends b3{constructor({device:t,attribute:e,timeline:i}){super({device:t,attribute:e,timeline:i}),this.type="interpolation",this.transform=l6(t,e)}start(t,e){const i=this.currentLength,s=this.currentStartIndices;if(super.start(t,e,t.duration),t.duration<=0){this.transition.cancel();return}const{buffers:r,attribute:l}=this;_3(r),r[0]=y3({device:this.device,buffer:r[0],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:t.enter}),r[1]=m3({device:this.device,source:r[0],target:r[1]}),this.setBuffer(r[1]);const{transform:c}=this,f=c.model;let d=Math.floor(this.currentLength/l.size);v3(l)&&(d/=2),f.setVertexCount(d),l.isConstant?(f.setAttributes({aFrom:r[0]}),f.setConstantAttributes({aTo:l.value})):f.setAttributes({aFrom:r[0],aTo:l.getBuffer()}),c.transformFeedback.setBuffers({vCurrent:r[1]})}onUpdate(){const{duration:t,easing:e}=this.settings,{time:i}=this.transition;let s=i/t;e&&(s=e(s));const{model:r}=this.transform,l={time:s};r.shaderInputs.setProps({interpolation:l}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const r6=`uniform interpolationUniforms {
  float time;
} interpolation;
`,Bx={name:"interpolation",vs:r6,uniformTypes:{time:"f32"}},a6=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,o6=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function v3(n){return n.doublePrecision&&n.value instanceof Float64Array}function l6(n,t){const e=t.size,i=p3(e),s=g3(e),r=t.getBufferLayout();return v3(t)?new wa(n,{vs:o6,bufferLayout:[{name:"aFrom",byteStride:8*e,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*e}]},{name:"aTo",byteStride:8*e,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*e}]}],modules:[TI,Bx],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:e},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new wa(n,{vs:a6,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:r.attributes[0].format}],modules:[Bx],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class c6 extends b3{constructor({device:t,attribute:e,timeline:i}){super({device:t,attribute:e,timeline:i}),this.type="spring",this.texture=g6(t),this.framebuffer=_6(t,this.texture),this.transform=p6(t,e)}start(t,e){const i=this.currentLength,s=this.currentStartIndices;super.start(t,e);const{buffers:r,attribute:l}=this;for(let f=0;f<2;f++)r[f]=y3({device:this.device,buffer:r[f],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:t.enter});r[2]=m3({device:this.device,source:r[0],target:r[2]}),this.setBuffer(r[1]);const{model:c}=this.transform;c.setVertexCount(Math.floor(this.currentLength/l.size)),l.isConstant?c.setConstantAttributes({aTo:l.value}):c.setAttributes({aTo:l.getBuffer()})}onUpdate(){const{buffers:t,transform:e,framebuffer:i,transition:s}=this,r=this.settings;e.model.setAttributes({aPrev:t[0],aCur:t[1]}),e.transformFeedback.setBuffers({vNext:t[2]});const l={stiffness:r.stiffness,damping:r.damping};e.model.shaderInputs.setProps({spring:l}),e.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),_3(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const u6=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,f6={name:"spring",vs:u6,uniformTypes:{damping:"f32",stiffness:"f32"}},h6=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,d6=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function p6(n,t){const e=p3(t.size),i=g3(t.size);return new wa(n,{vs:h6,fs:d6,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[f6],defines:{ATTRIBUTE_TYPE:e},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function g6(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function _6(n,t){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}const m6={interpolation:s6,spring:c6};class y6{constructor(t,{id:e,timeline:i}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=e,this.device=t,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:e,numInstances:i}){this.numInstances=i||1;for(const s in t){const r=t[s],l=r.getTransitionSetting(e);l&&this._updateAttribute(s,r,l)}for(const s in this.transitions){const r=t[s];(!r||!r.getTransitionSetting(e))&&this._removeTransition(s)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const i=this.transitions[e];i.inProgress&&(t[e]=i.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,e,i){const s=this.transitions[t];let r=!s||s.type!==i.type;if(r){s&&this._removeTransition(t);const l=m6[i.type];l?this.transitions[t]=new l({attribute:e,timeline:this.timeline,device:this.device}):(Qt.error(`unsupported transition type '${i.type}'`)(),r=!1)}(r||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(i,this.numInstances))}}const Ux="attributeManager.invalidate",b6="attributeManager.updateStart",v6="attributeManager.updateEnd",x6="attribute.updateStart",T6="attribute.allocate",S6="attribute.updateEnd";class A6{constructor(t,{id:e="attribute-manager",stats:i,timeline:s}={}){this.mergeBoundsMemoized=bl(UP),this.id=e,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new y6(t,{id:`${e}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{stepMode:"instance"})}remove(t){for(const e of t)this.attributes[e]!==void 0&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const i=this._invalidateTrigger(t,e);We(Ux,this,t,i)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);We(Ux,this,"all")}update({data:t,numInstances:e,startIndices:i=null,transitions:s,props:r={},buffers:l={},context:c={}}){let f=!1;We(b6,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const p=this.attributes[d],_=p.settings.accessor;p.startIndices=i,p.numInstances=e,r[d]&&Qt.removed(`props.${d}`,`data.attributes.${d}`)(),p.setExternalBuffer(l[d])||p.setBinaryValue(typeof _=="string"?l[_]:void 0,t.startIndices)||typeof _=="string"&&!l[_]&&p.setConstantValue(c,r[_])||p.needsUpdate()&&(f=!0,this._updateAttribute({attribute:p,numInstances:e,data:t,props:r,context:c})),this.needsRedraw=this.needsRedraw||p.needsRedraw()}f&&We(v6,this,e),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:e,transitions:s})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){const e=t.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(e)}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:e,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(const r in e){const l=e[r];l.needsRedraw(t)&&!i.hasAttribute(r)&&(s[r]=l)}return s}getBufferLayouts(t){return Object.values(this.getAttributes()).map(e=>e.getBufferLayout(t))}_add(t,e){for(const i in t){const s=t[i],r={...s,id:i,size:s.isIndexed&&1||s.size||1,...e};this.attributes[i]=new d3(this.device,r)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach(s=>{t[s]||(t[s]=[]),t[s].push(e)});this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:i,updateTriggers:s}=this,r=s[t];return r&&r.forEach(l=>{const c=i[l];c&&c.setNeedsUpdate(c.id,e)}),r}_updateAttribute(t){const{attribute:e,numInstances:i}=t;if(We(x6,e),e.constant){e.setConstantValue(t.context,e.value);return}e.allocate(i)&&We(T6,e,i),e.updateBuffer(t)&&(this.needsRedraw=!0,We(S6,e,i))}}class w6 extends cf{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:i,duration:s,easing:r}}=this,l=r(t/s);this._value=Lu(e,i,l)}}const Fx=1e-5;function Lx(n,t,e,i,s){const r=t-n,c=(e-t)*s,f=-r*i;return c+f+r+t}function E6(n,t,e,i,s){if(Array.isArray(e)){const r=[];for(let l=0;l<e.length;l++)r[l]=Lx(n[l],t[l],e[l],i,s);return r}return Lx(n,t,e,i,s)}function zx(n,t){if(Array.isArray(n)){let e=0;for(let i=0;i<n.length;i++){const s=n[i]-t[i];e+=s*s}return Math.sqrt(e)}return Math.abs(n-t)}class R6 extends cf{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:i,stiffness:s}=this.settings,{_prevValue:r=t,_currValue:l=t}=this;let c=E6(r,l,e,i,s);const f=zx(c,e),d=zx(c,l);f<Fx&&d<Fx&&(c=e,this.end()),this._prevValue=l,this._currValue=c}}const C6={interpolation:w6,spring:R6};class M6{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,i,s){const{transitions:r}=this;if(r.has(t)){const f=r.get(t),{value:d=f.settings.fromValue}=f;e=d,this.remove(t)}if(s=h3(s),!s)return;const l=C6[s.type];if(!l){Qt.error(`unsupported transition type '${s.type}'`)();return}const c=new l(this.timeline);c.start({...s,fromValue:e,toValue:i}),r.set(t,c)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,i]of this.transitions)i.update(),t[e]=i.value,i.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function O6(n){const t=n[tr];for(const e in t){const i=t[e],{validate:s}=i;if(s&&!s(n[e],i))throw new Error(`Invalid prop ${e}: ${n[e]}`)}}function I6(n,t){const e=x3({newProps:n,oldProps:t,propTypes:n[tr],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=D6(n,t);let s=!1;return i||(s=k6(n,t)),{dataChanged:i,propsChanged:e,updateTriggersChanged:s,extensionsChanged:N6(n,t),transitionsChanged:P6(n,t)}}function P6(n,t){if(!n.transitions)return!1;const e={},i=n[tr];let s=!1;for(const r in n.transitions){const l=i[r],c=l&&l.type;(c==="number"||c==="color"||c==="array")&&lg(n[r],t[r],l)&&(e[r]=!0,s=!0)}return s?e:!1}function x3({newProps:n,oldProps:t,ignoreProps:e={},propTypes:i={},triggerName:s="props"}){if(t===n)return!1;if(typeof n!="object"||n===null)return`${s} changed shallowly`;if(typeof t!="object"||t===null)return`${s} changed shallowly`;for(const r of Object.keys(n))if(!(r in e)){if(!(r in t))return`${s}.${r} added`;const l=lg(n[r],t[r],i[r]);if(l)return`${s}.${r} ${l}`}for(const r of Object.keys(t))if(!(r in e)){if(!(r in n))return`${s}.${r} dropped`;if(!Object.hasOwnProperty.call(n,r)){const l=lg(n[r],t[r],i[r]);if(l)return`${s}.${r} ${l}`}}return!1}function lg(n,t,e){let i=e&&e.equal;return i&&!i(n,t,e)||!i&&(i=n&&t&&n.equals,i&&!i.call(n,t))?"changed deeply":!i&&t!==n?"changed shallowly":null}function D6(n,t){if(t===null)return"oldProps is null, initial diff";let e=!1;const{dataComparator:i,_dataDiff:s}=n;return i?i(n.data,t.data)||(e="Data comparator detected a change"):n.data!==t.data&&(e="A new data container was supplied"),e&&s&&(e=s(n.data,t.data)||e),e}function k6(n,t){if(t===null)return{all:!0};if("all"in n.updateTriggers&&Vx(n,t,"all"))return{all:!0};const e={};let i=!1;for(const s in n.updateTriggers)s!=="all"&&Vx(n,t,s)&&(e[s]=!0,i=!0);return i?e:!1}function N6(n,t){if(t===null)return!0;const e=t.extensions,{extensions:i}=n;if(i===e)return!1;if(!e||!i||i.length!==e.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(e[s]))return!0;return!1}function Vx(n,t,e){let i=n.updateTriggers[e];i=i??{};let s=t.updateTriggers[e];return s=s??{},x3({oldProps:s,newProps:i,triggerName:e})}const B6="count(): argument not an object",U6="count(): argument not a container";function F6(n){if(!z6(n))throw new Error(B6);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(L6(n))return Object.keys(n).length;throw new Error(U6)}function L6(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function z6(n){return n!==null&&typeof n=="object"}function Hx(n,t){if(!t)return n;const e={...n,...t};if("defines"in t&&(e.defines={...n.defines,...t.defines}),"modules"in t&&(e.modules=(n.modules||[]).concat(t.modules),t.modules.some(i=>i.name==="project64"))){const i=e.modules.findIndex(s=>s.name==="project32");i>=0&&e.modules.splice(i,1)}if("inject"in t)if(!n.inject)e.inject=t.inject;else{const i={...n.inject};for(const s in t.inject)i[s]=(i[s]||"")+t.inject[s];e.inject=i}return e}const V6={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},cg={};function H6(n,t,e,i){if(e instanceof Se)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let s=null;e.compressed&&(s={minFilter:"linear",mipmapFilter:e.data.length>1?"nearest":"linear"});const{width:r,height:l}=e.data,c=t.createTexture({...e,sampler:{...V6,...s,...i},mipLevels:t.getMipLevelCount(r,l)});return c.generateMipmapsWebGL(),cg[c.id]=n,c}function j6(n,t){!t||!(t instanceof Se)||cg[t.id]===n&&(t.delete(),delete cg[t.id])}const W6={boolean:{validate(n,t){return!0},equal(n,t,e){return!!n==!!t}},number:{validate(n,t){return Number.isFinite(n)&&(!("max"in t)||n<=t.max)&&(!("min"in t)||n>=t.min)}},color:{validate(n,t){return t.optional&&!n||ug(n)&&(n.length===3||n.length===4)},equal(n,t,e){return Rn(n,t,1)}},accessor:{validate(n,t){const e=Xu(n);return e==="function"||e===Xu(t.value)},equal(n,t,e){return typeof t=="function"?!0:Rn(n,t,1)}},array:{validate(n,t){return t.optional&&!n||ug(n)},equal(n,t,e){const{compare:i}=e,s=Number.isInteger(i)?i:i?1:0;return i?Rn(n,t,s):n===t}},object:{equal(n,t,e){if(e.ignore)return!0;const{compare:i}=e,s=Number.isInteger(i)?i:i?1:0;return i?Rn(n,t,s):n===t}},function:{validate(n,t){return t.optional&&!n||typeof n=="function"},equal(n,t,e){return!e.compare&&e.ignore!==!1||n===t}},data:{transform:(n,t,e)=>{if(!n)return n;const{dataTransform:i}=e.props;return i?i(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,t,e)=>{const i=e.context;return!i||!i.device?null:H6(e.id,i.device,n,{...t.parameters,...e.props.textureParameters})},release:(n,t,e)=>{j6(e.id,n)}}};function $6(n){const t={},e={},i={};for(const[s,r]of Object.entries(n)){const l=r?.deprecatedFor;if(l)i[s]=Array.isArray(l)?l:[l];else{const c=X6(s,r);t[s]=c,e[s]=c.value}}return{propTypes:t,defaultProps:e,deprecatedProps:i}}function X6(n,t){switch(Xu(t)){case"object":return Po(n,t);case"array":return Po(n,{type:"array",value:t,compare:!1});case"boolean":return Po(n,{type:"boolean",value:t});case"number":return Po(n,{type:"number",value:t});case"function":return Po(n,{type:"function",value:t,compare:!0});default:return{name:n,type:"unknown",value:t}}}function Po(n,t){return"type"in t?{name:n,...W6[t.type],...t}:"value"in t?{name:n,type:Xu(t.value),...t}:{name:n,type:"object",value:t}}function ug(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function Xu(n){return ug(n)?"array":n===null?"null":typeof n}function Y6(n,t){let e;for(let r=t.length-1;r>=0;r--){const l=t[r];"extensions"in l&&(e=l.extensions)}const i=fg(n.constructor,e),s=Object.create(i);s[$u]=n,s[cr]={},s[hs]={};for(let r=0;r<t.length;++r){const l=t[r];for(const c in l)s[c]=l[c]}return Object.freeze(s),s}const q6="_mergedDefaultProps";function fg(n,t){if(!(n instanceof uf.constructor))return{};let e=q6;if(t)for(const s of t){const r=s.constructor;r&&(e+=`:${r.extensionName||r.name}`)}const i=T3(n,e);return i||(n[e]=K6(n,t||[]))}function K6(n,t){if(!n.prototype)return null;const i=Object.getPrototypeOf(n),s=fg(i),r=T3(n,"defaultProps")||{},l=$6(r),c=Object.assign(Object.create(null),s,l.defaultProps),f=Object.assign(Object.create(null),s?.[tr],l.propTypes),d=Object.assign(Object.create(null),s?.[dp],l.deprecatedProps);for(const p of t){const _=fg(p.constructor);_&&(Object.assign(c,_),Object.assign(f,_[tr]),Object.assign(d,_[dp]))}return Z6(c,n),G6(c,f),Q6(c,d),c[tr]=f,c[dp]=d,t.length===0&&!f_(n,"_propTypes")&&(n._propTypes=f),c}function Z6(n,t){const e=tB(t);Object.defineProperties(n,{id:{writable:!0,value:e}})}function Q6(n,t){for(const e in t)Object.defineProperty(n,e,{enumerable:!1,set(i){const s=`${this.id}: ${e}`;for(const r of t[e])f_(this,r)||(this[r]=i);Qt.deprecated(s,t[e].join("/"))()}})}function G6(n,t){const e={},i={};for(const s in t){const r=t[s],{name:l,value:c}=r;r.async&&(e[l]=c,i[l]=J6(l))}n[ga]=e,n[cr]={},Object.defineProperties(n,i)}function J6(n){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||u3(t)?this[cr][n]=t:this[hs][n]=t},get(){if(this[hs]){if(n in this[hs])return this[hs][n]||this[ga][n];if(n in this[cr]){const t=this[$u]&&this[$u].internalState;if(t&&t.hasAsyncProp(n))return t.getAsyncProp(n)||this[ga][n]}}return this[ga][n]}}}function f_(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function T3(n,t){return f_(n,t)&&n[t]}function tB(n){const t=n.componentName;return t||Qt.warn(`${n.name}.componentName not specified`)(),t||n.name}let eB=0;class uf{constructor(...t){this.props=Y6(this,t),this.id=this.props.id,this.count=eB++}clone(t){const{props:e}=this,i={};for(const s in e[ga])s in e[hs]?i[s]=e[hs][s]:s in e[cr]&&(i[s]=e[cr][s]);return new this.constructor({...e,...i,...t})}}uf.componentName="Component";uf.defaultProps={};const nB=Object.freeze({});class iB{constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||nB}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return!!(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[$u]||this.component;const e=t[hs]||{},i=t[cr]||t,s=t[ga]||{};for(const r in e){const l=e[r];this._createAsyncPropData(r,s[r]),this._updateAsyncProp(r,l),e[r]=this.getAsyncProp(r)}for(const r in i){const l=i[r];this._createAsyncPropData(r,s[r]),this._updateAsyncProp(r,l)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if(typeof e=="string"&&(e=this._fetch(t,e)),e instanceof Promise){this._watchPromise(t,e);return}if(u3(e)){this._resolveAsyncIterable(t,e);return}this._setPropValue(t,e)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const i=this.asyncProps[t];return e===i.resolvedValue||e===i.lastValue?!1:(i.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const i=this.asyncProps[t];i&&(e=this._postProcessValue(i,e),i.resolvedValue=e,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(t,e,i){const s=this.asyncProps[t];s&&i>=s.resolvedLoadCount&&e!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=e,s.resolvedLoadCount=i,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const i=this.asyncProps[t];if(i){i.pendingLoadCount++;const s=i.pendingLoadCount;e.then(r=>{this.component&&(r=this._postProcessValue(i,r),this._setAsyncPropValue(t,r,s),this._onResolve(t,r))}).catch(r=>{this._onError(t,r)})}}async _resolveAsyncIterable(t,e){if(t!=="data"){this._setPropValue(t,e);return}const i=this.asyncProps[t];if(!i)return;i.pendingLoadCount++;const s=i.pendingLoadCount;let r=[],l=0;for await(const c of e){if(!this.component)return;const{dataTransform:f}=this.component.props;f?r=f(c,r):r=r.concat(c),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:l,endRow:r.length}]}),l=r.length,this._setAsyncPropValue(t,r,s)}this._onResolve(t,r)}_postProcessValue(t,e){const i=t.type;return i&&this.component&&(i.release&&i.release(t.resolvedValue,i,this.component),i.transform)?i.transform(e,i,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const s=this.component&&this.component.props[tr];this.asyncProps[t]={type:s&&s[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class sB extends iB{constructor({attributeManager:t,layer:e}){super(e),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const i=this.layer,s=i?.props.fetch;return s?s(e,{propName:t,layer:i}):super._fetch(t,e)}_onResolve(t,e){const i=this.layer;if(i){const s=i.props.onDataLoad;t==="data"&&s&&s(e,{propName:t,layer:i})}}_onError(t,e){const i=this.layer;i&&i.raiseError(e,`loading ${t} of ${this.layer}`)}}const rB="layer.changeFlag",aB="layer.initialize",oB="layer.update",lB="layer.finalize",cB="layer.matched",jx=2**24-1,uB=Object.freeze([]),fB=bl(({oldViewport:n,viewport:t})=>n.equals(t));let zn=new Uint8ClampedArray(0);const hB={data:{type:"data",value:uB,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:t,layer:e,loaders:i,loadOptions:s,signal:r})=>{const{resourceManager:l}=e.context;s=s||e.getLoadOptions(),i=i||e.props.loaders,r&&(s={...s,fetch:{...s?.fetch,signal:r}});let c=l.contains(n);return!c&&!s&&(l.add({resourceId:n,data:kp(n,i),persistent:!1}),c=!0),c?l.subscribe({resourceId:n,onChange:f=>e.internalState?.reloadAsyncProp(t,f),consumerId:e.id,requestId:t}):kp(n,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Ut.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Tl extends uf{constructor(){super(...arguments),this.internalState=null,this.lifecycle=oa.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){ke(this.internalState);const e=this.internalState.viewport||this.context.viewport,i=V2(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,r,l]=B2(i,e.pixelProjectionMatrix);return t.length===2?[s,r]:[s,r,l]}unproject(t){return ke(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){ke(this.internalState);const i=this.internalState.viewport||this.context.viewport;return jP(t,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}get isDrawable(){return!0}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setShaderModuleProps(...t){for(const e of this.getModels())e.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===Ut.DEFAULT||t===Ut.LNGLAT||t===Ut.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,e=[]){return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){ke(t instanceof Uint8Array);const[e,i,s]=t;return e+i*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:F6(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(t){t=Hx(t,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const e of this.props.extensions)t=Hx(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:i}=t.changeFlags;if(i&&e)if(Array.isArray(i))for(const s of i)e.invalidateAll(s);else e.invalidateAll();if(e){const{props:s}=t,r=this.internalState.hasPickingBuffer,l=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(c=>c.getNeedsPickingBuffer.call(this,c));if(r!==l){this.internalState.hasPickingBuffer=l;const{pickingColors:c,instancePickingColors:f}=e.attributes,d=c||f;d&&(l&&d.constant&&(d.constant=!1,e.invalidate(d.id)),!d.value&&!l&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(t){for(const i of this.getModels())i.destroy();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t.renderPass)}getPickingInfo({info:t,mode:e,sourceLayer:i}){const{index:s}=t;return s>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[s]),t}raiseError(t,e){e&&(t=new Error(`${e}: ${t.message}`,{cause:t})),this.props.onError?.(t)||this.context?.onError?.(t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,(!e||!fB({oldViewport:e,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){const e=this.getAttributeManager();e&&(t==="all"?e.invalidateAll():e.invalidate(t))}updateAttributes(t){let e=!1;for(const i in t)t[i].layoutChanged()&&(e=!0);for(const i of this.getModels())this._setModelAttributes(i,t,e)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,i=this.getNumInstances(),s=this.getStartIndices();t.update({data:e.data,numInstances:i,startIndices:s,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const r=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),i=Object.create(this.props);for(const s in e)Object.defineProperty(i,s,{value:e[s]});return i}return this.props}calculateInstancePickingColors(t,{numInstances:e}){if(t.constant)return;const i=Math.floor(zn.length/4);if(this.internalState.usesPickingColorCache=!0,i<e){e>jx&&Qt.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),zn=Ta.allocate(zn,e,{size:4,copy:!0,maxCount:Math.max(e,jx)});const s=Math.floor(zn.length/4),r=[0,0,0];for(let l=i;l<s;l++)this.encodePickingColor(l,r),zn[l*4+0]=r[0],zn[l*4+1]=r[1],zn[l*4+2]=r[2],zn[l*4+3]=0}t.value=zn.subarray(0,e*4)}_setModelAttributes(t,e,i=!1){if(!Object.keys(e).length)return;if(i){const c=this.getAttributeManager();t.setBufferLayout(c.getBufferLayouts(t)),e=c.getAttributes()}const s=t.userData?.excludeAttributes||{},r={},l={};for(const c in e){if(s[c])continue;const f=e[c].getValue();for(const d in f){const p=f[d];p instanceof Gt?e[c].settings.isIndexed?t.setIndexBuffer(p):r[d]=p:p&&(l[d]=p)}}t.setAttributes(r),t.setConstantAttributes(l)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e)){this._disablePickingIndex(t);return}const{pickingColors:i,instancePickingColors:s}=this.getAttributeManager().attributes,r=i||s,l=r&&e.attributes&&e.attributes[r.id];if(l&&l.value){const c=l.value,f=this.encodePickingColor(t);for(let d=0;d<e.length;d++){const p=r.getVertexOffset(d);c[p]===f[0]&&c[p+1]===f[1]&&c[p+2]===f[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,s=e||i;if(!s)return;const r=s.getVertexOffset(t),l=s.getVertexOffset(t+1);s.buffer.write(new Uint8Array(l-r),r)}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,i=t||e;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==zn.buffer&&(i.value=zn.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){ke(!this.internalState),ke(Number.isFinite(this.props.coordinateSystem)),We(aB,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new sB({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Qt.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new M6(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){We(cB,this,this===t);const{state:e,internalState:i}=t;this!==t&&(this.internalState=i,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(We(oB,this,t),!t)return;const e=this.props,i=this.context,s=this.internalState,r=i.viewport,l=this._updateUniformTransition();s.propsInTransition=l,i.viewport=s.viewport||r,this.props=l;try{const c=this._getUpdateParams(),f=this.getModels();if(i.device)this.updateState(c);else try{this.updateState(c)}catch{}for(const p of this.props.extensions)p.updateState.call(this,c,p);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==f[0];this._postUpdate(c,d)}finally{i.viewport=r,this.props=e,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){We(lB,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,shaderModuleProps:e=null,uniforms:i={},parameters:s={}}){this._updateAttributeTransition();const r=this.props,l=this.context;this.props=this.internalState.propsInTransition||r;try{e&&this.setShaderModuleProps(e);const{getPolygonOffset:c}=this.props,f=c&&c(i)||[0,0];l.device instanceof ag&&l.device.setParametersWebGL({polygonOffset:f});for(const d of this.getModels())d.device.type==="webgpu"?d.setParameters({...d.parameters,...s}):d.setParameters(s);if(l.device instanceof ag)l.device.withParametersWebGL(s,()=>{const d={renderPass:t,shaderModuleProps:e,uniforms:i,parameters:s,context:l};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)});else{const d={renderPass:t,shaderModuleProps:e,uniforms:i,parameters:s,context:l};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)}}finally{this.props=r}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const s in t)if(t[s]){let r=!1;switch(s){case"dataChanged":const l=t[s],c=e[s];l&&Array.isArray(c)&&(e.dataChanged=Array.isArray(l)?c.concat(l):l,r=!0);default:e[s]||(e[s]=t[s],r=!0)}r&&We(rB,this,s,t)}const i=!!(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=i,e.somethingChanged=i||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const i=I6(t,e);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged)this.internalState.uniformTransitions.add(s,e[s],t[s],t.transitions?.[s]);return this.setChangeFlags(i)}validateProps(){O6(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={highlightedObjectColor:t.picked?t.color:null},{highlightColor:i}=this.props;t.picked&&typeof i=="function"&&(e.highlightColor=i(t)),this.setShaderModuleProps({picking:e}),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new A6(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:i,oldProps:s}=t,r=this.state.model;r?.isInstanced&&r.setInstanceCount(this.getNumInstances());const{autoHighlight:l,highlightedObjectIndex:c,highlightColor:f}=i;if(e||s.autoHighlight!==l||s.highlightedObjectIndex!==c||s.highlightColor!==f){const d={};Array.isArray(f)&&(d.highlightColor=f),(e||s.autoHighlight!==l||c!==s.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(c)&&c>=0?this.encodePickingColor(c):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),s=i?i.getNeedsRedraw(t):!1;if(e=e||s,e)for(const r of this.props.extensions)r.onNeedsRedraw.call(this,r);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Tl.defaultProps=hB;Tl.layerName="Layer";class dB{constructor(t){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:e={}}=t;this.typedArrayManager=Ta,this.attributes={},this._attributeDefs=e,this.opts=t,this.updateGeometry(t)}updateGeometry(t){Object.assign(this.opts,t);const{data:e,buffers:i={},getGeometry:s,geometryBuffer:r,positionFormat:l,dataChanged:c,normalize:f=!0}=this.opts;if(this.data=e,this.getGeometry=s,this.positionSize=r&&r.size||(l==="XY"?2:3),this.buffers=i,this.normalize=f,r&&(ke(e.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),f||(i.vertexPositions=r)),this.geometryBuffer=i.vertexPositions,Array.isArray(c))for(const d of c)this._rebuildGeometry(d);else this._rebuildGeometry()}updatePartialGeometry({startRow:t,endRow:e}){this._rebuildGeometry({startRow:t,endRow:e})}getGeometryFromBuffer(t){const e=t.value||t;return ArrayBuffer.isView(e)?f3(e,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices}):null}_allocate(t,e){const{attributes:i,buffers:s,_attributeDefs:r,typedArrayManager:l}=this;for(const c in r)if(c in s)l.release(i[c]),i[c]=null;else{const f=r[c];f.copy=e,i[c]=l.allocate(i[c],t,f)}}_forEachGeometry(t,e,i){const{data:s,getGeometry:r}=this,{iterable:l,objectInfo:c}=c3(s,e,i);for(const f of l){c.index++;const d=r?r(f,c):null;t(d,c.index)}}_rebuildGeometry(t){if(!this.data)return;let{indexStarts:e,vertexStarts:i,instanceCount:s}=this;const{data:r,geometryBuffer:l}=this,{startRow:c=0,endRow:f=1/0}=t||{},d={};if(t||(e=[0],i=[0]),this.normalize||!l)this._forEachGeometry((_,y)=>{const b=_&&this.normalizeGeometry(_);d[y]=b,i[y+1]=i[y]+(b?this.getGeometrySize(b):0)},c,f),s=i[i.length-1];else if(i=r.startIndices,s=i[r.length]||0,ArrayBuffer.isView(l))s=s||l.length/this.positionSize;else if(l instanceof Gt){const _=this.positionSize*4;s=s||l.byteLength/_}else if(l.buffer){const _=l.stride||this.positionSize*4;s=s||l.buffer.byteLength/_}else if(l.value){const _=l.value,y=l.stride/_.BYTES_PER_ELEMENT||this.positionSize;s=s||_.length/y}this._allocate(s,!!t),this.indexStarts=e,this.vertexStarts=i,this.instanceCount=s;const p={};this._forEachGeometry((_,y)=>{const b=d[y]||_;p.vertexStart=i[y],p.indexStart=e[y];const x=y<i.length-1?i[y+1]:s;p.geometrySize=x-i[y],p.geometryIndex=y,this.updateGeometryAttributes(b,p)},c,f),this.vertexCount=e[e.length-1]}}const pB=typeof window<"u"?At.useLayoutEffect:At.useEffect;function Yu(n,t){for(;n;){if(n===t)return!0;n=Object.getPrototypeOf(n)}return!1}const gB={position:"absolute",zIndex:-1};function S3(n,t){if(typeof n=="function")return n(t);if(Array.isArray(n))return n.map(e=>S3(e,t));if(ff(n)){if(_B(n))return t.style=gB,At.cloneElement(n,t);if(mB(n))return At.cloneElement(n,t)}return n}function ff(n){return n&&typeof n=="object"&&"type"in n||!1}function _B(n){return n.props?.mapStyle}function mB(n){const t=n.type;return t&&t.deckGLViewProps}function hg(n){if(typeof n=="function")return At.createElement(Ea,{},n);if(Array.isArray(n))return n.map(hg);if(ff(n)){if(n.type===At.Fragment)return hg(n.props.children);if(Yu(n.type,Ea))return n}return n}function yB({children:n,layers:t=[],views:e=null}){const i=[],s=[],r={};return At.Children.forEach(hg(n),l=>{if(ff(l)){const c=l.type;if(Yu(c,Tl)){const f=bB(c,l.props);s.push(f)}else i.push(l);if(Yu(c,Ea)&&c!==Ea&&l.props.id){const f=new c(l.props);r[f.id]=f}}else l&&i.push(l)}),Object.keys(r).length>0&&(Array.isArray(e)?e.forEach(l=>{r[l.id]=l}):e&&(r[e.id]=e),e=Object.values(r)),t=s.length>0?[...s,...t]:t,{layers:t,children:i,views:e}}function bB(n,t){const e={},i=n.defaultProps||{};for(const s in t)i[s]!==t[s]&&(e[s]=t[s]);return new n(e)}const vB=At.createContext();function xB({children:n,deck:t,ContextProvider:e=vB.Provider}){const{viewManager:i}=t||{};if(!i||!i.views.length)return[];const s={},r=i.views[0].id;for(const l of n){let c=r,f=l;ff(l)&&Yu(l.type,Ea)&&(c=l.props.id||r,f=l.props.children);const d=i.getViewport(c),p=i.getViewState(c);if(d){p.padding=d.padding;const{x:_,y,width:b,height:x}=d;f=S3(f,{x:_,y,width:b,height:x,viewport:d,viewState:p}),s[c]||(s[c]={viewport:d,children:[]}),s[c].children.push(f)}}return Object.keys(s).map(l=>{const{viewport:c,children:f}=s[l],{x:d,y:p,width:_,height:y}=c,b={position:"absolute",left:d,top:p,width:_,height:y},x=`view-${l}`,T=At.createElement("div",{key:x,id:x,style:b},...f),A={deck:t,viewport:c,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:D=>{D.viewId=l,t._onViewStateChange(D)},widgets:[]},E=`view-${l}-context`;return At.createElement(e,{key:E,value:A},T)})}const TB={mixBlendMode:null};function SB({width:n,height:t,style:e}){const i={position:"absolute",zIndex:0,left:0,top:0,width:n,height:t},s={left:0,top:0};if(e)for(const r in e)r in TB?s[r]=e[r]:i[r]=e[r];return{containerStyle:i,canvasStyle:s}}function AB(n){return{get deck(){return n.deck},pickObject:t=>n.deck.pickObject(t),pickMultipleObjects:t=>n.deck.pickMultipleObjects(t),pickObjects:t=>n.deck.pickObjects(t)}}function A3(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function wB(n,t,e){const i=new t({...e,_customRender:e.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:s=>{n.redrawReason=s;const r=i.getViewports();n.lastRenderedViewports!==r?n.forceUpdate():A3(n)}});return i}function EB(n,t){const[e,i]=At.useState(0),r=At.useRef({control:null,version:e,forceUpdate:()=>i(k=>k+1)}).current,l=At.useRef(null),c=At.useRef(null),f=At.useMemo(()=>yB(n),[n.layers,n.views,n.children]);let d=!0;const p=k=>d&&n.viewState?(r.viewStateUpdateRequested=k,null):(r.viewStateUpdateRequested=null,n.onViewStateChange?.(k)),_=k=>{d?r.interactionStateUpdateRequested=k:(r.interactionStateUpdateRequested=null,n.onInteractionStateChange?.(k))},y=At.useMemo(()=>{const k={widgets:[],...n,style:null,width:"100%",height:"100%",parent:l.current,canvas:c.current,layers:f.layers,views:f.views,onViewStateChange:p,onInteractionStateChange:_};return delete k._customRender,r.deck&&r.deck.setProps(k),k},[n]);At.useEffect(()=>{const k=n.Deck||u_;return r.deck=wB(r,k,{...y,parent:l.current,canvas:c.current}),()=>r.deck?.finalize()},[]),pB(()=>{A3(r);const{viewStateUpdateRequested:k,interactionStateUpdateRequested:z}=r;k&&p(k),z&&_(z),r.deck?.isInitialized&&r.deck.redraw("Initial render")}),At.useImperativeHandle(t,()=>AB(r),[]);const b=r.deck&&r.deck.isInitialized?r.deck.getViewports():void 0,{ContextProvider:x,width:T="100%",height:A="100%",id:E,style:D}=n,{containerStyle:C,canvasStyle:O}=At.useMemo(()=>SB({width:T,height:A,style:D}),[T,A,D]);if(!r.viewStateUpdateRequested&&r.lastRenderedViewports===b||r.version!==e){r.lastRenderedViewports=b,r.version=e;const k=xB({children:f.children,deck:r.deck,ContextProvider:x}),z=At.createElement("canvas",{key:"canvas",id:E||"deckgl-overlay",ref:c,style:O});r.control=At.createElement("div",{id:`${E||"deckgl"}-wrapper`,ref:l,style:C},[z,k])}return d=!1,r.control}const RB=At.forwardRef(EB),Wx=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,CB={name:"scatterplot",vs:Wx,fs:Wx,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},MB=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,OB=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,IB=`// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,$x=[0,0,0,255],PB={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:$x},getLineColor:{type:"accessor",value:$x},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class h_ extends Tl{getShaders(){return super.getShaders({vs:MB,fs:OB,source:IB,modules:[P2,MI,F2,CB]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{radiusUnits:e,radiusScale:i,radiusMinPixels:s,radiusMaxPixels:r,stroked:l,filled:c,billboard:f,antialiasing:d,lineWidthUnits:p,lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:b}=this.props,x={stroked:l,filled:c,billboard:f,antialiasing:d,radiusUnits:lr[e],radiusScale:i,radiusMinPixels:s,radiusMaxPixels:r,lineWidthUnits:lr[p],lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:b},T=this.state.model;T.shaderInputs.setProps({scatterplot:x}),this.context.device.type==="webgpu"&&(T.instanceCount=this.props.data.length),T.draw(this.context.renderPass)}_getModel(){const t=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Aa(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new W2({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0,parameters:t})}}h_.defaultProps=PB;h_.layerName="ScatterplotLayer";function iu(n,t){const e=t.length,i=n.length;if(i>0){let s=!0;for(let r=0;r<e;r++)if(n[i-e+r]!==t[r]){s=!1;break}if(s)return!1}for(let s=0;s<e;s++)n[i+s]=t[s];return!0}function Xx(n,t){const e=t.length;for(let i=0;i<e;i++)n[i]=t[i]}function Yx(n,t,e,i,s=[]){const r=i+t*e;for(let l=0;l<e;l++)s[l]=n[r+l];return s}function qx(n,t,e,i,s=[]){let r,l;if(e&8)r=(i[3]-n[1])/(t[1]-n[1]),l=3;else if(e&4)r=(i[1]-n[1])/(t[1]-n[1]),l=1;else if(e&2)r=(i[2]-n[0])/(t[0]-n[0]),l=2;else if(e&1)r=(i[0]-n[0])/(t[0]-n[0]),l=0;else return null;for(let c=0;c<n.length;c++)s[c]=(l&1)===c?i[l]:r*(t[c]-n[c])+n[c];return s}function vp(n,t){let e=0;return n[0]<t[0]?e|=1:n[0]>t[2]&&(e|=2),n[1]<t[1]?e|=4:n[1]>t[3]&&(e|=8),e}function w3(n,t){const{size:e=2,broken:i=!1,gridResolution:s=10,gridOffset:r=[0,0],startIndex:l=0,endIndex:c=n.length}=t||{},f=(c-l)/e;let d=[];const p=[d],_=Yx(n,0,e,l);let y,b;const x=DB(_,s,r,[]),T=[];iu(d,_);for(let A=1;A<f;A++){for(y=Yx(n,A,e,l,y),b=vp(y,x);b;){qx(_,y,b,x,T);const E=vp(T,x);E&&(qx(_,T,E,x,T),b=E),iu(d,T),Xx(_,T),kB(x,s,b),i&&d.length>e&&(d=[],p.push(d),iu(d,_)),b=vp(y,x)}iu(d,y),Xx(_,y)}return i?p:p[0]}function DB(n,t,e,i){const s=Math.floor((n[0]-e[0])/t)*t+e[0],r=Math.floor((n[1]-e[1])/t)*t+e[1];return i[0]=s,i[1]=r,i[2]=s+t,i[3]=r+t,i}function kB(n,t,e){e&8?(n[1]+=t,n[3]+=t):e&4?(n[1]-=t,n[3]-=t):e&2?(n[0]+=t,n[2]+=t):e&1&&(n[0]-=t,n[2]-=t)}function NB(n,t){const{size:e=2,startIndex:i=0,endIndex:s=n.length,normalize:r=!0}=t||{},l=n.slice(i,s);BB(l,e,0,s-i);const c=w3(l,{size:e,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(r)for(const f of c)UB(f,e);return c}function BB(n,t,e,i){let s=n[0],r;for(let l=e;l<i;l+=t){r=n[l];const c=r-s;(c>180||c<-180)&&(r-=Math.round(c/360)*360),n[l]=s=r}}function UB(n,t){let e;const i=n.length/t;for(let r=0;r<i&&(e=n[r*t],(e+180)%360===0);r++);const s=-Math.round(e/360)*360;if(s!==0)for(let r=0;r<i;r++)n[r*t]+=s}function FB(n,t,e,i){let s;if(Array.isArray(n[0])){const r=n.length*t;s=new Array(r);for(let l=0;l<n.length;l++)for(let c=0;c<t;c++)s[l*t+c]=n[l][c]||0}else s=n;return e?w3(s,{size:t,gridResolution:e}):i?NB(s,{size:t}):s}const LB=1,zB=2,xp=4;class VB extends dB{constructor(t){super({...t,attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(t){return this.attributes[t]}getGeometryFromBuffer(t){return this.normalize?super.getGeometryFromBuffer(t):null}normalizeGeometry(t){return this.normalize?FB(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}getGeometrySize(t){if(Kx(t)){let i=0;for(const s of t)i+=this.getGeometrySize(s);return i}const e=this.getPathLength(t);return e<2?0:this.isClosed(t)?e<3?0:e+2:e}updateGeometryAttributes(t,e){if(e.geometrySize!==0)if(t&&Kx(t))for(const i of t){const s=this.getGeometrySize(i);e.geometrySize=s,this.updateGeometryAttributes(i,e),e.vertexStart+=s}else this._updateSegmentTypes(t,e),this._updatePositions(t,e)}_updateSegmentTypes(t,e){const i=this.attributes.segmentTypes,s=t?this.isClosed(t):!1,{vertexStart:r,geometrySize:l}=e;i.fill(0,r,r+l),s?(i[r]=xp,i[r+l-2]=xp):(i[r]+=LB,i[r+l-2]+=zB),i[r+l-1]=xp}_updatePositions(t,e){const{positions:i}=this.attributes;if(!i||!t)return;const{vertexStart:s,geometrySize:r}=e,l=new Array(3);for(let c=s,f=0;f<r;c++,f++)this.getPointOnPath(t,f,l),i[c*3]=l[0],i[c*3+1]=l[1],i[c*3+2]=l[2]}getPathLength(t){return t.length/this.positionSize}getPointOnPath(t,e,i=[]){const{positionSize:s}=this;e*s>=t.length&&(e+=1-t.length/s);const r=e*s;return i[0]=t[r],i[1]=t[r+1],i[2]=s===3&&t[r+2]||0,i}isClosed(t){if(!this.normalize)return!!this.opts.loop;const{positionSize:e}=this,i=t.length-e;return t[0]===t[i]&&t[1]===t[i+1]&&(e===2||t[2]===t[i+2])}}function Kx(n){return Array.isArray(n[0])}const Zx=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,HB={name:"path",vs:Zx,fs:Zx,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},jB=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,WB=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,E3=[0,0,0,255],$B={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:n=>n.path},getColor:{type:"accessor",value:E3},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Tp={enter:(n,t)=>t.length?t.subarray(t.length-n.length):n};class d_ extends Tl{getShaders(){return super.getShaders({vs:jB,fs:WB,modules:[P2,F2,HB]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Tp,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Tp,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Tp,defaultValue:E3},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:s,target:r})=>this.encodePickingColor(i&&i.__source?i.__source.index:s,r)}}),this.setState({pathTesselator:new VB({fp64:this.use64bitPositions()})})}updateState(t){super.updateState(t);const{props:e,changeFlags:i}=t,s=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:l}=this.state,c=e.data.attributes||{};l.updateGeometry({data:e.data,geometryBuffer:c.getPath,buffers:c,normalize:!e._pathType,loop:e._pathType==="loop",getGeometry:e.getPath,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),i.dataChanged||s.invalidateAll()}i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll())}getPickingInfo(t){const e=super.getPickingInfo(t),{index:i}=e,s=this.props.data;return s[0]&&s[0].__source&&(e.object=s.find(r=>r.__source.index===i)),e}disablePickingIndex(t){const e=this.props.data;if(e[0]&&e[0].__source)for(let i=0;i<e.length;i++)e[i].__source.index===t&&this._disablePickingIndex(i);else super.disablePickingIndex(t)}draw({uniforms:t}){const{jointRounded:e,capRounded:i,billboard:s,miterLimit:r,widthUnits:l,widthScale:c,widthMinPixels:f,widthMaxPixels:d}=this.props,p=this.state.model,_={jointType:Number(e),capType:Number(i),billboard:s,widthUnits:lr[l],widthScale:c,miterLimit:r,widthMinPixels:f,widthMaxPixels:d};p.shaderInputs.setProps({path:_}),p.draw(this.context.renderPass)}_getModel(){const t=[0,1,2,1,4,2,1,3,4,3,5,4],e=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Aa(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new W2({topology:"triangle-list",attributes:{indices:new Uint16Array(t),positions:{value:new Float32Array(e),size:2}}}),isInstanced:!0})}calculatePositions(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("positions")}calculateSegmentTypes(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("segmentTypes")}}d_.defaultProps=$B;d_.layerName="PathLayer";function XB({data:n,viewState:t,onViewStateChange:e,setHoverInfo:i}){console.log("Map rendering. Data points:",n.length),console.log("Current ViewState:",t);const s=At.useMemo(()=>{if(!n||n.length===0)return[];const r=Math.min(...n.map(f=>f.magnitude)),l=Math.max(...n.map(f=>f.magnitude));console.log("Magnitude range:",r,l);const c=f=>{let d=(f.magnitude-r)/(l-r);return isNaN(d)&&(d=.5),[255*d,0,255*(1-d),255]};return[new d_({id:"path-layer",data:[n],getPath:f=>f.map(d=>[d.coordinates[0],d.coordinates[1]]),getColor:[0,255,0,255],getWidth:5,widthMinPixels:2}),new h_({id:"scatter-layer",data:n,getPosition:f=>[f.coordinates[0],f.coordinates[1]],getFillColor:c,getRadius:5,radiusMinPixels:5,pickable:!0,onHover:f=>i(f)})]},[n,i]);return qt.jsx(RB,{viewState:t,onViewStateChange:r=>e(r.viewState),controller:!0,layers:s,getTooltip:({object:r})=>r&&`Magnitude: ${r.magnitude.toFixed(2)} T`,parameters:{clearColor:[.1,.1,.1,1]},style:{width:"100%",height:"100%"}})}function Sl(n){return n+.5|0}const ds=(n,t,e)=>Math.max(Math.min(n,e),t);function jo(n){return ds(Sl(n*2.55),0,255)}function _s(n){return ds(Sl(n*255),0,255)}function Oi(n){return ds(Sl(n/2.55)/100,0,1)}function Qx(n){return ds(Sl(n*100),0,100)}const wn={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},dg=[..."0123456789ABCDEF"],YB=n=>dg[n&15],qB=n=>dg[(n&240)>>4]+dg[n&15],su=n=>(n&240)>>4===(n&15),KB=n=>su(n.r)&&su(n.g)&&su(n.b)&&su(n.a);function ZB(n){var t=n.length,e;return n[0]==="#"&&(t===4||t===5?e={r:255&wn[n[1]]*17,g:255&wn[n[2]]*17,b:255&wn[n[3]]*17,a:t===5?wn[n[4]]*17:255}:(t===7||t===9)&&(e={r:wn[n[1]]<<4|wn[n[2]],g:wn[n[3]]<<4|wn[n[4]],b:wn[n[5]]<<4|wn[n[6]],a:t===9?wn[n[7]]<<4|wn[n[8]]:255})),e}const QB=(n,t)=>n<255?t(n):"";function GB(n){var t=KB(n)?YB:qB;return n?"#"+t(n.r)+t(n.g)+t(n.b)+QB(n.a,t):void 0}const JB=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function R3(n,t,e){const i=t*Math.min(e,1-e),s=(r,l=(r+n/30)%12)=>e-i*Math.max(Math.min(l-3,9-l,1),-1);return[s(0),s(8),s(4)]}function tU(n,t,e){const i=(s,r=(s+n/60)%6)=>e-e*t*Math.max(Math.min(r,4-r,1),0);return[i(5),i(3),i(1)]}function eU(n,t,e){const i=R3(n,1,.5);let s;for(t+e>1&&(s=1/(t+e),t*=s,e*=s),s=0;s<3;s++)i[s]*=1-t-e,i[s]+=t;return i}function nU(n,t,e,i,s){return n===s?(t-e)/i+(t<e?6:0):t===s?(e-n)/i+2:(n-t)/i+4}function p_(n){const e=n.r/255,i=n.g/255,s=n.b/255,r=Math.max(e,i,s),l=Math.min(e,i,s),c=(r+l)/2;let f,d,p;return r!==l&&(p=r-l,d=c>.5?p/(2-r-l):p/(r+l),f=nU(e,i,s,p,r),f=f*60+.5),[f|0,d||0,c]}function g_(n,t,e,i){return(Array.isArray(t)?n(t[0],t[1],t[2]):n(t,e,i)).map(_s)}function __(n,t,e){return g_(R3,n,t,e)}function iU(n,t,e){return g_(eU,n,t,e)}function sU(n,t,e){return g_(tU,n,t,e)}function C3(n){return(n%360+360)%360}function rU(n){const t=JB.exec(n);let e=255,i;if(!t)return;t[5]!==i&&(e=t[6]?jo(+t[5]):_s(+t[5]));const s=C3(+t[2]),r=+t[3]/100,l=+t[4]/100;return t[1]==="hwb"?i=iU(s,r,l):t[1]==="hsv"?i=sU(s,r,l):i=__(s,r,l),{r:i[0],g:i[1],b:i[2],a:e}}function aU(n,t){var e=p_(n);e[0]=C3(e[0]+t),e=__(e),n.r=e[0],n.g=e[1],n.b=e[2]}function oU(n){if(!n)return;const t=p_(n),e=t[0],i=Qx(t[1]),s=Qx(t[2]);return n.a<255?`hsla(${e}, ${i}%, ${s}%, ${Oi(n.a)})`:`hsl(${e}, ${i}%, ${s}%)`}const Gx={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Jx={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function lU(){const n={},t=Object.keys(Jx),e=Object.keys(Gx);let i,s,r,l,c;for(i=0;i<t.length;i++){for(l=c=t[i],s=0;s<e.length;s++)r=e[s],c=c.replace(r,Gx[r]);r=parseInt(Jx[l],16),n[c]=[r>>16&255,r>>8&255,r&255]}return n}let ru;function cU(n){ru||(ru=lU(),ru.transparent=[0,0,0,0]);const t=ru[n.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const uU=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function fU(n){const t=uU.exec(n);let e=255,i,s,r;if(t){if(t[7]!==i){const l=+t[7];e=t[8]?jo(l):ds(l*255,0,255)}return i=+t[1],s=+t[3],r=+t[5],i=255&(t[2]?jo(i):ds(i,0,255)),s=255&(t[4]?jo(s):ds(s,0,255)),r=255&(t[6]?jo(r):ds(r,0,255)),{r:i,g:s,b:r,a:e}}}function hU(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${Oi(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const Sp=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,aa=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function dU(n,t,e){const i=aa(Oi(n.r)),s=aa(Oi(n.g)),r=aa(Oi(n.b));return{r:_s(Sp(i+e*(aa(Oi(t.r))-i))),g:_s(Sp(s+e*(aa(Oi(t.g))-s))),b:_s(Sp(r+e*(aa(Oi(t.b))-r))),a:n.a+e*(t.a-n.a)}}function au(n,t,e){if(n){let i=p_(n);i[t]=Math.max(0,Math.min(i[t]+i[t]*e,t===0?360:1)),i=__(i),n.r=i[0],n.g=i[1],n.b=i[2]}}function M3(n,t){return n&&Object.assign(t||{},n)}function tT(n){var t={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(t={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(t.a=_s(n[3]))):(t=M3(n,{r:0,g:0,b:0,a:1}),t.a=_s(t.a)),t}function pU(n){return n.charAt(0)==="r"?fU(n):rU(n)}class cl{constructor(t){if(t instanceof cl)return t;const e=typeof t;let i;e==="object"?i=tT(t):e==="string"&&(i=ZB(t)||cU(t)||pU(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=M3(this._rgb);return t&&(t.a=Oi(t.a)),t}set rgb(t){this._rgb=tT(t)}rgbString(){return this._valid?hU(this._rgb):void 0}hexString(){return this._valid?GB(this._rgb):void 0}hslString(){return this._valid?oU(this._rgb):void 0}mix(t,e){if(t){const i=this.rgb,s=t.rgb;let r;const l=e===r?.5:e,c=2*l-1,f=i.a-s.a,d=((c*f===-1?c:(c+f)/(1+c*f))+1)/2;r=1-d,i.r=255&d*i.r+r*s.r+.5,i.g=255&d*i.g+r*s.g+.5,i.b=255&d*i.b+r*s.b+.5,i.a=l*i.a+(1-l)*s.a,this.rgb=i}return this}interpolate(t,e){return t&&(this._rgb=dU(this._rgb,t._rgb,e)),this}clone(){return new cl(this.rgb)}alpha(t){return this._rgb.a=_s(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=Sl(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return au(this._rgb,2,t),this}darken(t){return au(this._rgb,2,-t),this}saturate(t){return au(this._rgb,1,t),this}desaturate(t){return au(this._rgb,1,-t),this}rotate(t){return aU(this._rgb,t),this}}function wi(){}const gU=(()=>{let n=0;return()=>n++})();function Jt(n){return n==null}function Re(n){if(Array.isArray&&Array.isArray(n))return!0;const t=Object.prototype.toString.call(n);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function Ft(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function kn(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function Qn(n,t){return kn(n)?n:t}function It(n,t){return typeof n>"u"?t:n}const _U=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*t:+n;function ne(n,t,e){if(n&&typeof n.call=="function")return n.apply(e,t)}function jt(n,t,e,i){let s,r,l;if(Re(n))for(r=n.length,s=0;s<r;s++)t.call(e,n[s],s);else if(Ft(n))for(l=Object.keys(n),r=l.length,s=0;s<r;s++)t.call(e,n[l[s]],l[s])}function qu(n,t){let e,i,s,r;if(!n||!t||n.length!==t.length)return!1;for(e=0,i=n.length;e<i;++e)if(s=n[e],r=t[e],s.datasetIndex!==r.datasetIndex||s.index!==r.index)return!1;return!0}function Ku(n){if(Re(n))return n.map(Ku);if(Ft(n)){const t=Object.create(null),e=Object.keys(n),i=e.length;let s=0;for(;s<i;++s)t[e[s]]=Ku(n[e[s]]);return t}return n}function O3(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function mU(n,t,e,i){if(!O3(n))return;const s=t[n],r=e[n];Ft(s)&&Ft(r)?ul(s,r,i):t[n]=Ku(r)}function ul(n,t,e){const i=Re(t)?t:[t],s=i.length;if(!Ft(n))return n;e=e||{};const r=e.merger||mU;let l;for(let c=0;c<s;++c){if(l=i[c],!Ft(l))continue;const f=Object.keys(l);for(let d=0,p=f.length;d<p;++d)r(f[d],n,l,e)}return n}function el(n,t){return ul(n,t,{merger:yU})}function yU(n,t,e){if(!O3(n))return;const i=t[n],s=e[n];Ft(i)&&Ft(s)?el(i,s):Object.prototype.hasOwnProperty.call(t,n)||(t[n]=Ku(s))}const eT={"":n=>n,x:n=>n.x,y:n=>n.y};function bU(n){const t=n.split("."),e=[];let i="";for(const s of t)i+=s,i.endsWith("\\")?i=i.slice(0,-1)+".":(e.push(i),i="");return e}function vU(n){const t=bU(n);return e=>{for(const i of t){if(i==="")break;e=e&&e[i]}return e}}function Zu(n,t){return(eT[t]||(eT[t]=vU(t)))(n)}function m_(n){return n.charAt(0).toUpperCase()+n.slice(1)}const Qu=n=>typeof n<"u",ys=n=>typeof n=="function",nT=(n,t)=>{if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0};function xU(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const Ce=Math.PI,ii=2*Ce,TU=ii+Ce,Gu=Number.POSITIVE_INFINITY,SU=Ce/180,jn=Ce/2,zs=Ce/4,iT=Ce*2/3,I3=Math.log10,Ca=Math.sign;function nl(n,t,e){return Math.abs(n-t)<e}function sT(n){const t=Math.round(n);n=nl(n,t,n/1e3)?t:n;const e=Math.pow(10,Math.floor(I3(n))),i=n/e;return(i<=1?1:i<=2?2:i<=5?5:10)*e}function AU(n){const t=[],e=Math.sqrt(n);let i;for(i=1;i<e;i++)n%i===0&&(t.push(i),t.push(n/i));return e===(e|0)&&t.push(e),t.sort((s,r)=>s-r).pop(),t}function wU(n){return typeof n=="symbol"||typeof n=="object"&&n!==null&&!(Symbol.toPrimitive in n||"toString"in n||"valueOf"in n)}function fl(n){return!wU(n)&&!isNaN(parseFloat(n))&&isFinite(n)}function EU(n,t){const e=Math.round(n);return e-t<=n&&e+t>=n}function RU(n,t,e){let i,s,r;for(i=0,s=n.length;i<s;i++)r=n[i][e],isNaN(r)||(t.min=Math.min(t.min,r),t.max=Math.max(t.max,r))}function Ks(n){return n*(Ce/180)}function CU(n){return n*(180/Ce)}function rT(n){if(!kn(n))return;let t=1,e=0;for(;Math.round(n*t)/t!==n;)t*=10,e++;return e}function MU(n,t){const e=t.x-n.x,i=t.y-n.y,s=Math.sqrt(e*e+i*i);let r=Math.atan2(i,e);return r<-.5*Ce&&(r+=ii),{angle:r,distance:s}}function pg(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function OU(n,t){return(n-t+TU)%ii-Ce}function os(n){return(n%ii+ii)%ii}function P3(n,t,e,i){const s=os(n),r=os(t),l=os(e),c=os(r-s),f=os(l-s),d=os(s-r),p=os(s-l);return s===r||s===l||i&&r===l||c>f&&d<p}function Cn(n,t,e){return Math.max(t,Math.min(e,n))}function IU(n){return Cn(n,-32768,32767)}function Wo(n,t,e,i=1e-6){return n>=Math.min(t,e)-i&&n<=Math.max(t,e)+i}function y_(n,t,e){e=e||(l=>n[l]<t);let i=n.length-1,s=0,r;for(;i-s>1;)r=s+i>>1,e(r)?s=r:i=r;return{lo:s,hi:i}}const Zs=(n,t,e,i)=>y_(n,e,i?s=>{const r=n[s][t];return r<e||r===e&&n[s+1][t]===e}:s=>n[s][t]<e),PU=(n,t,e)=>y_(n,e,i=>n[i][t]>=e);function DU(n,t,e){let i=0,s=n.length;for(;i<s&&n[i]<t;)i++;for(;s>i&&n[s-1]>e;)s--;return i>0||s<n.length?n.slice(i,s):n}const D3=["push","pop","shift","splice","unshift"];function kU(n,t){if(n._chartjs){n._chartjs.listeners.push(t);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),D3.forEach(e=>{const i="_onData"+m_(e),s=n[e];Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value(...r){const l=s.apply(this,r);return n._chartjs.listeners.forEach(c=>{typeof c[i]=="function"&&c[i](...r)}),l}})})}function aT(n,t){const e=n._chartjs;if(!e)return;const i=e.listeners,s=i.indexOf(t);s!==-1&&i.splice(s,1),!(i.length>0)&&(D3.forEach(r=>{delete n[r]}),delete n._chartjs)}function NU(n){const t=new Set(n);return t.size===n.length?n:Array.from(t)}const k3=(function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame})();function N3(n,t){let e=[],i=!1;return function(...s){e=s,i||(i=!0,k3.call(window,()=>{i=!1,n.apply(t,e)}))}}function BU(n,t){let e;return function(...i){return t?(clearTimeout(e),e=setTimeout(n,t,i)):n.apply(this,i),t}}const b_=n=>n==="start"?"left":n==="end"?"right":"center",Le=(n,t,e)=>n==="start"?t:n==="end"?e:(t+e)/2,UU=(n,t,e,i)=>n===(i?"left":"right")?e:n==="center"?(t+e)/2:t;function FU(n,t,e){const i=t.length;let s=0,r=i;if(n._sorted){const{iScale:l,vScale:c,_parsed:f}=n,d=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null,p=l.axis,{min:_,max:y,minDefined:b,maxDefined:x}=l.getUserBounds();if(b){if(s=Math.min(Zs(f,p,_).lo,e?i:Zs(t,p,l.getPixelForValue(_)).lo),d){const T=f.slice(0,s+1).reverse().findIndex(A=>!Jt(A[c.axis]));s-=Math.max(0,T)}s=Cn(s,0,i-1)}if(x){let T=Math.max(Zs(f,l.axis,y,!0).hi+1,e?0:Zs(t,p,l.getPixelForValue(y),!0).hi+1);if(d){const A=f.slice(T-1).findIndex(E=>!Jt(E[c.axis]));T+=Math.max(0,A)}r=Cn(T,s,i)-s}else r=i-s}return{start:s,count:r}}function LU(n){const{xScale:t,yScale:e,_scaleRanges:i}=n,s={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!i)return n._scaleRanges=s,!0;const r=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==e.min||i.ymax!==e.max;return Object.assign(i,s),r}const ou=n=>n===0||n===1,oT=(n,t,e)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-t)*ii/e)),lT=(n,t,e)=>Math.pow(2,-10*n)*Math.sin((n-t)*ii/e)+1,il={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*jn)+1,easeOutSine:n=>Math.sin(n*jn),easeInOutSine:n=>-.5*(Math.cos(Ce*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>ou(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>ou(n)?n:oT(n,.075,.3),easeOutElastic:n=>ou(n)?n:lT(n,.075,.3),easeInOutElastic(n){return ou(n)?n:n<.5?.5*oT(n*2,.1125,.45):.5+.5*lT(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let t=1.70158;return(n/=.5)<1?.5*(n*n*(((t*=1.525)+1)*n-t)):.5*((n-=2)*n*(((t*=1.525)+1)*n+t)+2)},easeInBounce:n=>1-il.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?il.easeInBounce(n*2)*.5:il.easeOutBounce(n*2-1)*.5+.5};function v_(n){if(n&&typeof n=="object"){const t=n.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function cT(n){return v_(n)?n:new cl(n)}function Ap(n){return v_(n)?n:new cl(n).saturate(.5).darken(.1).hexString()}const zU=["x","y","borderWidth","radius","tension"],VU=["color","borderColor","backgroundColor"];function HU(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),n.set("animations",{colors:{type:"color",properties:VU},numbers:{type:"number",properties:zU}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function jU(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const uT=new Map;function WU(n,t){t=t||{};const e=n+JSON.stringify(t);let i=uT.get(e);return i||(i=new Intl.NumberFormat(n,t),uT.set(e,i)),i}function B3(n,t,e){return WU(t,e).format(n)}const $U={values(n){return Re(n)?n:""+n},numeric(n,t,e){if(n===0)return"0";const i=this.chart.options.locale;let s,r=n;if(e.length>1){const d=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(d<1e-4||d>1e15)&&(s="scientific"),r=XU(n,e)}const l=I3(Math.abs(r)),c=isNaN(l)?1:Math.max(Math.min(-1*Math.floor(l),20),0),f={notation:s,minimumFractionDigits:c,maximumFractionDigits:c};return Object.assign(f,this.options.ticks.format),B3(n,i,f)}};function XU(n,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&n!==Math.floor(n)&&(e=n-Math.floor(n)),e}var U3={formatters:$U};function YU(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:U3.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const ur=Object.create(null),gg=Object.create(null);function sl(n,t){if(!t)return n;const e=t.split(".");for(let i=0,s=e.length;i<s;++i){const r=e[i];n=n[r]||(n[r]=Object.create(null))}return n}function wp(n,t,e){return typeof t=="string"?ul(sl(n,t),e):ul(sl(n,""),t)}class qU{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,s)=>Ap(s.backgroundColor),this.hoverBorderColor=(i,s)=>Ap(s.borderColor),this.hoverColor=(i,s)=>Ap(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return wp(this,t,e)}get(t){return sl(this,t)}describe(t,e){return wp(gg,t,e)}override(t,e){return wp(ur,t,e)}route(t,e,i,s){const r=sl(this,t),l=sl(this,i),c="_"+e;Object.defineProperties(r,{[c]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const f=this[c],d=l[s];return Ft(f)?Object.assign({},d,f):It(f,d)},set(f){this[c]=f}}})}apply(t){t.forEach(e=>e(this))}}var he=new qU({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[HU,jU,YU]);function KU(n){return!n||Jt(n.size)||Jt(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function fT(n,t,e,i,s){let r=t[s];return r||(r=t[s]=n.measureText(s).width,e.push(s)),r>i&&(i=r),i}function Vs(n,t,e){const i=n.currentDevicePixelRatio,s=e!==0?Math.max(e/2,.5):0;return Math.round((t-s)*i)/i+s}function hT(n,t){!t&&!n||(t=t||n.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,n.width,n.height),t.restore())}function _g(n,t,e,i){F3(n,t,e,i,null)}function F3(n,t,e,i,s){let r,l,c,f,d,p,_,y;const b=t.pointStyle,x=t.rotation,T=t.radius;let A=(x||0)*SU;if(b&&typeof b=="object"&&(r=b.toString(),r==="[object HTMLImageElement]"||r==="[object HTMLCanvasElement]")){n.save(),n.translate(e,i),n.rotate(A),n.drawImage(b,-b.width/2,-b.height/2,b.width,b.height),n.restore();return}if(!(isNaN(T)||T<=0)){switch(n.beginPath(),b){default:s?n.ellipse(e,i,s/2,T,0,0,ii):n.arc(e,i,T,0,ii),n.closePath();break;case"triangle":p=s?s/2:T,n.moveTo(e+Math.sin(A)*p,i-Math.cos(A)*T),A+=iT,n.lineTo(e+Math.sin(A)*p,i-Math.cos(A)*T),A+=iT,n.lineTo(e+Math.sin(A)*p,i-Math.cos(A)*T),n.closePath();break;case"rectRounded":d=T*.516,f=T-d,l=Math.cos(A+zs)*f,_=Math.cos(A+zs)*(s?s/2-d:f),c=Math.sin(A+zs)*f,y=Math.sin(A+zs)*(s?s/2-d:f),n.arc(e-_,i-c,d,A-Ce,A-jn),n.arc(e+y,i-l,d,A-jn,A),n.arc(e+_,i+c,d,A,A+jn),n.arc(e-y,i+l,d,A+jn,A+Ce),n.closePath();break;case"rect":if(!x){f=Math.SQRT1_2*T,p=s?s/2:f,n.rect(e-p,i-f,2*p,2*f);break}A+=zs;case"rectRot":_=Math.cos(A)*(s?s/2:T),l=Math.cos(A)*T,c=Math.sin(A)*T,y=Math.sin(A)*(s?s/2:T),n.moveTo(e-_,i-c),n.lineTo(e+y,i-l),n.lineTo(e+_,i+c),n.lineTo(e-y,i+l),n.closePath();break;case"crossRot":A+=zs;case"cross":_=Math.cos(A)*(s?s/2:T),l=Math.cos(A)*T,c=Math.sin(A)*T,y=Math.sin(A)*(s?s/2:T),n.moveTo(e-_,i-c),n.lineTo(e+_,i+c),n.moveTo(e+y,i-l),n.lineTo(e-y,i+l);break;case"star":_=Math.cos(A)*(s?s/2:T),l=Math.cos(A)*T,c=Math.sin(A)*T,y=Math.sin(A)*(s?s/2:T),n.moveTo(e-_,i-c),n.lineTo(e+_,i+c),n.moveTo(e+y,i-l),n.lineTo(e-y,i+l),A+=zs,_=Math.cos(A)*(s?s/2:T),l=Math.cos(A)*T,c=Math.sin(A)*T,y=Math.sin(A)*(s?s/2:T),n.moveTo(e-_,i-c),n.lineTo(e+_,i+c),n.moveTo(e+y,i-l),n.lineTo(e-y,i+l);break;case"line":l=s?s/2:Math.cos(A)*T,c=Math.sin(A)*T,n.moveTo(e-l,i-c),n.lineTo(e+l,i+c);break;case"dash":n.moveTo(e,i),n.lineTo(e+Math.cos(A)*(s?s/2:T),i+Math.sin(A)*T);break;case!1:n.closePath();break}n.fill(),t.borderWidth>0&&n.stroke()}}function hl(n,t,e){return e=e||.5,!t||n&&n.x>t.left-e&&n.x<t.right+e&&n.y>t.top-e&&n.y<t.bottom+e}function x_(n,t){n.save(),n.beginPath(),n.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),n.clip()}function T_(n){n.restore()}function ZU(n,t,e,i,s){if(!t)return n.lineTo(e.x,e.y);if(s==="middle"){const r=(t.x+e.x)/2;n.lineTo(r,t.y),n.lineTo(r,e.y)}else s==="after"!=!!i?n.lineTo(t.x,e.y):n.lineTo(e.x,t.y);n.lineTo(e.x,e.y)}function QU(n,t,e,i){if(!t)return n.lineTo(e.x,e.y);n.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?e.cp2x:e.cp1x,i?e.cp2y:e.cp1y,e.x,e.y)}function GU(n,t){t.translation&&n.translate(t.translation[0],t.translation[1]),Jt(t.rotation)||n.rotate(t.rotation),t.color&&(n.fillStyle=t.color),t.textAlign&&(n.textAlign=t.textAlign),t.textBaseline&&(n.textBaseline=t.textBaseline)}function JU(n,t,e,i,s){if(s.strikethrough||s.underline){const r=n.measureText(i),l=t-r.actualBoundingBoxLeft,c=t+r.actualBoundingBoxRight,f=e-r.actualBoundingBoxAscent,d=e+r.actualBoundingBoxDescent,p=s.strikethrough?(f+d)/2:d;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=s.decorationWidth||2,n.moveTo(l,p),n.lineTo(c,p),n.stroke()}}function tF(n,t){const e=n.fillStyle;n.fillStyle=t.color,n.fillRect(t.left,t.top,t.width,t.height),n.fillStyle=e}function dl(n,t,e,i,s,r={}){const l=Re(t)?t:[t],c=r.strokeWidth>0&&r.strokeColor!=="";let f,d;for(n.save(),n.font=s.string,GU(n,r),f=0;f<l.length;++f)d=l[f],r.backdrop&&tF(n,r.backdrop),c&&(r.strokeColor&&(n.strokeStyle=r.strokeColor),Jt(r.strokeWidth)||(n.lineWidth=r.strokeWidth),n.strokeText(d,e,i,r.maxWidth)),n.fillText(d,e,i,r.maxWidth),JU(n,e,i,d,r),i+=Number(s.lineHeight);n.restore()}function mg(n,t){const{x:e,y:i,w:s,h:r,radius:l}=t;n.arc(e+l.topLeft,i+l.topLeft,l.topLeft,1.5*Ce,Ce,!0),n.lineTo(e,i+r-l.bottomLeft),n.arc(e+l.bottomLeft,i+r-l.bottomLeft,l.bottomLeft,Ce,jn,!0),n.lineTo(e+s-l.bottomRight,i+r),n.arc(e+s-l.bottomRight,i+r-l.bottomRight,l.bottomRight,jn,0,!0),n.lineTo(e+s,i+l.topRight),n.arc(e+s-l.topRight,i+l.topRight,l.topRight,0,-jn,!0),n.lineTo(e+l.topLeft,i)}const eF=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,nF=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function iF(n,t){const e=(""+n).match(eF);if(!e||e[1]==="normal")return t*1.2;switch(n=+e[2],e[3]){case"px":return n;case"%":n/=100;break}return t*n}const sF=n=>+n||0;function L3(n,t){const e={},i=Ft(t),s=i?Object.keys(t):t,r=Ft(n)?i?l=>It(n[l],n[t[l]]):l=>n[l]:()=>n;for(const l of s)e[l]=sF(r(l));return e}function rF(n){return L3(n,{top:"y",right:"x",bottom:"y",left:"x"})}function rl(n){return L3(n,["topLeft","topRight","bottomLeft","bottomRight"])}function Nn(n){const t=rF(n);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function ze(n,t){n=n||{},t=t||he.font;let e=It(n.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let i=It(n.style,t.style);i&&!(""+i).match(nF)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const s={family:It(n.family,t.family),lineHeight:iF(It(n.lineHeight,t.lineHeight),e),size:e,style:i,weight:It(n.weight,t.weight),string:""};return s.string=KU(s),s}function lu(n,t,e,i){let s,r,l;for(s=0,r=n.length;s<r;++s)if(l=n[s],l!==void 0&&l!==void 0)return l}function aF(n,t,e){const{min:i,max:s}=n,r=_U(t,(s-i)/2),l=(c,f)=>e&&c===0?0:c+f;return{min:l(i,-Math.abs(r)),max:l(s,r)}}function pr(n,t){return Object.assign(Object.create(n),t)}function S_(n,t=[""],e,i,s=()=>n[0]){const r=e||n;typeof i>"u"&&(i=j3("_fallback",n));const l={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:r,_fallback:i,_getTarget:s,override:c=>S_([c,...n],t,r,i)};return new Proxy(l,{deleteProperty(c,f){return delete c[f],delete c._keys,delete n[0][f],!0},get(c,f){return V3(c,f,()=>pF(f,t,n,c))},getOwnPropertyDescriptor(c,f){return Reflect.getOwnPropertyDescriptor(c._scopes[0],f)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(c,f){return pT(c).includes(f)},ownKeys(c){return pT(c)},set(c,f,d){const p=c._storage||(c._storage=s());return c[f]=p[f]=d,delete c._keys,!0}})}function Ma(n,t,e,i){const s={_cacheable:!1,_proxy:n,_context:t,_subProxy:e,_stack:new Set,_descriptors:z3(n,i),setContext:r=>Ma(n,r,e,i),override:r=>Ma(n.override(r),t,e,i)};return new Proxy(s,{deleteProperty(r,l){return delete r[l],delete n[l],!0},get(r,l,c){return V3(r,l,()=>lF(r,l,c))},getOwnPropertyDescriptor(r,l){return r._descriptors.allKeys?Reflect.has(n,l)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,l)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(r,l){return Reflect.has(n,l)},ownKeys(){return Reflect.ownKeys(n)},set(r,l,c){return n[l]=c,delete r[l],!0}})}function z3(n,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:i=t.indexable,_allKeys:s=t.allKeys}=n;return{allKeys:s,scriptable:e,indexable:i,isScriptable:ys(e)?e:()=>e,isIndexable:ys(i)?i:()=>i}}const oF=(n,t)=>n?n+m_(t):t,A_=(n,t)=>Ft(t)&&n!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function V3(n,t,e){if(Object.prototype.hasOwnProperty.call(n,t)||t==="constructor")return n[t];const i=e();return n[t]=i,i}function lF(n,t,e){const{_proxy:i,_context:s,_subProxy:r,_descriptors:l}=n;let c=i[t];return ys(c)&&l.isScriptable(t)&&(c=cF(t,c,n,e)),Re(c)&&c.length&&(c=uF(t,c,n,l.isIndexable)),A_(t,c)&&(c=Ma(c,s,r&&r[t],l)),c}function cF(n,t,e,i){const{_proxy:s,_context:r,_subProxy:l,_stack:c}=e;if(c.has(n))throw new Error("Recursion detected: "+Array.from(c).join("->")+"->"+n);c.add(n);let f=t(r,l||i);return c.delete(n),A_(n,f)&&(f=w_(s._scopes,s,n,f)),f}function uF(n,t,e,i){const{_proxy:s,_context:r,_subProxy:l,_descriptors:c}=e;if(typeof r.index<"u"&&i(n))return t[r.index%t.length];if(Ft(t[0])){const f=t,d=s._scopes.filter(p=>p!==f);t=[];for(const p of f){const _=w_(d,s,n,p);t.push(Ma(_,r,l&&l[n],c))}}return t}function H3(n,t,e){return ys(n)?n(t,e):n}const fF=(n,t)=>n===!0?t:typeof n=="string"?Zu(t,n):void 0;function hF(n,t,e,i,s){for(const r of t){const l=fF(e,r);if(l){n.add(l);const c=H3(l._fallback,e,s);if(typeof c<"u"&&c!==e&&c!==i)return c}else if(l===!1&&typeof i<"u"&&e!==i)return null}return!1}function w_(n,t,e,i){const s=t._rootScopes,r=H3(t._fallback,e,i),l=[...n,...s],c=new Set;c.add(i);let f=dT(c,l,e,r||e,i);return f===null||typeof r<"u"&&r!==e&&(f=dT(c,l,r,f,i),f===null)?!1:S_(Array.from(c),[""],s,r,()=>dF(t,e,i))}function dT(n,t,e,i,s){for(;e;)e=hF(n,t,e,i,s);return e}function dF(n,t,e){const i=n._getTarget();t in i||(i[t]={});const s=i[t];return Re(s)&&Ft(e)?e:s||{}}function pF(n,t,e,i){let s;for(const r of t)if(s=j3(oF(r,n),e),typeof s<"u")return A_(n,s)?w_(e,i,n,s):s}function j3(n,t){for(const e of t){if(!e)continue;const i=e[n];if(typeof i<"u")return i}}function pT(n){let t=n._keys;return t||(t=n._keys=gF(n._scopes)),t}function gF(n){const t=new Set;for(const e of n)for(const i of Object.keys(e).filter(s=>!s.startsWith("_")))t.add(i);return Array.from(t)}const _F=Number.EPSILON||1e-14,Oa=(n,t)=>t<n.length&&!n[t].skip&&n[t],W3=n=>n==="x"?"y":"x";function mF(n,t,e,i){const s=n.skip?t:n,r=t,l=e.skip?t:e,c=pg(r,s),f=pg(l,r);let d=c/(c+f),p=f/(c+f);d=isNaN(d)?0:d,p=isNaN(p)?0:p;const _=i*d,y=i*p;return{previous:{x:r.x-_*(l.x-s.x),y:r.y-_*(l.y-s.y)},next:{x:r.x+y*(l.x-s.x),y:r.y+y*(l.y-s.y)}}}function yF(n,t,e){const i=n.length;let s,r,l,c,f,d=Oa(n,0);for(let p=0;p<i-1;++p)if(f=d,d=Oa(n,p+1),!(!f||!d)){if(nl(t[p],0,_F)){e[p]=e[p+1]=0;continue}s=e[p]/t[p],r=e[p+1]/t[p],c=Math.pow(s,2)+Math.pow(r,2),!(c<=9)&&(l=3/Math.sqrt(c),e[p]=s*l*t[p],e[p+1]=r*l*t[p])}}function bF(n,t,e="x"){const i=W3(e),s=n.length;let r,l,c,f=Oa(n,0);for(let d=0;d<s;++d){if(l=c,c=f,f=Oa(n,d+1),!c)continue;const p=c[e],_=c[i];l&&(r=(p-l[e])/3,c[`cp1${e}`]=p-r,c[`cp1${i}`]=_-r*t[d]),f&&(r=(f[e]-p)/3,c[`cp2${e}`]=p+r,c[`cp2${i}`]=_+r*t[d])}}function vF(n,t="x"){const e=W3(t),i=n.length,s=Array(i).fill(0),r=Array(i);let l,c,f,d=Oa(n,0);for(l=0;l<i;++l)if(c=f,f=d,d=Oa(n,l+1),!!f){if(d){const p=d[t]-f[t];s[l]=p!==0?(d[e]-f[e])/p:0}r[l]=c?d?Ca(s[l-1])!==Ca(s[l])?0:(s[l-1]+s[l])/2:s[l-1]:s[l]}yF(n,s,r),bF(n,r,t)}function cu(n,t,e){return Math.max(Math.min(n,e),t)}function xF(n,t){let e,i,s,r,l,c=hl(n[0],t);for(e=0,i=n.length;e<i;++e)l=r,r=c,c=e<i-1&&hl(n[e+1],t),r&&(s=n[e],l&&(s.cp1x=cu(s.cp1x,t.left,t.right),s.cp1y=cu(s.cp1y,t.top,t.bottom)),c&&(s.cp2x=cu(s.cp2x,t.left,t.right),s.cp2y=cu(s.cp2y,t.top,t.bottom)))}function TF(n,t,e,i,s){let r,l,c,f;if(t.spanGaps&&(n=n.filter(d=>!d.skip)),t.cubicInterpolationMode==="monotone")vF(n,s);else{let d=i?n[n.length-1]:n[0];for(r=0,l=n.length;r<l;++r)c=n[r],f=mF(d,c,n[Math.min(r+1,l-(i?0:1))%l],t.tension),c.cp1x=f.previous.x,c.cp1y=f.previous.y,c.cp2x=f.next.x,c.cp2y=f.next.y,d=c}t.capBezierPoints&&xF(n,e)}function E_(){return typeof window<"u"&&typeof document<"u"}function R_(n){let t=n.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function Ju(n,t,e){let i;return typeof n=="string"?(i=parseInt(n,10),n.indexOf("%")!==-1&&(i=i/100*t.parentNode[e])):i=n,i}const hf=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function SF(n,t){return hf(n).getPropertyValue(t)}const AF=["top","right","bottom","left"];function ir(n,t,e){const i={};e=e?"-"+e:"";for(let s=0;s<4;s++){const r=AF[s];i[r]=parseFloat(n[t+"-"+r+e])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const wF=(n,t,e)=>(n>0||t>0)&&(!e||!e.shadowRoot);function EF(n,t){const e=n.touches,i=e&&e.length?e[0]:n,{offsetX:s,offsetY:r}=i;let l=!1,c,f;if(wF(s,r,n.target))c=s,f=r;else{const d=t.getBoundingClientRect();c=i.clientX-d.left,f=i.clientY-d.top,l=!0}return{x:c,y:f,box:l}}function js(n,t){if("native"in n)return n;const{canvas:e,currentDevicePixelRatio:i}=t,s=hf(e),r=s.boxSizing==="border-box",l=ir(s,"padding"),c=ir(s,"border","width"),{x:f,y:d,box:p}=EF(n,e),_=l.left+(p&&c.left),y=l.top+(p&&c.top);let{width:b,height:x}=t;return r&&(b-=l.width+c.width,x-=l.height+c.height),{x:Math.round((f-_)/b*e.width/i),y:Math.round((d-y)/x*e.height/i)}}function RF(n,t,e){let i,s;if(t===void 0||e===void 0){const r=n&&R_(n);if(!r)t=n.clientWidth,e=n.clientHeight;else{const l=r.getBoundingClientRect(),c=hf(r),f=ir(c,"border","width"),d=ir(c,"padding");t=l.width-d.width-f.width,e=l.height-d.height-f.height,i=Ju(c.maxWidth,r,"clientWidth"),s=Ju(c.maxHeight,r,"clientHeight")}}return{width:t,height:e,maxWidth:i||Gu,maxHeight:s||Gu}}const ps=n=>Math.round(n*10)/10;function CF(n,t,e,i){const s=hf(n),r=ir(s,"margin"),l=Ju(s.maxWidth,n,"clientWidth")||Gu,c=Ju(s.maxHeight,n,"clientHeight")||Gu,f=RF(n,t,e);let{width:d,height:p}=f;if(s.boxSizing==="content-box"){const y=ir(s,"border","width"),b=ir(s,"padding");d-=b.width+y.width,p-=b.height+y.height}return d=Math.max(0,d-r.width),p=Math.max(0,i?d/i:p-r.height),d=ps(Math.min(d,l,f.maxWidth)),p=ps(Math.min(p,c,f.maxHeight)),d&&!p&&(p=ps(d/2)),(t!==void 0||e!==void 0)&&i&&f.height&&p>f.height&&(p=f.height,d=ps(Math.floor(p*i))),{width:d,height:p}}function gT(n,t,e){const i=t||1,s=ps(n.height*i),r=ps(n.width*i);n.height=ps(n.height),n.width=ps(n.width);const l=n.canvas;return l.style&&(e||!l.style.height&&!l.style.width)&&(l.style.height=`${n.height}px`,l.style.width=`${n.width}px`),n.currentDevicePixelRatio!==i||l.height!==s||l.width!==r?(n.currentDevicePixelRatio=i,l.height=s,l.width=r,n.ctx.setTransform(i,0,0,i,0,0),!0):!1}const MF=(function(){let n=!1;try{const t={get passive(){return n=!0,!1}};E_()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return n})();function _T(n,t){const e=SF(n,t),i=e&&e.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function Ws(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:n.y+e*(t.y-n.y)}}function OF(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:i==="middle"?e<.5?n.y:t.y:i==="after"?e<1?n.y:t.y:e>0?t.y:n.y}}function IF(n,t,e,i){const s={x:n.cp2x,y:n.cp2y},r={x:t.cp1x,y:t.cp1y},l=Ws(n,s,e),c=Ws(s,r,e),f=Ws(r,t,e),d=Ws(l,c,e),p=Ws(c,f,e);return Ws(d,p,e)}const PF=function(n,t){return{x(e){return n+n+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,i){return e-i},leftForLtr(e,i){return e-i}}},DF=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,t){return n+t},leftForLtr(n,t){return n}}};function _a(n,t,e){return n?PF(t,e):DF()}function $3(n,t){let e,i;(t==="ltr"||t==="rtl")&&(e=n.canvas.style,i=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),n.prevTextDirection=i)}function X3(n,t){t!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",t[0],t[1]))}function Y3(n){return n==="angle"?{between:P3,compare:OU,normalize:os}:{between:Wo,compare:(t,e)=>t-e,normalize:t=>t}}function mT({start:n,end:t,count:e,loop:i,style:s}){return{start:n%e,end:t%e,loop:i&&(t-n+1)%e===0,style:s}}function kF(n,t,e){const{property:i,start:s,end:r}=e,{between:l,normalize:c}=Y3(i),f=t.length;let{start:d,end:p,loop:_}=n,y,b;if(_){for(d+=f,p+=f,y=0,b=f;y<b&&l(c(t[d%f][i]),s,r);++y)d--,p--;d%=f,p%=f}return p<d&&(p+=f),{start:d,end:p,loop:_,style:n.style}}function NF(n,t,e){if(!e)return[n];const{property:i,start:s,end:r}=e,l=t.length,{compare:c,between:f,normalize:d}=Y3(i),{start:p,end:_,loop:y,style:b}=kF(n,t,e),x=[];let T=!1,A=null,E,D,C;const O=()=>f(s,C,E)&&c(s,C)!==0,k=()=>c(r,E)===0||f(r,C,E),z=()=>T||O(),Y=()=>!T||k();for(let q=p,G=p;q<=_;++q)D=t[q%l],!D.skip&&(E=d(D[i]),E!==C&&(T=f(E,s,r),A===null&&z()&&(A=c(E,s)===0?q:G),A!==null&&Y()&&(x.push(mT({start:A,end:q,loop:y,count:l,style:b})),A=null),G=q,C=E));return A!==null&&x.push(mT({start:A,end:_,loop:y,count:l,style:b})),x}function BF(n,t){const e=[],i=n.segments;for(let s=0;s<i.length;s++){const r=NF(i[s],n.points,t);r.length&&e.push(...r)}return e}function UF(n,t,e,i){let s=0,r=t-1;if(e&&!i)for(;s<t&&!n[s].skip;)s++;for(;s<t&&n[s].skip;)s++;for(s%=t,e&&(r+=s);r>s&&n[r%t].skip;)r--;return r%=t,{start:s,end:r}}function FF(n,t,e,i){const s=n.length,r=[];let l=t,c=n[t],f;for(f=t+1;f<=e;++f){const d=n[f%s];d.skip||d.stop?c.skip||(i=!1,r.push({start:t%s,end:(f-1)%s,loop:i}),t=l=d.stop?f:null):(l=f,c.skip&&(t=f)),c=d}return l!==null&&r.push({start:t%s,end:l%s,loop:i}),r}function LF(n,t){const e=n.points,i=n.options.spanGaps,s=e.length;if(!s)return[];const r=!!n._loop,{start:l,end:c}=UF(e,s,r,i);if(i===!0)return yT(n,[{start:l,end:c,loop:r}],e,t);const f=c<l?c+s:c,d=!!n._fullLoop&&l===0&&c===s-1;return yT(n,FF(e,l,f,d),e,t)}function yT(n,t,e,i){return!i||!i.setContext||!e?t:zF(n,t,e,i)}function zF(n,t,e,i){const s=n._chart.getContext(),r=bT(n.options),{_datasetIndex:l,options:{spanGaps:c}}=n,f=e.length,d=[];let p=r,_=t[0].start,y=_;function b(x,T,A,E){const D=c?-1:1;if(x!==T){for(x+=f;e[x%f].skip;)x-=D;for(;e[T%f].skip;)T+=D;x%f!==T%f&&(d.push({start:x%f,end:T%f,loop:A,style:E}),p=E,_=T%f)}}for(const x of t){_=c?_:x.start;let T=e[_%f],A;for(y=_+1;y<=x.end;y++){const E=e[y%f];A=bT(i.setContext(pr(s,{type:"segment",p0:T,p1:E,p0DataIndex:(y-1)%f,p1DataIndex:y%f,datasetIndex:l}))),VF(A,p)&&b(_,y-1,x.loop,p),T=E,p=A}_<y-1&&b(_,y-1,x.loop,p)}return d}function bT(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function VF(n,t){if(!t)return!1;const e=[],i=function(s,r){return v_(r)?(e.includes(r)||e.push(r),e.indexOf(r)):r};return JSON.stringify(n,i)!==JSON.stringify(t,i)}function uu(n,t,e){return n.options.clip?n[e]:t[e]}function HF(n,t){const{xScale:e,yScale:i}=n;return e&&i?{left:uu(e,t,"left"),right:uu(e,t,"right"),top:uu(i,t,"top"),bottom:uu(i,t,"bottom")}:t}function jF(n,t){const e=t._clip;if(e.disabled)return!1;const i=HF(t,n.chartArea);return{left:e.left===!1?0:i.left-(e.left===!0?0:e.left),right:e.right===!1?n.width:i.right+(e.right===!0?0:e.right),top:e.top===!1?0:i.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?n.height:i.bottom+(e.bottom===!0?0:e.bottom)}}class WF{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,s){const r=e.listeners[s],l=e.duration;r.forEach(c=>c({chart:t,initial:e.initial,numSteps:l,currentStep:Math.min(i-e.start,l)}))}_refresh(){this._request||(this._running=!0,this._request=k3.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((i,s)=>{if(!i.running||!i.items.length)return;const r=i.items;let l=r.length-1,c=!1,f;for(;l>=0;--l)f=r[l],f._active?(f._total>i.duration&&(i.duration=f._total),f.tick(t),c=!0):(r[l]=r[r.length-1],r.pop());c&&(s.draw(),this._notify(s,i,t,"progress")),r.length||(i.running=!1,this._notify(s,i,t,"complete"),i.initial=!1),e+=r.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((i,s)=>Math.max(i,s._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let s=i.length-1;for(;s>=0;--s)i[s].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Ei=new WF;const vT="transparent",$F={boolean(n,t,e){return e>.5?t:n},color(n,t,e){const i=cT(n||vT),s=i.valid&&cT(t||vT);return s&&s.valid?s.mix(i,e).hexString():t},number(n,t,e){return n+(t-n)*e}};class XF{constructor(t,e,i,s){const r=e[i];s=lu([t.to,s,r,t.from]);const l=lu([t.from,r,s]);this._active=!0,this._fn=t.fn||$F[t.type||typeof l],this._easing=il[t.easing]||il.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=l,this._to=s,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const s=this._target[this._prop],r=i-this._start,l=this._duration-r;this._start=i,this._duration=Math.floor(Math.max(l,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=lu([t.to,e,s,t.from]),this._from=lu([t.from,s,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,s=this._prop,r=this._from,l=this._loop,c=this._to;let f;if(this._active=r!==c&&(l||e<i),!this._active){this._target[s]=c,this._notify(!0);return}if(e<0){this._target[s]=r;return}f=e/i%2,f=l&&f>1?2-f:f,f=this._easing(Math.min(1,Math.max(0,f))),this._target[s]=this._fn(r,c,f)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,i)=>{t.push({res:e,rej:i})})}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let s=0;s<i.length;s++)i[s][e]()}}class q3{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!Ft(t))return;const e=Object.keys(he.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(s=>{const r=t[s];if(!Ft(r))return;const l={};for(const c of e)l[c]=r[c];(Re(r.properties)&&r.properties||[s]).forEach(c=>{(c===s||!i.has(c))&&i.set(c,l)})})}_animateOptions(t,e){const i=e.options,s=qF(t,i);if(!s)return[];const r=this._createAnimations(s,i);return i.$shared&&YF(t.options.$animations,i).then(()=>{t.options=i},()=>{}),r}_createAnimations(t,e){const i=this._properties,s=[],r=t.$animations||(t.$animations={}),l=Object.keys(e),c=Date.now();let f;for(f=l.length-1;f>=0;--f){const d=l[f];if(d.charAt(0)==="$")continue;if(d==="options"){s.push(...this._animateOptions(t,e));continue}const p=e[d];let _=r[d];const y=i.get(d);if(_)if(y&&_.active()){_.update(y,p,c);continue}else _.cancel();if(!y||!y.duration){t[d]=p;continue}r[d]=_=new XF(y,t,d,p),s.push(_)}return s}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const i=this._createAnimations(t,e);if(i.length)return Ei.add(this._chart,i),!0}}function YF(n,t){const e=[],i=Object.keys(t);for(let s=0;s<i.length;s++){const r=n[i[s]];r&&r.active()&&e.push(r.wait())}return Promise.all(e)}function qF(n,t){if(!t)return;let e=n.options;if(!e){n.options=t;return}return e.$shared&&(n.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function xT(n,t){const e=n&&n.options||{},i=e.reverse,s=e.min===void 0?t:0,r=e.max===void 0?t:0;return{start:i?r:s,end:i?s:r}}function KF(n,t,e){if(e===!1)return!1;const i=xT(n,e),s=xT(t,e);return{top:s.end,right:i.end,bottom:s.start,left:i.start}}function ZF(n){let t,e,i,s;return Ft(n)?(t=n.top,e=n.right,i=n.bottom,s=n.left):t=e=i=s=n,{top:t,right:e,bottom:i,left:s,disabled:n===!1}}function K3(n,t){const e=[],i=n._getSortedDatasetMetas(t);let s,r;for(s=0,r=i.length;s<r;++s)e.push(i[s].index);return e}function TT(n,t,e,i={}){const s=n.keys,r=i.mode==="single";let l,c,f,d;if(t===null)return;let p=!1;for(l=0,c=s.length;l<c;++l){if(f=+s[l],f===e){if(p=!0,i.all)continue;break}d=n.values[f],kn(d)&&(r||t===0||Ca(t)===Ca(d))&&(t+=d)}return!p&&!i.all?0:t}function QF(n,t){const{iScale:e,vScale:i}=t,s=e.axis==="x"?"x":"y",r=i.axis==="x"?"x":"y",l=Object.keys(n),c=new Array(l.length);let f,d,p;for(f=0,d=l.length;f<d;++f)p=l[f],c[f]={[s]:p,[r]:n[p]};return c}function Ep(n,t){const e=n&&n.options.stacked;return e||e===void 0&&t.stack!==void 0}function GF(n,t,e){return`${n.id}.${t.id}.${e.stack||e.type}`}function JF(n){const{min:t,max:e,minDefined:i,maxDefined:s}=n.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:s?e:Number.POSITIVE_INFINITY}}function tL(n,t,e){const i=n[t]||(n[t]={});return i[e]||(i[e]={})}function ST(n,t,e,i){for(const s of t.getMatchingVisibleMetas(i).reverse()){const r=n[s.index];if(e&&r>0||!e&&r<0)return s.index}return null}function AT(n,t){const{chart:e,_cachedMeta:i}=n,s=e._stacks||(e._stacks={}),{iScale:r,vScale:l,index:c}=i,f=r.axis,d=l.axis,p=GF(r,l,i),_=t.length;let y;for(let b=0;b<_;++b){const x=t[b],{[f]:T,[d]:A}=x,E=x._stacks||(x._stacks={});y=E[d]=tL(s,p,T),y[c]=A,y._top=ST(y,l,!0,i.type),y._bottom=ST(y,l,!1,i.type);const D=y._visualValues||(y._visualValues={});D[c]=A}}function Rp(n,t){const e=n.scales;return Object.keys(e).filter(i=>e[i].axis===t).shift()}function eL(n,t){return pr(n,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function nL(n,t,e){return pr(n,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function Do(n,t){const e=n.controller.index,i=n.vScale&&n.vScale.axis;if(i){t=t||n._parsed;for(const s of t){const r=s._stacks;if(!r||r[i]===void 0||r[i][e]===void 0)return;delete r[i][e],r[i]._visualValues!==void 0&&r[i]._visualValues[e]!==void 0&&delete r[i]._visualValues[e]}}}const Cp=n=>n==="reset"||n==="none",wT=(n,t)=>t?n:Object.assign({},n),iL=(n,t,e)=>n&&!t.hidden&&t._stacked&&{keys:K3(e,!0),values:null};class Z3{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=Ep(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&Do(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),s=(_,y,b,x)=>_==="x"?y:_==="r"?x:b,r=e.xAxisID=It(i.xAxisID,Rp(t,"x")),l=e.yAxisID=It(i.yAxisID,Rp(t,"y")),c=e.rAxisID=It(i.rAxisID,Rp(t,"r")),f=e.indexAxis,d=e.iAxisID=s(f,r,l,c),p=e.vAxisID=s(f,l,r,c);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(l),e.rScale=this.getScaleForId(c),e.iScale=this.getScaleForId(d),e.vScale=this.getScaleForId(p)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&aT(this._data,this),t._stacked&&Do(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(Ft(e)){const s=this._cachedMeta;this._data=QF(e,s)}else if(i!==e){if(i){aT(i,this);const s=this._cachedMeta;Do(s),s._parsed=[]}e&&Object.isExtensible(e)&&kU(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let s=!1;this._dataCheck();const r=e._stacked;e._stacked=Ep(e.vScale,e),e.stack!==i.stack&&(s=!0,Do(e),e.stack=i.stack),this._resyncElements(t),(s||r!==e._stacked)&&(AT(this,e._parsed),e._stacked=Ep(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:s}=this,{iScale:r,_stacked:l}=i,c=r.axis;let f=t===0&&e===s.length?!0:i._sorted,d=t>0&&i._parsed[t-1],p,_,y;if(this._parsing===!1)i._parsed=s,i._sorted=!0,y=s;else{Re(s[t])?y=this.parseArrayData(i,s,t,e):Ft(s[t])?y=this.parseObjectData(i,s,t,e):y=this.parsePrimitiveData(i,s,t,e);const b=()=>_[c]===null||d&&_[c]<d[c];for(p=0;p<e;++p)i._parsed[p+t]=_=y[p],f&&(b()&&(f=!1),d=_);i._sorted=f}l&&AT(this,y)}parsePrimitiveData(t,e,i,s){const{iScale:r,vScale:l}=t,c=r.axis,f=l.axis,d=r.getLabels(),p=r===l,_=new Array(s);let y,b,x;for(y=0,b=s;y<b;++y)x=y+i,_[y]={[c]:p||r.parse(d[x],x),[f]:l.parse(e[x],x)};return _}parseArrayData(t,e,i,s){const{xScale:r,yScale:l}=t,c=new Array(s);let f,d,p,_;for(f=0,d=s;f<d;++f)p=f+i,_=e[p],c[f]={x:r.parse(_[0],p),y:l.parse(_[1],p)};return c}parseObjectData(t,e,i,s){const{xScale:r,yScale:l}=t,{xAxisKey:c="x",yAxisKey:f="y"}=this._parsing,d=new Array(s);let p,_,y,b;for(p=0,_=s;p<_;++p)y=p+i,b=e[y],d[p]={x:r.parse(Zu(b,c),y),y:l.parse(Zu(b,f),y)};return d}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const s=this.chart,r=this._cachedMeta,l=e[t.axis],c={keys:K3(s,!0),values:e._stacks[t.axis]._visualValues};return TT(c,l,r.index,{mode:i})}updateRangeFromParsed(t,e,i,s){const r=i[e.axis];let l=r===null?NaN:r;const c=s&&i._stacks[e.axis];s&&c&&(s.values=c,l=TT(s,r,this._cachedMeta.index)),t.min=Math.min(t.min,l),t.max=Math.max(t.max,l)}getMinMax(t,e){const i=this._cachedMeta,s=i._parsed,r=i._sorted&&t===i.iScale,l=s.length,c=this._getOtherScale(t),f=iL(e,i,this.chart),d={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:p,max:_}=JF(c);let y,b;function x(){b=s[y];const T=b[c.axis];return!kn(b[t.axis])||p>T||_<T}for(y=0;y<l&&!(!x()&&(this.updateRangeFromParsed(d,t,b,f),r));++y);if(r){for(y=l-1;y>=0;--y)if(!x()){this.updateRangeFromParsed(d,t,b,f);break}}return d}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let s,r,l;for(s=0,r=e.length;s<r;++s)l=e[s][t.axis],kn(l)&&i.push(l);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,s=e.vScale,r=this.getParsed(t);return{label:i?""+i.getLabelForValue(r[i.axis]):"",value:s?""+s.getLabelForValue(r[s.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=ZF(It(this.options.clip,KF(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,s=i.data||[],r=e.chartArea,l=[],c=this._drawStart||0,f=this._drawCount||s.length-c,d=this.options.drawActiveElementsOnTop;let p;for(i.dataset&&i.dataset.draw(t,r,c,f),p=c;p<c+f;++p){const _=s[p];_.hidden||(_.active&&d?l.push(_):_.draw(t,r))}for(p=0;p<l.length;++p)l[p].draw(t,r)}getStyle(t,e){const i=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const s=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const l=this._cachedMeta.data[t];r=l.$context||(l.$context=nL(this.getContext(),t,l)),r.parsed=this.getParsed(t),r.raw=s.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=eL(this.chart.getContext(),this.index)),r.dataset=s,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=i,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const s=e==="active",r=this._cachedDataOpts,l=t+"-"+e,c=r[l],f=this.enableOptionSharing&&Qu(i);if(c)return wT(c,f);const d=this.chart.config,p=d.datasetElementScopeKeys(this._type,t),_=s?[`${t}Hover`,"hover",t,""]:[t,""],y=d.getOptionScopes(this.getDataset(),p),b=Object.keys(he.elements[t]),x=()=>this.getContext(i,s,e),T=d.resolveNamedOptions(y,b,x,_);return T.$shared&&(T.$shared=f,r[l]=Object.freeze(wT(T,f))),T}_resolveAnimations(t,e,i){const s=this.chart,r=this._cachedDataOpts,l=`animation-${e}`,c=r[l];if(c)return c;let f;if(s.options.animation!==!1){const p=this.chart.config,_=p.datasetAnimationScopeKeys(this._type,e),y=p.getOptionScopes(this.getDataset(),_);f=p.createResolver(y,this.getContext(t,i,e))}const d=new q3(s,f&&f.animations);return f&&f._cacheable&&(r[l]=Object.freeze(d)),d}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||Cp(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const i=this.resolveDataElementOptions(t,e),s=this._sharedOptions,r=this.getSharedOptions(i),l=this.includeOptions(e,r)||r!==s;return this.updateSharedOptions(r,e,i),{sharedOptions:r,includeOptions:l}}updateElement(t,e,i,s){Cp(s)?Object.assign(t,i):this._resolveAnimations(e,s).update(t,i)}updateSharedOptions(t,e,i){t&&!Cp(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,s){t.active=s;const r=this.getStyle(e,s);this._resolveAnimations(e,i,s).update(t,{options:!s&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[c,f,d]of this._syncList)this[c](f,d);this._syncList=[];const s=i.length,r=e.length,l=Math.min(r,s);l&&this.parse(0,l),r>s?this._insertElements(s,r-s,t):r<s&&this._removeElements(r,s-r)}_insertElements(t,e,i=!0){const s=this._cachedMeta,r=s.data,l=t+e;let c;const f=d=>{for(d.length+=e,c=d.length-1;c>=l;c--)d[c]=d[c-e]};for(f(r),c=t;c<l;++c)r[c]=new this.dataElementType;this._parsing&&f(s._parsed),this.parse(t,e),i&&this.updateElements(r,t,e,"reset")}updateElements(t,e,i,s){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const s=i._parsed.splice(t,e);i._stacked&&Do(i,s)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,s]=t;this[e](i,s)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}class sL extends Z3{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:s=[],_dataset:r}=e,l=this.chart._animationsDisabled;let{start:c,count:f}=FU(e,s,l);this._drawStart=c,this._drawCount=f,LU(e)&&(c=0,f=s.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!r._decimated,i.points=s;const d=this.resolveDatasetElementOptions(t);this.options.showLine||(d.borderWidth=0),d.segment=this.options.segment,this.updateElement(i,void 0,{animated:!l,options:d},t),this.updateElements(s,c,f,t)}updateElements(t,e,i,s){const r=s==="reset",{iScale:l,vScale:c,_stacked:f,_dataset:d}=this._cachedMeta,{sharedOptions:p,includeOptions:_}=this._getSharedOptions(e,s),y=l.axis,b=c.axis,{spanGaps:x,segment:T}=this.options,A=fl(x)?x:Number.POSITIVE_INFINITY,E=this.chart._animationsDisabled||r||s==="none",D=e+i,C=t.length;let O=e>0&&this.getParsed(e-1);for(let k=0;k<C;++k){const z=t[k],Y=E?z:{};if(k<e||k>=D){Y.skip=!0;continue}const q=this.getParsed(k),G=Jt(q[b]),at=Y[y]=l.getPixelForValue(q[y],k),nt=Y[b]=r||G?c.getBasePixel():c.getPixelForValue(f?this.applyStack(c,q,f):q[b],k);Y.skip=isNaN(at)||isNaN(nt)||G,Y.stop=k>0&&Math.abs(q[y]-O[y])>A,T&&(Y.parsed=q,Y.raw=d.data[k]),_&&(Y.options=p||this.resolveDataElementOptions(k,z.active?"active":s)),E||this.updateElement(z,k,Y,s),O=q}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,s=t.data||[];if(!s.length)return i;const r=s[0].size(this.resolveDataElementOptions(0)),l=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(i,r,l)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}function Hs(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class C_{static override(t){Object.assign(C_.prototype,t)}options;constructor(t){this.options=t||{}}init(){}formats(){return Hs()}parse(){return Hs()}format(){return Hs()}add(){return Hs()}diff(){return Hs()}startOf(){return Hs()}endOf(){return Hs()}}var rL={_date:C_};function aL(n,t,e,i){const{controller:s,data:r,_sorted:l}=n,c=s._cachedMeta.iScale,f=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null;if(c&&t===c.axis&&t!=="r"&&l&&r.length){const d=c._reversePixels?PU:Zs;if(i){if(s._sharedOptions){const p=r[0],_=typeof p.getRange=="function"&&p.getRange(t);if(_){const y=d(r,t,e-_),b=d(r,t,e+_);return{lo:y.lo,hi:b.hi}}}}else{const p=d(r,t,e);if(f){const{vScale:_}=s._cachedMeta,{_parsed:y}=n,b=y.slice(0,p.lo+1).reverse().findIndex(T=>!Jt(T[_.axis]));p.lo-=Math.max(0,b);const x=y.slice(p.hi).findIndex(T=>!Jt(T[_.axis]));p.hi+=Math.max(0,x)}return p}}return{lo:0,hi:r.length-1}}function df(n,t,e,i,s){const r=n.getSortedVisibleDatasetMetas(),l=e[t];for(let c=0,f=r.length;c<f;++c){const{index:d,data:p}=r[c],{lo:_,hi:y}=aL(r[c],t,l,s);for(let b=_;b<=y;++b){const x=p[b];x.skip||i(x,d,b)}}}function oL(n){const t=n.indexOf("x")!==-1,e=n.indexOf("y")!==-1;return function(i,s){const r=t?Math.abs(i.x-s.x):0,l=e?Math.abs(i.y-s.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(l,2))}}function Mp(n,t,e,i,s){const r=[];return!s&&!n.isPointInArea(t)||df(n,e,t,function(c,f,d){!s&&!hl(c,n.chartArea,0)||c.inRange(t.x,t.y,i)&&r.push({element:c,datasetIndex:f,index:d})},!0),r}function lL(n,t,e,i){let s=[];function r(l,c,f){const{startAngle:d,endAngle:p}=l.getProps(["startAngle","endAngle"],i),{angle:_}=MU(l,{x:t.x,y:t.y});P3(_,d,p)&&s.push({element:l,datasetIndex:c,index:f})}return df(n,e,t,r),s}function cL(n,t,e,i,s,r){let l=[];const c=oL(e);let f=Number.POSITIVE_INFINITY;function d(p,_,y){const b=p.inRange(t.x,t.y,s);if(i&&!b)return;const x=p.getCenterPoint(s);if(!(!!r||n.isPointInArea(x))&&!b)return;const A=c(t,x);A<f?(l=[{element:p,datasetIndex:_,index:y}],f=A):A===f&&l.push({element:p,datasetIndex:_,index:y})}return df(n,e,t,d),l}function Op(n,t,e,i,s,r){return!r&&!n.isPointInArea(t)?[]:e==="r"&&!i?lL(n,t,e,s):cL(n,t,e,i,s,r)}function ET(n,t,e,i,s){const r=[],l=e==="x"?"inXRange":"inYRange";let c=!1;return df(n,e,t,(f,d,p)=>{f[l]&&f[l](t[e],s)&&(r.push({element:f,datasetIndex:d,index:p}),c=c||f.inRange(t.x,t.y,s))}),i&&!c?[]:r}var uL={modes:{index(n,t,e,i){const s=js(t,n),r=e.axis||"x",l=e.includeInvisible||!1,c=e.intersect?Mp(n,s,r,i,l):Op(n,s,r,!1,i,l),f=[];return c.length?(n.getSortedVisibleDatasetMetas().forEach(d=>{const p=c[0].index,_=d.data[p];_&&!_.skip&&f.push({element:_,datasetIndex:d.index,index:p})}),f):[]},dataset(n,t,e,i){const s=js(t,n),r=e.axis||"xy",l=e.includeInvisible||!1;let c=e.intersect?Mp(n,s,r,i,l):Op(n,s,r,!1,i,l);if(c.length>0){const f=c[0].datasetIndex,d=n.getDatasetMeta(f).data;c=[];for(let p=0;p<d.length;++p)c.push({element:d[p],datasetIndex:f,index:p})}return c},point(n,t,e,i){const s=js(t,n),r=e.axis||"xy",l=e.includeInvisible||!1;return Mp(n,s,r,i,l)},nearest(n,t,e,i){const s=js(t,n),r=e.axis||"xy",l=e.includeInvisible||!1;return Op(n,s,r,e.intersect,i,l)},x(n,t,e,i){const s=js(t,n);return ET(n,s,"x",e.intersect,i)},y(n,t,e,i){const s=js(t,n);return ET(n,s,"y",e.intersect,i)}}};const Q3=["left","top","right","bottom"];function ko(n,t){return n.filter(e=>e.pos===t)}function RT(n,t){return n.filter(e=>Q3.indexOf(e.pos)===-1&&e.box.axis===t)}function No(n,t){return n.sort((e,i)=>{const s=t?i:e,r=t?e:i;return s.weight===r.weight?s.index-r.index:s.weight-r.weight})}function fL(n){const t=[];let e,i,s,r,l,c;for(e=0,i=(n||[]).length;e<i;++e)s=n[e],{position:r,options:{stack:l,stackWeight:c=1}}=s,t.push({index:e,box:s,pos:r,horizontal:s.isHorizontal(),weight:s.weight,stack:l&&r+l,stackWeight:c});return t}function hL(n){const t={};for(const e of n){const{stack:i,pos:s,stackWeight:r}=e;if(!i||!Q3.includes(s))continue;const l=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});l.count++,l.weight+=r}return t}function dL(n,t){const e=hL(n),{vBoxMaxWidth:i,hBoxMaxHeight:s}=t;let r,l,c;for(r=0,l=n.length;r<l;++r){c=n[r];const{fullSize:f}=c.box,d=e[c.stack],p=d&&c.stackWeight/d.weight;c.horizontal?(c.width=p?p*i:f&&t.availableWidth,c.height=s):(c.width=i,c.height=p?p*s:f&&t.availableHeight)}return e}function pL(n){const t=fL(n),e=No(t.filter(d=>d.box.fullSize),!0),i=No(ko(t,"left"),!0),s=No(ko(t,"right")),r=No(ko(t,"top"),!0),l=No(ko(t,"bottom")),c=RT(t,"x"),f=RT(t,"y");return{fullSize:e,leftAndTop:i.concat(r),rightAndBottom:s.concat(f).concat(l).concat(c),chartArea:ko(t,"chartArea"),vertical:i.concat(s).concat(f),horizontal:r.concat(l).concat(c)}}function CT(n,t,e,i){return Math.max(n[e],t[e])+Math.max(n[i],t[i])}function G3(n,t){n.top=Math.max(n.top,t.top),n.left=Math.max(n.left,t.left),n.bottom=Math.max(n.bottom,t.bottom),n.right=Math.max(n.right,t.right)}function gL(n,t,e,i){const{pos:s,box:r}=e,l=n.maxPadding;if(!Ft(s)){e.size&&(n[s]-=e.size);const _=i[e.stack]||{size:0,count:1};_.size=Math.max(_.size,e.horizontal?r.height:r.width),e.size=_.size/_.count,n[s]+=e.size}r.getPadding&&G3(l,r.getPadding());const c=Math.max(0,t.outerWidth-CT(l,n,"left","right")),f=Math.max(0,t.outerHeight-CT(l,n,"top","bottom")),d=c!==n.w,p=f!==n.h;return n.w=c,n.h=f,e.horizontal?{same:d,other:p}:{same:p,other:d}}function _L(n){const t=n.maxPadding;function e(i){const s=Math.max(t[i]-n[i],0);return n[i]+=s,s}n.y+=e("top"),n.x+=e("left"),e("right"),e("bottom")}function mL(n,t){const e=t.maxPadding;function i(s){const r={left:0,top:0,right:0,bottom:0};return s.forEach(l=>{r[l]=Math.max(t[l],e[l])}),r}return i(n?["left","right"]:["top","bottom"])}function $o(n,t,e,i){const s=[];let r,l,c,f,d,p;for(r=0,l=n.length,d=0;r<l;++r){c=n[r],f=c.box,f.update(c.width||t.w,c.height||t.h,mL(c.horizontal,t));const{same:_,other:y}=gL(t,e,c,i);d|=_&&s.length,p=p||y,f.fullSize||s.push(c)}return d&&$o(s,t,e,i)||p}function fu(n,t,e,i,s){n.top=e,n.left=t,n.right=t+i,n.bottom=e+s,n.width=i,n.height=s}function MT(n,t,e,i){const s=e.padding;let{x:r,y:l}=t;for(const c of n){const f=c.box,d=i[c.stack]||{placed:0,weight:1},p=c.stackWeight/d.weight||1;if(c.horizontal){const _=t.w*p,y=d.size||f.height;Qu(d.start)&&(l=d.start),f.fullSize?fu(f,s.left,l,e.outerWidth-s.right-s.left,y):fu(f,t.left+d.placed,l,_,y),d.start=l,d.placed+=_,l=f.bottom}else{const _=t.h*p,y=d.size||f.width;Qu(d.start)&&(r=d.start),f.fullSize?fu(f,r,s.top,y,e.outerHeight-s.bottom-s.top):fu(f,r,t.top+d.placed,y,_),d.start=r,d.placed+=_,r=f.right}}t.x=r,t.y=l}var Mn={addBox(n,t){n.boxes||(n.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},n.boxes.push(t)},removeBox(n,t){const e=n.boxes?n.boxes.indexOf(t):-1;e!==-1&&n.boxes.splice(e,1)},configure(n,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(n,t,e,i){if(!n)return;const s=Nn(n.options.layout.padding),r=Math.max(t-s.width,0),l=Math.max(e-s.height,0),c=pL(n.boxes),f=c.vertical,d=c.horizontal;jt(n.boxes,T=>{typeof T.beforeLayout=="function"&&T.beforeLayout()});const p=f.reduce((T,A)=>A.box.options&&A.box.options.display===!1?T:T+1,0)||1,_=Object.freeze({outerWidth:t,outerHeight:e,padding:s,availableWidth:r,availableHeight:l,vBoxMaxWidth:r/2/p,hBoxMaxHeight:l/2}),y=Object.assign({},s);G3(y,Nn(i));const b=Object.assign({maxPadding:y,w:r,h:l,x:s.left,y:s.top},s),x=dL(f.concat(d),_);$o(c.fullSize,b,_,x),$o(f,b,_,x),$o(d,b,_,x)&&$o(f,b,_,x),_L(b),MT(c.leftAndTop,b,_,x),b.x+=b.w,b.y+=b.h,MT(c.rightAndBottom,b,_,x),n.chartArea={left:b.left,top:b.top,right:b.left+b.w,bottom:b.top+b.h,height:b.h,width:b.w},jt(c.chartArea,T=>{const A=T.box;Object.assign(A,n.chartArea),A.update(b.w,b.h,{left:0,top:0,right:0,bottom:0})})}};class J3{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,s){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,s?Math.floor(e/s):i)}}isAttached(t){return!0}updateConfig(t){}}class yL extends J3{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Au="$chartjs",bL={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},OT=n=>n===null||n==="";function vL(n,t){const e=n.style,i=n.getAttribute("height"),s=n.getAttribute("width");if(n[Au]={initial:{height:i,width:s,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",OT(s)){const r=_T(n,"width");r!==void 0&&(n.width=r)}if(OT(i))if(n.style.height==="")n.height=n.width/(t||2);else{const r=_T(n,"height");r!==void 0&&(n.height=r)}return n}const tS=MF?{passive:!0}:!1;function xL(n,t,e){n&&n.addEventListener(t,e,tS)}function TL(n,t,e){n&&n.canvas&&n.canvas.removeEventListener(t,e,tS)}function SL(n,t){const e=bL[n.type]||n.type,{x:i,y:s}=js(n,t);return{type:e,chart:t,native:n,x:i!==void 0?i:null,y:s!==void 0?s:null}}function tf(n,t){for(const e of n)if(e===t||e.contains(t))return!0}function AL(n,t,e){const i=n.canvas,s=new MutationObserver(r=>{let l=!1;for(const c of r)l=l||tf(c.addedNodes,i),l=l&&!tf(c.removedNodes,i);l&&e()});return s.observe(document,{childList:!0,subtree:!0}),s}function wL(n,t,e){const i=n.canvas,s=new MutationObserver(r=>{let l=!1;for(const c of r)l=l||tf(c.removedNodes,i),l=l&&!tf(c.addedNodes,i);l&&e()});return s.observe(document,{childList:!0,subtree:!0}),s}const pl=new Map;let IT=0;function eS(){const n=window.devicePixelRatio;n!==IT&&(IT=n,pl.forEach((t,e)=>{e.currentDevicePixelRatio!==n&&t()}))}function EL(n,t){pl.size||window.addEventListener("resize",eS),pl.set(n,t)}function RL(n){pl.delete(n),pl.size||window.removeEventListener("resize",eS)}function CL(n,t,e){const i=n.canvas,s=i&&R_(i);if(!s)return;const r=N3((c,f)=>{const d=s.clientWidth;e(c,f),d<s.clientWidth&&e()},window),l=new ResizeObserver(c=>{const f=c[0],d=f.contentRect.width,p=f.contentRect.height;d===0&&p===0||r(d,p)});return l.observe(s),EL(n,r),l}function Ip(n,t,e){e&&e.disconnect(),t==="resize"&&RL(n)}function ML(n,t,e){const i=n.canvas,s=N3(r=>{n.ctx!==null&&e(SL(r,n))},n);return xL(i,t,s),s}class OL extends J3{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(vL(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e[Au])return!1;const i=e[Au].initial;["height","width"].forEach(r=>{const l=i[r];Jt(l)?e.removeAttribute(r):e.setAttribute(r,l)});const s=i.style||{};return Object.keys(s).forEach(r=>{e.style[r]=s[r]}),e.width=e.width,delete e[Au],!0}addEventListener(t,e,i){this.removeEventListener(t,e);const s=t.$proxies||(t.$proxies={}),l={attach:AL,detach:wL,resize:CL}[e]||ML;s[e]=l(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),s=i[e];if(!s)return;({attach:Ip,detach:Ip,resize:Ip}[e]||TL)(t,e,s),i[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,s){return CF(t,e,i,s)}isAttached(t){const e=t&&R_(t);return!!(e&&e.isConnected)}}function IL(n){return!E_()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?yL:OL}class gr{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return fl(this.x)&&fl(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const s={};return t.forEach(r=>{s[r]=i[r]&&i[r].active()?i[r]._to:this[r]}),s}}function PL(n,t){const e=n.options.ticks,i=DL(n),s=Math.min(e.maxTicksLimit||i,i),r=e.major.enabled?NL(t):[],l=r.length,c=r[0],f=r[l-1],d=[];if(l>s)return BL(t,d,r,l/s),d;const p=kL(r,t,s);if(l>0){let _,y;const b=l>1?Math.round((f-c)/(l-1)):null;for(hu(t,d,p,Jt(b)?0:c-b,c),_=0,y=l-1;_<y;_++)hu(t,d,p,r[_],r[_+1]);return hu(t,d,p,f,Jt(b)?t.length:f+b),d}return hu(t,d,p),d}function DL(n){const t=n.options.offset,e=n._tickSize(),i=n._length/e+(t?0:1),s=n._maxLength/e;return Math.floor(Math.min(i,s))}function kL(n,t,e){const i=UL(n),s=t.length/e;if(!i)return Math.max(s,1);const r=AU(i);for(let l=0,c=r.length-1;l<c;l++){const f=r[l];if(f>s)return f}return Math.max(s,1)}function NL(n){const t=[];let e,i;for(e=0,i=n.length;e<i;e++)n[e].major&&t.push(e);return t}function BL(n,t,e,i){let s=0,r=e[0],l;for(i=Math.ceil(i),l=0;l<n.length;l++)l===r&&(t.push(n[l]),s++,r=e[s*i])}function hu(n,t,e,i,s){const r=It(i,0),l=Math.min(It(s,n.length),n.length);let c=0,f,d,p;for(e=Math.ceil(e),s&&(f=s-i,e=f/Math.floor(f/e)),p=r;p<0;)c++,p=Math.round(r+c*e);for(d=Math.max(r,0);d<l;d++)d===p&&(t.push(n[d]),c++,p=Math.round(r+c*e))}function UL(n){const t=n.length;let e,i;if(t<2)return!1;for(i=n[0],e=1;e<t;++e)if(n[e]-n[e-1]!==i)return!1;return i}const FL=n=>n==="left"?"right":n==="right"?"left":n,PT=(n,t,e)=>t==="top"||t==="left"?n[t]+e:n[t]-e,DT=(n,t)=>Math.min(t||n,n);function kT(n,t){const e=[],i=n.length/t,s=n.length;let r=0;for(;r<s;r+=i)e.push(n[Math.floor(r)]);return e}function LL(n,t,e){const i=n.ticks.length,s=Math.min(t,i-1),r=n._startPixel,l=n._endPixel,c=1e-6;let f=n.getPixelForTick(s),d;if(!(e&&(i===1?d=Math.max(f-r,l-f):t===0?d=(n.getPixelForTick(1)-f)/2:d=(f-n.getPixelForTick(s-1))/2,f+=s<t?d:-d,f<r-c||f>l+c)))return f}function zL(n,t){jt(n,e=>{const i=e.gc,s=i.length/2;let r;if(s>t){for(r=0;r<s;++r)delete e.data[i[r]];i.splice(0,s)}})}function Bo(n){return n.drawTicks?n.tickLength:0}function NT(n,t){if(!n.display)return 0;const e=ze(n.font,t),i=Nn(n.padding);return(Re(n.text)?n.text.length:1)*e.lineHeight+i.height}function VL(n,t){return pr(n,{scale:t,type:"scale"})}function HL(n,t,e){return pr(n,{tick:e,index:t,type:"tick"})}function jL(n,t,e){let i=b_(n);return(e&&t!=="right"||!e&&t==="right")&&(i=FL(i)),i}function WL(n,t,e,i){const{top:s,left:r,bottom:l,right:c,chart:f}=n,{chartArea:d,scales:p}=f;let _=0,y,b,x;const T=l-s,A=c-r;if(n.isHorizontal()){if(b=Le(i,r,c),Ft(e)){const E=Object.keys(e)[0],D=e[E];x=p[E].getPixelForValue(D)+T-t}else e==="center"?x=(d.bottom+d.top)/2+T-t:x=PT(n,e,t);y=c-r}else{if(Ft(e)){const E=Object.keys(e)[0],D=e[E];b=p[E].getPixelForValue(D)-A+t}else e==="center"?b=(d.left+d.right)/2-A+t:b=PT(n,e,t);x=Le(i,l,s),_=e==="left"?-jn:jn}return{titleX:b,titleY:x,maxWidth:y,rotation:_}}class Pa extends gr{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:s}=this;return t=Qn(t,Number.POSITIVE_INFINITY),e=Qn(e,Number.NEGATIVE_INFINITY),i=Qn(i,Number.POSITIVE_INFINITY),s=Qn(s,Number.NEGATIVE_INFINITY),{min:Qn(t,i),max:Qn(e,s),minDefined:kn(t),maxDefined:kn(e)}}getMinMax(t){let{min:e,max:i,minDefined:s,maxDefined:r}=this.getUserBounds(),l;if(s&&r)return{min:e,max:i};const c=this.getMatchingVisibleMetas();for(let f=0,d=c.length;f<d;++f)l=c[f].controller.getMinMax(this,t),s||(e=Math.min(e,l.min)),r||(i=Math.max(i,l.max));return e=r&&e>i?i:e,i=s&&e>i?e:i,{min:Qn(e,Qn(i,e)),max:Qn(i,Qn(e,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){ne(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:s,grace:r,ticks:l}=this.options,c=l.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=aF(this,r,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const f=c<this.ticks.length;this._convertTicksToLabels(f?kT(this.ticks,c):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),l.display&&(l.autoSkip||l.source==="auto")&&(this.ticks=PL(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),f&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,i;this.isHorizontal()?(e=this.left,i=this.right):(e=this.top,i=this.bottom,t=!t),this._startPixel=e,this._endPixel=i,this._reversePixels=t,this._length=i-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){ne(this.options.afterUpdate,[this])}beforeSetDimensions(){ne(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){ne(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),ne(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){ne(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,s,r;for(i=0,s=t.length;i<s;i++)r=t[i],r.label=ne(e.callback,[r.value,i,t],this)}afterTickToLabelConversion(){ne(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){ne(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=DT(this.ticks.length,t.ticks.maxTicksLimit),s=e.minRotation||0,r=e.maxRotation;let l=s,c,f,d;if(!this._isVisible()||!e.display||s>=r||i<=1||!this.isHorizontal()){this.labelRotation=s;return}const p=this._getLabelSizes(),_=p.widest.width,y=p.highest.height,b=Cn(this.chart.width-_,0,this.maxWidth);c=t.offset?this.maxWidth/i:b/(i-1),_+6>c&&(c=b/(i-(t.offset?.5:1)),f=this.maxHeight-Bo(t.grid)-e.padding-NT(t.title,this.chart.options.font),d=Math.sqrt(_*_+y*y),l=CU(Math.min(Math.asin(Cn((p.highest.height+6)/c,-1,1)),Math.asin(Cn(f/d,-1,1))-Math.asin(Cn(y/d,-1,1)))),l=Math.max(s,Math.min(r,l))),this.labelRotation=l}afterCalculateLabelRotation(){ne(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){ne(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:s,grid:r}}=this,l=this._isVisible(),c=this.isHorizontal();if(l){const f=NT(s,e.options.font);if(c?(t.width=this.maxWidth,t.height=Bo(r)+f):(t.height=this.maxHeight,t.width=Bo(r)+f),i.display&&this.ticks.length){const{first:d,last:p,widest:_,highest:y}=this._getLabelSizes(),b=i.padding*2,x=Ks(this.labelRotation),T=Math.cos(x),A=Math.sin(x);if(c){const E=i.mirror?0:A*_.width+T*y.height;t.height=Math.min(this.maxHeight,t.height+E+b)}else{const E=i.mirror?0:T*_.width+A*y.height;t.width=Math.min(this.maxWidth,t.width+E+b)}this._calculatePadding(d,p,A,T)}}this._handleMargins(),c?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,s){const{ticks:{align:r,padding:l},position:c}=this.options,f=this.labelRotation!==0,d=c!=="top"&&this.axis==="x";if(this.isHorizontal()){const p=this.getPixelForTick(0)-this.left,_=this.right-this.getPixelForTick(this.ticks.length-1);let y=0,b=0;f?d?(y=s*t.width,b=i*e.height):(y=i*t.height,b=s*e.width):r==="start"?b=e.width:r==="end"?y=t.width:r!=="inner"&&(y=t.width/2,b=e.width/2),this.paddingLeft=Math.max((y-p+l)*this.width/(this.width-p),0),this.paddingRight=Math.max((b-_+l)*this.width/(this.width-_),0)}else{let p=e.height/2,_=t.height/2;r==="start"?(p=0,_=t.height):r==="end"&&(p=e.height,_=0),this.paddingTop=p+l,this.paddingBottom=_+l}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){ne(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,i;for(e=0,i=t.length;e<i;e++)Jt(t[e].label)&&(t.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=kT(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,i){const{ctx:s,_longestTextCache:r}=this,l=[],c=[],f=Math.floor(e/DT(e,i));let d=0,p=0,_,y,b,x,T,A,E,D,C,O,k;for(_=0;_<e;_+=f){if(x=t[_].label,T=this._resolveTickFontOptions(_),s.font=A=T.string,E=r[A]=r[A]||{data:{},gc:[]},D=T.lineHeight,C=O=0,!Jt(x)&&!Re(x))C=fT(s,E.data,E.gc,C,x),O=D;else if(Re(x))for(y=0,b=x.length;y<b;++y)k=x[y],!Jt(k)&&!Re(k)&&(C=fT(s,E.data,E.gc,C,k),O+=D);l.push(C),c.push(O),d=Math.max(C,d),p=Math.max(O,p)}zL(r,e);const z=l.indexOf(d),Y=c.indexOf(p),q=G=>({width:l[G]||0,height:c[G]||0});return{first:q(0),last:q(e-1),widest:q(z),highest:q(Y),widths:l,heights:c}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return IU(this._alignToPixels?Vs(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=HL(this.getContext(),t,i))}return this.$context||(this.$context=VL(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=Ks(this.labelRotation),i=Math.abs(Math.cos(e)),s=Math.abs(Math.sin(e)),r=this._getLabelSizes(),l=t.autoSkipPadding||0,c=r?r.widest.width+l:0,f=r?r.highest.height+l:0;return this.isHorizontal()?f*i>c*s?c/i:f/s:f*s<c*i?f/i:c/s}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,s=this.options,{grid:r,position:l,border:c}=s,f=r.offset,d=this.isHorizontal(),_=this.ticks.length+(f?1:0),y=Bo(r),b=[],x=c.setContext(this.getContext()),T=x.display?x.width:0,A=T/2,E=function($){return Vs(i,$,T)};let D,C,O,k,z,Y,q,G,at,nt,ot,xt;if(l==="top")D=E(this.bottom),Y=this.bottom-y,G=D-A,nt=E(t.top)+A,xt=t.bottom;else if(l==="bottom")D=E(this.top),nt=t.top,xt=E(t.bottom)-A,Y=D+A,G=this.top+y;else if(l==="left")D=E(this.right),z=this.right-y,q=D-A,at=E(t.left)+A,ot=t.right;else if(l==="right")D=E(this.left),at=t.left,ot=E(t.right)-A,z=D+A,q=this.left+y;else if(e==="x"){if(l==="center")D=E((t.top+t.bottom)/2+.5);else if(Ft(l)){const $=Object.keys(l)[0],it=l[$];D=E(this.chart.scales[$].getPixelForValue(it))}nt=t.top,xt=t.bottom,Y=D+A,G=Y+y}else if(e==="y"){if(l==="center")D=E((t.left+t.right)/2);else if(Ft(l)){const $=Object.keys(l)[0],it=l[$];D=E(this.chart.scales[$].getPixelForValue(it))}z=D-A,q=z-y,at=t.left,ot=t.right}const dt=It(s.ticks.maxTicksLimit,_),mt=Math.max(1,Math.ceil(_/dt));for(C=0;C<_;C+=mt){const $=this.getContext(C),it=r.setContext($),ht=c.setContext($),Pt=it.lineWidth,Ot=it.color,P=ht.dash||[],Q=ht.dashOffset,st=it.tickWidth,lt=it.tickColor,_t=it.tickBorderDash||[],yt=it.tickBorderDashOffset;O=LL(this,C,f),O!==void 0&&(k=Vs(i,O,Pt),d?z=q=at=ot=k:Y=G=nt=xt=k,b.push({tx1:z,ty1:Y,tx2:q,ty2:G,x1:at,y1:nt,x2:ot,y2:xt,width:Pt,color:Ot,borderDash:P,borderDashOffset:Q,tickWidth:st,tickColor:lt,tickBorderDash:_t,tickBorderDashOffset:yt}))}return this._ticksLength=_,this._borderValue=D,b}_computeLabelItems(t){const e=this.axis,i=this.options,{position:s,ticks:r}=i,l=this.isHorizontal(),c=this.ticks,{align:f,crossAlign:d,padding:p,mirror:_}=r,y=Bo(i.grid),b=y+p,x=_?-p:b,T=-Ks(this.labelRotation),A=[];let E,D,C,O,k,z,Y,q,G,at,nt,ot,xt="middle";if(s==="top")z=this.bottom-x,Y=this._getXAxisLabelAlignment();else if(s==="bottom")z=this.top+x,Y=this._getXAxisLabelAlignment();else if(s==="left"){const mt=this._getYAxisLabelAlignment(y);Y=mt.textAlign,k=mt.x}else if(s==="right"){const mt=this._getYAxisLabelAlignment(y);Y=mt.textAlign,k=mt.x}else if(e==="x"){if(s==="center")z=(t.top+t.bottom)/2+b;else if(Ft(s)){const mt=Object.keys(s)[0],$=s[mt];z=this.chart.scales[mt].getPixelForValue($)+b}Y=this._getXAxisLabelAlignment()}else if(e==="y"){if(s==="center")k=(t.left+t.right)/2-b;else if(Ft(s)){const mt=Object.keys(s)[0],$=s[mt];k=this.chart.scales[mt].getPixelForValue($)}Y=this._getYAxisLabelAlignment(y).textAlign}e==="y"&&(f==="start"?xt="top":f==="end"&&(xt="bottom"));const dt=this._getLabelSizes();for(E=0,D=c.length;E<D;++E){C=c[E],O=C.label;const mt=r.setContext(this.getContext(E));q=this.getPixelForTick(E)+r.labelOffset,G=this._resolveTickFontOptions(E),at=G.lineHeight,nt=Re(O)?O.length:1;const $=nt/2,it=mt.color,ht=mt.textStrokeColor,Pt=mt.textStrokeWidth;let Ot=Y;l?(k=q,Y==="inner"&&(E===D-1?Ot=this.options.reverse?"left":"right":E===0?Ot=this.options.reverse?"right":"left":Ot="center"),s==="top"?d==="near"||T!==0?ot=-nt*at+at/2:d==="center"?ot=-dt.highest.height/2-$*at+at:ot=-dt.highest.height+at/2:d==="near"||T!==0?ot=at/2:d==="center"?ot=dt.highest.height/2-$*at:ot=dt.highest.height-nt*at,_&&(ot*=-1),T!==0&&!mt.showLabelBackdrop&&(k+=at/2*Math.sin(T))):(z=q,ot=(1-nt)*at/2);let P;if(mt.showLabelBackdrop){const Q=Nn(mt.backdropPadding),st=dt.heights[E],lt=dt.widths[E];let _t=ot-Q.top,yt=0-Q.left;switch(xt){case"middle":_t-=st/2;break;case"bottom":_t-=st;break}switch(Y){case"center":yt-=lt/2;break;case"right":yt-=lt;break;case"inner":E===D-1?yt-=lt:E>0&&(yt-=lt/2);break}P={left:yt,top:_t,width:lt+Q.width,height:st+Q.height,color:mt.backdropColor}}A.push({label:O,font:G,textOffset:ot,options:{rotation:T,color:it,strokeColor:ht,strokeWidth:Pt,textAlign:Ot,textBaseline:xt,translation:[k,z],backdrop:P}})}return A}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-Ks(this.labelRotation))return t==="top"?"left":"right";let s="center";return e.align==="start"?s="left":e.align==="end"?s="right":e.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:s,padding:r}}=this.options,l=this._getLabelSizes(),c=t+r,f=l.widest.width;let d,p;return e==="left"?s?(p=this.right+r,i==="near"?d="left":i==="center"?(d="center",p+=f/2):(d="right",p+=f)):(p=this.right-c,i==="near"?d="right":i==="center"?(d="center",p-=f/2):(d="left",p=this.left)):e==="right"?s?(p=this.left+r,i==="near"?d="right":i==="center"?(d="center",p-=f/2):(d="left",p-=f)):(p=this.left+c,i==="near"?d="left":i==="center"?(d="center",p+=f/2):(d="right",p=this.right)):d="right",{textAlign:d,x:p}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:s,width:r,height:l}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,s,r,l),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const s=this.ticks.findIndex(r=>r.value===t);return s>=0?e.setContext(this.getContext(s)).lineWidth:0}drawGrid(t){const e=this.options.grid,i=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,l;const c=(f,d,p)=>{!p.width||!p.color||(i.save(),i.lineWidth=p.width,i.strokeStyle=p.color,i.setLineDash(p.borderDash||[]),i.lineDashOffset=p.borderDashOffset,i.beginPath(),i.moveTo(f.x,f.y),i.lineTo(d.x,d.y),i.stroke(),i.restore())};if(e.display)for(r=0,l=s.length;r<l;++r){const f=s[r];e.drawOnChartArea&&c({x:f.x1,y:f.y1},{x:f.x2,y:f.y2},f),e.drawTicks&&c({x:f.tx1,y:f.ty1},{x:f.tx2,y:f.ty2},{color:f.tickColor,width:f.tickWidth,borderDash:f.tickBorderDash,borderDashOffset:f.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:i,grid:s}}=this,r=i.setContext(this.getContext()),l=i.display?r.width:0;if(!l)return;const c=s.setContext(this.getContext(0)).lineWidth,f=this._borderValue;let d,p,_,y;this.isHorizontal()?(d=Vs(t,this.left,l)-l/2,p=Vs(t,this.right,c)+c/2,_=y=f):(_=Vs(t,this.top,l)-l/2,y=Vs(t,this.bottom,c)+c/2,d=p=f),e.save(),e.lineWidth=r.width,e.strokeStyle=r.color,e.beginPath(),e.moveTo(d,_),e.lineTo(p,y),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,s=this._computeLabelArea();s&&x_(i,s);const r=this.getLabelItems(t);for(const l of r){const c=l.options,f=l.font,d=l.label,p=l.textOffset;dl(i,d,0,p,f,c)}s&&T_(i)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:s}}=this;if(!i.display)return;const r=ze(i.font),l=Nn(i.padding),c=i.align;let f=r.lineHeight/2;e==="bottom"||e==="center"||Ft(e)?(f+=l.bottom,Re(i.text)&&(f+=r.lineHeight*(i.text.length-1))):f+=l.top;const{titleX:d,titleY:p,maxWidth:_,rotation:y}=WL(this,f,e,c);dl(t,i.text,0,0,r,{color:i.color,maxWidth:_,rotation:y,textAlign:jL(c,e,s),textBaseline:"middle",translation:[d,p]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=It(t.grid&&t.grid.z,-1),s=It(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==Pa.prototype.draw?[{z:e,draw:r=>{this.draw(r)}}]:[{z:i,draw:r=>{this.drawBackground(),this.drawGrid(r),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:e,draw:r=>{this.drawLabels(r)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",s=[];let r,l;for(r=0,l=e.length;r<l;++r){const c=e[r];c[i]===this.id&&(!t||c.type===t)&&s.push(c)}return s}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return ze(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class du{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;YL(e)&&(i=this.register(e));const s=this.items,r=t.id,l=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in s||(s[r]=t,$L(t,l,i),this.override&&he.override(t.id,t.overrides)),l}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,s=this.scope;i in e&&delete e[i],s&&i in he[s]&&(delete he[s][i],this.override&&delete ur[i])}}function $L(n,t,e){const i=ul(Object.create(null),[e?he.get(e):{},he.get(t),n.defaults]);he.set(t,i),n.defaultRoutes&&XL(t,n.defaultRoutes),n.descriptors&&he.describe(t,n.descriptors)}function XL(n,t){Object.keys(t).forEach(e=>{const i=e.split("."),s=i.pop(),r=[n].concat(i).join("."),l=t[e].split("."),c=l.pop(),f=l.join(".");he.route(r,s,f,c)})}function YL(n){return"id"in n&&"defaults"in n}class qL{constructor(){this.controllers=new du(Z3,"datasets",!0),this.elements=new du(gr,"elements"),this.plugins=new du(Object,"plugins"),this.scales=new du(Pa,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach(s=>{const r=i||this._getRegistryForType(s);i||r.isForType(s)||r===this.plugins&&s.id?this._exec(t,r,s):jt(s,l=>{const c=i||this._getRegistryForType(l);this._exec(t,c,l)})})}_exec(t,e,i){const s=m_(t);ne(i["before"+s],[],i),e[t](i),ne(i["after"+s],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const s=e.get(t);if(s===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return s}}var Jn=new qL;class KL{constructor(){this._init=void 0}notify(t,e,i,s){if(e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const r=s?this._descriptors(t).filter(s):this._descriptors(t),l=this._notify(r,t,e,i);return e==="afterDestroy"&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),l}_notify(t,e,i,s){s=s||{};for(const r of t){const l=r.plugin,c=l[i],f=[e,s,r.options];if(ne(c,f,l)===!1&&s.cancelable)return!1}return!0}invalidate(){Jt(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,s=It(i.options&&i.options.plugins,{}),r=ZL(i);return s===!1&&!e?[]:GL(t,r,s,e)}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,s=(r,l)=>r.filter(c=>!l.some(f=>c.plugin.id===f.plugin.id));this._notify(s(e,i),t,"stop"),this._notify(s(i,e),t,"start")}}function ZL(n){const t={},e=[],i=Object.keys(Jn.plugins.items);for(let r=0;r<i.length;r++)e.push(Jn.getPlugin(i[r]));const s=n.plugins||[];for(let r=0;r<s.length;r++){const l=s[r];e.indexOf(l)===-1&&(e.push(l),t[l.id]=!0)}return{plugins:e,localIds:t}}function QL(n,t){return!t&&n===!1?null:n===!0?{}:n}function GL(n,{plugins:t,localIds:e},i,s){const r=[],l=n.getContext();for(const c of t){const f=c.id,d=QL(i[f],s);d!==null&&r.push({plugin:c,options:JL(n.config,{plugin:c,local:e[f]},d,l)})}return r}function JL(n,{plugin:t,local:e},i,s){const r=n.pluginScopeKeys(t),l=n.getOptionScopes(i,r);return e&&t.defaults&&l.push(t.defaults),n.createResolver(l,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function yg(n,t){const e=he.datasets[n]||{};return((t.datasets||{})[n]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function t8(n,t){let e=n;return n==="_index_"?e=t:n==="_value_"&&(e=t==="x"?"y":"x"),e}function e8(n,t){return n===t?"_index_":"_value_"}function BT(n){if(n==="x"||n==="y"||n==="r")return n}function n8(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function bg(n,...t){if(BT(n))return n;for(const e of t){const i=e.axis||n8(e.position)||n.length>1&&BT(n[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${n}' axis. Please provide 'axis' or 'position' option.`)}function UT(n,t,e){if(e[t+"AxisID"]===n)return{axis:t}}function i8(n,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(i=>i.xAxisID===n||i.yAxisID===n);if(e.length)return UT(n,"x",e[0])||UT(n,"y",e[0])}return{}}function s8(n,t){const e=ur[n.type]||{scales:{}},i=t.scales||{},s=yg(n.type,t),r=Object.create(null);return Object.keys(i).forEach(l=>{const c=i[l];if(!Ft(c))return console.error(`Invalid scale configuration for scale: ${l}`);if(c._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${l}`);const f=bg(l,c,i8(l,n),he.scales[c.type]),d=e8(f,s),p=e.scales||{};r[l]=el(Object.create(null),[{axis:f},c,p[f],p[d]])}),n.data.datasets.forEach(l=>{const c=l.type||n.type,f=l.indexAxis||yg(c,t),p=(ur[c]||{}).scales||{};Object.keys(p).forEach(_=>{const y=t8(_,f),b=l[y+"AxisID"]||y;r[b]=r[b]||Object.create(null),el(r[b],[{axis:y},i[b],p[_]])})}),Object.keys(r).forEach(l=>{const c=r[l];el(c,[he.scales[c.type],he.scale])}),r}function nS(n){const t=n.options||(n.options={});t.plugins=It(t.plugins,{}),t.scales=s8(n,t)}function iS(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function r8(n){return n=n||{},n.data=iS(n.data),nS(n),n}const FT=new Map,sS=new Set;function pu(n,t){let e=FT.get(n);return e||(e=t(),FT.set(n,e),sS.add(e)),e}const Uo=(n,t,e)=>{const i=Zu(t,e);i!==void 0&&n.add(i)};class a8{constructor(t){this._config=r8(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=iS(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),nS(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return pu(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return pu(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return pu(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,i=this.type;return pu(`${i}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const i=this._scopeCache;let s=i.get(t);return(!s||e)&&(s=new Map,i.set(t,s)),s}getOptionScopes(t,e,i){const{options:s,type:r}=this,l=this._cachedScopes(t,i),c=l.get(e);if(c)return c;const f=new Set;e.forEach(p=>{t&&(f.add(t),p.forEach(_=>Uo(f,t,_))),p.forEach(_=>Uo(f,s,_)),p.forEach(_=>Uo(f,ur[r]||{},_)),p.forEach(_=>Uo(f,he,_)),p.forEach(_=>Uo(f,gg,_))});const d=Array.from(f);return d.length===0&&d.push(Object.create(null)),sS.has(e)&&l.set(e,d),d}chartOptionScopes(){const{options:t,type:e}=this;return[t,ur[e]||{},he.datasets[e]||{},{type:e},he,gg]}resolveNamedOptions(t,e,i,s=[""]){const r={$shared:!0},{resolver:l,subPrefixes:c}=LT(this._resolverCache,t,s);let f=l;if(l8(l,e)){r.$shared=!1,i=ys(i)?i():i;const d=this.createResolver(t,i,c);f=Ma(l,i,d)}for(const d of e)r[d]=f[d];return r}createResolver(t,e,i=[""],s){const{resolver:r}=LT(this._resolverCache,t,i);return Ft(e)?Ma(r,e,void 0,s):r}}function LT(n,t,e){let i=n.get(t);i||(i=new Map,n.set(t,i));const s=e.join();let r=i.get(s);return r||(r={resolver:S_(t,e),subPrefixes:e.filter(c=>!c.toLowerCase().includes("hover"))},i.set(s,r)),r}const o8=n=>Ft(n)&&Object.getOwnPropertyNames(n).some(t=>ys(n[t]));function l8(n,t){const{isScriptable:e,isIndexable:i}=z3(n);for(const s of t){const r=e(s),l=i(s),c=(l||r)&&n[s];if(r&&(ys(c)||o8(c))||l&&Re(c))return!0}return!1}var c8="4.5.1";const u8=["top","bottom","left","right","chartArea"];function zT(n,t){return n==="top"||n==="bottom"||u8.indexOf(n)===-1&&t==="x"}function VT(n,t){return function(e,i){return e[n]===i[n]?e[t]-i[t]:e[n]-i[n]}}function HT(n){const t=n.chart,e=t.options.animation;t.notifyPlugins("afterRender"),ne(e&&e.onComplete,[n],t)}function f8(n){const t=n.chart,e=t.options.animation;ne(e&&e.onProgress,[n],t)}function rS(n){return E_()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const wu={},jT=n=>{const t=rS(n);return Object.values(wu).filter(e=>e.canvas===t).pop()};function h8(n,t,e){const i=Object.keys(n);for(const s of i){const r=+s;if(r>=t){const l=n[s];delete n[s],(e>0||r>t)&&(n[r+e]=l)}}}function d8(n,t,e,i){return!e||n.type==="mouseout"?null:i?t:n}let pf=class{static defaults=he;static instances=wu;static overrides=ur;static registry=Jn;static version=c8;static getChart=jT;static register(...t){Jn.add(...t),WT()}static unregister(...t){Jn.remove(...t),WT()}constructor(t,e){const i=this.config=new a8(e),s=rS(t),r=jT(s);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const l=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||IL(s)),this.platform.updateConfig(i);const c=this.platform.acquireContext(s,l.aspectRatio),f=c&&c.canvas,d=f&&f.height,p=f&&f.width;if(this.id=gU(),this.ctx=c,this.canvas=f,this.width=p,this.height=d,this._options=l,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new KL,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=BU(_=>this.update(_),l.resizeDelay||0),this._dataChanges=[],wu[this.id]=this,!c||!f){console.error("Failed to create chart: can't acquire context from the given item");return}Ei.listen(this,"complete",HT),Ei.listen(this,"progress",f8),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:i,height:s,_aspectRatio:r}=this;return Jt(t)?e&&r?r:s?i/s:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Jn}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():gT(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return hT(this.canvas,this.ctx),this}stop(){return Ei.stop(this),this}resize(t,e){Ei.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,s=this.canvas,r=i.maintainAspectRatio&&this.aspectRatio,l=this.platform.getMaximumSize(s,t,e,r),c=i.devicePixelRatio||this.platform.getDevicePixelRatio(),f=this.width?"resize":"attach";this.width=l.width,this.height=l.height,this._aspectRatio=this.aspectRatio,gT(this,c,!0)&&(this.notifyPlugins("resize",{size:l}),ne(i.onResize,[this,l],this),this.attached&&this._doResize(f)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};jt(e,(i,s)=>{i.id=s})}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,s=Object.keys(i).reduce((l,c)=>(l[c]=!1,l),{});let r=[];e&&(r=r.concat(Object.keys(e).map(l=>{const c=e[l],f=bg(l,c),d=f==="r",p=f==="x";return{options:c,dposition:d?"chartArea":p?"bottom":"left",dtype:d?"radialLinear":p?"category":"linear"}}))),jt(r,l=>{const c=l.options,f=c.id,d=bg(f,c),p=It(c.type,l.dtype);(c.position===void 0||zT(c.position,d)!==zT(l.dposition))&&(c.position=l.dposition),s[f]=!0;let _=null;if(f in i&&i[f].type===p)_=i[f];else{const y=Jn.getScale(p);_=new y({id:f,type:p,ctx:this.ctx,chart:this}),i[_.id]=_}_.init(c,t)}),jt(s,(l,c)=>{l||delete i[c]}),jt(i,l=>{Mn.configure(this,l,l.options),Mn.addBox(this,l)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort((s,r)=>s.index-r.index),i>e){for(let s=e;s<i;++s)this._destroyDatasetMeta(s);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(VT("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((i,s)=>{e.filter(r=>r===i._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,s;for(this._removeUnreferencedMetasets(),i=0,s=e.length;i<s;i++){const r=e[i];let l=this.getDatasetMeta(i);const c=r.type||this.config.type;if(l.type&&l.type!==c&&(this._destroyDatasetMeta(i),l=this.getDatasetMeta(i)),l.type=c,l.indexAxis=r.indexAxis||yg(c,this.options),l.order=r.order||0,l.index=i,l.label=""+r.label,l.visible=this.isDatasetVisible(i),l.controller)l.controller.updateIndex(i),l.controller.linkScales();else{const f=Jn.getController(c),{datasetElementType:d,dataElementType:p}=he.datasets[c];Object.assign(f,{dataElementType:Jn.getElement(p),datasetElementType:d&&Jn.getElement(d)}),l.controller=new f(this,i),t.push(l.controller)}}return this._updateMetasets(),t}_resetElements(){jt(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let l=0;for(let d=0,p=this.data.datasets.length;d<p;d++){const{controller:_}=this.getDatasetMeta(d),y=!s&&r.indexOf(_)===-1;_.buildOrUpdateElements(y),l=Math.max(+_.getMaxOverflow(),l)}l=this._minPadding=i.layout.autoPadding?l:0,this._updateLayout(l),s||jt(r,d=>{d.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(VT("z","_idx"));const{_active:c,_lastEvent:f}=this;f?this._eventHandler(f,!0):c.length&&this._updateHoverStyles(c,c,!0),this.render()}_updateScales(){jt(this.scales,t=>{Mn.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!nT(e,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:s,count:r}of e){const l=i==="_removeElements"?-r:r;h8(t,s,l)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=r=>new Set(t.filter(l=>l[0]===r).map((l,c)=>c+","+l.splice(1).join(","))),s=i(0);for(let r=1;r<e;r++)if(!nT(s,i(r)))return;return Array.from(s).map(r=>r.split(",")).map(r=>({method:r[1],start:+r[2],count:+r[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Mn.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],jt(this.boxes,s=>{i&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,r)=>{s._idx=r}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,i=this.data.datasets.length;e<i;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,ys(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),s={meta:i,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(i.controller._update(e),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Ei.has(this)?this.attached&&!Ei.running(this)&&Ei.start(this):(this.draw(),HT({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,s)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let s,r;for(s=0,r=e.length;s<r;++s){const l=e[s];(!t||l.visible)&&i.push(l)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i={meta:t,index:t.index,cancelable:!0},s=jF(this,t);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(s&&x_(e,s),t.controller.draw(),s&&T_(e),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return hl(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,i,s){const r=uL.modes[e];return typeof r=="function"?r(this,t,i,s):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let s=i.filter(r=>r&&r._dataset===e).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(s)),s}getContext(){return this.$context||(this.$context=pr(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!e.hidden}setDatasetVisibility(t,e){const i=this.getDatasetMeta(t);i.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const s=i?"show":"hide",r=this.getDatasetMeta(t),l=r.controller._resolveAnimations(void 0,s);Qu(e)?(r.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),l.update(r,{visible:i}),this.update(c=>c.datasetIndex===t?s:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),Ei.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),hT(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete wu[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(r,l)=>{e.addEventListener(this,r,l),t[r]=l},s=(r,l,c)=>{r.offsetX=l,r.offsetY=c,this._eventHandler(r)};jt(this.options.events,r=>i(r,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(f,d)=>{e.addEventListener(this,f,d),t[f]=d},s=(f,d)=>{t[f]&&(e.removeEventListener(this,f,d),delete t[f])},r=(f,d)=>{this.canvas&&this.resize(f,d)};let l;const c=()=>{s("attach",c),this.attached=!0,this.resize(),i("resize",r),i("detach",l)};l=()=>{this.attached=!1,s("resize",r),this._stop(),this._resize(0,0),i("attach",c)},e.isAttached(this.canvas)?c():l()}unbindEvents(){jt(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},jt(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const s=i?"set":"remove";let r,l,c,f;for(e==="dataset"&&(r=this.getDatasetMeta(t[0].datasetIndex),r.controller["_"+s+"DatasetHoverStyle"]()),c=0,f=t.length;c<f;++c){l=t[c];const d=l&&this.getDatasetMeta(l.datasetIndex).controller;d&&d[s+"HoverStyle"](l.element,l.datasetIndex,l.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map(({datasetIndex:r,index:l})=>{const c=this.getDatasetMeta(r);if(!c)throw new Error("No dataset found at index "+r);return{datasetIndex:r,element:c.data[l],index:l}});!qu(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,i){const s=this.options.hover,r=(f,d)=>f.filter(p=>!d.some(_=>p.datasetIndex===_.datasetIndex&&p.index===_.index)),l=r(e,t),c=i?t:r(t,e);l.length&&this.updateHoverStyle(l,s.mode,!1),c.length&&s.mode&&this.updateHoverStyle(c,s.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},s=l=>(l.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,s)===!1)return;const r=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,s),(r||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:s=[],options:r}=this,l=e,c=this._getActiveElements(t,s,i,l),f=xU(t),d=d8(t,this._lastEvent,i,f);i&&(this._lastEvent=null,ne(r.onHover,[t,c,this],this),f&&ne(r.onClick,[t,c,this],this));const p=!qu(c,s);return(p||e)&&(this._active=c,this._updateHoverStyles(c,s,e)),this._lastEvent=d,p}_getActiveElements(t,e,i,s){if(t.type==="mouseout")return[];if(!i)return e;const r=this.options.hover;return this.getElementsAtEventForMode(t,r.mode,r,s)}};function WT(){return jt(pf.instances,n=>n._plugins.invalidate())}function aS(n,t,e=t){n.lineCap=It(e.borderCapStyle,t.borderCapStyle),n.setLineDash(It(e.borderDash,t.borderDash)),n.lineDashOffset=It(e.borderDashOffset,t.borderDashOffset),n.lineJoin=It(e.borderJoinStyle,t.borderJoinStyle),n.lineWidth=It(e.borderWidth,t.borderWidth),n.strokeStyle=It(e.borderColor,t.borderColor)}function p8(n,t,e){n.lineTo(e.x,e.y)}function g8(n){return n.stepped?ZU:n.tension||n.cubicInterpolationMode==="monotone"?QU:p8}function oS(n,t,e={}){const i=n.length,{start:s=0,end:r=i-1}=e,{start:l,end:c}=t,f=Math.max(s,l),d=Math.min(r,c),p=s<l&&r<l||s>c&&r>c;return{count:i,start:f,loop:t.loop,ilen:d<f&&!p?i+d-f:d-f}}function _8(n,t,e,i){const{points:s,options:r}=t,{count:l,start:c,loop:f,ilen:d}=oS(s,e,i),p=g8(r);let{move:_=!0,reverse:y}=i||{},b,x,T;for(b=0;b<=d;++b)x=s[(c+(y?d-b:b))%l],!x.skip&&(_?(n.moveTo(x.x,x.y),_=!1):p(n,T,x,y,r.stepped),T=x);return f&&(x=s[(c+(y?d:0))%l],p(n,T,x,y,r.stepped)),!!f}function m8(n,t,e,i){const s=t.points,{count:r,start:l,ilen:c}=oS(s,e,i),{move:f=!0,reverse:d}=i||{};let p=0,_=0,y,b,x,T,A,E;const D=O=>(l+(d?c-O:O))%r,C=()=>{T!==A&&(n.lineTo(p,A),n.lineTo(p,T),n.lineTo(p,E))};for(f&&(b=s[D(0)],n.moveTo(b.x,b.y)),y=0;y<=c;++y){if(b=s[D(y)],b.skip)continue;const O=b.x,k=b.y,z=O|0;z===x?(k<T?T=k:k>A&&(A=k),p=(_*p+O)/++_):(C(),n.lineTo(O,k),x=z,_=0,T=A=k),E=k}C()}function vg(n){const t=n.options,e=t.borderDash&&t.borderDash.length;return!n._decimated&&!n._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?m8:_8}function y8(n){return n.stepped?OF:n.tension||n.cubicInterpolationMode==="monotone"?IF:Ws}function b8(n,t,e,i){let s=t._path;s||(s=t._path=new Path2D,t.path(s,e,i)&&s.closePath()),aS(n,t.options),n.stroke(s)}function v8(n,t,e,i){const{segments:s,options:r}=t,l=vg(t);for(const c of s)aS(n,r,c.style),n.beginPath(),l(n,t,c,{start:e,end:e+i-1})&&n.closePath(),n.stroke()}const x8=typeof Path2D=="function";function T8(n,t,e,i){x8&&!t.options.segment?b8(n,t,e,i):v8(n,t,e,i)}class S8 extends gr{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"};constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const s=i.spanGaps?this._loop:this._fullLoop;TF(this._points,i,t,s,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=LF(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,s=t[e],r=this.points,l=BF(this,{property:e,start:s,end:s});if(!l.length)return;const c=[],f=y8(i);let d,p;for(d=0,p=l.length;d<p;++d){const{start:_,end:y}=l[d],b=r[_],x=r[y];if(b===x){c.push(b);continue}const T=Math.abs((s-b[e])/(x[e]-b[e])),A=f(b,x,T,i.stepped);A[e]=t[e],c.push(A)}return c.length===1?c[0]:c}pathSegment(t,e,i){return vg(this)(t,this,e,i)}path(t,e,i){const s=this.segments,r=vg(this);let l=this._loop;e=e||0,i=i||this.points.length-e;for(const c of s)l&=r(t,this,c,{start:e,end:e+i-1});return!!l}draw(t,e,i,s){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),T8(t,this,i,s),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function $T(n,t,e,i){const s=n.options,{[e]:r}=n.getProps([e],i);return Math.abs(t-r)<s.radius+s.hitRadius}class A8 extends gr{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,i){const s=this.options,{x:r,y:l}=this.getProps(["x","y"],i);return Math.pow(t-r,2)+Math.pow(e-l,2)<Math.pow(s.hitRadius+s.radius,2)}inXRange(t,e){return $T(this,t,"x",e)}inYRange(t,e){return $T(this,t,"y",e)}getCenterPoint(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}size(t){t=t||this.options||{};let e=t.radius||0;e=Math.max(e,e&&t.hoverRadius||0);const i=e&&t.borderWidth||0;return(e+i)*2}draw(t,e){const i=this.options;this.skip||i.radius<.1||!hl(this,e,this.size(i)/2)||(t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.fillStyle=i.backgroundColor,_g(t,i,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}const XT=(n,t)=>{let{boxHeight:e=t,boxWidth:i=t}=n;return n.usePointStyle&&(e=Math.min(e,t),i=n.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:e,itemHeight:Math.max(t,e)}},w8=(n,t)=>n!==null&&t!==null&&n.datasetIndex===t.datasetIndex&&n.index===t.index;class YT extends gr{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=ne(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(i=>t.filter(i,this.chart.data))),t.sort&&(e=e.sort((i,s)=>t.sort(i,s,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,s=ze(i.font),r=s.size,l=this._computeTitleHeight(),{boxWidth:c,itemHeight:f}=XT(i,r);let d,p;e.font=s.string,this.isHorizontal()?(d=this.maxWidth,p=this._fitRows(l,r,c,f)+10):(p=this.maxHeight,d=this._fitCols(l,s,c,f)+10),this.width=Math.min(d,t.maxWidth||this.maxWidth),this.height=Math.min(p,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,s){const{ctx:r,maxWidth:l,options:{labels:{padding:c}}}=this,f=this.legendHitBoxes=[],d=this.lineWidths=[0],p=s+c;let _=t;r.textAlign="left",r.textBaseline="middle";let y=-1,b=-p;return this.legendItems.forEach((x,T)=>{const A=i+e/2+r.measureText(x.text).width;(T===0||d[d.length-1]+A+2*c>l)&&(_+=p,d[d.length-(T>0?0:1)]=0,b+=p,y++),f[T]={left:0,top:b,row:y,width:A,height:s},d[d.length-1]+=A+c}),_}_fitCols(t,e,i,s){const{ctx:r,maxHeight:l,options:{labels:{padding:c}}}=this,f=this.legendHitBoxes=[],d=this.columnSizes=[],p=l-t;let _=c,y=0,b=0,x=0,T=0;return this.legendItems.forEach((A,E)=>{const{itemWidth:D,itemHeight:C}=E8(i,e,r,A,s);E>0&&b+C+2*c>p&&(_+=y+c,d.push({width:y,height:b}),x+=y+c,T++,y=b=0),f[E]={left:x,top:b,col:T,width:D,height:C},y=Math.max(y,D),b+=C+c}),_+=y,d.push({width:y,height:b}),_}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:s},rtl:r}}=this,l=_a(r,this.left,this.width);if(this.isHorizontal()){let c=0,f=Le(i,this.left+s,this.right-this.lineWidths[c]);for(const d of e)c!==d.row&&(c=d.row,f=Le(i,this.left+s,this.right-this.lineWidths[c])),d.top+=this.top+t+s,d.left=l.leftForLtr(l.x(f),d.width),f+=d.width+s}else{let c=0,f=Le(i,this.top+t+s,this.bottom-this.columnSizes[c].height);for(const d of e)d.col!==c&&(c=d.col,f=Le(i,this.top+t+s,this.bottom-this.columnSizes[c].height)),d.top=f,d.left+=this.left+s,d.left=l.leftForLtr(l.x(d.left),d.width),f+=d.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;x_(t,this),this._draw(),T_(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:s}=this,{align:r,labels:l}=t,c=he.color,f=_a(t.rtl,this.left,this.width),d=ze(l.font),{padding:p}=l,_=d.size,y=_/2;let b;this.drawTitle(),s.textAlign=f.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=d.string;const{boxWidth:x,boxHeight:T,itemHeight:A}=XT(l,_),E=function(z,Y,q){if(isNaN(x)||x<=0||isNaN(T)||T<0)return;s.save();const G=It(q.lineWidth,1);if(s.fillStyle=It(q.fillStyle,c),s.lineCap=It(q.lineCap,"butt"),s.lineDashOffset=It(q.lineDashOffset,0),s.lineJoin=It(q.lineJoin,"miter"),s.lineWidth=G,s.strokeStyle=It(q.strokeStyle,c),s.setLineDash(It(q.lineDash,[])),l.usePointStyle){const at={radius:T*Math.SQRT2/2,pointStyle:q.pointStyle,rotation:q.rotation,borderWidth:G},nt=f.xPlus(z,x/2),ot=Y+y;F3(s,at,nt,ot,l.pointStyleWidth&&x)}else{const at=Y+Math.max((_-T)/2,0),nt=f.leftForLtr(z,x),ot=rl(q.borderRadius);s.beginPath(),Object.values(ot).some(xt=>xt!==0)?mg(s,{x:nt,y:at,w:x,h:T,radius:ot}):s.rect(nt,at,x,T),s.fill(),G!==0&&s.stroke()}s.restore()},D=function(z,Y,q){dl(s,q.text,z,Y+A/2,d,{strikethrough:q.hidden,textAlign:f.textAlign(q.textAlign)})},C=this.isHorizontal(),O=this._computeTitleHeight();C?b={x:Le(r,this.left+p,this.right-i[0]),y:this.top+p+O,line:0}:b={x:this.left+p,y:Le(r,this.top+O+p,this.bottom-e[0].height),line:0},$3(this.ctx,t.textDirection);const k=A+p;this.legendItems.forEach((z,Y)=>{s.strokeStyle=z.fontColor,s.fillStyle=z.fontColor;const q=s.measureText(z.text).width,G=f.textAlign(z.textAlign||(z.textAlign=l.textAlign)),at=x+y+q;let nt=b.x,ot=b.y;f.setWidth(this.width),C?Y>0&&nt+at+p>this.right&&(ot=b.y+=k,b.line++,nt=b.x=Le(r,this.left+p,this.right-i[b.line])):Y>0&&ot+k>this.bottom&&(nt=b.x=nt+e[b.line].width+p,b.line++,ot=b.y=Le(r,this.top+O+p,this.bottom-e[b.line].height));const xt=f.x(nt);if(E(xt,ot,z),nt=UU(G,nt+x+y,C?nt+at:this.right,t.rtl),D(f.x(nt),ot,z),C)b.x+=at+p;else if(typeof z.text!="string"){const dt=d.lineHeight;b.y+=lS(z,dt)+p}else b.y+=k}),X3(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=ze(e.font),s=Nn(e.padding);if(!e.display)return;const r=_a(t.rtl,this.left,this.width),l=this.ctx,c=e.position,f=i.size/2,d=s.top+f;let p,_=this.left,y=this.width;if(this.isHorizontal())y=Math.max(...this.lineWidths),p=this.top+d,_=Le(t.align,_,this.right-y);else{const x=this.columnSizes.reduce((T,A)=>Math.max(T,A.height),0);p=d+Le(t.align,this.top,this.bottom-x-t.labels.padding-this._computeTitleHeight())}const b=Le(c,_,_+y);l.textAlign=r.textAlign(b_(c)),l.textBaseline="middle",l.strokeStyle=e.color,l.fillStyle=e.color,l.font=i.string,dl(l,e.text,b,p,i)}_computeTitleHeight(){const t=this.options.title,e=ze(t.font),i=Nn(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,s,r;if(Wo(t,this.left,this.right)&&Wo(e,this.top,this.bottom)){for(r=this.legendHitBoxes,i=0;i<r.length;++i)if(s=r[i],Wo(t,s.left,s.left+s.width)&&Wo(e,s.top,s.top+s.height))return this.legendItems[i]}return null}handleEvent(t){const e=this.options;if(!M8(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const s=this._hoveredItem,r=w8(s,i);s&&!r&&ne(e.onLeave,[t,s,this],this),this._hoveredItem=i,i&&!r&&ne(e.onHover,[t,i,this],this)}else i&&ne(e.onClick,[t,i,this],this)}}function E8(n,t,e,i,s){const r=R8(i,n,t,e),l=C8(s,i,t.lineHeight);return{itemWidth:r,itemHeight:l}}function R8(n,t,e,i){let s=n.text;return s&&typeof s!="string"&&(s=s.reduce((r,l)=>r.length>l.length?r:l)),t+e.size/2+i.measureText(s).width}function C8(n,t,e){let i=n;return typeof t.text!="string"&&(i=lS(t,e)),i}function lS(n,t){const e=n.text?n.text.length:0;return t*e}function M8(n,t){return!!((n==="mousemove"||n==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(n==="click"||n==="mouseup"))}var O8={id:"legend",_element:YT,start(n,t,e){const i=n.legend=new YT({ctx:n.ctx,options:e,chart:n});Mn.configure(n,i,e),Mn.addBox(n,i)},stop(n){Mn.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,t,e){const i=n.legend;Mn.configure(n,i,e),i.options=e},afterUpdate(n){const t=n.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(n,t){t.replay||n.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,t,e){const i=t.datasetIndex,s=e.chart;s.isDatasetVisible(i)?(s.hide(i),t.hidden=!0):(s.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const t=n.data.datasets,{labels:{usePointStyle:e,pointStyle:i,textAlign:s,color:r,useBorderRadius:l,borderRadius:c}}=n.legend.options;return n._getSortedDatasetMetas().map(f=>{const d=f.controller.getStyle(e?0:void 0),p=Nn(d.borderWidth);return{text:t[f.index].label,fillStyle:d.backgroundColor,fontColor:r,hidden:!f.visible,lineCap:d.borderCapStyle,lineDash:d.borderDash,lineDashOffset:d.borderDashOffset,lineJoin:d.borderJoinStyle,lineWidth:(p.width+p.height)/4,strokeStyle:d.borderColor,pointStyle:i||d.pointStyle,rotation:d.rotation,textAlign:s||d.textAlign,borderRadius:l&&(c||d.borderRadius),datasetIndex:f.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class cS extends gr{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const s=Re(i.text)?i.text.length:1;this._padding=Nn(i.padding);const r=s*ze(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:i,bottom:s,right:r,options:l}=this,c=l.align;let f=0,d,p,_;return this.isHorizontal()?(p=Le(c,i,r),_=e+t,d=r-i):(l.position==="left"?(p=i+t,_=Le(c,s,e),f=Ce*-.5):(p=r-t,_=Le(c,e,s),f=Ce*.5),d=s-e),{titleX:p,titleY:_,maxWidth:d,rotation:f}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=ze(e.font),r=i.lineHeight/2+this._padding.top,{titleX:l,titleY:c,maxWidth:f,rotation:d}=this._drawArgs(r);dl(t,e.text,0,0,i,{color:e.color,maxWidth:f,rotation:d,textAlign:b_(e.align),textBaseline:"middle",translation:[l,c]})}}function I8(n,t){const e=new cS({ctx:n.ctx,options:t,chart:n});Mn.configure(n,e,t),Mn.addBox(n,e),n.titleBlock=e}var P8={id:"title",_element:cS,start(n,t,e){I8(n,e)},stop(n){const t=n.titleBlock;Mn.removeBox(n,t),delete n.titleBlock},beforeUpdate(n,t,e){const i=n.titleBlock;Mn.configure(n,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Xo={average(n){if(!n.length)return!1;let t,e,i=new Set,s=0,r=0;for(t=0,e=n.length;t<e;++t){const c=n[t].element;if(c&&c.hasValue()){const f=c.tooltipPosition();i.add(f.x),s+=f.y,++r}}return r===0||i.size===0?!1:{x:[...i].reduce((c,f)=>c+f)/i.size,y:s/r}},nearest(n,t){if(!n.length)return!1;let e=t.x,i=t.y,s=Number.POSITIVE_INFINITY,r,l,c;for(r=0,l=n.length;r<l;++r){const f=n[r].element;if(f&&f.hasValue()){const d=f.getCenterPoint(),p=pg(t,d);p<s&&(s=p,c=f)}}if(c){const f=c.tooltipPosition();e=f.x,i=f.y}return{x:e,y:i}}};function Gn(n,t){return t&&(Re(t)?Array.prototype.push.apply(n,t):n.push(t)),n}function Ri(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function D8(n,t){const{element:e,datasetIndex:i,index:s}=t,r=n.getDatasetMeta(i).controller,{label:l,value:c}=r.getLabelAndValue(s);return{chart:n,label:l,parsed:r.getParsed(s),raw:n.data.datasets[i].data[s],formattedValue:c,dataset:r.getDataset(),dataIndex:s,datasetIndex:i,element:e}}function qT(n,t){const e=n.chart.ctx,{body:i,footer:s,title:r}=n,{boxWidth:l,boxHeight:c}=t,f=ze(t.bodyFont),d=ze(t.titleFont),p=ze(t.footerFont),_=r.length,y=s.length,b=i.length,x=Nn(t.padding);let T=x.height,A=0,E=i.reduce((O,k)=>O+k.before.length+k.lines.length+k.after.length,0);if(E+=n.beforeBody.length+n.afterBody.length,_&&(T+=_*d.lineHeight+(_-1)*t.titleSpacing+t.titleMarginBottom),E){const O=t.displayColors?Math.max(c,f.lineHeight):f.lineHeight;T+=b*O+(E-b)*f.lineHeight+(E-1)*t.bodySpacing}y&&(T+=t.footerMarginTop+y*p.lineHeight+(y-1)*t.footerSpacing);let D=0;const C=function(O){A=Math.max(A,e.measureText(O).width+D)};return e.save(),e.font=d.string,jt(n.title,C),e.font=f.string,jt(n.beforeBody.concat(n.afterBody),C),D=t.displayColors?l+2+t.boxPadding:0,jt(i,O=>{jt(O.before,C),jt(O.lines,C),jt(O.after,C)}),D=0,e.font=p.string,jt(n.footer,C),e.restore(),A+=x.width,{width:A,height:T}}function k8(n,t){const{y:e,height:i}=t;return e<i/2?"top":e>n.height-i/2?"bottom":"center"}function N8(n,t,e,i){const{x:s,width:r}=i,l=e.caretSize+e.caretPadding;if(n==="left"&&s+r+l>t.width||n==="right"&&s-r-l<0)return!0}function B8(n,t,e,i){const{x:s,width:r}=e,{width:l,chartArea:{left:c,right:f}}=n;let d="center";return i==="center"?d=s<=(c+f)/2?"left":"right":s<=r/2?d="left":s>=l-r/2&&(d="right"),N8(d,n,t,e)&&(d="center"),d}function KT(n,t,e){const i=e.yAlign||t.yAlign||k8(n,e);return{xAlign:e.xAlign||t.xAlign||B8(n,t,e,i),yAlign:i}}function U8(n,t){let{x:e,width:i}=n;return t==="right"?e-=i:t==="center"&&(e-=i/2),e}function F8(n,t,e){let{y:i,height:s}=n;return t==="top"?i+=e:t==="bottom"?i-=s+e:i-=s/2,i}function ZT(n,t,e,i){const{caretSize:s,caretPadding:r,cornerRadius:l}=n,{xAlign:c,yAlign:f}=e,d=s+r,{topLeft:p,topRight:_,bottomLeft:y,bottomRight:b}=rl(l);let x=U8(t,c);const T=F8(t,f,d);return f==="center"?c==="left"?x+=d:c==="right"&&(x-=d):c==="left"?x-=Math.max(p,y)+s:c==="right"&&(x+=Math.max(_,b)+s),{x:Cn(x,0,i.width-t.width),y:Cn(T,0,i.height-t.height)}}function gu(n,t,e){const i=Nn(e.padding);return t==="center"?n.x+n.width/2:t==="right"?n.x+n.width-i.right:n.x+i.left}function QT(n){return Gn([],Ri(n))}function L8(n,t,e){return pr(n,{tooltip:t,tooltipItems:e,type:"tooltip"})}function GT(n,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?n.override(e):n}const uS={beforeTitle:wi,title(n){if(n.length>0){const t=n[0],e=t.chart.data.labels,i=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return e[t.dataIndex]}return""},afterTitle:wi,beforeBody:wi,beforeLabel:wi,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let t=n.dataset.label||"";t&&(t+=": ");const e=n.formattedValue;return Jt(e)||(t+=e),t},labelColor(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:wi,afterBody:wi,beforeFooter:wi,footer:wi,afterFooter:wi};function Ge(n,t,e,i){const s=n[t].call(e,i);return typeof s>"u"?uS[t].call(e,i):s}class JT extends gr{static positioners=Xo;constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),s=i.enabled&&e.options.animation&&i.animations,r=new q3(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=L8(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:i}=e,s=Ge(i,"beforeTitle",this,t),r=Ge(i,"title",this,t),l=Ge(i,"afterTitle",this,t);let c=[];return c=Gn(c,Ri(s)),c=Gn(c,Ri(r)),c=Gn(c,Ri(l)),c}getBeforeBody(t,e){return QT(Ge(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:i}=e,s=[];return jt(t,r=>{const l={before:[],lines:[],after:[]},c=GT(i,r);Gn(l.before,Ri(Ge(c,"beforeLabel",this,r))),Gn(l.lines,Ge(c,"label",this,r)),Gn(l.after,Ri(Ge(c,"afterLabel",this,r))),s.push(l)}),s}getAfterBody(t,e){return QT(Ge(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:i}=e,s=Ge(i,"beforeFooter",this,t),r=Ge(i,"footer",this,t),l=Ge(i,"afterFooter",this,t);let c=[];return c=Gn(c,Ri(s)),c=Gn(c,Ri(r)),c=Gn(c,Ri(l)),c}_createItems(t){const e=this._active,i=this.chart.data,s=[],r=[],l=[];let c=[],f,d;for(f=0,d=e.length;f<d;++f)c.push(D8(this.chart,e[f]));return t.filter&&(c=c.filter((p,_,y)=>t.filter(p,_,y,i))),t.itemSort&&(c=c.sort((p,_)=>t.itemSort(p,_,i))),jt(c,p=>{const _=GT(t.callbacks,p);s.push(Ge(_,"labelColor",this,p)),r.push(Ge(_,"labelPointStyle",this,p)),l.push(Ge(_,"labelTextColor",this,p))}),this.labelColors=s,this.labelPointStyles=r,this.labelTextColors=l,this.dataPoints=c,c}update(t,e){const i=this.options.setContext(this.getContext()),s=this._active;let r,l=[];if(!s.length)this.opacity!==0&&(r={opacity:0});else{const c=Xo[i.position].call(this,s,this._eventPosition);l=this._createItems(i),this.title=this.getTitle(l,i),this.beforeBody=this.getBeforeBody(l,i),this.body=this.getBody(l,i),this.afterBody=this.getAfterBody(l,i),this.footer=this.getFooter(l,i);const f=this._size=qT(this,i),d=Object.assign({},c,f),p=KT(this.chart,i,d),_=ZT(i,d,p,this.chart);this.xAlign=p.xAlign,this.yAlign=p.yAlign,r={opacity:1,x:_.x,y:_.y,width:f.width,height:f.height,caretX:c.x,caretY:c.y}}this._tooltipItems=l,this.$context=void 0,r&&this._resolveAnimations().update(this,r),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,s){const r=this.getCaretPosition(t,i,s);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}getCaretPosition(t,e,i){const{xAlign:s,yAlign:r}=this,{caretSize:l,cornerRadius:c}=i,{topLeft:f,topRight:d,bottomLeft:p,bottomRight:_}=rl(c),{x:y,y:b}=t,{width:x,height:T}=e;let A,E,D,C,O,k;return r==="center"?(O=b+T/2,s==="left"?(A=y,E=A-l,C=O+l,k=O-l):(A=y+x,E=A+l,C=O-l,k=O+l),D=A):(s==="left"?E=y+Math.max(f,p)+l:s==="right"?E=y+x-Math.max(d,_)-l:E=this.caretX,r==="top"?(C=b,O=C-l,A=E-l,D=E+l):(C=b+T,O=C+l,A=E+l,D=E-l),k=C),{x1:A,x2:E,x3:D,y1:C,y2:O,y3:k}}drawTitle(t,e,i){const s=this.title,r=s.length;let l,c,f;if(r){const d=_a(i.rtl,this.x,this.width);for(t.x=gu(this,i.titleAlign,i),e.textAlign=d.textAlign(i.titleAlign),e.textBaseline="middle",l=ze(i.titleFont),c=i.titleSpacing,e.fillStyle=i.titleColor,e.font=l.string,f=0;f<r;++f)e.fillText(s[f],d.x(t.x),t.y+l.lineHeight/2),t.y+=l.lineHeight+c,f+1===r&&(t.y+=i.titleMarginBottom-c)}}_drawColorBox(t,e,i,s,r){const l=this.labelColors[i],c=this.labelPointStyles[i],{boxHeight:f,boxWidth:d}=r,p=ze(r.bodyFont),_=gu(this,"left",r),y=s.x(_),b=f<p.lineHeight?(p.lineHeight-f)/2:0,x=e.y+b;if(r.usePointStyle){const T={radius:Math.min(d,f)/2,pointStyle:c.pointStyle,rotation:c.rotation,borderWidth:1},A=s.leftForLtr(y,d)+d/2,E=x+f/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,_g(t,T,A,E),t.strokeStyle=l.borderColor,t.fillStyle=l.backgroundColor,_g(t,T,A,E)}else{t.lineWidth=Ft(l.borderWidth)?Math.max(...Object.values(l.borderWidth)):l.borderWidth||1,t.strokeStyle=l.borderColor,t.setLineDash(l.borderDash||[]),t.lineDashOffset=l.borderDashOffset||0;const T=s.leftForLtr(y,d),A=s.leftForLtr(s.xPlus(y,1),d-2),E=rl(l.borderRadius);Object.values(E).some(D=>D!==0)?(t.beginPath(),t.fillStyle=r.multiKeyBackground,mg(t,{x:T,y:x,w:d,h:f,radius:E}),t.fill(),t.stroke(),t.fillStyle=l.backgroundColor,t.beginPath(),mg(t,{x:A,y:x+1,w:d-2,h:f-2,radius:E}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(T,x,d,f),t.strokeRect(T,x,d,f),t.fillStyle=l.backgroundColor,t.fillRect(A,x+1,d-2,f-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:s}=this,{bodySpacing:r,bodyAlign:l,displayColors:c,boxHeight:f,boxWidth:d,boxPadding:p}=i,_=ze(i.bodyFont);let y=_.lineHeight,b=0;const x=_a(i.rtl,this.x,this.width),T=function(q){e.fillText(q,x.x(t.x+b),t.y+y/2),t.y+=y+r},A=x.textAlign(l);let E,D,C,O,k,z,Y;for(e.textAlign=l,e.textBaseline="middle",e.font=_.string,t.x=gu(this,A,i),e.fillStyle=i.bodyColor,jt(this.beforeBody,T),b=c&&A!=="right"?l==="center"?d/2+p:d+2+p:0,O=0,z=s.length;O<z;++O){for(E=s[O],D=this.labelTextColors[O],e.fillStyle=D,jt(E.before,T),C=E.lines,c&&C.length&&(this._drawColorBox(e,t,O,x,i),y=Math.max(_.lineHeight,f)),k=0,Y=C.length;k<Y;++k)T(C[k]),y=_.lineHeight;jt(E.after,T)}b=0,y=_.lineHeight,jt(this.afterBody,T),t.y-=r}drawFooter(t,e,i){const s=this.footer,r=s.length;let l,c;if(r){const f=_a(i.rtl,this.x,this.width);for(t.x=gu(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=f.textAlign(i.footerAlign),e.textBaseline="middle",l=ze(i.footerFont),e.fillStyle=i.footerColor,e.font=l.string,c=0;c<r;++c)e.fillText(s[c],f.x(t.x),t.y+l.lineHeight/2),t.y+=l.lineHeight+i.footerSpacing}}drawBackground(t,e,i,s){const{xAlign:r,yAlign:l}=this,{x:c,y:f}=t,{width:d,height:p}=i,{topLeft:_,topRight:y,bottomLeft:b,bottomRight:x}=rl(s.cornerRadius);e.fillStyle=s.backgroundColor,e.strokeStyle=s.borderColor,e.lineWidth=s.borderWidth,e.beginPath(),e.moveTo(c+_,f),l==="top"&&this.drawCaret(t,e,i,s),e.lineTo(c+d-y,f),e.quadraticCurveTo(c+d,f,c+d,f+y),l==="center"&&r==="right"&&this.drawCaret(t,e,i,s),e.lineTo(c+d,f+p-x),e.quadraticCurveTo(c+d,f+p,c+d-x,f+p),l==="bottom"&&this.drawCaret(t,e,i,s),e.lineTo(c+b,f+p),e.quadraticCurveTo(c,f+p,c,f+p-b),l==="center"&&r==="left"&&this.drawCaret(t,e,i,s),e.lineTo(c,f+_),e.quadraticCurveTo(c,f,c+_,f),e.closePath(),e.fill(),s.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,s=i&&i.x,r=i&&i.y;if(s||r){const l=Xo[t.position].call(this,this._active,this._eventPosition);if(!l)return;const c=this._size=qT(this,t),f=Object.assign({},l,this._size),d=KT(e,t,f),p=ZT(t,f,d,e);(s._to!==p.x||r._to!==p.y)&&(this.xAlign=d.xAlign,this.yAlign=d.yAlign,this.width=c.width,this.height=c.height,this.caretX=l.x,this.caretY=l.y,this._resolveAnimations().update(this,p))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const s={width:this.width,height:this.height},r={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const l=Nn(e.padding),c=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&c&&(t.save(),t.globalAlpha=i,this.drawBackground(r,t,s,e),$3(t,e.textDirection),r.y+=l.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),X3(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,s=t.map(({datasetIndex:c,index:f})=>{const d=this.chart.getDatasetMeta(c);if(!d)throw new Error("Cannot find a dataset at index "+c);return{datasetIndex:c,element:d.data[f],index:f}}),r=!qu(i,s),l=this._positionChanged(s,e);(r||l)&&(this._active=s,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,r=this._active||[],l=this._getActiveElements(t,r,e,i),c=this._positionChanged(l,t),f=e||!qu(l,r)||c;return f&&(this._active=l,(s.enabled||s.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),f}_getActiveElements(t,e,i,s){const r=this.options;if(t.type==="mouseout")return[];if(!s)return e.filter(c=>this.chart.data.datasets[c.datasetIndex]&&this.chart.getDatasetMeta(c.datasetIndex).controller.getParsed(c.index)!==void 0);const l=this.chart.getElementsAtEventForMode(t,r.mode,r,i);return r.reverse&&l.reverse(),l}_positionChanged(t,e){const{caretX:i,caretY:s,options:r}=this,l=Xo[r.position].call(this,t,e);return l!==!1&&(i!==l.x||s!==l.y)}}var z8={id:"tooltip",_element:JT,positioners:Xo,afterInit(n,t,e){e&&(n.tooltip=new JT({chart:n,options:e}))},beforeUpdate(n,t,e){n.tooltip&&n.tooltip.initialize(e)},reset(n,t,e){n.tooltip&&n.tooltip.initialize(e)},afterDraw(n){const t=n.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(n.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",e)}},afterEvent(n,t){if(n.tooltip){const e=t.replay;n.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,t)=>t.bodyFont.size,boxWidth:(n,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:uS},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const V8=(n,t,e,i)=>(typeof t=="string"?(e=n.push(t)-1,i.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function H8(n,t,e,i){const s=n.indexOf(t);if(s===-1)return V8(n,t,e,i);const r=n.lastIndexOf(t);return s!==r?e:s}const j8=(n,t)=>n===null?null:Cn(Math.round(n),0,t);function t1(n){const t=this.getLabels();return n>=0&&n<t.length?t[n]:n}class W8 extends Pa{static id="category";static defaults={ticks:{callback:t1}};constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const i=this.getLabels();for(const{index:s,label:r}of e)i[s]===r&&i.splice(s,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(Jt(t))return null;const i=this.getLabels();return e=isFinite(e)&&i[e]===t?e:H8(i,t,It(e,t),this._addedLabels),j8(e,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),e||(s=this.getLabels().length-1)),this.min=i,this.max=s}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,s=[];let r=this.getLabels();r=t===0&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let l=t;l<=e;l++)s.push({value:l});return s}getLabelForValue(t){return t1.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}function $8(n,t){const e=[],{bounds:s,step:r,min:l,max:c,precision:f,count:d,maxTicks:p,maxDigits:_,includeBounds:y}=n,b=r||1,x=p-1,{min:T,max:A}=t,E=!Jt(l),D=!Jt(c),C=!Jt(d),O=(A-T)/(_+1);let k=sT((A-T)/x/b)*b,z,Y,q,G;if(k<1e-14&&!E&&!D)return[{value:T},{value:A}];G=Math.ceil(A/k)-Math.floor(T/k),G>x&&(k=sT(G*k/x/b)*b),Jt(f)||(z=Math.pow(10,f),k=Math.ceil(k*z)/z),s==="ticks"?(Y=Math.floor(T/k)*k,q=Math.ceil(A/k)*k):(Y=T,q=A),E&&D&&r&&EU((c-l)/r,k/1e3)?(G=Math.round(Math.min((c-l)/k,p)),k=(c-l)/G,Y=l,q=c):C?(Y=E?l:Y,q=D?c:q,G=d-1,k=(q-Y)/G):(G=(q-Y)/k,nl(G,Math.round(G),k/1e3)?G=Math.round(G):G=Math.ceil(G));const at=Math.max(rT(k),rT(Y));z=Math.pow(10,Jt(f)?at:f),Y=Math.round(Y*z)/z,q=Math.round(q*z)/z;let nt=0;for(E&&(y&&Y!==l?(e.push({value:l}),Y<l&&nt++,nl(Math.round((Y+nt*k)*z)/z,l,e1(l,O,n))&&nt++):Y<l&&nt++);nt<G;++nt){const ot=Math.round((Y+nt*k)*z)/z;if(D&&ot>c)break;e.push({value:ot})}return D&&y&&q!==c?e.length&&nl(e[e.length-1].value,c,e1(c,O,n))?e[e.length-1].value=c:e.push({value:c}):(!D||q===c)&&e.push({value:q}),e}function e1(n,t,{horizontal:e,minRotation:i}){const s=Ks(i),r=(e?Math.sin(s):Math.cos(s))||.001,l=.75*t*(""+n).length;return Math.min(t/r,l)}class X8 extends Pa{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return Jt(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:s,max:r}=this;const l=f=>s=e?s:f,c=f=>r=i?r:f;if(t){const f=Ca(s),d=Ca(r);f<0&&d<0?c(0):f>0&&d>0&&l(0)}if(s===r){let f=r===0?1:Math.abs(r*.05);c(r+f),t||l(s-f)}this.min=s,this.max=r}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:i}=t,s;return i?(s=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),e=e||11),e&&(s=Math.min(e,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const s={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},r=this._range||this,l=$8(s,r);return t.bounds==="ticks"&&RU(l,this,"value"),t.reverse?(l.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),l}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const s=(i-e)/Math.max(t.length-1,1)/2;e-=s,i+=s}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return B3(t,this.chart.options.locale,this.options.ticks.format)}}class Y8 extends X8{static id="linear";static defaults={ticks:{callback:U3.formatters.numeric}};determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=kn(t)?t:0,this.max=kn(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=Ks(this.options.ticks.minRotation),s=(t?Math.sin(i):Math.cos(i))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/s))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}const gf={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Je=Object.keys(gf);function n1(n,t){return n-t}function i1(n,t){if(Jt(t))return null;const e=n._adapter,{parser:i,round:s,isoWeekday:r}=n._parseOpts;let l=t;return typeof i=="function"&&(l=i(l)),kn(l)||(l=typeof i=="string"?e.parse(l,i):e.parse(l)),l===null?null:(s&&(l=s==="week"&&(fl(r)||r===!0)?e.startOf(l,"isoWeek",r):e.startOf(l,s)),+l)}function s1(n,t,e,i){const s=Je.length;for(let r=Je.indexOf(n);r<s-1;++r){const l=gf[Je[r]],c=l.steps?l.steps:Number.MAX_SAFE_INTEGER;if(l.common&&Math.ceil((e-t)/(c*l.size))<=i)return Je[r]}return Je[s-1]}function q8(n,t,e,i,s){for(let r=Je.length-1;r>=Je.indexOf(e);r--){const l=Je[r];if(gf[l].common&&n._adapter.diff(s,i,l)>=t-1)return l}return Je[e?Je.indexOf(e):0]}function K8(n){for(let t=Je.indexOf(n)+1,e=Je.length;t<e;++t)if(gf[Je[t]].common)return Je[t]}function r1(n,t,e){if(!e)n[t]=!0;else if(e.length){const{lo:i,hi:s}=y_(e,t),r=e[i]>=t?e[i]:e[s];n[r]=!0}}function Z8(n,t,e,i){const s=n._adapter,r=+s.startOf(t[0].value,i),l=t[t.length-1].value;let c,f;for(c=r;c<=l;c=+s.add(c,1,i))f=e[c],f>=0&&(t[f].major=!0);return t}function a1(n,t,e){const i=[],s={},r=t.length;let l,c;for(l=0;l<r;++l)c=t[l],s[c]=l,i.push({value:c,major:!1});return r===0||!e?i:Z8(n,i,s,e)}class o1 extends Pa{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const i=t.time||(t.time={}),s=this._adapter=new rL._date(t.adapters.date);s.init(e),el(i.displayFormats,s.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:i1(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:s,max:r,minDefined:l,maxDefined:c}=this.getUserBounds();function f(d){!l&&!isNaN(d.min)&&(s=Math.min(s,d.min)),!c&&!isNaN(d.max)&&(r=Math.max(r,d.max))}(!l||!c)&&(f(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&f(this.getMinMax(!1))),s=kn(s)&&!isNaN(s)?s:+e.startOf(Date.now(),i),r=kn(r)&&!isNaN(r)?r:+e.endOf(Date.now(),i)+1,this.min=Math.min(s,r-1),this.max=Math.max(s+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,s=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const r=this.min,l=this.max,c=DU(s,r,l);return this._unit=e.unit||(i.autoSkip?s1(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):q8(this,c.length,e.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:K8(this._unit),this.initOffsets(s),t.reverse&&c.reverse(),a1(this,c,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,i=0,s,r;this.options.offset&&t.length&&(s=this.getDecimalForValue(t[0]),t.length===1?e=1-s:e=(this.getDecimalForValue(t[1])-s)/2,r=this.getDecimalForValue(t[t.length-1]),t.length===1?i=r:i=(r-this.getDecimalForValue(t[t.length-2]))/2);const l=t.length<3?.5:.25;e=Cn(e,0,l),i=Cn(i,0,l),this._offsets={start:e,end:i,factor:1/(e+1+i)}}_generate(){const t=this._adapter,e=this.min,i=this.max,s=this.options,r=s.time,l=r.unit||s1(r.minUnit,e,i,this._getLabelCapacity(e)),c=It(s.ticks.stepSize,1),f=l==="week"?r.isoWeekday:!1,d=fl(f)||f===!0,p={};let _=e,y,b;if(d&&(_=+t.startOf(_,"isoWeek",f)),_=+t.startOf(_,d?"day":l),t.diff(i,e,l)>1e5*c)throw new Error(e+" and "+i+" are too far apart with stepSize of "+c+" "+l);const x=s.ticks.source==="data"&&this.getDataTimestamps();for(y=_,b=0;y<i;y=+t.add(y,c,l),b++)r1(p,y,x);return(y===i||s.bounds==="ticks"||b===1)&&r1(p,y,x),Object.keys(p).sort(n1).map(T=>+T)}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}format(t,e){const s=this.options.time.displayFormats,r=this._unit,l=e||s[r];return this._adapter.format(t,l)}_tickFormatFunction(t,e,i,s){const r=this.options,l=r.ticks.callback;if(l)return ne(l,[t,e,i],this);const c=r.time.displayFormats,f=this._unit,d=this._majorUnit,p=f&&c[f],_=d&&c[d],y=i[e],b=d&&_&&y&&y.major;return this._adapter.format(t,s||(b?_:p))}generateTickLabels(t){let e,i,s;for(e=0,i=t.length;e<i;++e)s=t[e],s.label=this._tickFormatFunction(s.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,s=Ks(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(s),l=Math.sin(s),c=this._resolveTickFontOptions(0).size;return{w:i*r+c*l,h:i*l+c*r}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,s=i[e.unit]||i.millisecond,r=this._tickFormatFunction(t,0,a1(this,[t],this._majorUnit),s),l=this._getLabelSize(r),c=Math.floor(this.isHorizontal()?this.width/l.w:this.height/l.h)-1;return c>0?c:1}getDataTimestamps(){let t=this._cache.data||[],e,i;if(t.length)return t;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(e=0,i=s.length;e<i;++e)t=t.concat(s[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const s=this.getLabels();for(e=0,i=s.length;e<i;++e)t.push(i1(this,s[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return NU(t.sort(n1))}}function _u(n,t,e){let i=0,s=n.length-1,r,l,c,f;e?(t>=n[i].pos&&t<=n[s].pos&&({lo:i,hi:s}=Zs(n,"pos",t)),{pos:r,time:c}=n[i],{pos:l,time:f}=n[s]):(t>=n[i].time&&t<=n[s].time&&({lo:i,hi:s}=Zs(n,"time",t)),{time:r,pos:c}=n[i],{time:l,pos:f}=n[s]);const d=l-r;return d?c+(f-c)*(t-r)/d:c}class c5 extends o1{static id="timeseries";static defaults=o1.defaults;constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=_u(e,this.min),this._tableRange=_u(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,s=[],r=[];let l,c,f,d,p;for(l=0,c=t.length;l<c;++l)d=t[l],d>=e&&d<=i&&s.push(d);if(s.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(l=0,c=s.length;l<c;++l)p=s[l+1],f=s[l-1],d=s[l],Math.round((p+f)/2)!==d&&r.push({time:d,pos:l/(c-1)});return r}_generate(){const t=this.min,e=this.max;let i=super.getDataTimestamps();return(!i.includes(t)||!i.length)&&i.splice(0,0,t),(!i.includes(e)||i.length===1)&&i.push(e),i.sort((s,r)=>s-r)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return e.length&&i.length?t=this.normalize(e.concat(i)):t=e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(_u(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return _u(this._table,i*this._tableRange+this._minPos,!0)}}const fS="label";function l1(n,t){typeof n=="function"?n(t):n&&(n.current=t)}function Q8(n,t){const e=n.options;e&&t&&Object.assign(e,t)}function hS(n,t){n.labels=t}function dS(n,t,e=fS){const i=[];n.datasets=t.map(s=>{const r=n.datasets.find(l=>l[e]===s[e]);return!r||!s.data||i.includes(r)?{...s}:(i.push(r),Object.assign(r,s),r)})}function G8(n,t=fS){const e={labels:[],datasets:[]};return hS(e,n.labels),dS(e,n.datasets,t),e}function J8(n,t){const{height:e=150,width:i=300,redraw:s=!1,datasetIdKey:r,type:l,data:c,options:f,plugins:d=[],fallbackContent:p,updateMode:_,...y}=n,b=At.useRef(null),x=At.useRef(null),T=()=>{b.current&&(x.current=new pf(b.current,{type:l,data:G8(c,r),options:f&&{...f},plugins:d}),l1(t,x.current))},A=()=>{l1(t,null),x.current&&(x.current.destroy(),x.current=null)};return At.useEffect(()=>{!s&&x.current&&f&&Q8(x.current,f)},[s,f]),At.useEffect(()=>{!s&&x.current&&hS(x.current.config.data,c.labels)},[s,c.labels]),At.useEffect(()=>{!s&&x.current&&c.datasets&&dS(x.current.config.data,c.datasets,r)},[s,c.datasets]),At.useEffect(()=>{x.current&&(s?(A(),setTimeout(T)):x.current.update(_))},[s,f,c.labels,c.datasets,_]),At.useEffect(()=>{x.current&&(A(),setTimeout(T))},[l]),At.useEffect(()=>(T(),()=>A()),[]),qt.jsx("canvas",{ref:b,role:"img",height:e,width:i,...y,children:p})}const t5=At.forwardRef(J8);function e5(n,t){return pf.register(t),At.forwardRef((e,i)=>qt.jsx(t5,{...e,ref:i,type:n}))}const n5=e5("line",sL);pf.register(W8,Y8,A8,S8,P8,z8,O8);function i5({data:n,hoverInfo:t}){if(!n||n.length===0)return qt.jsx("div",{className:"dashboard loading",children:"Loading data..."});const e=Math.max(...n.map(c=>c.magnitude)),i=Math.min(...n.map(c=>c.magnitude)),s=n.reduce((c,f)=>c+f.magnitude,0)/n.length,r={labels:n.map((c,f)=>f),datasets:[{label:"Magnitude (T)",data:n.map(c=>c.magnitude),borderColor:"rgb(255, 99, 132)",backgroundColor:"rgba(255, 99, 132, 0.5)",pointRadius:0,borderWidth:1}]},l={responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Magnetic Field Magnitude",color:"#fff"}},scales:{x:{display:!1},y:{grid:{color:"#333"},ticks:{color:"#ccc"}}}};return qt.jsxs("div",{className:"dashboard",children:[qt.jsx("h2",{children:"IRM Magnet View"}),qt.jsxs("div",{className:"stats",children:[qt.jsxs("div",{className:"stat-item",children:[qt.jsx("span",{className:"label",children:"Max"}),qt.jsxs("span",{className:"value",children:[e.toFixed(2)," T"]})]}),qt.jsxs("div",{className:"stat-item",children:[qt.jsx("span",{className:"label",children:"Min"}),qt.jsxs("span",{className:"value",children:[i.toFixed(2)," T"]})]}),qt.jsxs("div",{className:"stat-item",children:[qt.jsx("span",{className:"label",children:"Avg"}),qt.jsxs("span",{className:"value",children:[s.toFixed(2)," T"]})]})]}),qt.jsx("div",{className:"chart-container",children:qt.jsx(n5,{data:r,options:l})}),t&&t.object&&qt.jsxs("div",{className:"hover-info",children:[qt.jsx("h3",{children:"Current Point"}),qt.jsxs("p",{children:["Mag: ",t.object.magnitude.toFixed(2)," T"]}),qt.jsxs("p",{children:["X: ",t.object.mag_x.toFixed(2)]}),qt.jsxs("p",{children:["Y: ",t.object.mag_y.toFixed(2)]}),qt.jsxs("p",{children:["Z: ",t.object.mag_z.toFixed(2)]})]})]})}async function s5(n="/data.geojson"){try{const t=await fetch(n);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();return console.log("GeoJSON loaded:",e),e.features.map(i=>({time:i.properties.time,coordinates:i.geometry.coordinates,mag_x:i.properties.mag_x,mag_y:i.properties.mag_y,mag_z:i.properties.mag_z,magnitude:i.properties.magnitude}))}catch(t){return console.error("Failed to load data:",t),[]}}function r5(){const[n,t]=At.useState([]),[e,i]=At.useState({longitude:5.97,latitude:45.546,zoom:16,pitch:45,bearing:0}),[s,r]=At.useState(null);return At.useEffect(()=>{console.log("Loading data..."),s5().then(l=>{console.log("Data loaded:",l.length,"points"),t(l)}).catch(l=>console.error("Error loading data:",l))},[]),At.useEffect(()=>{if(n.length>0){const l=Math.floor(n.length/2);console.log("Centering map on:",n[l].coordinates),i(c=>({...c,longitude:n[l].coordinates[0],latitude:n[l].coordinates[1]}))}},[n]),qt.jsxs("div",{className:"app-container",children:[qt.jsx(XB,{data:n,viewState:e,onViewStateChange:i,setHoverInfo:r}),qt.jsx(i5,{data:n,hoverInfo:s})]})}Xw.createRoot(document.getElementById("root")).render(qt.jsx(r5,{}));
